const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pageIm-yScSA0Mt.js","./index-CTd46-d9.js","./index-BeWLCHqW.css","./page-C1qLJvvz.js","./pageSignUp-DxpXInBo.js","./loginPage-BpEoSn3G.js","./avatar-CgVSdQqn.js","./putPreloader-B9hRs7f6.js","./pagePassword-C5yF6n4z.js","./htmlToSpan-DhAls8qz.js"])))=>i.map(i=>d[i]);
import{a as d,c as A,d as C,s as b,e as E,i as g,r as y,f as S,g as F,_ as c,m as k}from"./index-CTd46-d9.js";import{P as L}from"./page-C1qLJvvz.js";import T from"./pageSignIn-giBDf9YW.js";import"./putPreloader-B9hRs7f6.js";import"./pageSignQR-CSBiMz1o.js";import"./textToSvgURL-Cnw_Q8Rw.js";import"./countryInputField-Cu1ppnXS.js";class w{constructor(t,e){this.inputField=t,this.size=e,this.max=45,this.needFrame=0,this.container=document.createElement("div"),this.container.classList.add("media-sticker-wrapper");const i=t.input;i.addEventListener("blur",()=>{this.playAnimation(0)}),i.addEventListener("input",l=>{this.playAnimation(t.value.length)})}playAnimation(t){if(!this.animation)return;t=Math.min(t,30);let e;t?(e=Math.round(Math.min(this.max,t)*(165/this.max)+11.33),this.idleAnimation&&(this.idleAnimation.stop(!0),this.idleAnimation.canvas[0].style.display="none"),this.animation.canvas[0].style.display=""):e=0;const i=this.needFrame>e?-1:1;this.animation.setDirection(i),this.needFrame!==0&&e===0&&this.animation.setSpeed(7),this.needFrame=e,this.animation.play()}load(){return this.loadPromise?this.loadPromise:this.loadPromise=Promise.all([d.loadAnimationAsAsset({container:this.container,loop:!0,autoplay:!0,width:this.size,height:this.size},"TwoFactorSetupMonkeyIdle").then(t=>(this.idleAnimation=t,this.inputField.value.length||t.play(),d.waitForFirstFrame(t))),d.loadAnimationAsAsset({container:this.container,loop:!1,autoplay:!1,width:this.size,height:this.size},"TwoFactorSetupMonkeyTracking").then(t=>(this.animation=t,this.inputField.value.length||(this.animation.canvas[0].style.display="none"),this.animation.addEventListener("enterFrame",e=>{(this.animation.direction===1&&e>=this.needFrame||this.animation.direction===-1&&e<=this.needFrame)&&(this.animation.setSpeed(1),this.animation.pause()),e===0&&this.needFrame===0&&this.idleAnimation&&(this.idleAnimation.canvas[0].style.display="",this.idleAnimation.play(),this.animation.canvas[0].style.display="none")}),d.waitForFirstFrame(t)))])}remove(){this.animation&&this.animation.remove(),this.idleAnimation&&this.idleAnimation.remove()}}class P extends A{constructor(t){super(Object.assign(t,{plainText:!0})),this.options=t;const e=this.input;e.type="tel",e.setAttribute("required",""),e.autocomplete="off";let i=0;this.input.addEventListener("input",l=>{this.input.classList.remove("error"),this.setLabel();const n=this.value.replace(/\D/g,"").slice(0,t.length);this.setValueSilently(n);const p=this.value.length;if(p===t.length)t.onFill(this.value);else if(p===i)return;i=p})}}let r=null,_=null,f=null,o,s,h,m;const v=()=>{setTimeout(()=>{h?.remove(),m?.remove()},300)},D=a=>{o.setAttribute("disabled","true");const t={phone_number:r.phone_number,phone_code_hash:r.phone_code_hash,phone_code:a};y.managers.apiManager.invokeApi("auth.signIn",t,{ignoreErrors:!0}).then(async e=>{switch(e._){case"auth.authorization":await y.managers.apiManager.setUser(e.user),c(()=>import("./pageIm-yScSA0Mt.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(i=>{i.default.mount()}),v();break;case"auth.authorizationSignUpRequired":c(()=>import("./pageSignUp-DxpXInBo.js"),__vite__mapDeps([4,1,2,5,3,6,7]),import.meta.url).then(i=>{i.default.mount({phone_number:r.phone_number,phone_code_hash:r.phone_code_hash})}),v();break}}).catch(async e=>{let i=!1;switch(e.type){case"SESSION_PASSWORD_NEEDED":i=!0,await(await c(async()=>{const{default:l}=await import("./pagePassword-C5yF6n4z.js");return{default:l}},__vite__mapDeps([8,1,2,7,3,5,9]),import.meta.url)).default.mount(),setTimeout(()=>{o.value=""},300);break;case"PHONE_CODE_EXPIRED":o.classList.add("error"),E(s.label,g("PHONE_CODE_EXPIRED"));break;case"PHONE_CODE_EMPTY":case"PHONE_CODE_INVALID":o.classList.add("error"),E(s.label,g("PHONE_CODE_INVALID"));break;default:s.label.innerText=e.type;break}i||s.select(),o.removeAttribute("disabled")})},I=()=>{u.pageEl.querySelector(".input-wrapper").append(s.container);const a=u.pageEl.querySelector(".phone-edit");a.append(S("edit")),F(a,()=>T.mount())},O=()=>{const a=u.pageEl.querySelector(".auth-image"),t=k.isMobile?100:166;if(r.type._==="auth.sentCodeTypeFragmentSms"){a.firstElementChild&&(h?.remove(),h=void 0,a.replaceChildren());const e=document.createElement("div");return e.classList.add("media-sticker-wrapper"),a.append(e),d.loadAnimationAsAsset({container:e,loop:!0,autoplay:!0,width:t,height:t},"jolly_roger").then(i=>(m=i,d.waitForFirstFrame(i))).then(()=>{})}else return a.firstElementChild&&(m?.remove(),m=void 0,a.replaceChildren()),h=new w(s,t),a.append(h.container),h.load()},u=new L("page-authCode",!0,I,a=>{if(r=a,!_)_=u.pageEl.getElementsByClassName("phone")[0],f=u.pageEl.getElementsByClassName("sent-type")[0];else{o.value="";const n=document.createEvent("HTMLEvents");n.initEvent("input",!1,!0),o.dispatchEvent(n)}const t=r.type.length;s||(s=new P({label:"Code",name:C(),length:t,onFill:n=>{D(n)}}),o=s.input),s.options.length=t,_.innerText=r.phone_number;let e,i;const l=r.type;switch(l._){case"auth.sentCodeTypeSms":e="Login.Code.SentSms";break;case"auth.sentCodeTypeApp":e="Login.Code.SentInApp";break;case"auth.sentCodeTypeCall":e="Login.Code.SentCall";break;case"auth.sentCodeTypeFragmentSms":e="PhoneNumber.Code.Fragment.Info";const n=document.createElement("a");b(n),n.href=l.url,i=[n];break;default:e="Login.Code.SentUnknown",i=[l._];break}return E(f,g(e,i)),y.managers.appStateManager.pushToState("authState",{_:"authStateAuthCode",sentCode:a}),O().catch(()=>{})},()=>{o.focus()});export{u as default};
//# sourceMappingURL=pageAuthCode-85sav6uy.js.map
