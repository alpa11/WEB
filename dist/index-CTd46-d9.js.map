{"version":3,"mappings":"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,OACF,YACQ,EAEN,MACF,YACY,EAEV,UACF,eACU,EAER,QACF,cACY,EAEV,UACF,iBACM,EACJ,KACA,CACA,SACF,aAEE,EACF,wBAEE,EACF,0BAEE,EACF,gCAEE,EACF,wBAEE,EACF,gBACY,EAEV,UACF,gBACY,EAEV,YACF,iBACO,EAEL,KACF,YAEE,EACF,cAEE,EACF,cACU,EAER,QACF,oBAEE,EACF,UAEE,EACF,cAEE,EACF,YAEE,EACF,cACO,EAEL,KACF,YAEE,EACF,UAEE,EACF,sBAEE,EACF,4BAEE,EACF,UACY,EAEV,UACF,gBAEE,EACF,wBAEE,EACF,UACU,EAER,UACF,gBACY,EACV,WACA,CACA,UACF,iBAEE,EACF,kBAEE,EACF,cAEE,EACF,cACgB,EAEd,cACF,uBACa,EAEX,WACF,kBAEE,EACF,gCAEE,EACF,oBACQ,EAEN,MACF,WAEE,EACF,kBAEE,EACF,UAEE,EACF,UAEE,EACF,gBAEE,EACF,MAEE,EACF,YAEE,EACF,sBAEE,EACF,UAEE,EACF,cAEE,EACF,YAEE,EACF,wCACiB,EAEf,iBACF,iBACiB,EAEf,iBACF,0BACU,EAER,QACF,qBACkB,EAEhB,kBACF,UAEE,EACF,YAEE,EACF,4BAEE,EACF,gBACO,EAEL,KACF,WAEE,EACF,gBAEE,EACF,UAEE,EACF,UAEE,EACF,kCAEE,EACF,UAEE,EACF,gBACiB,EACf,gBACA,CACA,gBACF,YAEE,EACF,cAEE,EACF,gBAEE,EACF,cAEE,EACF,sDAEE,EACF,YAEE,EACF,kBAEE,EACF,qCACsB,EAEpB,sBACF,yBAEE,EACF,kBAEE,EACF,iBAEE,EACF,oBAEE,EACF,gBACW,EAET,SACF,cAEE,EACF,UAEE,EACF,YACM,EAEJ,IACF,UACqB,EAEnB,qBACF,oBAEE,EACF,QACa,EAEX,aACF,oBAEE,EACF,gBAEE,EACF,kBAEE,EACF,gBAEE,EACF,YAEE,EACF,qBAEE,EACF,kBAEE,EACF,YACc,EACZ,WACA,CACA,aACF,gBACW,EAET,SACF,cAEE,EACF,YAEE,EACF,UAEE,EACF,YAEE,EACF,YAEE,EACF,8BAEE,EACF,wCACQ,EAEN,MACF,oBACO,EAEL,KACF,WAEE,EACF,YAEE,EACF,sBAEE,EACF,YAEE,EACF,0CACS,EAEP,OACF,aACW,EACT,UACA,CACA,SACA,YACF,sBAEE,EACF,qBAEE,EACF,UAEE,EACF,QAEE,EACF,MAEE,EACF,YAEE,EACF,cAEE,EACF,UAEE,EACF,6BAEE,EACF,kBAEE,EACF,oCAEE,EACF,cAEE,EACF,QACc,EAEZ,YACF,iBAEE,EACF,cACQ,EAEN,MACF,cAEE,EACF,cAEE,EACF,cAEE,EACF,gCAEE,EACF,cAEE,EACF,oCAEE,EACF,gBACU,EACR,OACA,CACA,SACF,UAEE,EACF,cACS,EACP,MACA,CACA,QACF,eAEE,EACF,cAEE,EACF,gBACY,EAEV,UACF,eAEE,EACF,gBACQ,EACN,KACA,CACA,OACA,QACF,oBAEE,EACF,wBAEE,EACF,iBAEE,EACF,iBAEE,EACF,kBAEE,EACF,sBAEE,EACF,oBAEE,EACF,YAEE,EACF,gBAEE,EACF,sBAEE,EACF,UAEE,EACF,kBAEE,EACF,oBAEE,EACF,cAEE,EACF,kBAEE,EACF,gBACc,EAEZ,YACF,mBAEE,EACF,YAEE,EACF,uCACoB,EAElB,oBACF,mBAEE,EACF,YAEE,EACF,YAEE,EACF,cAEE,EACF,cAEE,EACF,UAEE,EACF,UAEE,EACF,YACe,EAEb,eACF,mBAEE,EACF,cAEE,EACF,YAEE,EACF,gBACY,EAEV,UACF,iBAEE,EACF,QAEE,EACF,mBAEE,EACF,gBACU,EAER,QACF,uBAEE,EACF,sBAEE,EACF,kCACW,EAET,WACF,aACc,EAEZ,YACF,oBAEE,EACF,YAEE,EACF,gBACY,EAEV,UACF,sBAEE,EACF,iBACc,EACZ,WACA,CACA,aACF,cAEE,EACF,wBAEE,EACF,wBAEE,EACF,gBAEE,EACF,gBAEE,EACF,2BAEE,EACF,8BAEE,EACF,gBAEE,EACF,YAEE,EACF,UAEE,EACF,gBACa,EAEX,WACF,oBACU,EAER,QACF,aACM,EAEJ,MACF,aAEE,EACF,wBAEE,EACF,UAEE,EACF,YAEE,EACF,MACU,EAER,QACF,cACY,EAEV,YACF,gBAEE,EACF,kBAEE,EACF,kBAEE,EACF,gBAEE,EACF,YACW,EAET,UACF,aACY,EAEV,UACF,gBAEE,EACF,iCAEE,EACF,UAEE,EACF,oBACmB,EAEjB,mBACF,wBAEE,EACF,YAEE,EACF,UAEE,EACF,qBACiB,EACf,gBACA,CACA,gBACF,2BAEE,EACF,cAEE,EACF,sBAEE,EACF,gBACO,EAEL,KACF,aACuB,EAErB,uBACF,gBACiB,EAEf,iBACF,qBAEE,EACF,+BAEE,EACF,0BAEE,EACF,0CAEE,EACF,oBAEE,EACF,YAEE,EACF,oBAEE,EACF,wCACiB,EAEf,eACF,wBAEE,EACF,cAEE,EACF,uCAEE,EACF,gCAC0B,EAExB,0BACF,YAEE,EACF,iBAEE,EACF,iCAEE,EACF,UAEE,EACF,UAEE,EACF,2BAEE,EACF,YACU,EACR,OACA,CACA,SACF,gBACc,EAEZ,YACF,uBACgB,EACd,aACA,CACA,eACF,cAEE,EACF,4BAEE,EACF,MAEE,EACF,YAEE,EACF,oBAEE,EACF,kBAEE,EACF,YAEE,EACF,UACgB,EACd,eACA,CACA,eACF,UAEE,EACF,wBAEE,EACF,mBACW,EAET,WACF,kBAEE,EACF,YAEE,EACF,qBACoB,EAClB,mBACA,CACA,UACA,cACF,SAEE,EACF,YACS,EAEP,OACF,mBAEE,EACF,0BAEE,EACF,gBAEE,EACF,YAEE,OAEJ,KAEO,CAEP,QAEE,UAAQC,KAAiBD,GAAa,CAC9B,QAAOA,IAAwB,EACjBE,EAAA,QAAAD,EAAA,eAAc,QAAApgD,EAAA,EAAA0E,EAAA27C,EAAA,OAAArgD,EAAA0E,EAAA,EAAA1E,EAEtCsgD,GAAAD,EAAArgD,CAAA,GAAAogD,CAGE,CACA,SAAMG,KAA0B,CAChC,MAAAC,IAA4B,cACvBH,EAAMF,GAAkBG,GAAAE,CAAA,OACzB,UAAOC,KAAWJ,EAAY,GAAAK,GAAA,UAAAD,CAAA,EAChC,gBAAAA,EAAA,MAAAC,EAAA,EAM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","names":["MAIN_DOMAINS","DEFAULT_BACKGROUND_SLUG","threads","App","blurActiveElement","IS_TOUCH_SUPPORTED","ctx","USER_AGENT","IS_APPLE","IS_ANDROID","IS_CHROMIUM","CHROMIUM_VERSION","IS_APPLE_MOBILE","IS_SAFARI","IS_FIREFOX","IS_MOBILE_SAFARI","IS_MOBILE","findUpClassName","el","className","fastRafCallbacks","fastRaf","callback","currentCallbacks","cb","fastRafConventionalCallbacks","processing","fastRafConventional","i","rafPromise","fastRafPromise","resolve","doubleRaf","FontFamilyName","FontFamily","FontSize","FontWeight","FontFull","noop","pause","ms","TGICO_CLASS","_tgico","icon","texts","cache","fonts","loadFonts","types","promises","type","_texts","font","weights","weight","_promises","text","key","IS_EMOJI_SUPPORTED","CURRENT_ACCOUNT_QUERY_PARAM","MAX_ACCOUNTS_FREE","MAX_ACCOUNTS_PREMIUM","MAX_ACCOUNTS","makeWorkerURL","url","value","setWorkerProxy","workerHandler","target","args","w","toggleAttributePolyfill","name","force","NULL_PEER_ID","REPLIES_PEER_ID","REPLIES_HIDDEN_CHANNEL_ID","HIDDEN_PEER_ID","SERVICE_PEER_ID","MUTE_UNTIL","BOT_START_PARAM","MAX_FILE_SAVE_SIZE","THUMB_TYPE_FULL","TOPIC_COLORS","ATTACH_MENU_BOT_ICON_NAME","MESSAGE_ID_OFFSET","GENERAL_TOPIC_ID","T_ME_PREFIXES","SEND_WHEN_ONLINE_TIMESTAMP","SERVER_IMAGE_MIME_TYPES","STARS_CURRENCY","SEND_PAID_REACTION_DELAY","SEND_PAID_REACTION_ANONYMOUS_PEER_ID","FOLDER_ID_ALL","FOLDER_ID_ARCHIVE","REAL_FOLDERS","EventListenerBase","reuseResults","options","listenerObject","_a","obj","l","listener","result","error","err","collectResults","arr","listeners","Modes","IS_BETA","DEBUG","MOUNT_CLASS_TO","tabId","indexOfAndSplice","array","item","idx","IS_SERVICE_WORKER","IS_WEB_WORKER","IS_WORKER","getWindowClients","postMessage","notifyServiceWorker","all","notifyWorker","makeError","message","realError","_logTimer","dT","LogTypes","LOG_LEVELS","IS_WEBKIT","STYLES_SUPPORTED","LOGGER_STYLES","methods","logger","prefix","ignoreDebugReset","style","originalPrefix","originalStyle","log","method","logType","newPrefix","level","acc","v","prefixCache","_type","prefix2","USE_LOCKS","SuperMessagePort","logSuffix","event","task","source","taskId","deferred","payload","previousResolve","ret","reject","pingResolve","newEvent","id","innerTask","resultTaskPayload","resultTask","ackTask","isPromise","cached","port","promise","lock","port2","portTasks","tasks","batchTask","ports","transfer","withAck","_void","interval","TransferableResult","transferables","SuperMessagePort$1","MTProtoMessagePort","RootScope","isNew","isPremium","status","accountNumber","rootScope","deepEqual","x","y","ignoreKeys","ignoreSet","okok","ok","tx","safeAssign","object","fromObject","capitalizeFirstLetter","string","SKIP_PROTOCOLS","matchUrlProtocol","protocol","originalString","ALPHA_CHARS_REG_EXP","ALPHA_NUMERIC_REG_EXP","DOMAIN_ADD_CHARS","URL_ALPHANUMERIC_REG_EXP_PART","URL_PROTOCOL_REG_EXP_PART","URL_REG_EXP","USERNAME_REG_EXP","TIMESTAMP_REG_EXP","BOT_COMMAND_REG_EXP","FULL_REG_EXP","emojiRegExp","EMAIL_REG_EXP","MARKDOWN_REG_EXP","SITE_HASHTAGS","MARKDOWN_ENTITIES","PASS_CONFLICTING_ENTITIES","PASS_SINGLE_CONFLICTING_ENTITIES","PHONE_NUMBER_REG_EXP","wrapUrl","unsafe","out","tgMeMatch","tgMatch","onclick","u","fullPath","path","setInnerHTML","elem","html","setDirection","getDirection","setBlankToAnchor","anchor","equalFn","a","b","$PROXY","$TRACK","signalOptions","runEffects","runQueue","STALE","PENDING","UNOWNED","NO_INIT","Owner","Transition","ExternalSourceConfig","Listener","Updates","Effects","ExecCount","createRoot","fn","detachedOwner","owner","unowned","current","root","updateFn","untrack","cleanNode","runUpdates","createSignal","s","setter","writeSignal","readSignal","createComputed","c","createComputation","updateComputation","createRenderEffect","createEffect","runUserEffects","createReaction","onInvalidate","tracking","createMemo","createResource","pSource","pFetcher","pOptions","fetcher","pr","initP","scheduled","resolved","dynamic","contexts","setValue","setError","track","trigger","state","setState","loadEnd","p","completeLoad","read","SuspenseContext","load","refetching","lookup","e","castError","createSelector","subs","node","val","onCleanup","batch","on","deps","isArray","prevValue","input","defer","prevInput","onMount","getListener","getOwner","runWithOwner","o","prev","prevListener","handleError","startTransition","t","setTransPending","useTransition","transPending","createContext","defaultValue","createProvider","useContext","context","children","memo","resolveChildren","updates","lookUpstream","sSlot","isComp","TransitionRunning","markDownstream","time","runComputation","nextValue","init","pure","ancestors","wait","res","completeUpdates","queue","runTop","userLength","ignore","obs","index","n","results","props","FALLBACK","dispose","d","mapArray","list","mapFn","items","mapped","disposers","len","newItems","j","newLen","newIndices","newIndicesNext","temp","tempdisposers","tempIndexes","start","end","newEnd","indexes","disposer","mapper","set","createComponent","Comp","trueFn","_","property","receiver","resolveSource","resolveSources","length","mergeProps","sources","proxy","keys","propTraps","defined","sourceKeys","sourcesMap","desc","definedKeys","splitProps","blocked","k","otherObject","propName","isDefaultDesc","objects","objectIndex","For","fallback","Show","keyed","condition","child","narrowedError","getOldDatabaseState","getCommonDatabaseState","getDatabaseState","deferredHelper","noop$2","deferredPromise","_resolve","_reject","bindPromiseToDeferred","throttleWith","schedulerFn","shouldRunFirst","isPending","_args","waiting","_waiting","_IDB","db","createNew","createIndexes","store","indexNames","os","indexName","createObjectStore","request","finished","calledNew","transaction","instance","preserve","storage","dbName","IDB","IDBStorage","storeName","entryName","objectStore","entryName2","mode","perf","timeout","_db","onError","onComplete","requests","r","waitForTransactionComplete","callbackResult","left","onRequestFinished","entries","cursor","StaticUtilityClass","_DeferredIsUsingPasscode","DeferredIsUsingPasscode","toArray","bytes","decimals","strictDecimals","_decimals","dm","sizes","fixed","asyncThrottle","timeoutMs","lastArgs","timeoutId","wasCalledWhileRunning","runAfterTimeout","CryptoMessagePort","sendPortIndex","cryptoMessagePort","_EncryptionKeyStore","exportedKey","EncryptionKeyStore","_EncryptedStorageLayer","encryptedStoreName","startTime","encryptedData","encryptedDataSize","encryptionTime","endTime","f","formatBytesPure","data","dataAsBuffer","convertToUint8Array","decoded","storageData","decrypted","names","values","EncryptedStorageLayer","_AppStorage","store2","isEncryptable","useCache","onlyLocal","canUseStorage","setSomething","saveLocal","currentStorage","prevFreezed","enabled","clearWrite","shouldEncrypt","isEncrypted","entry","AppStorage","CommonStateStorage","commonStateStorage","settings","langPack","UNSUPPORTED_LANG_PACK_KEY","I18n","I18n2","setRTL","rtl","setLangCode","langCode","getCacheLangPack","cacheLangPackPromise","langPack2","applyLangPack","updateAmPm","dateTimeFormat","getDateTimeFormat","date","amText","pmText","setTimeFormat","format2","haveToUpdate","cachedDateTimeFormats","element","IntlDateElement","defaultCode","__vitePreload","lang","langSign","countries","strings","strings2","formatLocalStrings","saveLangPack","loadLocalLangPack","web","managers","getStrings","pushTo","getLangPack","loadLangPack","langPack1","localLangPack1","localLangPack2","_Intl","currentLangCode","pluralRules","langPackKey","country","pushNextArgument","indexHolder","arg","str","regExp","lastIndex","p1","p2","p3","p4","offset","superFormatter","wrappedUrl","formatted","match","plain","format","IntlElementBase","IntlElement","json","hours","i18n","i18n2","i18n_2","i18n_","_i18n2","_i18n","I18n$1","joinElementsWith","elements","joiner","isLast","join","useLast","joined","isAnyChat","peerId","isUser","isChat","newMethod","originMethod","bufferConcats","tmp","lastLength","onFinally","reason","WebpWorkerController","fileName","convertPromise","webpWorkerController","LocalStorage","stringified","lastError","preserveKeys","_LocalStorageController","encryptableKeys","methodName","filteredEntries","encryptedStorage","LocalStorageController","sessionStorage","cancelEvent","isSwipingBackSafari","AppNavigationController","hash","wasIndex","good","single","appNavigationController","AppRuntimeManager","removeHash","appRuntimeManager","copy","clonedObj","prop","IS_SHARED_WORKER_SUPPORTED","FOCUS_EVENT_NAME","IdleController","idle","idleController","CHECK_INSTANCE_INTERVAL","DEACTIVATE_TIMEOUT","MULTIPLE_TABS_THRESHOLD","IS_MULTIPLE_TABS_SUPPORTED","newInstance","curInstance","build","apiManagerProxy","singleInstance","clearMessageId","messageId","toServer","getServerMessageId","PING_PUSH_INTERVAL","reg","subscription","ACTIONS_LANG_MAP","action","successful","newSettings","subscriptionObj","mid","script","tsNow","seconds","canRedirect","curValue","ts","loadScript","IS_WEBRTC_SUPPORTED","CAN_USE_TRANSFERABLES","IS_CANVAS_FILTER_SUPPORTED","IS_GEOLOCATION_SUPPORTED","IS_GROUP_CALL_SUPPORTED","IS_WEBP_SUPPORTED","IMAGE_MIME_TYPES_SUPPORTED","possible","mime","img","supported","IMAGE_MIME_TYPES_SUPPORTED_PROMISE","mimeTypes","video","IS_WEBM_SUPPORTED","IS_MOV_SUPPORTED","MEDIA_MIME_TYPES_SUPPORTED","IS_PARALLAX_SUPPORTED","IS_SCREEN_SHARING_SUPPORTED","IS_VIBRATE_SUPPORTED","IS_OPUS_SUPPORTED","audio","extension","renderer","IS_APPLE_MX","IS_LIVE_STREAM_SUPPORTED","IS_CALL_SUPPORTED","VIDEO_MIME_TYPES_SUPPORTED","getTimeFormat","offsetWidth","STATE_VERSION$1","BUILD$1","DEFAULT_THEME","baseTheme","highlightingColor","SETTINGS_INIT","makeDefaultAppTheme","COMMON_STATE_INIT","compareVersion","v1","v2","s1","v12","v22","isObject","validateInitObject","initObject","currentObject","onReplace","previousKey","ignorePaths","_path","recordPromise","description","recordPromiseBound","StateStorage","AccountController","accountData","overrideAll","prevData","updatedData","upTo","toMove","toClear","authKeyKey","serverSaltKey","createStorages","storages","REFRESH_EVERY","STATE_VERSION","STATE_INIT","BUILD","ALL_KEYS","COMMON_KEYS","REFRESH_KEYS","AnyStateWriter","pushedKeys","pushToState","replaceState","_state","StateWriter","resetStorages","CommonStateWriter","STATE_STEPS","writer","SKIP_VALIDATING_PATHS","missingKey","newVersion","oldVersion","authKeyFingerprint","baseDcAuthKey","_authKeyFingerprint","loadStateForAccount","stateStorage","commonWriter","loadOldState","totalPerf","migrateToStateKeys","commonKeys","migrateToStateSettingsValues","settingsKeyIndex","auth","resetKeysPromise","callbacks","userAuth","fingerprint","resetKeys","moveStoragesToMultiAccountFormat","storagesNew","users","dialogs","toObject","chats","checkIfHasMultiAccount","deleteOldDatabase","applyBuildVersionToStorage","sessionBuild","loadStateForAllAccounts","hasMultiAccount","stateForFirstAccount","moveAccessKeysToMultiAccountFormat","rest","restPromise","loadStateForAllAccountsOnce","OpusDecodeController","typedArray","keepAlive","kill","pages","withWaveform","dataBlob","opusDecodeController","mimeType","blobConstruct","blobParts","blobSafeMimeType","safeMimeType","readBlobAs","blob","reader","readBlobAsArrayBuffer","readBlobAsUint8Array","MemoryWriter","size","saveFileCallback","part","newBytes","endOffset","saveToStorage","parts","cacheStorageDbConfig","_CacheStorageController","response","rejected","fileSize","_clearWrite","storageNames","storageName","encryptable","encryptableStorageNames","toggleStorages","CacheStorageController","ServiceMessagePort","ServiceWorkerURL","joinDeepPath","splitDeepPath","DEEP_PATH_JOINER","deleteIfUndefined","splitted","lastObject","lastKey","getFileNameByLocation","location","ext","FILENAME_JOINER","geoPoint","getFileURL","encoded","isWebFileLocation","getThumbKey","media","generateEmptyThumb","getStickerThumbKey","docId","toneIndex","smth","isLegacyMessageId","$RAW","$NODE","$HAS","$SELF","wrap$1","proxyTraps$1","isWrappable","proto","unwrap","unwrapped","getNodes","symbol","nodes","getNode","proxyDescriptor$1","trackSelf","ownKeys","tracked","setProperty","deleting","mergeStoreNode","updateArray","next","updatePath","traversed","partType","from","to","by","createStore","unwrappedStore","wrappedStore","setStore","proxyDescriptor","isFunction","wrap","proxyTraps","isClass","descriptors","get","og","createMutable","$ROOT","parent","merge","previous","keyVal","applyState","targetKeys","previousKeys","reconcile","_setAppState","appState","useAppState","getObjectKeysAndSort","sort","ids","createMemoOrReturn","valueOrGetter","usePeer","peerId2","useChat","chatId","chatId2","useUser","userId","userId2","reconcilePeer","peer","reconcilePeers","peers","getValidatedAccount","getCurrentAccountFromURL","urlString","params","DEBUG_MANAGER_REQUESTS","createProxy","ack","createProxyProxy","proxied2","createProxiedManagersForAccount","proxied","getCurrentAccount","limitSymbols","limitFrom","usernames","username","TLD","checkBrackets","urlLength","urlOpenBrackets","urlCloseBrackets","EmojiVersions","Emoji","version","encodeEmoji","emojiText","toCodePoints","removeVS16s","vs16RegExp","zeroWidthJoiner","rawEmoji","unicodeSurrogates","points","char","getEmojiToneIndex","VIRTUAL_COUNTRIES_EMOJIS","getCountryEmoji","iso2","emojiFromCodePoints","codePoints","getEmojiUnified","emojiCode","unified","parseEntities","raw","entities","rawOffset","matchIndex","tld","balanced","timestamp","splittedLength","minutes","buildURLHash","encodeEntities","value2","low","chars","charsLength","encodeSpoiler","entity","before","spoilerBefore","spoilerAfter","spoiler","after","isEmojiSupported","emoji","inlineEl","newEmojiWidth","legacyEmojiWidth","EMOJI_VERSIONS_SUPPORTED","lastMouseDownElement","CLICK_EVENT_NAME","attachClickEvent","hasMouseMovedSinceDown","add","simulateClickEvent","BOM","wrapTelegramUrlToAnchor","url1","isInDOM","forEachReverse","AnimationIntersector","group","animation","_animation","paused","override","found","player","observeElement","controlled","liteModeKey","locked","blurred","destroy","imitateIntersection","groups","group2","animations","safePlay","play","animationItem","changed","loop","animationIntersector","VisibilityIntersector","change","onVisibilityChange","visible","targets","findAndSpliceAll","verify","findAndSplice","throttle","clear","PARALLEL_LIMIT","IGNORE_ERRORS","LazyLoadQueueBase","parallelLimit","item2","eventListener","ANIMATION_START_EVENT","isAnimating","heavyAnimationPromise","promisesInQueue","log$2","dispatchHeavyAnimationEvent","_heavyAnimationPromise","onHeavyAnimationEnd","ANIMATION_END_EVENT","interruptHeavyAnimation","getHeavyAnimationPromise","useHeavyAnimationCheck","handleAnimationStart","handleAnimationEnd","listenerSetter","remove","LazyLoadQueueIntersector","ignoreHeavyAnimation","getPathFromBytes","num","outCanvas","outContext","computeLockColor","canvas","width","height","skipx","imageData","skipy","sr","sb","sa","sg","rgba","color","log$1","isDocumentHlsQualityFile","doc","hlsInstancesByVideo","src","middleware","Hls","hls","updateStreamInUse","inUse","createVideo","pip","originalSrc","newValue","initVideoHls","CRBUG_1250841_ERROR","isCrbug1250841Error","shouldIgnoreVideoError","isChromeBug","srcPromise","callbackify","onMediaLoad","readyState","useCanplayOnIos","loadEventName","errorEventName","onLoad","loadedURLs","renderImageFromUrl","processImageOnLoad","isVideo","isImage","loader","bytesFromHex","hexString","bytesToDataURL","JPEG_HEADER_HEX","JPEG_HEADER","JPEG_TAIL","getPreviewBytesFromURL","needle","sliced","jpegBytes","getPreviewURLFromBytes","isSticker","getPreviewURLFromThumb","photo","thumb","heavyQueue","addHeavyTask","processHeavyQueue","processingQueue","timedChunk","todo","realResult","possiblePromise","requireBlurPromise","fastBlurFunc","m","processBlurNext","radius","iterations","CACHE_SIZE","blur","dataUri","RADIUS","ITERATIONS","getImageFromStrippedThumb","useBlur","loadPromise","renderImageFromUrlPromise","calcImageInBox","imageW","boxW","boxH","noZoom","imageH","makeMediaSize","boxedImageW","boxedImageH","MediaSize","boxSize","fitted","ScreenSize2","ScreenSize","MOBILE_SIZE","FLOATING_LEFT_SIDEBAR_SIZE","MEDIUM_SIZE","LARGE_SIZE","CUSTOM_EMOJI_SIZE","ESG_CUSTOM_EMOJI_SIZE","EMOJI_STATUS_SIZE","MediaSizes","innerWidth","activeScreen","wasScreen","mediaSizes","clamp","min","max","IS_IMAGE_BITMAP_SUPPORTED","FramesCache","framesCache","CustomProperties","night","customProperties","getLottiePixelRatio","needUpscale","pixelRatio","applyColorOnContext","worker","_RLottiePlayer","skipRatio","clearPendingRAF","renderFirstFrame","curFrame","speed","direction","frameNo","frame","cachedSource","now","delta","frameNew","maxFrame","skipDelta","minFrame","bounds","renderIfPaused","frameCount","fps","diff","container","savingLottiePreview","isSavingLottiePreview","saving","sharedCanvas","sharedContext","createCanvas","saveLottiePreview","blob2","SequentialDom","kind","isConnected","sequentialDom","uploadId","file","getDocumentInputFileLocation","thumbSize","getDocumentDownloadOptions","queueId","onlyCache","inputFileLocation","getPhotoDownloadOptions","photoSize","isDocument","isPhoto","getWebDocumentDownloadOptions","webDocument","downloadOptions","getWebFileDownloadOptions","isWebDocument","getDownloadFileNameFromOptions","getDownloadMediaDetails","createDownloadAnchor","onRemove","AppDownloadManager","details","download","main","downloads","getPromise","promiseBefore","getFileNameForUpload","justAttach","USE_SW","getOutFileName","pingPromise","iframe","_iframe","onSuccess","onFinish","onDownloadRequestReceived","downloadId","hadProgress","onProgress","url2","choosePhotoSize","boxWidth","boxHeight","useBytes","pushDocumentSize","bestPhotoSize","getStickerEffectThumb","QueryableWorker","IS_WEB_ASSEMBLY_SUPPORTED","LottieLoader","reqId","remain","queryableWorker","newParams","cacheName","RLottiePlayer","players","containers","playersByCacheName","lottieLoader","MIDDLEWARE_ERROR","MiddlewareHelper","createDetails","helper","additionalCallback","getMiddleware","throttleWithRaf","createUnifiedSignal","args2","getter","WindowSize","windowSize","emojiAnimationContainer","stickerSize","side","fullThumb","withRandomOffset","relativeEffect","loopEffect","onUnmount","scrollable","textColor","_addOffsetX","_addOffsetY","animationDiv","unmountAnimation","middlewareHelper","onScroll","stickerPromise","wrapSticker","render","generateRandomSigned","randomOffsetX","randomOffsetY","setPosition","rect","factor","stableOffsetX","stableOffsetY","rectX","rectY","addOffsetX","addOffsetY","LiteMode","liteMode","Icons","IconsReverse","getIconContent","span","classes","setCurrentTime","USE_FIX","SHOULD_HANDLE_VIDEO_LEAK","onVideoLeak","firstElementChild","testVideoLeak","isLeak","bindPromise","onTimeUpdate","eventsOrder","eventsOrderLength","sawEvents","leakVideoFallbacks","events","normalized","fallbackCallback","attachVideoLeakListener","onVideoLeakListener","attachVideoLeakListeners","STICKER_EFFECT_MULTIPLIER","locksUrls","videosCache","onAnimationEnd","onEnd","onAnimationEnd2","_timeout","isEmptyContainer","childElementCount","getThumbFromContainer","div","loadStickerMiddleware","lazyLoadQueue","exportLoad","onlyThumb","withThumb","loadPromises","needFadeIn","asStatic","isOut","noPremium","withLock","isCustomEmoji","syncedVideo","isEffect","showPremiumInfo","stickerType","div2","getCacheContext","cacheContext","isAnimated","effectThumb","willHaveLock","Icon","lockUrl","customEmojiAttribute","attribute","lottieCachedThumbToneIndex","downloaded","isThumbNeededForType","lottieCachedThumb","loadThumbPromise","haveThumbCached","thumbImage","afterRender","ns","svg","load2","appDownloadManager","middlewareError","setLockColor","onFirstFrame","isSingleVideo","cachePromise","media2","onTimeupdate","previousTime","playedTimes","mediaLength","loaded","thumbImage2","videoWidth","videoHeight","ratio","h","reset","d2","detach","_media","lastPromise","promise2","attachStickerEffectHandler","fireStickerEffect","isAvailable","wrapStickerAnimation","getVisibleRect","overflowElement","lookForSticky","overflowRect","overflowTop","overflowRight","overflowLeft","sticky","overflowBottom","windowWidth","windowHeight","overflow","selector","extraSize","extraMinLength","invisibleTop","invisibleBottom","foundVisible","isVisible","visibleRect","replaceContent","firstChild","resizeObserverMap","resizeObserver","observeResize","unobserveResize","PAID_REACTION_EMOJI_DOCID","globalLazyLoadQueue","LazyLoadQueue","_CustomEmojiRendererElement","syncedPlayer","syncedPlayersFrames","syncedPlayers","clearRenderInterval","emojiRenderers","offsetsMap","elementsArr","getViewportSlice","offsets","elementRect","top","isDimensionsSet","dpr","isImageData","frameHeight","frameWidth","elementWidth","maxLeft","forceRenderAfter","newWidth","newHeight","renderEmojis","isPaidReactionEmoji","addCustomEmojis","usingOwnQueue","newElements","customEmojis","newElementsArray","isLottie","isStatic","attribute2","willHaveSyncedPlayer","CUSTOM_EMOJI_INSTANT_PLAY","_loadPromises","addition","readyPromise","placeholder","_p","player2","setRenderInterval","middleware2","addElements","docIds","docs","missing","wrapOptions","uncachedPromisesPromise","docs2","loadFromPromises","onRender","element2","cachedPromises","uncached","CustomEmojiRendererElement","emojiRenderInterval","renderers","r2","CUSTOM_EMOJI_FPS","CUSTOM_EMOJI_FRAME_INTERVAL","CustomEmojiElement","replaceChildren","createCustomFiller","CodeLanguageMap","language","aliases","CodeLanguageAliases","importPrismLanguage","lowerCase","alias","prism","importPrism","hadBefore","module","Prism","env","highlightCode","code","_language","imported","prism2","findIndexFrom","predicate","createElementFromMarkup","markup","instances","cancelAnimationByKey","getAnimationInstance","animateSingle","createAnimationInstance","tick","animate","callbackifyAll","getUnsafeRandomInt","_BluffSpoilerController","imageURL","onReconnect","weakRef","ref","reconnectCallback","BluffSpoilerController","NEWTON_ITERATIONS","NEWTON_MIN_SLOPE","SUBDIVISION_PRECISION","SUBDIVISION_MAX_ITERATIONS","kSplineTableSize","kSampleStepSize","A","aA1","aA2","B","C","calcBezier","aT","getSlope","binarySubdivide","aX","aA","aB","mX1","mX2","currentX","currentT","newtonRaphsonIterate","aGuessT","currentSlope","LinearEasing","BezierEasing","mY1","mY2","sampleValues","intervalStart","currentSample","lastSample","dist","guessForT","initialSlope","getTForX","rgbToHsv","g","hsvToRgb","rgbaToHsla","hslaToString","hsla","hslaToRgba","hue2rgb","q2","q","hslaStringToRgba","alpha","hexaToRgba","hexa","hexToRgb","hex","hexaToHsla","rgbaToHexa","hslaStringToHexa","hslaStringToHex","mixColors","color1","color2","computePerceivedBrightness","getAverageColor","getAccentColor","baseHsv","baseColor","elementColor","hsvTemp3","hsvTemp4","changeColorAccent","accentHsv","isDarkTheme","colorHsv","origBrightness","newBrightness","newColor","fallbackAmount","changeBrightness","amount","getHexColorFromTelegramColor","getRgbColorFromTelegramColor","getColorsFromWallPaper","wallPaper","rgbaToRgb","bg","calculateLuminance","rgb","getTextColor","luminance","calculateOpacity","targetTextLuminance","targetContrast","adaptiveOpacity","delay","withCurrentOwner","distance","vw","vh","getSnappedViewportsScale","vh1","vw2","vh2","snapToViewport","vw1","getContrastColor","lerp","progress","lerpArray","defaultEasing","simpleEasing","animateValue","duration","easing","canceled","currentTime","elapsed","currentValues","startVal","easedProgress","animateFrame","fontInfoMap","AnimationItemNested","getDefaultParticlesCount","_DotRenderer","multiply","config","shaderTextResult","shaderText","shader","gl","dt","draw","tempId","vertexShader","fragmentShader","program","shaders","animationGroup","rotate","flipX","flipY","transforms","drawClippingCircle","coords","maxDist","width2","height2","revealAnimation","transformedCoords","underLyingCtx","underlyingCanvasClickCoords","scaledProgress","maxDistUnderlyingCanvas","revealWithAnimation","underLyingCanvas","bcr","transX","transY","distToMargin","instanceCanvasWidth","instanceCanvasHeight","DotRenderer","utf16","output","extra","initial_n","initial_bias","delimiter","base","damp","tmin","tmax","skew","maxint","decode_digit","cp","adapt","numpoints","firsttime","decode","preserveCase","input_length","bias","basic","ic","oldi","digit","toUnicode","domain","domain_array","isMixedScriptUrl","hasLatin","hasNonLatin","createMarkupFormatting","formatting","scrollHeight","padding","isExpanded","makeQuoteCollapsable","collapseIcon","onQuoteResize","wrapRichText","fragment","wrapSomething","wrapElement","noFiller","lastElement","customWraps","nasty","passEntities","contextSite","contextExternal","textLength","startOffset","endPartOffset","nextEntity","partText","processingBlockElement","entityLanguage","content","languageName","header","headerName","headerWrapButton","fullEntityText","usedText","lastInnerEntityIndex","command","bot","atPos","customEmojiElement","isSupported","wrapped","hostname","masked","currentContext","href","contextUrl","hashtag","encodedLetter","foundNextLinebreakIndex","lastInnerLinebreakIndex","insertCustomFillers","notFiller","isCustomFillerNeededBySiblingNode","check","needed","previousSibling","nextSibling","wrapEmojiText","isDraft","getPeerTitle","plainText","onlyFirstName","limitSymbols$1","user","title","getPeerActiveUsernames","threadId","useManagers","NOTIFICATION_BADGE_PATH","createAppURLForAccount","hashParams","keepHash","filteredParams","hashSearchParams","_setAppSettings","appSettings","useAppSettings","setAppSettings","colorMap","coordinates","themeColorElem","darkModeMediaQuery","checkDarkMode","theme","highlightingRgba","silent","isNight","theme2","wasApplied","reverse","transition","endRadius","appliedColors","_options","appColorMap","lightenAlpha","darkenAlpha","mixColor","saveToCache","appColor","lightenedRgb","darkenedHsla","properties","name2","currentTheme","themes","themeSettings","themeSettings2","newAppTheme","hsvTemp1","baseColors","hsvTemp2","newAccentHex","newAccentRgb","applyAppColor","finalize","messageLightenAlpha","baseMessageColor","myMessagesAccent","nextColor","baseMessageOutBackgroundColor","accentColor2","newMessageOutBackgroundColor","messageOutBackgroundColorHsl","themePropertiesMap","themeParams","themeController","DialogColorsFg","DialogColors","_DialogColorsFg","getPeerColorIndexById","getPeerColorIndexByPeer","fgColor","hue","getPeerColorsByPeer","colorIndex","replaceColors","writeIn","peerColorOptions","dark","peerColorOption","colors","partSize","startValue","endValue","setPeerColors","newColors","peerProperty","borderBackgroundProperty","colorRgbProperty","gradient","myColors","colorProperty","borderBackground","makeColorsGradient","getEmojiEntityFromEmoji","EMOJI_REG_EXP","getAbbreviation","onlyFirst","firstEmojiMatch","first","lastEmojiMatch","last","drawCircle","fill","stroke","drawCircleFromStart","avatarCanvas","avatarContext","avatarGradients","createNotificationImage","peerTitle","peerPhoto","SIZE","getPeerAvatarColorByPeer","colorTop","colorBottom","abbreviation","fontSize","booleans","Properties","Aliases","PropAliases","getPropAlias","tagName","reconcileArrays","parentNode","bLength","aEnd","bEnd","aStart","bStart","map","sequence","$$EVENTS","insert","template","isCE","isSVG","create","eventNames","document","eventHandler","setAttribute","setAttributeNS","namespace","addEventListener","handler","delegate","handlerFn","classList","classKeys","prevKeys","toggleClassKey","classValue","nodeStyle","spread","skipChildren","prevProps","insertExpression","assign","use","accessor","initial","marker","skipRef","assignProp","toPropertyName","classNames","nameLen","isProp","isChildProp","propAlias","forceProp","DelegatedEvents","delegateEvents","ChildProperties","SVGNamespace","unwrapArray","multi","cleanChildren","currentArray","normalizeIncomingArray","appendNodes","replacement","inserted","isParent","createElement","SVG_NAMESPACE","useShadow","mount","clean","setClean","cleanup","renderRoot","Dynamic","others","component","isSvg","SVGElements","documentFragmentToHTML","findUpAttribute","findUpTag","tag","findUpAsChild","getCaretPosNew","selection","getCaretPosF","childNodesLength","childNodes","CAN_COMBINE_ENTITIES","nextEntityIdx","_i","sortEntities","markdownTags","tabulationMatch","BLOCK_TAGS","BOM_REG_EXP","SELECTION_SEPARATOR","checkNodeForEntity","parentElement","closest","codeElement","isLineEmpty","line","getRichElementValue","lines","selNode","selOffset","nodeValue","pushLine","isSelected","isQuote","isBlock","alt","stickerEmoji","isTableCell","wasEntitiesLength","wasNodeEmpty","curChild","lastValue","getCaretPos","field","sel","range","possibleChildrenFocusOffset","getRichValueWithCaret","withEntities","withCaret","caretPos","combineSameEntities","isInputEmpty","allowStartingSpace","ListenerSetter","_listener","countNonElements","node1","node1Offset","node2","node2Offset","whichChild","parents","commonAncestorContainer","placeCaretAtEnd","ignoreTouchCheck","focus","NOT_ONLY_BOMS_REG_EXP","RichInputHandler","caret","move","toLeft","addInputCallback","moveFirst","isBOM","something","compareNodes","fromSelectionChange","idxidx","c2","rangeString","onlyBOMs","moved","smthIndex","br","newCallback","capture","sibling","treeWalker","textNode","cleanSiblings","bomNode","focusOffsetBefore","focusNodeAfter","focusOffsetAfter","focusNodeBefore","fillers","smths","SINGLE_ENTITIES","findConflictingEntity","currentEntities","newEntity","currentEntity","singleStart","singleEnd","newEntities","filtered","wrapDraftText","insertRichTextAsHTML","wrappingForPeerId","createCustomEmojiRendererForInput","customEmojiElements","pre","simulateEvent","noLinebreaks","usePlainText","filterEntity","e2","richValue","lineIndex","nextLine","correctedText","richTextLength","plainTextLength","entities2","mergeEntities","InputState2","InputState","processCustomEmojisInInput","customEmojiElements2","hasSet","InputField","empty","showLengthOn","canBeEdited","autocomplete","withBorder","canHaveFormatting","label","onInputCallbacks","isEmpty","placeholder2","centerX","focusOnNext","border","maxLength","labelEl","showingLength","wasError","inputLength","isError","onInput","selectElementContents","_value","PasswordInputHelpers","stealthy","toggleVisible","PasswordInputField","PasswordMonkey","passwordInputField","currentFrame","InputFieldTsx","inProps","instanceRef","SolidJSHotReloadGuardContext","contextValue","LockScreenHotReloadGuardContext","LockScreenHotReloadGuardProvider","_PasscodeLockScreenController","isLocked","storedBase64Key","importedKey","keyAsBuffer","checkLockState","isLockedCallback","appStartupDeferred","undefined","fromLockIcon","savedHash","window","shouldAnimateIn","Promise","mountedElement","clonedLockIcon","HTMLElement","append","body","PasscodeLockScreen","_self$","_$createComponent","onUnlock","overrideHash","startViewTransition","getIsLocked","PasscodeLockScreenController","ApiManagerProxy","mirror","setDeepProperty","mid2","groupedId","_mid","previousMessage","setAppStateSilent","commonEventNames","isDifferentAccount","notification","intervalId","migrateTo","telegramMeWebManager","webPushApiManager","currentAccount","newAccountNumber","setAppSettingsSilent","ENVIRONMENT","serviceWorker","registration","FIX_KEY","swfix","controller","__","pathnameSplitted","originals","originalUrl","createWorker","attachWorkerToPort","worker2","constructor","firstWorker","messagePort","loadedStates","stateForThisAccount","tab","reaction","availableReactions","availableReaction","message2","minMid","mids","saved","overwrite","appConfig","isPremiumPurchaseBlocked","totalAccounts","hasSomeonePremium","OverlayCounter","overlayCounter","uri","parseUriParamsLine","cacheInstallPrompt","deferredPrompt","outcome","getInstallPrompt","days","monthsLocalized","months","daysLocalized","ONE_DAY","ONE_DAY_MINUTES","ONE_WEEK_MINUTES","getWeekDays","getMonths","getWeekNumber","dayNum","yearStart","formatDate","today","formatDateAccordingToTodayNew","formatFullSentTimeRaw","dateEl","formatTimeOptions","formatFullSentTime","capitalize","noToday","timeEl","formatTime","formatMonthsDuration","months2","bold","isYears","minYear","yearPattern","anyLetterRegExp","monthPattern","monthYearOrDayPattern","yearOrDayAndMonthPattern","shortDate","longDate","numberOfDaysEachMonth","query","dates","haystack","year","month","day","minDate","maxDate","dayOfWeek","currentDay","formatWeekLong","matches","g1","g2","k1","selectedYear","createForMonthYear","createForDayMonth","g3","currentYear","formatterYearMax","getMonth","formatterMonthYear","validDateForMonth","isLeapYear","formatterDayMonth","getDayOfWeek","fillTipDates","arrays","nextRandomUint","bits","randomLong","USE_NATIVE_SCROLL","USE_CUSTOM_SCROLL","IS_OVERLAY_SCROLL_SUPPORTED","newTab","newUrl","replaceChildrenPolyfill","preparePrint","chat","chatClone","bubbles","bubblesInner","video2","printable","removePrint","listenForWindowPrint","cancelImageEvents","ripple","prepend","attachListenerTo","drawRipple","clientX","clientY","circle","clickId","rippleClickId","elapsedTime","touchStartFired","_handler","clickX","clickY","isRippleUnneeded","touchEnd","onTouchStart","onMouseDown","isSendShortcutPressed","secondaryKey","requestFullScreen","cancelFullScreen","addFullScreenListener","addListener","eventName","getFullScreenElement","isFullScreen","MIN_JS_DURATION","MAX_JS_DURATION","FocusDirection2","FocusDirection","fastSmoothScrollToStart","axis","fastSmoothScroll","LONG_TRANSITION_MAX_DISTANCE","scrollWithJs","getNormalSize","getElementPosition","transitionFunction","margin","position","forceDirection","maxDistance","forceDuration","rectStartKey","rectEndKey","sizeKey","scrollSizeKey","elementScrollSizeKey","scrollPositionKey","containerRect","possibleElementPosition","elementPosition","elementSize","containerSize","scrollPosition","jumpToScrollPosition","remainingPath","scrollSize","absPath","startAt","SHORT_TRANSITION_MAX_DISTANCE","shortTransition","longTransition","getProgress","currentPath","distanceToEnd","SCROLL_THROTTLE","USE_OWN_SCROLL","throttleMeasurement","cancelMeasurement","ScrollableBase","logPrefix","contentHeight","viewportHeight","scrollbarSize","maxScrollTop","maxScrollbarOffset","scrollAmount","newScrollTop","prependTo","clientSize","divider","maxValue","Scrollable","onScrollOffset","withPaddingContainer","maxScrollPosition","setClassOn","ScrollableX","splitCount","scrollHorizontally","Button","button","replaceButtonIcon","oldIcon","newIcon","ButtonIcon","toggleDisability","disable","DEFAULT_APPEND_TO","appendPopupTo","onFullScreenChange","PopupElement","_PopupElement","background","buttons","buttonsDiv","buttonsElements","toggle","button2","popupConstructor","ctor","addCancelButton","MIN_SIDEBAR_WIDTH","SIDEBAR_COLLAPSE_FACTOR","randomlyChooseVersionFromSearch","setManifest","manifest","setViewportHeightListeners","lastVH","setVH","sidebarEl","storedWidth","validatedWidth","MAX_SIDEBAR_WIDTH","setRootClasses","onInstanceDeactivated","isUpdated","popup","subtitle","onClose","TIME_LABEL","setDocumentLangPackProperties","setSidebarLeftWidth","getProxiedManagers","IS_INSTALL_PROMPT_SUPPORTED","allStates","stateResult","sendAllStatesPromise","setUnreadMessagesText","fillLocalizedDates","fadeInWhenFontsReady","authState","urlSearchParams","maxAccountNumber","changeAccount","isEnteringAnimationFinished","telegramMeWebManager$1","webPushApiManager$1","meModule","pushModule","__vite_default__","pagePromise","finishEnteringAnimation","fontsPromise","page","shouldAnimate"],"ignoreList":[25],"sources":["../src/config/app.ts","../src/helpers/dom/blurActiveElement.ts","../src/environment/touchSupport.ts","../src/environment/ctx.ts","../src/environment/userAgent.ts","../src/helpers/dom/findUpClassName.ts","../src/helpers/schedulers.ts","../src/config/font.ts","../src/helpers/noop.ts","../src/helpers/schedulers/pause.ts","../src/helpers/tgico.ts","../src/helpers/dom/loadFonts.ts","../src/environment/emojiSupport.ts","../src/lib/accounts/constants.ts","../src/helpers/setWorkerProxy.ts","../src/helpers/dom/toggleAttributePolyfill.ts","../src/lib/mtproto/mtproto_config.ts","../src/helpers/eventListenerBase.ts","../src/config/modes.ts","../src/config/debug.ts","../src/config/tabId.ts","../src/helpers/array/indexOfAndSplice.ts","../src/helpers/context.ts","../src/helpers/makeError.ts","../src/helpers/dT.ts","../src/lib/logger.ts","../src/lib/mtproto/superMessagePort.ts","../src/lib/mtproto/mtprotoMessagePort.ts","../src/lib/rootScope.ts","../src/helpers/object/deepEqual.ts","../src/helpers/object/safeAssign.ts","../src/helpers/string/capitalizeFirstLetter.ts","../src/lib/richTextProcessor/matchUrlProtocol.ts","../src/vendor/emoji/regex.ts","../src/lib/richTextProcessor/index.ts","../src/lib/richTextProcessor/wrapUrl.ts","../src/helpers/dom/setInnerHTML.ts","../src/lib/richTextProcessor/setBlankToAnchor.ts","../src/vendor/solid/dist/solid.js","../src/config/databases/state.ts","../src/helpers/cancellablePromise.ts","../src/helpers/schedulers/throttleWith.ts","../src/lib/files/idb.ts","../src/lib/staticUtilityClass.ts","../src/lib/passcode/deferredIsUsingPasscode.ts","../src/helpers/array/toArray.ts","../src/helpers/bytes/convertToUint8Array.ts","../src/helpers/formatBytesPure.ts","../src/helpers/schedulers/asyncThrottle.ts","../src/lib/crypto/cryptoMessagePort.ts","../src/lib/passcode/keyStore.ts","../src/lib/encryptedStorageLayer.ts","../src/lib/storage.ts","../src/lib/commonStateStorage.ts","../src/lib/langPack.ts","../src/lib/appManagers/utils/peers/isAnyChat.ts","../src/lib/appManagers/utils/peers/isUser.ts","../src/helpers/peerIdPolyfill.ts","../src/helpers/bytes/bufferConcats.ts","../src/lib/polyfill.ts","../src/lib/webp/webpWorkerController.ts","../src/lib/localStorage.ts","../src/lib/sessionStorage.ts","../src/helpers/dom/cancelEvent.ts","../src/helpers/dom/isSwipingBackSafari.ts","../src/components/appNavigationController.ts","../src/lib/appManagers/appRuntimeManager.ts","../src/helpers/object/copy.ts","../src/environment/sharedWorkerSupport.ts","../src/helpers/idleController.ts","../src/lib/mtproto/singleInstance.ts","../src/lib/appManagers/utils/messageId/clearMessageId.ts","../src/lib/appManagers/utils/messageId/getServerMessageId.ts","../src/lib/mtproto/webPushApiManager.ts","../src/helpers/dom/loadScript.ts","../src/helpers/tsNow.ts","../src/lib/mtproto/telegramMeWebManager.ts","../src/environment/webrtcSupport.ts","../src/environment/callSupport.ts","../src/environment/canUseTransferables.ts","../src/environment/geolocationSupport.ts","../src/environment/groupCallSupport.ts","../src/environment/webpSupport.ts","../src/environment/imageMimeTypesSupport.ts","../src/environment/videoSupport.ts","../src/environment/videoMimeTypesSupport.ts","../src/environment/parallaxSupport.ts","../src/environment/screenSharingSupport.ts","../src/environment/vibrateSupport.ts","../src/environment/opusSupport.ts","../src/environment/appleMx.ts","../src/environment/liveStreamSupport.ts","../src/environment/index.ts","../src/helpers/getTimeFormat.ts","../src/config/state.ts","../src/helpers/compareVersion.ts","../src/helpers/object/isObject.ts","../src/helpers/object/validateInitObject.ts","../src/helpers/recordPromise.ts","../src/lib/stateStorage.ts","../src/lib/accounts/accountController.ts","../src/lib/appManagers/utils/storages/createStorages.ts","../src/lib/appManagers/utils/state/loadState.ts","../src/lib/opusDecodeController.ts","../src/helpers/blob/blobSafeMimeType.ts","../src/helpers/blob/blobConstruct.ts","../src/helpers/blob/readBlobAs.ts","../src/helpers/blob/readBlobAsArrayBuffer.ts","../src/helpers/blob/readBlobAsUint8Array.ts","../src/lib/files/memoryWriter.ts","../src/lib/files/cacheStorage.ts","../src/helpers/toggleStorages.ts","../src/lib/serviceWorker/serviceMessagePort.ts","../src/helpers/object/setDeepProperty.ts","../src/helpers/fileName.ts","../src/lib/appManagers/utils/webFiles/isWebFileLocation.ts","../src/lib/storages/utils/thumbs/getThumbKey.ts","../src/lib/storages/utils/thumbs/generateEmptyThumb.ts","../src/lib/storages/utils/thumbs/getStickerThumbKey.ts","../src/helpers/callbackify.ts","../src/lib/appManagers/utils/messageId/isLegacyMessageId.ts","../src/vendor/solid/store/dist/store.js","../src/stores/appState.ts","../src/helpers/object/getObjectKeysAndSort.ts","../src/stores/peers.ts","../src/lib/accounts/getValidatedAccount.ts","../src/lib/accounts/getCurrentAccountFromURL.ts","../src/lib/accounts/getCurrentAccount.ts","../src/lib/appManagers/getProxiedManagers.ts","../src/helpers/string/limitSymbols.ts","../src/lib/appManagers/utils/peers/getPeerActiveUsernames.ts","../src/config/tld.ts","../src/lib/richTextProcessor/checkBrackets.ts","../src/config/emoji.ts","../src/vendor/emoji/index.ts","../src/lib/richTextProcessor/getEmojiUnified.ts","../src/lib/richTextProcessor/parseEntities.ts","../src/helpers/buildURLHash.ts","../src/helpers/string/encodeEntities.ts","../src/lib/richTextProcessor/spoiler.ts","../src/lib/richTextProcessor/encodeSpoiler.ts","../src/environment/emojiVersionsSupport.ts","../src/helpers/dom/dispatchEvent.ts","../src/helpers/dom/clickEvent.ts","../src/helpers/string/bom.ts","../src/lib/richTextProcessor/wrapTelegramUrlToAnchor.ts","../src/helpers/dom/isInDOM.ts","../src/helpers/array/forEachReverse.ts","../src/helpers/dom/safePlay.ts","../src/components/animationIntersector.ts","../src/components/visibilityIntersector.ts","../src/helpers/array/findAndSpliceAll.ts","../src/helpers/array/findAndSplice.ts","../src/helpers/schedulers/throttle.ts","../src/components/lazyLoadQueueBase.ts","../src/components/lazyLoadQueueIntersector.ts","../src/hooks/useHeavyAnimationCheck.ts","../src/components/lazyLoadQueue.ts","../src/helpers/bytes/getPathFromBytes.ts","../src/helpers/computeLockColor.ts","../src/lib/hls/common.ts","../src/lib/hls/hlsInstancesByVideo.ts","../src/lib/hls/initVideoHls.ts","../src/helpers/dom/createVideo.ts","../src/helpers/fixChromiumMp4.constants.ts","../src/helpers/onMediaLoad.ts","../src/helpers/dom/renderImageFromUrl.ts","../src/helpers/bytes/bytesFromHex.ts","../src/helpers/bytes/bytesToDataURL.ts","../src/helpers/bytes/getPreviewURLFromBytes.ts","../src/helpers/getPreviewURLFromThumb.ts","../src/helpers/heavyQueue.ts","../src/helpers/blur.ts","../src/helpers/getImageFromStrippedThumb.ts","../src/helpers/calcImageInBox.ts","../src/helpers/mediaSize.ts","../src/helpers/mediaSizes.ts","../src/helpers/number/clamp.ts","../src/environment/imageBitmapSupport.ts","../src/helpers/framesCache.ts","../src/helpers/dom/customProperties.ts","../src/lib/rlottie/rlottiePlayer.ts","../src/helpers/saveLottiePreview.ts","../src/helpers/sequentialDom.ts","../src/helpers/getFileNameForUpload.ts","../src/lib/appManagers/utils/docs/getDocumentInputFileLocation.ts","../src/lib/appManagers/utils/docs/getDocumentDownloadOptions.ts","../src/lib/appManagers/utils/photos/getPhotoDownloadOptions.ts","../src/lib/appManagers/utils/webFiles/getWebFileDownloadOptions.ts","../src/lib/appManagers/utils/webDocs/getWebDocumentDownloadOptions.ts","../src/lib/appManagers/utils/webDocs/isWebDocument.ts","../src/lib/appManagers/utils/download/getDownloadFileNameFromOptions.ts","../src/lib/appManagers/utils/download/getDownloadMediaDetails.ts","../src/helpers/dom/createDownloadAnchor.ts","../src/lib/appManagers/appDownloadManager.ts","../src/lib/appManagers/utils/photos/choosePhotoSize.ts","../src/lib/appManagers/utils/stickers/getStickerEffectThumb.ts","../src/lib/rlottie/queryableWorker.ts","../src/environment/webAssemblySupport.ts","../src/lib/rlottie/lottieLoader.ts","../src/helpers/middleware.ts","../src/helpers/schedulers/throttleWithRaf.ts","../src/helpers/solid/createUnifiedSignal.ts","../src/helpers/windowSize.ts","../src/components/wrappers/stickerAnimation.ts","../src/helpers/liteMode.ts","../src/icons.ts","../src/iconsReverse.ts","../src/components/icon.ts","../src/helpers/dom/setCurrentTime.ts","../src/helpers/dom/handleVideoLeak.ts","../src/components/wrappers/sticker.ts","../src/helpers/dom/getVisibleRect.ts","../src/helpers/dom/getViewportSlice.ts","../src/helpers/dom/replaceContent.ts","../src/components/resizeObserver.ts","../src/lib/customEmoji/constants.ts","../src/lib/customEmoji/renderer.ts","../src/lib/customEmoji/element.ts","../src/codeLanguages.ts","../src/helpers/array/findIndexFrom.ts","../src/helpers/createElementFromMarkup.ts","../src/helpers/animation.ts","../src/helpers/callbackifyAll.ts","../src/helpers/number/getUnsafeRandomInt.ts","../src/components/bluffSpoilerController.ts","../src/vendor/bezierEasing.ts","../src/helpers/color.ts","../src/components/mediaEditor/utils.ts","../src/components/dotRenderer.ts","../src/vendor/convertPunycode.js","../src/helpers/string/isMixedScriptUrl.ts","../src/lib/richTextProcessor/wrapRichText.ts","../src/lib/richTextProcessor/wrapEmojiText.ts","../src/components/wrappers/getPeerTitle.ts","../src/config/notifications.ts","../src/lib/accounts/createAppURLForAccount.ts","../src/stores/appSettings.ts","../src/helpers/themeController.ts","../src/lib/appManagers/utils/peers/getPeerColorById.ts","../src/lib/richTextProcessor/getEmojiEntityFromEmoji.ts","../src/lib/richTextProcessor/getAbbreviation.ts","../src/helpers/canvas/drawCircle.ts","../src/helpers/createNotificationImage.ts","../src/vendor/solid/web/dist/web.js","../src/helpers/dom/documentFragmentToHTML.ts","../src/helpers/dom/findUpAttribute.ts","../src/helpers/dom/findUpTag.ts","../src/helpers/dom/findUpAsChild.ts","../src/helpers/dom/getCaretPosNew.ts","../src/lib/richTextProcessor/combineSameEntities.ts","../src/lib/richTextProcessor/sortEntities.ts","../src/helpers/dom/getRichElementValue.ts","../src/helpers/dom/getRichValueWithCaret.ts","../src/helpers/dom/isInputEmpty.ts","../src/helpers/listenerSetter.ts","../src/helpers/dom/whichChild.ts","../src/helpers/dom/compareNodes.ts","../src/helpers/dom/placeCaretAtEnd.ts","../src/helpers/dom/richInputHandler.ts","../src/helpers/dom/selectElementContents.ts","../src/lib/richTextProcessor/findConflictingEntity.ts","../src/lib/richTextProcessor/mergeEntities.ts","../src/lib/richTextProcessor/wrapDraftText.ts","../src/components/inputField.ts","../src/components/passwordInputField.ts","../src/components/monkeys/password.ts","../src/components/inputFieldTsx.tsx","../src/lib/solidjs/hotReloadGuard.ts","../src/lib/solidjs/lockScreenHotReloadGuardProvider.tsx","../src/components/passcodeLock/passcodeLockScreenController.tsx","../src/lib/mtproto/mtprotoworker.ts","../src/helpers/overlayCounter.ts","../src/helpers/string/parseUriParams.ts","../src/environment/installPrompt.ts","../src/helpers/dom/installPrompt.ts","../src/helpers/date/common.ts","../src/helpers/date.ts","../src/helpers/random.ts","../src/environment/overlayScrollSupport.ts","../src/lib/accounts/changeAccount.ts","../src/helpers/dom/replaceChildrenPolyfill.ts","../src/helpers/dom/windowPrint.ts","../src/helpers/dom/cancelImageEvents.ts","../src/components/ripple.ts","../src/helpers/dom/isSendShortcutPressed.ts","../src/helpers/dom/fullScreen.ts","../src/helpers/fastSmoothScroll.ts","../src/components/scrollable.ts","../src/components/button.ts","../src/components/buttonIcon.ts","../src/helpers/dom/toggleDisability.ts","../src/components/popups/index.ts","../src/components/sidebarLeft/constants.ts","../src/index.ts"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type {TrueDcId} from '../types';\r\n\r\nexport const MAIN_DOMAINS = ['web.telegram.org', 'webk.telegram.org'];\r\nexport const DEFAULT_BACKGROUND_SLUG = 'pattern';\r\n\r\nconst threads = Math.min(4, navigator.hardwareConcurrency ?? 4);\r\n\r\nconst App = {\r\n  id: +import.meta.env.VITE_API_ID,\r\n  hash: import.meta.env.VITE_API_HASH,\r\n  version: import.meta.env.VITE_VERSION,\r\n  versionFull: import.meta.env.VITE_VERSION_FULL,\r\n  build: +import.meta.env.VITE_BUILD,\r\n  langPackVersion: '6.2.7',\r\n  langPack: 'webk',\r\n  langPackCode: 'en',\r\n  domains: MAIN_DOMAINS,\r\n  baseDcId: 2 as TrueDcId,\r\n  isMainDomain: MAIN_DOMAINS.includes(location.hostname),\r\n  suffix: 'K',\r\n  threads,\r\n  cryptoWorkers: threads\r\n};\r\n\r\nif(App.isMainDomain) { // use Webogram credentials then\r\n  App.id = 2496;\r\n  App.hash = '8da85b0d5bfe62527e5b244c209159c3';\r\n}\r\n\r\nexport default App;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function blurActiveElement() {\r\n  if((document.activeElement as HTMLInputElement)?.blur) {\r\n    (document.activeElement as HTMLInputElement).blur();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// @ts-ignore\r\nconst IS_TOUCH_SUPPORTED = ('ontouchstart' in window) || (window.DocumentTouch && document instanceof DocumentTouch)/*  || true */;\r\nexport default IS_TOUCH_SUPPORTED;\r\n","const ctx = typeof(window) !== 'undefined' ? window : self;\r\n\r\nexport default ctx;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ctx from './ctx';\r\n\r\nexport const USER_AGENT = navigator ? navigator.userAgent : null;\r\nexport const IS_APPLE = navigator.userAgent.search(/OS X|iPhone|iPad|iOS/i) !== -1;\r\nexport const IS_ANDROID = navigator.userAgent.toLowerCase().indexOf('android') !== -1;\r\nexport const IS_CHROMIUM = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);\r\nexport const CHROMIUM_VERSION = (() => {\r\n  try {\r\n    return +navigator.userAgent.match(/Chrom(?:e|ium)\\/(.+?)(?:\\s|\\.)/)[1];\r\n  } catch(err) {\r\n  }\r\n})();\r\n\r\n// https://stackoverflow.com/a/58065241\r\nexport const IS_APPLE_MOBILE = (/iPad|iPhone|iPod/.test(navigator.platform) ||\r\n  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&\r\n  !(ctx as any).MSStream;\r\n\r\nexport const IS_SAFARI = !!('safari' in ctx) || !!(USER_AGENT && (/\\b(iPad|iPhone|iPod)\\b/.test(USER_AGENT) || (!!USER_AGENT.match('Safari') && !USER_AGENT.match('Chrome'))))/*  || true */;\r\nexport const IS_FIREFOX = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const IS_MOBILE_SAFARI = IS_SAFARI && IS_APPLE_MOBILE;\r\n\r\nexport const IS_MOBILE = (navigator.maxTouchPoints === undefined || navigator.maxTouchPoints > 0) && navigator.userAgent.search(/iOS|iPhone OS|Android|BlackBerry|BB10|Series ?[64]0|J2ME|MIDP|opera mini|opera mobi|mobi.+Gecko|Windows Phone/i) != -1;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// export function findUpClassName<T>(el: any, className: string): T;\r\nexport default function findUpClassName(el: EventTarget | {closest: (selector: string) => any}, className: string): HTMLElement {\r\n  return (el as any).closest('.' + className);\r\n  /* if(el.classList.contains(className)) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.classList.contains(className))\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's schedulers\r\nimport {NoneToVoidFunction} from '../types';\r\n\r\n/*\r\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\r\n  return throttleWith(onTickEnd, fn);\r\n}\r\n\r\nexport function throttleWithNow<F extends AnyToVoidFunction>(fn: F) {\r\n  return throttleWith(runNow, fn);\r\n}\r\n\r\nexport function onTickEnd(cb: NoneToVoidFunction) {\r\n  Promise.resolve().then(cb);\r\n}\r\n\r\nfunction runNow(fn: NoneToVoidFunction) {\r\n  fn();\r\n} */\r\n\r\nlet fastRafCallbacks: NoneToVoidFunction[] | undefined;\r\nexport function fastRaf(callback: NoneToVoidFunction) {\r\n  if(!fastRafCallbacks) {\r\n    fastRafCallbacks = [callback];\r\n\r\n    requestAnimationFrame(() => {\r\n      const currentCallbacks = fastRafCallbacks!;\r\n      fastRafCallbacks = undefined;\r\n      currentCallbacks.forEach((cb) => cb());\r\n    });\r\n  } else {\r\n    fastRafCallbacks.push(callback);\r\n  }\r\n}\r\n\r\nlet fastRafConventionalCallbacks: NoneToVoidFunction[] | undefined, processing = false;\r\nexport function fastRafConventional(callback: NoneToVoidFunction) {\r\n  if(!fastRafConventionalCallbacks) {\r\n    fastRafConventionalCallbacks = [callback];\r\n\r\n    requestAnimationFrame(() => {\r\n      processing = true;\r\n      for(let i = 0; i < fastRafConventionalCallbacks.length; ++i) {\r\n        fastRafConventionalCallbacks[i]();\r\n      }\r\n\r\n      fastRafConventionalCallbacks = undefined;\r\n      processing = false;\r\n    });\r\n  } else if(processing) {\r\n    callback();\r\n  } else {\r\n    fastRafConventionalCallbacks.push(callback);\r\n  }\r\n}\r\n\r\nlet rafPromise: Promise<void>;\r\nexport function fastRafPromise() {\r\n  if(rafPromise) return rafPromise;\r\n\r\n  rafPromise = new Promise<void>((resolve) => fastRaf(() => resolve()));\r\n  rafPromise.then(() => {\r\n    rafPromise = undefined;\r\n  });\r\n\r\n  return rafPromise;\r\n}\r\n\r\nexport function doubleRaf() {\r\n  return new Promise<void>((resolve) => {\r\n    fastRaf(() => {\r\n      fastRaf(resolve);\r\n    });\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport const FontFamilyName = 'Roboto';\r\nexport const FontFamily = FontFamilyName + ', -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif';\r\nexport const FontSize = '16px';\r\nexport const FontWeight = '400';\r\nexport const FontFull = `${FontWeight} ${FontSize} ${FontFamily}`;\r\n","export default function noop() {}\r\n","export default function pause(ms: number) {\r\n  return new Promise<void>((resolve) => {\r\n    setTimeout(resolve, ms);\r\n  });\r\n}\r\n","export const TGICO_CLASS = 'tgico';\r\nexport default function tgico(icon: Icon) {\r\n  return [TGICO_CLASS, _tgico(icon)];\r\n}\r\n\r\nexport function _tgico(icon: Icon) {\r\n  return TGICO_CLASS + '-' + icon;\r\n}\r\n\r\nexport function tgico_(icon: Icon) {\r\n  return tgico(icon).join(' ');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {FontFamilyName} from '../../config/font';\r\nimport noop from '../noop';\r\nimport pause from '../schedulers/pause';\r\nimport {TGICO_CLASS} from '../tgico';\r\n\r\nconst texts = ['b', 'б'];\r\ntype FontType = 'text' | 'icons' | 'monospace';\r\n\r\nconst cache: {\r\n  [key: string]: {\r\n    [text: string]: Promise<any>\r\n  }\r\n} = {};\r\n\r\nconst fonts: {[type in FontType]: string} = {\r\n  text: FontFamilyName,\r\n  icons: TGICO_CLASS,\r\n  monospace: 'Roboto Mono'\r\n};\r\n\r\nexport default function loadFonts(types: {[type in FontType]?: string[] | 'all'} = {\r\n  text: texts,\r\n  icons: undefined,\r\n  monospace: texts\r\n}): Promise<any> {\r\n  if(!('fonts' in document)) {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const promises: Promise<any>[] = [];\r\n  for(const type in types) {\r\n    let _texts = types[type as FontType];\r\n    if(_texts === 'all') {\r\n      _texts = texts;\r\n    }\r\n\r\n    const font = fonts[type as FontType];\r\n    const weights = type === 'icons' ? [500] : [400, 500];\r\n    for(const weight of weights) {\r\n      const _promises = (_texts || [undefined]).map((text) => {\r\n        const key = [weight, '1rem', font].join(' ');\r\n        const promise = (cache[key] ??= {})[text || ''] ??= document.fonts.load(key, text);\r\n        return promise;\r\n      });\r\n      promises.push(..._promises);\r\n    }\r\n  }\r\n\r\n  return Promise.race([\r\n    Promise.all(promises).catch(noop),\r\n    pause(1000)\r\n  ]);\r\n}\r\n","const IS_EMOJI_SUPPORTED = navigator.userAgent.search(/OS X|iPhone|iPad|iOS/i) !== -1/*  && false *//*  || true */;\r\n\r\nexport default IS_EMOJI_SUPPORTED;\r\n","export const CURRENT_ACCOUNT_QUERY_PARAM = 'account';\r\n\r\nexport const MAX_ACCOUNTS_FREE = 3;\r\nexport const MAX_ACCOUNTS_PREMIUM = 4;\r\nexport const MAX_ACCOUNTS = MAX_ACCOUNTS_PREMIUM;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CURRENT_ACCOUNT_QUERY_PARAM} from '../lib/accounts/constants';\r\n\r\nexport function makeWorkerURL(url: string | URL) {\r\n  if(!(url instanceof URL)) {\r\n    url = new URL(url + '', location.href);\r\n  }\r\n\r\n  if(location.search && url.protocol !== 'blob:') {\r\n    const params = new URLSearchParams(location.search);\r\n    params.forEach((value, key) => {\r\n      if(key === CURRENT_ACCOUNT_QUERY_PARAM) return;\r\n      (url as URL).searchParams.set(key, value);\r\n    });\r\n  }\r\n\r\n  // exclude useless params\r\n  (url as URL).searchParams.delete('swfix');\r\n\r\n  return url;\r\n}\r\n\r\nexport default function setWorkerProxy() {\r\n  // * hook worker constructor to set search parameters (test, debug, etc)\r\n  const workerHandler = {\r\n    construct(target: any, args: any) {\r\n      args[0] = makeWorkerURL(args[0]);\r\n      return new target(...args);\r\n    }\r\n  };\r\n\r\n  [\r\n    Worker,\r\n    typeof(SharedWorker) !== 'undefined' && SharedWorker\r\n  ].filter(Boolean).forEach((w) => {\r\n    window[w.name as any] = new Proxy(w, workerHandler);\r\n  });\r\n}\r\n\r\nsetWorkerProxy();\r\n","export default function toggleAttributePolyfill() {\r\n  if(!Element.prototype.toggleAttribute) {\r\n    Element.prototype.toggleAttribute = function(name, force) {\r\n      if(force !== void 0) force = !!force;\r\n\r\n      if(this.hasAttribute(name)) {\r\n        if(force) return true;\r\n\r\n        this.removeAttribute(name);\r\n        return false;\r\n      }\r\n      if(force === false) return false;\r\n\r\n      this.setAttribute(name, '');\r\n      return true;\r\n    };\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDialogFilter} from '../storages/filters';\r\n\r\n/**\r\n * Legacy Webogram's format, don't change dcID to camelCase. date is timestamp\r\n */\r\nexport type UserAuth = {dcID: number | string, date: number, id: PeerId};\r\nexport type REAL_FOLDER_ID = 0 | 1;\r\n\r\nexport const NULL_PEER_ID: PeerId = 0;\r\nexport const REPLIES_PEER_ID: PeerId = 1271266957;\r\nexport const REPLIES_HIDDEN_CHANNEL_ID: ChatId = 777;\r\nexport const HIDDEN_PEER_ID: PeerId = 2666000;\r\nexport const SERVICE_PEER_ID: PeerId = 777000;\r\nexport const MUTE_UNTIL = 0x7FFFFFFF;\r\nexport const BOT_START_PARAM = '';\r\nexport const MAX_FILE_SAVE_SIZE = 20 * 1024 * 1024;\r\nexport const THUMB_TYPE_FULL = '';\r\nexport const TOPIC_COLORS = [0x6FB9F0, 0xFFD67E, 0xCB86DB, 0x8EEE98, 0xFF93B2, 0xFB6F5F];\r\nexport const ATTACH_MENU_BOT_ICON_NAME = 'default_static';\r\nexport const MESSAGE_ID_OFFSET = 0x100000000;\r\nexport const GENERAL_TOPIC_ID = MESSAGE_ID_OFFSET + 1;\r\nexport const CAN_HIDE_TOPIC = false;\r\nexport const T_ME_PREFIXES = new Set(['web', 'k', 'z', 'a']);\r\nexport const SEND_WHEN_ONLINE_TIMESTAMP = 0x7FFFFFFE;\r\nexport const SERVER_IMAGE_MIME_TYPES = new Set(['image/jpeg', 'image/png', 'image/bmp', 'image/gif']);\r\nexport const STARS_CURRENCY = 'XTR';\r\nexport const SEND_PAID_REACTION_DELAY = 5 * 1e3;\r\nexport const SEND_PAID_REACTION_ANONYMOUS_PEER_ID: PeerId = -1;\r\n\r\nexport const FOLDER_ID_ALL: REAL_FOLDER_ID = 0;\r\nexport const FOLDER_ID_ARCHIVE: REAL_FOLDER_ID = 1;\r\nexport const REAL_FOLDERS: Set<number> = new Set([FOLDER_ID_ALL, FOLDER_ID_ARCHIVE]);\r\nexport const START_LOCAL_ID = Math.max(...Array.from(REAL_FOLDERS)) + 1 as MyDialogFilter['localId'];\r\n\r\nexport const TEST_NO_STORIES = false;\r\nexport const TEST_NO_SAVED = false;\r\nexport const TEST_NO_STREAMING = false;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport type {ArgumentTypes, SuperReturnType} from '../types';\r\n\r\n// class EventSystem {\r\n//   wm: WeakMap<any, Record<any, Set<any>>> = new WeakMap();\r\n\r\n//   add(target: any, event: any, listener: any) {\r\n//     let listeners = this.wm.get(target);\r\n//     if (listeners === undefined) {\r\n//         listeners = {};\r\n//     }\r\n//     let listenersForEvent = listeners[event];\r\n//     if (listenersForEvent === undefined) {\r\n//         listenersForEvent = new Set();\r\n//     }\r\n//     listenersForEvent.add(listener);\r\n//     listeners[event] = listenersForEvent;\r\n//     //target.addEventListener(event, listener);\r\n//     this.wm.set(target, listeners);\r\n//   };\r\n\r\n//   remove(target: any, event: any, listener: any) {\r\n//     let listeners = this.wm.get(target);\r\n//     if (!listeners) return;\r\n//     let listenersForEvent = listeners[event];\r\n//     if (!listenersForEvent) return;\r\n//     listenersForEvent.delete(listener);\r\n//   };\r\n\r\n//   /* fire(target, event) {\r\n//      let listeners = this.wm.get(target);\r\n//      if (!listeners) return;\r\n//      let listenersForEvent = listeners[event];\r\n//      if (!listenersForEvent) return;\r\n//      for (let handler of handlers) {\r\n//          setTimeout(handler, 0, event, target); // we use a setTimeout here because we want event triggering to be asynchronous.\r\n//      }\r\n//   }; */\r\n// }\r\n\r\n// console.log = () => {};\r\n\r\n// const e = new EventSystem();\r\n// MOUNT_CLASS_TO.e = e;\r\n\r\nexport type EventListenerListeners = Record<string, Function>;\r\n// export type EventListenerListeners = Record<string, (...args: any[]) => any>;\r\n// export type EventListenerListeners = {[name in string]: Function};\r\n\r\n/**\r\n * Better not to remove listeners during setting\r\n * Should add listener callback only once\r\n */\r\n\r\ntype ListenerObject<T> = {callback: T, options: boolean | AddEventListenerOptions};\r\n\r\n// type EventLitenerCallback<T> = (data: T) =>\r\n// export default class EventListenerBase<Listeners extends {[name: string]: Function}> {\r\nexport default class EventListenerBase<Listeners extends EventListenerListeners> {\r\n  protected listeners: Partial<{\r\n    [k in keyof Listeners]: Set<ListenerObject<Listeners[k]>>\r\n  }>;\r\n  protected listenerResults: Partial<{\r\n    [k in keyof Listeners]: ArgumentTypes<Listeners[k]>\r\n  }>;\r\n\r\n  private reuseResults: boolean;\r\n\r\n  constructor(reuseResults?: boolean) {\r\n    this._constructor(reuseResults);\r\n  }\r\n\r\n  public _constructor(reuseResults?: boolean): any {\r\n    this.reuseResults = reuseResults;\r\n    this.listeners = {};\r\n    this.listenerResults = {};\r\n  }\r\n\r\n  public addEventListener<T extends keyof Listeners>(name: T, callback: Listeners[T], options?: boolean | AddEventListenerOptions) {\r\n    const listenerObject: ListenerObject<Listeners[T]> = {callback, options};\r\n    (this.listeners[name] ??= new Set()).add(listenerObject); // ! add before because if you don't, you won't be able to delete it from callback\r\n\r\n    if(this.listenerResults.hasOwnProperty(name)) {\r\n      callback(...this.listenerResults[name]);\r\n\r\n      if((options as AddEventListenerOptions)?.once) {\r\n        this.listeners[name].delete(listenerObject);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // e.add(this, name, {callback, once});\r\n  }\r\n\r\n  public addMultipleEventsListeners(obj: {\r\n    [name in keyof Listeners]?: Listeners[name]\r\n  }) {\r\n    for(const i in obj) {\r\n      this.addEventListener(i, obj[i]);\r\n    }\r\n  }\r\n\r\n  public removeEventListener<T extends keyof Listeners>(\r\n    name: T,\r\n    callback: Listeners[T],\r\n    options?: boolean | AddEventListenerOptions\r\n  ) {\r\n    if(this.listeners[name]) {\r\n      for(const l of this.listeners[name]) {\r\n        if(l.callback === callback) {\r\n          this.listeners[name].delete(l);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    // e.remove(this, name, callback);\r\n  }\r\n\r\n  protected invokeListenerCallback<T extends keyof Listeners, L extends ListenerObject<any>>(\r\n    name: T,\r\n    listener: L,\r\n    ...args: ArgumentTypes<L['callback']>\r\n  ) {\r\n    let result: any, error: any;\r\n    try {\r\n      result = listener.callback(...args);\r\n    } catch(err) {\r\n      error = err;\r\n      // console.error('listener callback error', err);\r\n    }\r\n\r\n    if((listener.options as AddEventListenerOptions)?.once) {\r\n      this.removeEventListener(name, listener.callback);\r\n    }\r\n\r\n    if(error) {\r\n      throw error;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private _dispatchEvent<T extends keyof Listeners>(\r\n    name: T,\r\n    collectResults: boolean,\r\n    ...args: ArgumentTypes<Listeners[T]>\r\n  ) {\r\n    if(this.reuseResults) {\r\n      this.listenerResults[name] = args;\r\n    }\r\n\r\n    const arr: Array<SuperReturnType<Listeners[typeof name]>> = collectResults && [];\r\n\r\n    const listeners = this.listeners[name];\r\n    if(listeners) {\r\n      for(const listener of listeners) {\r\n        const result = this.invokeListenerCallback(name, listener, ...args);\r\n        if(arr) {\r\n          arr.push(result);\r\n        }\r\n      }\r\n    }\r\n\r\n    return arr;\r\n  }\r\n\r\n  public dispatchResultableEvent<T extends keyof Listeners>(name: T, ...args: ArgumentTypes<Listeners[T]>) {\r\n    return this._dispatchEvent(name, true, ...args);\r\n  }\r\n\r\n  // * must be protected, but who cares\r\n  public dispatchEvent<L extends EventListenerListeners = Listeners, T extends keyof L = keyof L>(\r\n    name: T,\r\n    ...args: ArgumentTypes<L[T]>\r\n  ) {\r\n    // @ts-ignore\r\n    this._dispatchEvent(name, false, ...args);\r\n  }\r\n\r\n  public cleanup() {\r\n    this.listeners = {};\r\n    this.listenerResults = {};\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type {TransportType} from '../lib/mtproto/dcConfigurator';\r\n\r\nconst Modes = {\r\n  test: location.search.indexOf('test=1') > 0/*  || true */,\r\n  debug: location.search.indexOf('debug=1') > 0,\r\n  http: false,\r\n  ssl: true, // location.search.indexOf('ssl=1') > 0 || location.protocol === 'https:' && location.search.indexOf('ssl=0') === -1,\r\n  asServiceWorker: !!import.meta.env.VITE_MTPROTO_SW,\r\n  transport: 'websocket' as TransportType,\r\n  noSharedWorker: location.search.indexOf('noSharedWorker=1') > 0,\r\n  multipleTransports: !!(import.meta.env.VITE_MTPROTO_AUTO && import.meta.env.VITE_MTPROTO_HAS_HTTP && import.meta.env.VITE_MTPROTO_HAS_WS)\r\n};\r\n\r\nif(import.meta.env.VITE_MTPROTO_HAS_HTTP) {\r\n  const httpOnly = Modes.http = location.search.indexOf('http=1') > 0;\r\n  if(httpOnly) {\r\n    Modes.multipleTransports = false;\r\n  }\r\n}\r\n\r\n// * start with HTTP first\r\nif(Modes.multipleTransports) {\r\n  Modes.http = true;\r\n}\r\n\r\nif(Modes.http) {\r\n  Modes.transport = 'https';\r\n}\r\n\r\nexport default Modes;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Modes from './modes';\r\n\r\nexport const IS_BETA = import.meta.env.DEV;\r\nexport const DEBUG = (IS_BETA || Modes.debug)/*  && false */;\r\nconst ctx: any = typeof(window) !== 'undefined' ? window : self;\r\nexport const MOUNT_CLASS_TO: any = DEBUG || true/*  && false */ ? ctx : {};\r\nexport default DEBUG;\r\n\r\n// let m = DEBUG;\r\n/* if(!DEBUG) {\r\n  ctx.sandpitTurtle = () => {\r\n    //if(!m) {\r\n      for(let i in MOUNT_CLASS_TO) {\r\n        ctx[i] = MOUNT_CLASS_TO[i];\r\n      }\r\n      //m = true;\r\n    //}\r\n\r\n    //DEBUG = !DEBUG;\r\n  };\r\n} */\r\n\r\n/* export const superDebug = (object: any, key: string) => {\r\n  var d = object[key];\r\n  var beforeStr = '', afterStr = '';\r\n  for(var r of d) {\r\n    beforeStr += r.before.hex + '\\n';\r\n    afterStr += r.after.hex + '\\n';\r\n  }\r\n\r\n  beforeStr = beforeStr.trim();\r\n  afterStr = afterStr.trim();\r\n  //var beforeStr = d.map((r) => r.before.hex).join('\\n');\r\n  //var afterStr = d.map((r) => r.after.hex).join('\\n');\r\n\r\n  var dada = (name: string, str: string) => {\r\n    var a = document.createElement('a');\r\n    a.target = '_blank';\r\n    a.download = name + '.txt';\r\n    a.href = URL.createObjectURL(new Blob([str], {\r\n      type: 'text/plain'\r\n    }));\r\n    document.body.append(a);\r\n    a.click();\r\n  };\r\n\r\n  dada(key + '_' + 'before', beforeStr);\r\n  dada(key + '_' + 'after', afterStr);\r\n}\r\n\r\nMOUNT_CLASS_TO.superDebug = superDebug; */\r\n","const tabId = Date.now() % Math.random() * 100000000 | 0;\r\nexport default tabId;\r\n","export default function indexOfAndSplice<T>(array: Array<T>, item: T) {\r\n  const idx = array.indexOf(item);\r\n  const spliced = idx === -1 ? undefined : array.splice(idx, 1);\r\n  return spliced?.[0];\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// в SW может быть сразу две переменных TRUE\r\nexport const IS_SERVICE_WORKER = typeof ServiceWorkerGlobalScope !== 'undefined' && self instanceof ServiceWorkerGlobalScope;\r\nexport const IS_WEB_WORKER = typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope && !IS_SERVICE_WORKER;\r\nexport const IS_WORKER = IS_WEB_WORKER || IS_SERVICE_WORKER;\r\n\r\nexport const getWindowClients = () => {\r\n  return (self as any as ServiceWorkerGlobalScope)\r\n  .clients\r\n  .matchAll({includeUncontrolled: false, type: 'window'});\r\n};\r\n\r\nexport const getLastWindowClient = () => getWindowClients().then((windowClients) => windowClients.slice(-1)[0]);\r\n\r\nconst postMessage = (listener: WindowClient | DedicatedWorkerGlobalScope, ...args: any[]) => {\r\n  try {\r\n    // @ts-ignore\r\n    listener.postMessage(...args);\r\n  } catch(err) {\r\n    console.error('[worker] postMessage error:', err, args);\r\n  }\r\n};\r\n\r\nconst notifyServiceWorker = (all: boolean, ...args: any[]) => {\r\n  getWindowClients().then((listeners) => {\r\n    if(!listeners.length) {\r\n      // console.trace('no listeners?', self, listeners);\r\n      return;\r\n    }\r\n\r\n    listeners.slice(all ? 0 : -1).forEach((listener) => {\r\n      postMessage(listener, ...args);\r\n    });\r\n  });\r\n};\r\n\r\nconst notifyWorker = (...args: any[]) => {\r\n  postMessage(self as any as DedicatedWorkerGlobalScope, ...args);\r\n};\r\n\r\nconst noop = () => {};\r\n\r\nexport const notifySomeone = IS_SERVICE_WORKER ? notifyServiceWorker.bind(null, false) : (IS_WEB_WORKER ? notifyWorker : noop);\r\nexport const notifyAll = IS_SERVICE_WORKER ? notifyServiceWorker.bind(null, true) : (IS_WEB_WORKER ? notifyWorker : noop);\r\n","export default function makeError(type: ErrorType, message?: string): ApiError {\r\n  const realError = new Error();\r\n  const error: ApiError = {type, stack: realError.stack};\r\n  if(message) {\r\n    error.message = message;\r\n  }\r\n\r\n  return error;\r\n}\r\n","const _logTimer = Date.now();\r\nexport default function dT() {\r\n  return '[' + ((Date.now() - _logTimer) / 1000).toFixed(3) + ']';\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport DEBUG from '../config/debug';\r\nimport {IS_FIREFOX, IS_SAFARI} from '../environment/userAgent';\r\nimport {IS_SERVICE_WORKER, IS_WEB_WORKER} from '../helpers/context';\r\nimport dT from '../helpers/dT';\r\n\r\nexport enum LogTypes {\r\n  None = 0,\r\n  Error = 1,\r\n  Warn = 2,\r\n  Log = 4,\r\n  Debug = 8\r\n};\r\n\r\nexport const LOG_LEVELS = [LogTypes.None, LogTypes.Error, LogTypes.Warn, LogTypes.Log, LogTypes.Debug];\r\n\r\nconst IS_WEBKIT = IS_SAFARI || IS_FIREFOX;\r\n\r\n// let getCallerFunctionNameFromLine: (line: string) => string;\r\n// if(IS_WEBKIT) {\r\n//   getCallerFunctionNameFromLine = (line) => {\r\n//     const splitted = line.split('@');\r\n//     return splitted[0];\r\n//   };\r\n// } else {\r\n//   getCallerFunctionNameFromLine = (line: string) => {\r\n//     const splitted = line.trim().split(' ');\r\n//     if(splitted.length === 3) {\r\n//       return splitted[1].slice(splitted[1].lastIndexOf('.') + 1);\r\n//     }\r\n//   };\r\n// }\r\n\r\nconst STYLES_SUPPORTED = !IS_WEBKIT;\r\n// const LINE_INDEX = IS_WEBKIT ? 2 : 3;\r\n\r\n// function getCallerFunctionName() {\r\n//   const stack = new Error().stack;\r\n//   const lines = stack.split('\\n');\r\n//   const line = lines[LINE_INDEX] || lines[lines.length - 1];\r\n//   // const match = line.match(/\\.([^\\.]+?)\\s/);\r\n//   // line = match ? match[1] : line.trim();\r\n//   const caller = getCallerFunctionNameFromLine(line) || '<anonymous>';\r\n//   return '[' + caller + ']';\r\n// }\r\n\r\nexport const LOGGER_STYLES = {\r\n  reset: '\\x1b[0m',\r\n  bright: '\\x1b[1m',\r\n  dim: '\\x1b[2m',\r\n  underscore: '\\x1b[4m',\r\n  blink: '\\x1b[5m',\r\n  reverse: '\\x1b[7m',\r\n  hidden: '\\x1b[8m',\r\n  // Foreground (text) colors\r\n  fg: {\r\n    black: '\\x1b[30m',\r\n    red: '\\x1b[31m',\r\n    green: '\\x1b[32m',\r\n    yellow: '\\x1b[33m',\r\n    blue: '\\x1b[34m',\r\n    magenta: '\\x1b[35m',\r\n    cyan: '\\x1b[36m',\r\n    white: '\\x1b[37m'\r\n  },\r\n  // Background colors\r\n  bg: {\r\n    black: '\\x1b[40m',\r\n    red: '\\x1b[41m',\r\n    green: '\\x1b[42m',\r\n    yellow: '\\x1b[43m',\r\n    blue: '\\x1b[44m',\r\n    magenta: '\\x1b[45m',\r\n    cyan: '\\x1b[46m',\r\n    white: '\\x1b[47m'\r\n  }\r\n};\r\n\r\nexport type Logger = {\r\n  (...args: any[]): void;\r\n  warn(...args: any[]): void;\r\n  info(...args: any[]): void;\r\n  error(...args: any[]): void;\r\n  trace(...args: any[]): void;\r\n  debug(...args: any[]): void;\r\n  assert(...args: any[]): void;\r\n  // log(...args: any[]): void;\r\n  group(...args: any[]): void;\r\n  groupCollapsed(...args: any[]): void;\r\n  groupEnd(...args: any[]): void;\r\n  setPrefix(newPrefix: string): void;\r\n  setLevel(level: 0 | 1 | 2 | 3 | 4): void;\r\n  bindPrefix(prefix: string, type?: LogTypes): Logger;\r\n};\r\n\r\nconst methods: ['debug' | 'info' | 'warn' | 'error' | 'assert' | 'trace'/*  | 'log' */ | 'group' | 'groupCollapsed' | 'groupEnd', LogTypes][] = [\r\n  ['debug', LogTypes.Debug],\r\n  ['info', LogTypes.Log],\r\n  ['warn', LogTypes.Warn],\r\n  ['error', LogTypes.Error],\r\n  ['assert', LogTypes.Error],\r\n  ['trace', LogTypes.Log],\r\n  ['group', LogTypes.Log],\r\n  ['groupCollapsed', LogTypes.Log],\r\n  ['groupEnd', LogTypes.Log]\r\n  // [\"log\", LogTypes.Log]\r\n];\r\n\r\nexport function logger(prefix: string, type: LogTypes = LogTypes.Log | LogTypes.Warn | LogTypes.Error, ignoreDebugReset = false, style = ''): Logger {\r\n  let originalPrefix: string;\r\n  if(!DEBUG && !ignoreDebugReset/*  || true */) {\r\n    type = LogTypes.Error;\r\n  }\r\n\r\n  if(!STYLES_SUPPORTED) {\r\n    style = '';\r\n  } else if(!style) {\r\n    if(IS_SERVICE_WORKER) style = LOGGER_STYLES.fg.yellow;\r\n    else if(IS_WEB_WORKER) style = LOGGER_STYLES.fg.cyan;\r\n  }\r\n\r\n  const originalStyle = style;\r\n  if(style) style = `%s ${style}%s`;\r\n  else style = '%s';\r\n\r\n  // level = LogLevels.log | LogLevels.warn | LogLevels.error | LogLevels.debug\r\n\r\n  const log: Logger = function(...args: any[]) {\r\n    return type & LogTypes.Log && console.log(style, dT(), prefix, /* getCallerFunctionName(), */ ...args);\r\n  } as any;\r\n\r\n  methods.forEach(([method, logType]) => {\r\n    log[method] = function(...args: any[]) {\r\n      return type & logType && console[method](style, dT(), prefix, /* getCallerFunctionName(), */ ...args);\r\n    };\r\n  });\r\n\r\n  log.setPrefix = function(newPrefix: string) {\r\n    originalPrefix = newPrefix;\r\n    prefix = '[' + newPrefix + ']';\r\n  };\r\n\r\n  log.setPrefix(prefix);\r\n\r\n  log.setLevel = function(level: 0 | 1 | 2 | 3 | 4) {\r\n    type = LOG_LEVELS.slice(0, level + 1).reduce((acc, v) => acc | v, 0) as any;\r\n  };\r\n\r\n  const prefixCache: {[prefix: string]: Logger} = {};\r\n  log.bindPrefix = function(prefix: string, _type = type) {\r\n    return prefixCache[prefix] ??= logger(\r\n      // `${originalPrefix}] ${LOGGER_STYLES.fg.magenta}[${prefix}`,\r\n      `${originalPrefix}] ${STYLES_SUPPORTED && originalStyle ? LOGGER_STYLES.reset : ''}[${prefix}`,\r\n      // `${originalPrefix}] [${prefix}`,\r\n      _type,\r\n      ignoreDebugReset,\r\n      // originalStyle || LOGGER_STYLES.reset\r\n      originalStyle\r\n      // LOGGER_STYLES.reset\r\n    );\r\n  };\r\n\r\n  return log;\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport DEBUG from '../../config/debug';\r\nimport tabId from '../../config/tabId';\r\nimport ctx from '../../environment/ctx';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport {IS_WORKER} from '../../helpers/context';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport makeError from '../../helpers/makeError';\r\nimport {Awaited, WorkerTaskTemplate, WorkerTaskVoidTemplate} from '../../types';\r\nimport {logger} from '../logger';\r\n\r\ntype SuperMessagePortTask = WorkerTaskTemplate & {\r\n  transfer?: Transferable[]\r\n};\r\n\r\ninterface InvokeTask extends SuperMessagePortTask {\r\n  type: 'invoke',\r\n  payload: WorkerTaskVoidTemplate & {withAck?: boolean, void?: boolean}\r\n}\r\n\r\ninterface ResultTask extends SuperMessagePortTask {\r\n  type: 'result',\r\n  payload: {\r\n    taskId: number,\r\n    result?: any,\r\n    error?: any\r\n  }\r\n}\r\n\r\ninterface AckTask extends SuperMessagePortTask {\r\n  type: 'ack',\r\n  payload: {\r\n    cached: boolean,\r\n    taskId: number\r\n    result?: any,\r\n    error?: any,\r\n  }\r\n}\r\n\r\ninterface PingTask extends SuperMessagePortTask {\r\n  type: 'ping'\r\n}\r\n\r\ninterface PongTask extends SuperMessagePortTask {\r\n  type: 'pong'\r\n}\r\n\r\ninterface BatchTask extends SuperMessagePortTask {\r\n  type: 'batch',\r\n  payload: Task[]\r\n}\r\n\r\ninterface CloseTask extends SuperMessagePortTask {\r\n  type: 'close'\r\n}\r\n\r\n// interface OpenTask extends SuperMessagePortTask {\r\n//   type: 'open'\r\n// }\r\n\r\ninterface LockTask extends SuperMessagePortTask {\r\n  type: 'lock',\r\n  payload: string\r\n}\r\n\r\ntype Task = InvokeTask | ResultTask | AckTask | PingTask | PongTask | BatchTask | CloseTask/*  | OpenTask */ | LockTask;\r\ntype TaskMap = {\r\n  [type in Task as type['type']]?: (task: Extract<Task, type>, source: MessageEventSource, event: MessageEvent<any>) => void | Promise<any>\r\n};\r\n\r\nexport type AckedResult<T> = {\r\n  cached: boolean,\r\n  result: Promise<T>\r\n};\r\n// export type AckedResult<T> = {\r\n//   cached: true,\r\n//   result: T\r\n// } | {\r\n//   cached: false,\r\n//   result: Promise<T>\r\n// };\r\n\r\ntype ListenPort = WindowProxy | MessagePort | ServiceWorker | Worker | ServiceWorkerContainer;\r\ntype SendPort = Pick<MessageEventSource, 'postMessage'>/* WindowProxy | MessagePort | ServiceWorker | Worker */;\r\n\r\nexport type MessageListenPort = ListenPort;\r\nexport type MessageSendPort = SendPort;\r\n\r\ntype ListenerCallback = (payload: any, source: MessageEventSource, event: MessageEvent<any>) => any;\r\ntype Listeners = Record<string, ListenerCallback>;\r\n\r\nconst USE_LOCKS = true;\r\nconst USE_BATCHING = true;\r\n\r\n// const PING_INTERVAL = DEBUG && false ? 0x7FFFFFFF : 5000;\r\n// const PING_TIMEOUT = DEBUG && false ? 0x7FFFFFFF : 10000;\r\n\r\n\r\nclass SuperMessagePort<\r\n  Workers extends Listeners,\r\n  Masters extends Listeners,\r\n  IsMaster extends boolean,\r\n  Receive extends Listeners = IsMaster extends true ? Masters : Workers,\r\n  Send extends Listeners = IsMaster extends true ? Workers : Masters\r\n> extends EventListenerBase<Receive> {\r\n  protected listenPorts: Array<ListenPort>;\r\n  protected sendPorts: Array<SendPort>;\r\n  protected pingResolves: Map<SendPort, () => void>;\r\n\r\n  protected taskId: number;\r\n  protected awaiting: {\r\n    [id: number]: {\r\n      resolve: any,\r\n      reject: any,\r\n      taskType: string,\r\n      port?: SendPort\r\n    }\r\n  };\r\n  protected pending: Map<SendPort, Task[]>;\r\n\r\n  protected log: ReturnType<typeof logger>;\r\n  protected debug: boolean;\r\n  protected releasingPending: boolean;\r\n\r\n  protected processTaskMap: TaskMap;\r\n\r\n  protected onPortDisconnect: (source: MessageEventSource) => void;\r\n  // protected onPortConnect: (source: MessageEventSource) => void;\r\n\r\n  protected heldLocks: Map<SendPort, {resolve: () => void, id: string}>;\r\n  protected requestedLocks: Map<string, SendPort>;\r\n\r\n  constructor(protected logSuffix?: string) {\r\n    super(false);\r\n\r\n    this.listenPorts = [];\r\n    this.sendPorts = [];\r\n    this.pingResolves = new Map();\r\n    this.taskId = Math.random(); // [0 <-> 1] Have some decimals to prevent tabs from overlapping ids\r\n    this.awaiting = {};\r\n    this.pending = new Map();\r\n    this.log = logger('MP' + (logSuffix ? '-' + logSuffix : ''));\r\n    this.debug = DEBUG;\r\n    this.heldLocks = new Map();\r\n    this.requestedLocks = new Map();\r\n\r\n    this.processTaskMap = {\r\n      result: this.processResultTask,\r\n      ack: this.processAckTask,\r\n      invoke: this.processInvokeTask,\r\n      ping: this.processPingTask,\r\n      pong: this.processPongTask,\r\n      close: this.processCloseTask,\r\n      // open: this.processOpenTask,\r\n      lock: this.processLockTask,\r\n      batch: this.processBatchTask\r\n    };\r\n  }\r\n\r\n  public setOnPortDisconnect(callback: (source: MessageEventSource) => void) {\r\n    this.onPortDisconnect = callback;\r\n  }\r\n\r\n  // public setOnPortConnect(callback: (source: MessageEventSource) => void) {\r\n  //   this.onPortConnect = callback;\r\n  // }\r\n\r\n  public attachPort(port: MessageEventSource) {\r\n    this.attachListenPort(port);\r\n    this.attachSendPort(port);\r\n  }\r\n\r\n  public attachListenPort(port: ListenPort) {\r\n    this.listenPorts.push(port);\r\n    port.addEventListener('message', this.onMessage as any);\r\n  }\r\n\r\n  public attachSendPort(port: SendPort) {\r\n    this.log.warn('attaching send port');\r\n\r\n    (port as MessagePort).start?.();\r\n\r\n    this.sendPorts.push(port);\r\n    // this.sendPing(port);\r\n\r\n    // const task = this.createTask('open', undefined);\r\n    // this.postMessage(port, task);\r\n\r\n    if(typeof(window) !== 'undefined' && USE_LOCKS) {\r\n      if('locks' in navigator) {\r\n        const id = ['lock', tabId, this.logSuffix || '', Math.random() * 0x7FFFFFFF | 0].join('-');\r\n        this.log.warn('created lock', id);\r\n        const promise = new Promise<void>((resolve) => this.heldLocks.set(port, {resolve, id}))\r\n        .then(() => this.heldLocks.delete(port));\r\n        navigator.locks.request(id, () => {\r\n          this.resendLockTask(port);\r\n          return promise;\r\n        });\r\n      } else {\r\n        window.addEventListener('beforeunload', () => {\r\n          const task = this.createTask('close', undefined);\r\n          this.postMessage(undefined, task);\r\n        });\r\n      }\r\n    }\r\n\r\n    this.releasePending();\r\n  }\r\n\r\n  public resendLockTask(port: SendPort) {\r\n    const lock = this.heldLocks.get(port);\r\n    if(!lock) {\r\n      return;\r\n    }\r\n\r\n    this.pushTask(this.createTask('lock', lock.id), port);\r\n  }\r\n\r\n  // ! Can't rely on ping because timers can be suspended\r\n  // protected sendPing(port: SendPort, loop = IS_WORKER) {\r\n  //   let timeout: number;\r\n  //   const promise = new Promise<void>((resolve, reject) => {\r\n  //     this.pingResolves.set(port, resolve);\r\n  //     this.pushTask(this.createTask('ping', undefined), port);\r\n\r\n  //     timeout = ctx.setTimeout(() => {\r\n  //       reject();\r\n  //     }, PING_TIMEOUT);\r\n  //   });\r\n\r\n  //   promise.then(() => {\r\n  //     // this.log('got pong');\r\n\r\n  //     clearTimeout(timeout);\r\n  //     this.pingResolves.delete(port);\r\n\r\n  //     if(loop) {\r\n  //       this.sendPingWithTimeout(port);\r\n  //     }\r\n  //   }, () => {\r\n  //     this.pingResolves.delete(port);\r\n  //     this.detachPort(port);\r\n  //   });\r\n  // }\r\n\r\n  // protected sendPingWithTimeout(port: SendPort, timeout = PING_INTERVAL) {\r\n  //   ctx.setTimeout(() => {\r\n  //     if(!this.sendPorts.includes(port)) {\r\n  //       return;\r\n  //     }\r\n\r\n  //     this.sendPing(port);\r\n  //   }, timeout);\r\n  // }\r\n\r\n  public detachPort(port: ListenPort) {\r\n    this.log.warn('disconnecting port');\r\n\r\n    indexOfAndSplice(this.listenPorts, port);\r\n    indexOfAndSplice(this.sendPorts, port as any);\r\n\r\n    port.removeEventListener?.('message', this.onMessage as any);\r\n    (port as MessagePort).close?.();\r\n\r\n    this.onPortDisconnect?.(port as any);\r\n\r\n    const heldLock = this.heldLocks.get(port as SendPort);\r\n    heldLock?.resolve();\r\n\r\n    const error = makeError('PORT_DISCONNECTED');\r\n    for(const id in this.awaiting) {\r\n      const task = this.awaiting[id];\r\n      if(task.port === port) {\r\n        task.reject(error);\r\n        delete this.awaiting[id];\r\n      }\r\n    }\r\n  }\r\n\r\n  protected postMessage(port: SendPort | SendPort[], task: Task) {\r\n    const ports = Array.isArray(port) ? port : (port ? [port] : this.sendPorts);\r\n    ports.forEach((port) => {\r\n      if(import.meta.env.MODE === 'test') {\r\n        return;\r\n      }\r\n\r\n      port.postMessage(task, task.transfer as any);\r\n    });\r\n  }\r\n\r\n  protected onMessage = (event: MessageEvent) => {\r\n    const task: Task = event.data;\r\n    // this.log('got message', task);\r\n\r\n    const source: MessageEventSource = event.source || event.currentTarget as any; // can have no source\r\n\r\n    // @ts-ignore\r\n    this.processTaskMap[task.type](task, source, event);\r\n  };\r\n\r\n  protected async releasePending() {\r\n    // return;\r\n\r\n    if(/* !this.listenPorts.length || !this.sendPorts.length ||  */this.releasingPending) {\r\n      return;\r\n    }\r\n\r\n    this.releasingPending = true;\r\n    // const perf = performance.now();\r\n\r\n    if(USE_BATCHING) {\r\n      await Promise.resolve();\r\n    }\r\n    // await pause(0);\r\n\r\n    this.debug && this.log.debug('releasing tasks, length:', this.pending.size/* , performance.now() - perf */);\r\n\r\n    this.pending.forEach((portTasks, port) => {\r\n      let tasks: Task[] = portTasks;\r\n      if(USE_BATCHING) {\r\n        let batchTask: BatchTask;\r\n        tasks = [];\r\n        portTasks.forEach((task) => {\r\n          if(task.transfer) {\r\n            batchTask = undefined;\r\n            tasks.push(task);\r\n          } else {\r\n            if(!batchTask) {\r\n              batchTask = this.createTask('batch', []);\r\n              tasks.push(batchTask);\r\n            }\r\n\r\n            batchTask.payload.push(task);\r\n          }\r\n        });\r\n      }\r\n\r\n      const ports = port ? [port] : this.sendPorts;\r\n      if(!ports.length) {\r\n        return;\r\n      }\r\n\r\n      tasks.forEach((task) => {\r\n        // if(USE_BATCHING && task.type === 'batch') {\r\n        //   this.log(`batching ${task.payload.length} tasks`);\r\n        // }\r\n\r\n        try {\r\n          // if(IS_SERVICE_WORKER && !port) {\r\n          //   notifyAll(task);\r\n          // } else {\r\n          this.postMessage(ports, task);\r\n          // }\r\n        } catch(err) {\r\n          this.log.error('postMessage error:', err, task, ports);\r\n        }\r\n      });\r\n\r\n      this.pending.delete(port);\r\n    });\r\n\r\n    this.debug && this.log.debug('released tasks');\r\n\r\n    this.releasingPending = false;\r\n  }\r\n\r\n  protected processResultTask = (task: ResultTask) => {\r\n    const {taskId, result, error} = task.payload;\r\n    const deferred = this.awaiting[taskId];\r\n    if(!deferred) {\r\n      return;\r\n    }\r\n\r\n    this.debug && this.log.debug('done', deferred.taskType, result, error);\r\n    'error' in task.payload ? deferred.reject(error) : deferred.resolve(result);\r\n    delete this.awaiting[taskId];\r\n  };\r\n\r\n  protected processAckTask = (task: AckTask) => {\r\n    const payload = task.payload;\r\n    const deferred = this.awaiting[payload.taskId];\r\n    if(!deferred) {\r\n      return;\r\n    }\r\n\r\n    // * will finish the init promise with incoming result\r\n    const previousResolve: (acked: AckedResult<any>) => void = deferred.resolve;\r\n    // const previousReject = deferred.reject;\r\n\r\n    // if(payload.cached) {\r\n    //   if('result' in payload) {\r\n    //     previousResolve({\r\n    //       cached: true,\r\n    //       result: payload.result\r\n    //     });\r\n    //   } else {\r\n    //     previousReject(payload.error);\r\n    //   }\r\n    // } else {\r\n    //   const ret: AckedResult<any> = {\r\n    //     cached: false,\r\n    //     result: new Promise((resolve, reject) => {\r\n    //       deferred.resolve = resolve;\r\n    //       deferred.reject = reject;\r\n    //     })\r\n    //   };\r\n\r\n    //   previousResolve(ret);\r\n    // }\r\n\r\n    const ret: AckedResult<any> = {\r\n      cached: payload.cached,\r\n      result: payload.cached ? ('result' in payload ? Promise.resolve(payload.result) : Promise.reject(payload.error)) : new Promise((resolve, reject) => {\r\n        deferred.resolve = resolve;\r\n        deferred.reject = reject;\r\n      })\r\n    };\r\n\r\n    previousResolve(ret);\r\n\r\n    if(payload.cached) {\r\n      delete this.awaiting[payload.taskId];\r\n    }\r\n  };\r\n\r\n  protected processPingTask = (task: PingTask, source: MessageEventSource, event: MessageEvent) => {\r\n    this.pushTask(this.createTask('pong', undefined), event.source);\r\n  };\r\n\r\n  protected processPongTask = (task: PongTask, source: MessageEventSource, event: MessageEvent) => {\r\n    const pingResolve = this.pingResolves.get(source);\r\n    if(pingResolve) {\r\n      this.pingResolves.delete(source);\r\n      pingResolve();\r\n    }\r\n  };\r\n\r\n  protected processCloseTask = (task: CloseTask, source: MessageEventSource, event: MessageEvent) => {\r\n    this.detachPort(source);\r\n  };\r\n\r\n  protected processBatchTask = (task: BatchTask, source: MessageEventSource, event: MessageEvent) => {\r\n    if(!USE_BATCHING) {\r\n      return;\r\n    }\r\n\r\n    const newEvent: MessageEvent = {data: event.data, source: event.source, currentTarget: event.currentTarget} as any;\r\n    task.payload.forEach((task) => {\r\n      // @ts-ignore\r\n      newEvent.data = task;\r\n      this.onMessage(newEvent);\r\n    });\r\n  };\r\n\r\n  // * it's just an 'open' callback, DO NOT attach port from here\r\n  // protected processOpenTask = (task: OpenTask, source: MessageEventSource, event: MessageEvent) => {\r\n  //   this.onPortConnect?.(source);\r\n  // };\r\n\r\n  protected processLockTask = (task: LockTask, source: MessageEventSource, event: MessageEvent) => {\r\n    const id = task.payload;\r\n    if(this.requestedLocks.has(id)) {\r\n      return;\r\n    }\r\n\r\n    this.requestedLocks.set(id, source);\r\n    navigator.locks.request(id, () => {\r\n      this.processCloseTask(undefined, source, undefined);\r\n      this.requestedLocks.delete(id);\r\n    });\r\n  };\r\n\r\n  protected processInvokeTask = async(task: InvokeTask, source: MessageEventSource, event: MessageEvent) => {\r\n    const id = task.id;\r\n    const innerTask = task.payload;\r\n\r\n    let resultTaskPayload: ResultTask['payload'];\r\n    let resultTask: ResultTask, ackTask: AckTask;\r\n    if(!innerTask.void) {\r\n      resultTaskPayload = {taskId: id};\r\n      resultTask = this.createTask('result', resultTaskPayload);\r\n    }\r\n\r\n    if(innerTask.withAck) {\r\n      ackTask = this.createTask('ack', {\r\n        taskId: id,\r\n        cached: true\r\n      });\r\n    }\r\n\r\n    let isPromise: boolean;\r\n\r\n    try {\r\n      const listeners = this.listeners[innerTask.type];\r\n      if(!listeners?.size) {\r\n        throw new Error('no listener');\r\n      }\r\n\r\n      const listener = listeners.values().next().value;\r\n\r\n      // @ts-ignore\r\n      let result = this.invokeListenerCallback(innerTask.type, listener, innerTask.payload, source, event);\r\n      if(innerTask.void) {\r\n        return;\r\n      }\r\n\r\n      isPromise = result instanceof Promise;\r\n\r\n      if(ackTask) {\r\n        const cached = !isPromise;\r\n        ackTask.payload.cached = cached;\r\n        if(cached) ackTask.payload.result = result;\r\n        this.pushTask(ackTask, source);\r\n\r\n        if(cached) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      if(isPromise) {\r\n        result = await result;\r\n      }\r\n\r\n      if(result instanceof SuperMessagePort.TransferableResult) {\r\n        resultTask.transfer = result.transferables;\r\n        result = result.value;\r\n      }\r\n\r\n      resultTaskPayload.result = result;\r\n    } catch(error) {\r\n      this.log.error('worker task error:', error, task);\r\n      if(innerTask.void) {\r\n        return;\r\n      }\r\n\r\n      if(ackTask && ackTask.payload.cached) {\r\n        ackTask.payload.error = error;\r\n        this.pushTask(ackTask, source);\r\n        return;\r\n      }\r\n\r\n      resultTaskPayload.error = error;\r\n    }\r\n\r\n    this.pushTask(resultTask, source);\r\n  };\r\n\r\n  protected createTask<T extends Task['type'], K extends Task = Parameters<TaskMap[T]>[0]>(type: T, payload: K['payload'], transfer?: Transferable[]): K {\r\n    return {\r\n      type,\r\n      payload,\r\n      id: this.taskId++,\r\n      transfer\r\n    } as K;\r\n  }\r\n\r\n  protected createInvokeTask(type: string, payload: any, withAck?: boolean, _void?: boolean, transfer?: Transferable[]): InvokeTask {\r\n    return this.createTask('invoke', {\r\n      type,\r\n      payload,\r\n      withAck,\r\n      void: _void\r\n    }, transfer);\r\n  }\r\n\r\n  protected pushTask(task: Task, port?: SendPort) {\r\n    let tasks = this.pending.get(port);\r\n    if(!tasks) {\r\n      this.pending.set(port, tasks = []);\r\n    }\r\n\r\n    tasks.push(task);\r\n    this.releasePending();\r\n  }\r\n\r\n  public invokeVoid<T extends keyof Send>(type: T, payload: Parameters<Send[T]>[0], port?: SendPort, transfer?: Transferable[]) {\r\n    const task = this.createInvokeTask(type as string, payload, undefined, true, transfer);\r\n    this.pushTask(task, port);\r\n  }\r\n\r\n  public invoke<T extends keyof Send>(type: T, payload: Parameters<Send[T]>[0], withAck?: false, port?: SendPort, transfer?: Transferable[]): Promise<Awaited<ReturnType<Send[T]>>>;\r\n  public invoke<T extends keyof Send>(type: T, payload: Parameters<Send[T]>[0], withAck?: true, port?: SendPort, transfer?: Transferable[]): Promise<AckedResult<Awaited<ReturnType<Send[T]>>>>;\r\n  public invoke<T extends keyof Send>(type: T, payload: Parameters<Send[T]>[0], withAck?: boolean, port?: SendPort, transfer?: Transferable[]) {\r\n    this.debug && this.log.debug('start', type, payload);\r\n\r\n    let task: InvokeTask;\r\n    const promise = new Promise<Awaited<ReturnType<Send[T]>>>((resolve, reject) => {\r\n      task = this.createInvokeTask(type as string, payload, withAck, undefined, transfer);\r\n      this.awaiting[task.id] = {resolve, reject, taskType: type as string, port};\r\n      this.pushTask(task, port);\r\n    });\r\n\r\n    if(IS_WORKER) {\r\n      promise.finally(() => {\r\n        clearInterval(interval);\r\n      });\r\n\r\n      const interval = ctx.setInterval(() => {\r\n        this.log.error('task still has no result', task, port);\r\n      }, 60e3);\r\n    } else if(false) {\r\n      // let timedOut = false;\r\n      const startTime = Date.now();\r\n      promise.finally(() => {\r\n        const elapsedTime = Date.now() - startTime;\r\n        if(elapsedTime >= TIMEOUT) {\r\n          this.log.error(`task was processing ${Date.now() - startTime}ms`, task.payload.payload, port);\r\n        }/*  else {\r\n          clearTimeout(timeout);\r\n        } */\r\n      });\r\n\r\n      const TIMEOUT = 10;\r\n      // const timeout = ctx.setTimeout(() => {\r\n      //   timedOut = true;\r\n      //   // this.log.error(`task is processing more than ${TIMEOUT} milliseconds`, task, port);\r\n      // }, TIMEOUT);\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public invokeExceptSource<T extends keyof Send>(type: T, payload: Parameters<Send[T]>[0], source?: SendPort) {\r\n    const ports = this.sendPorts.slice();\r\n    indexOfAndSplice(ports, source);\r\n\r\n    ports.forEach((target) => {\r\n      this.invokeVoid(type, payload, target);\r\n    });\r\n  }\r\n\r\n  public async invokeExceptSourceAsync<T extends keyof Send>(type: T, payload: Parameters<Send[T]>[0], source?: SendPort) {\r\n    const ports = this.sendPorts.slice();\r\n    indexOfAndSplice(ports, source);\r\n\r\n    await Promise.all(ports.map((target) => this.invoke(type, payload, undefined, target)));\r\n  }\r\n}\r\n\r\nnamespace SuperMessagePort {\r\n  export type TransferableResultValue<T> = T extends MaybePromise<TransferableResult<infer U>> ? U : T;\r\n\r\n  export class TransferableResult<T> {\r\n    constructor(public value: T, public transferables: Transferable[]) { }\r\n  };\r\n}\r\n\r\nexport default SuperMessagePort;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport type {getEnvironment} from '../../environment/utils';\r\nimport type {LocalStorageEncryptedProxyTaskPayload, LocalStorageProxyTask} from '../localStorage';\r\nimport type {MirrorTaskPayload, NotificationBuildTaskPayload, TabState} from './mtprotoworker';\r\nimport type toggleStorages from '../../helpers/toggleStorages';\r\nimport type {ActiveAccountNumber} from '../accounts/types';\r\nimport type {LoadStateResult} from '../appManagers/utils/state/loadState';\r\nimport type {PasscodeStorageValue} from '../commonStateStorage';\r\nimport SuperMessagePort from './superMessagePort';\r\n\r\nexport type MTProtoManagerTaskPayload = {name: string, method: string, args: any[], accountNumber: ActiveAccountNumber};\r\n\r\ntype CallNotificationPayload = {\r\n  callerId: string | number,\r\n  callId: string | number,\r\n  accountNumber: ActiveAccountNumber\r\n}\r\n\r\ntype MTProtoBroadcastEvent = {\r\n  event: (payload: {name: string, args: any[], accountNumber: ActiveAccountNumber}, source: MessageEventSource) => void\r\n};\r\n\r\nexport type ToggleUsingPasscodePayload = {\r\n  isUsingPasscode: true;\r\n  encryptionKey: CryptoKey;\r\n} | {\r\n  isUsingPasscode: false;\r\n};\r\n\r\nexport default class MTProtoMessagePort<Master extends boolean = true> extends SuperMessagePort<{\r\n  environment: (environment: ReturnType<typeof getEnvironment>) => void,\r\n  crypto: (payload: {method: string, args: any[]}) => Promise<any>,\r\n  state: (payload: {accountNumber: ActiveAccountNumber} & LoadStateResult) => void,\r\n  manager: (payload: MTProtoManagerTaskPayload) => any,\r\n  toggleStorages: (payload: {enabled: boolean, clearWrite: boolean}) => ReturnType<typeof toggleStorages>,\r\n  serviceWorkerOnline: (online: boolean) => void,\r\n  serviceWorkerPort: (payload: void, source: MessageEventSource, event: MessageEvent) => void,\r\n  cryptoPort: (payload: void, source: MessageEventSource, event: MessageEvent) => void,\r\n  createObjectURL: (blob: Blob) => string,\r\n  tabState: (payload: TabState, source: MessageEventSource) => void,\r\n  createProxyWorkerURLs: (payload: {originalUrl: string, blob: Blob}) => string[],\r\n  setInterval: (timeout: number) => number,\r\n  clearInterval: (intervalId: number) => void,\r\n  terminate: () => void,\r\n  toggleUsingPasscode: (payload: ToggleUsingPasscodePayload, source: MessageEventSource) => void,\r\n  changePasscode: (payload: {toStore: PasscodeStorageValue, encryptionKey: CryptoKey}, source: MessageEventSource) => void,\r\n  saveEncryptionKey: (payload: CryptoKey, source: MessageEventSource) => void,\r\n  isLocked: (payload: void, source: MessageEventSource) => Promise<boolean>,\r\n  toggleLockOthers: (isLocked: boolean, source: MessageEventSource) => void\r\n  localStorageEncryptedProxy: (payload: LocalStorageEncryptedProxyTaskPayload) => Promise<any>,\r\n  toggleCacheStorage: (value: boolean, source: MessageEventSource) => void,\r\n  forceLogout: () => void,\r\n  toggleUninteruptableActivity: (payload: {activity: string, active: boolean}, source: MessageEventSource) => void\r\n} & MTProtoBroadcastEvent, {\r\n  convertWebp: (payload: {fileName: string, bytes: Uint8Array}) => Promise<Uint8Array>,\r\n  convertOpus: (payload: {fileName: string, bytes: Uint8Array}) => Promise<Uint8Array>,\r\n  localStorageProxy: (payload: LocalStorageProxyTask['payload']) => Promise<any>,\r\n  mirror: (payload: MirrorTaskPayload) => void,\r\n  notificationBuild: (payload: NotificationBuildTaskPayload) => void,\r\n  receivedServiceMessagePort: (payload: void) => void,\r\n  log: (payload: any) => void,\r\n  tabsUpdated: (payload: TabState[]) => void,\r\n  callNotification: (payload: CallNotificationPayload) => void,\r\n  intervalCallback: (intervalId: number) => void,\r\n  toggleLock: (isLocked: boolean) => void,\r\n  saveEncryptionKey: (payload: CryptoKey, source: MessageEventSource) => void,\r\n  toggleCacheStorage: (value: boolean, source: MessageEventSource) => void,\r\n  toggleUsingPasscode: (payload: ToggleUsingPasscodePayload, source: MessageEventSource) => void,\r\n} & MTProtoBroadcastEvent, Master> {\r\n  private static INSTANCE: MTProtoMessagePort;\r\n\r\n  constructor() {\r\n    super('MTPROTO');\r\n\r\n    MTProtoMessagePort.INSTANCE = this;\r\n\r\n    MOUNT_CLASS_TO && (MOUNT_CLASS_TO.mtprotoMessagePort = this);\r\n  }\r\n\r\n  public static getInstance<Master extends boolean>() {\r\n    return this.INSTANCE as MTProtoMessagePort<Master>;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {Message, StickerSet, Update, NotifyPeer, PeerNotifySettings, PollResults, Poll, WebPage, GroupCall, GroupCallParticipant, ReactionCount, MessagePeerReaction, PhoneCall, Config, Reaction, AttachMenuBot, PeerSettings, StoryItem, PeerStories, SavedDialog, SavedReactionTag} from '../layer';\r\nimport type {Dialog, ForumTopic, MessagesStorageKey, MyMessage} from './appManagers/appMessagesManager';\r\nimport type {MyDialogFilter} from './storages/filters';\r\nimport type {AnyDialog, Folder} from './storages/dialogs';\r\nimport type {UserTyping} from './appManagers/appProfileManager';\r\nimport type {MyDraftMessage} from './appManagers/appDraftsManager';\r\nimport type {ConnectionStatusChange} from './mtproto/connectionStatus';\r\nimport type {GroupCallId} from './appManagers/appGroupCallsManager';\r\nimport type {AppManagers} from './appManagers/managers';\r\nimport type {StateSettings} from '../config/state';\r\nimport type {Progress} from './appManagers/appDownloadManager';\r\nimport type {CallId} from './appManagers/appCallsManager';\r\nimport type {MyDocument} from './appManagers/appDocsManager';\r\nimport type {MTAppConfig} from './mtproto/appConfig';\r\nimport type StoriesCacheType from './appManagers/utils/stories/cacheType';\r\nimport type {StoriesListPosition} from './appManagers/appStoriesManager';\r\nimport type {ArgumentTypes} from '../types';\r\nimport type {RtmpCallInstance} from './calls/rtmpCallsController';\r\nimport {NULL_PEER_ID, UserAuth} from './mtproto/mtproto_config';\r\nimport EventListenerBase, {EventListenerListeners} from '../helpers/eventListenerBase';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport MTProtoMessagePort from './mtproto/mtprotoMessagePort';\r\nimport {ActiveAccountNumber} from './accounts/types';\r\n\r\nexport type BroadcastEvents = {\r\n  'chat_full_update': ChatId,\r\n  'chat_update': ChatId,\r\n  'chat_toggle_forum': {chatId: ChatId, enabled: boolean},\r\n  'chat_participant': Update.updateChannelParticipant,\r\n  'chat_participation': {chatId: ChatId, left: boolean},\r\n  'chat_requests': {requestsPending: number, recentRequesters: UserId[], chatId: ChatId}\r\n\r\n  'channel_update': ChatId,\r\n\r\n  'user_update': UserId,\r\n  'user_auth': UserAuth,\r\n  'user_full_update': UserId,\r\n\r\n  'attach_menu_bot': AttachMenuBot,\r\n\r\n  'emoji_status_change': void,\r\n\r\n  'peer_pinned_messages': {peerId: PeerId, mids?: number[], pinned?: boolean, unpinAll?: true},\r\n  'peer_pinned_hidden': {peerId: PeerId, maxId: number},\r\n  'peer_typings': {peerId: PeerId, threadId?: number, typings: UserTyping[]},\r\n  'peer_block': {peerId: PeerId, blocked?: boolean, blockedMyStoriesFrom?: boolean},\r\n  'peer_title_edit': {peerId: PeerId, threadId?: number},\r\n  'peer_bio_edit': PeerId,\r\n  'peer_deleted': PeerId, // left chat, deleted user dialog, left channel\r\n  'peer_full_update': PeerId,\r\n  'peer_settings': {peerId: PeerId, settings: PeerSettings},\r\n  'peer_stories': {peerId: PeerId, available: boolean},\r\n  'peer_stories_hidden': {peerId: PeerId, hidden: boolean},\r\n\r\n  'filter_delete': MyDialogFilter,\r\n  'filter_update': MyDialogFilter,\r\n  'filter_new': MyDialogFilter,\r\n  'filter_order': number[],\r\n  'filter_joined': MyDialogFilter,\r\n\r\n  'folder_unread': Omit<Folder, 'dialogs' | 'dispatchUnreadTimeout'>,\r\n\r\n  'changing_folder_from_chatlist': number,\r\n  'changing_folder_from_sidebar': {id: number, dontAnimate?: boolean},\r\n\r\n  'dialog_draft': {peerId: PeerId, dialog: Dialog | ForumTopic, drop: boolean, draft: MyDraftMessage | undefined},\r\n  'dialog_unread': {peerId: PeerId, dialog: Dialog | ForumTopic},\r\n  'dialog_flush': {peerId: PeerId, dialog: Dialog},\r\n  'dialog_drop': AnyDialog,\r\n  'dialog_migrate': {migrateFrom: PeerId, migrateTo: PeerId},\r\n  // 'dialog_top': Dialog,\r\n  'dialog_notify_settings': Dialog | ForumTopic,\r\n  // 'dialog_order': {dialog: Dialog, pos: number},\r\n  'dialogs_multiupdate': Map<PeerId, {dialog?: Dialog, topics?: Map<number, ForumTopic>, saved?: Map<PeerId, SavedDialog>}>,\r\n\r\n  'history_append': {storageKey: MessagesStorageKey, message: Message.message},\r\n  'history_update': {storageKey: MessagesStorageKey, message: MyMessage, sequential?: boolean},\r\n  'history_reply_markup': {peerId: PeerId},\r\n  'history_multiappend': MyMessage,\r\n  // 'history_delete': {peerId: PeerId, msgs: Map<number, {savedPeerId?: PeerId}>},\r\n  'history_delete': {peerId: PeerId, msgs: Set<number>},\r\n  'history_forbidden': PeerId,\r\n  'history_reload': PeerId,\r\n  'history_count': {historyKey: string, count: number},\r\n  'history_delete_key': {historyKey: string, mid: number},\r\n  // 'history_request': void,\r\n\r\n  'message_edit': {storageKey: MessagesStorageKey, peerId: PeerId, mid: number, message: MyMessage},\r\n  'message_sent': {storageKey: MessagesStorageKey, tempId: number, tempMessage: any, mid: number, message: MyMessage},\r\n  'message_error': {storageKey: MessagesStorageKey, peerId: PeerId, tempId: number, error: ApiError},\r\n  'message_transcribed': {peerId: PeerId, mid: number, text: string, pending?: boolean},\r\n  'messages_views': {peerId: PeerId, mid: number, views: number}[],\r\n  'messages_reactions': {message: Message.message, changedResults: ReactionCount[], removedResults: ReactionCount[]}[],\r\n  'messages_pending': void,\r\n  'messages_read': void,\r\n  'messages_downloaded': {peerId: PeerId, mids: number[]},\r\n  'messages_media_read': {peerId: PeerId, mids: number[]},\r\n\r\n  'story_update': {peerId: PeerId, story: StoryItem, modifiedPinned?: boolean, modifiedArchive?: boolean, modifiedPinnedToTop?: boolean},\r\n  'story_deleted': {peerId: PeerId, id: number},\r\n  'story_expired': {peerId: PeerId, id: number},\r\n  'story_new': {peerId: PeerId, story: StoryItem, cacheType: StoriesCacheType, maxReadId: number},\r\n  'stories_stories': PeerStories,\r\n  'stories_read': {peerId: PeerId, maxReadId: number},\r\n  'stories_downloaded': {peerId: PeerId, ids: number[]},\r\n  'stories_position': {peerId: PeerId, position: StoriesListPosition},\r\n\r\n  'replies_updated': Message.message,\r\n  'replies_short_update': Message.message,\r\n\r\n  'scheduled_new': Message.message,\r\n  'scheduled_delete': {peerId: PeerId, mids: number[]},\r\n\r\n  'grouped_edit': {peerId: PeerId, groupedId: string, deletedMids: number[], messages: Message.message[]},\r\n\r\n  'stickers_installed': StickerSet.stickerSet,\r\n  'stickers_deleted': StickerSet.stickerSet,\r\n  'stickers_updated': {type: 'recent' | 'faved', stickers: MyDocument[]},\r\n  'stickers_top': Long,\r\n  'stickers_order': {type: 'masks' | 'emojis' | 'stickers', order: Long[]},\r\n  'sticker_updated': {type: 'recent' | 'faved', document: MyDocument, faved: boolean},\r\n\r\n  'gifs_updated': MyDocument[],\r\n  'gif_updated': {document: MyDocument, saved: boolean},\r\n\r\n  'state_cleared': void,\r\n  'state_synchronized': void,\r\n  'state_synchronizing': void,\r\n\r\n  'contacts_update': UserId,\r\n  'avatar_update': {peerId: PeerId, threadId?: number},\r\n  'poll_update': {poll: Poll, results: PollResults},\r\n  'invalidate_participants': ChatId,\r\n  // 'channel_settings': {channelId: number},\r\n  'webpage_updated': {id: WebPage.webPage['id'], msgs: {peerId: PeerId, mid: number, isScheduled: boolean}[]},\r\n\r\n  'connection_status_change': ConnectionStatusChange,\r\n  'settings_updated': {key: string, value: any, settings: StateSettings},\r\n  'draft_updated': {peerId: PeerId, threadId: number, draft: MyDraftMessage | undefined, force?: boolean},\r\n\r\n  'background_change': void,\r\n\r\n  'privacy_update': Update.updatePrivacy,\r\n\r\n  'notify_settings': Update.updateNotifySettings,\r\n  'notify_peer_type_settings': {key: Exclude<NotifyPeer['_'], 'notifyPeer'>, settings: PeerNotifySettings},\r\n\r\n  'notification_reset': string,\r\n  'notification_cancel': string,\r\n\r\n  'notification_count_update': void,\r\n\r\n  'language_change': string,\r\n\r\n  'theme_change': {x: number, y: number} | void,\r\n  'theme_changed': void,\r\n\r\n  'media_play': void,\r\n\r\n  'emoji_recent': {emoji: AppEmoji, deleted?: boolean},\r\n\r\n  'download_progress': Progress,\r\n  'document_downloading': DocId,\r\n  'document_downloaded': DocId,\r\n\r\n  'choosing_sticker': boolean\r\n\r\n  'group_call_update': GroupCall,\r\n  'group_call_participant': {groupCallId: GroupCallId, participant: GroupCallParticipant},\r\n  // 'group_call_video_track_added': {instance: GroupCallInstance}\r\n\r\n  'call_update': PhoneCall,\r\n  'call_signaling': {callId: CallId, data: Uint8Array},\r\n\r\n  'rtmp_call_update': RtmpCallInstance,\r\n\r\n  'quick_reaction': Reaction,\r\n\r\n  'service_notification': Update.updateServiceNotification,\r\n\r\n  'logging_out': {accountNumber?: ActiveAccountNumber, migrateTo?: ActiveAccountNumber},\r\n\r\n  'payment_sent': {peerId: PeerId, mid: number, receiptMessage: Message.messageService},\r\n\r\n  'web_view_result_sent': Long,\r\n\r\n  'premium_toggle': boolean,\r\n  'premium_toggle_private': {isNew: boolean, isPremium: boolean},\r\n\r\n  'saved_tags': {savedPeerId: PeerId, tags: SavedReactionTag[]},\r\n  'saved_tags_clear': void,\r\n\r\n  'stars_balance': Long,\r\n\r\n  'file_speed_limited': {increaseTimes: number, isUpload: boolean},\r\n\r\n  'config': Config,\r\n  'app_config': MTAppConfig,\r\n  'managers_ready': void, // ! inner\r\n\r\n  'account_logged_in': {accountNumber: ActiveAccountNumber, userId: UserId},\r\n\r\n  'resizing_left_sidebar': void,\r\n\r\n  'chat_background_set': void,\r\n\r\n  'toggle_using_passcode': boolean,\r\n  'toggle_locked': boolean\r\n};\r\n\r\nexport type BroadcastEventsListeners = {\r\n  [name in keyof BroadcastEvents]: (e: BroadcastEvents[name]) => void\r\n};\r\n\r\nexport class RootScope extends EventListenerBase<BroadcastEventsListeners> {\r\n  public myId: PeerId;\r\n  private connectionStatus: {[name: string]: ConnectionStatusChange};\r\n  public settings: StateSettings;\r\n  public managers: AppManagers;\r\n  public premium: boolean;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.myId = NULL_PEER_ID;\r\n    this.connectionStatus = {};\r\n    this.premium = false;\r\n\r\n    this.addEventListener('user_auth', ({id}) => {\r\n      this.myId = id.toPeerId();\r\n    });\r\n\r\n    this.addEventListener('premium_toggle_private', ({isNew, isPremium}) => {\r\n      this.premium = isPremium;\r\n      if(!isNew) { // * only on change\r\n        this.dispatchEventSingle('premium_toggle', isPremium);\r\n      }\r\n    });\r\n\r\n    this.addEventListener('connection_status_change', (status) => {\r\n      this.connectionStatus[status.name] = status;\r\n    });\r\n\r\n    this.dispatchEvent = (e, ...args) => {\r\n      super.dispatchEvent(e, ...args);\r\n      (async() => {\r\n        const accountNumber = this.managers ? await this.managers.apiManager.getAccountNumber() : undefined;\r\n        MTProtoMessagePort.getInstance().invokeVoid('event', {\r\n          name: e as string,\r\n          args,\r\n          accountNumber\r\n        });\r\n      })();\r\n    };\r\n  }\r\n\r\n  public getConnectionStatus() {\r\n    return this.connectionStatus;\r\n  }\r\n\r\n  public getPremium() {\r\n    return this.premium;\r\n  }\r\n\r\n  public getMyId() {\r\n    return this.myId;\r\n  }\r\n\r\n  public dispatchEventSingle<L extends EventListenerListeners = BroadcastEventsListeners, T extends keyof L = keyof L>(\r\n    name: T,\r\n    ...args: ArgumentTypes<L[T]>\r\n  ) {\r\n    super.dispatchEvent(name, ...args);\r\n  }\r\n}\r\n\r\nconst rootScope = new RootScope();\r\nMOUNT_CLASS_TO.rootScope = rootScope;\r\nexport default rootScope;\r\n","/**\r\n * ignores `undefined` properties\r\n */\r\nexport default function deepEqual<T>(x: T, y: T, ignoreKeys?: (keyof T)[]): boolean {\r\n  const ignoreSet = ignoreKeys && new Set(ignoreKeys);\r\n  const okok = (obj: any) => Object.keys(obj).filter((key) => obj[key] !== undefined);\r\n  const ok = ignoreKeys ? (obj: any) => okok(obj).filter((key) => !ignoreSet.has(key as any)) : okok,\r\n    tx = typeof x,\r\n    ty = typeof y;\r\n  return x && y && tx === 'object' && tx === ty ? (\r\n    ok(x).length === ok(y).length &&\r\n      ok(x).every((key) => deepEqual((x as any)[key], (y as any)[key], ignoreKeys))\r\n  ) : (x === y);\r\n}\r\n","export default function safeAssign<T>(object: T, fromObject: any) {\r\n  if(fromObject) {\r\n    for(const i in fromObject) {\r\n      if(fromObject[i] !== undefined) {\r\n        // @ts-ignore\r\n        object[i] = fromObject[i];\r\n      }\r\n    }\r\n  }\r\n\r\n  return object;\r\n}\r\n","export default function capitalizeFirstLetter(string: string) {\r\n  return string.charAt(0).toUpperCase() + string.slice(1);\r\n}\r\n","const SKIP_PROTOCOLS: Set<string> = new Set([\r\n  'javascript:'\r\n]);\r\nexport default function matchUrlProtocol(text: string) {\r\n  if(!text) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const protocol = new URL(text).protocol;\r\n    if(SKIP_PROTOCOLS.has(protocol)) {\r\n      return null;\r\n    }\r\n\r\n    return protocol;\r\n  } catch(err) {\r\n    return null;\r\n  }\r\n}\r\n","// Copyright Twitter Inc. Licensed under MIT\r\n// https://github.com/twitter/twemoji-parser/blob/master/LICENSE.md\r\n\r\nconst originalString = '((?:\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f?\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f?\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f?\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f?\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f?\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc8b\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\udef1\\ud83c\\udffb\\u200d\\ud83e\\udef2\\ud83c[\\udffc-\\udfff]|\\ud83e\\udef1\\ud83c\\udffc\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\udef1\\ud83c\\udffd\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\udef1\\ud83c\\udffe\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\udef1\\ud83c\\udfff\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f?\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f?\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1|\\ud83d\\udc6b\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6c\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6d\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc8f\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc91\\ud83c[\\udffb-\\udfff]|\\ud83e\\udd1d\\ud83c[\\udffb-\\udfff]|\\ud83d[\\udc6b-\\udc6d\\udc8f\\udc91]|\\ud83e\\udd1d)|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\u2695\\ufe0f?|\\u2696\\ufe0f?|\\u2708\\ufe0f?|\\ud83c[\\udf3e\\udf73\\udf7c\\udf84\\udf93\\udfa4\\udfa8\\udfeb\\udfed]|\\ud83d[\\udcbb\\udcbc\\udd27\\udd2c\\ude80\\ude92]|\\ud83e[\\uddaf-\\uddb3\\uddbc\\uddbd])|(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75]|\\u26f9)(?:(?:\\ud83c[\\udffb-\\udfff]|\\ufe0f?)\\u200d[\\u2640\\u2642]\\ufe0f?)|(?:\\ud83c[\\udfc3\\udfc4\\udfca]|\\ud83d[\\udc6e\\udc70\\udc71\\udc73\\udc77\\udc81\\udc82\\udc86\\udc87\\ude45-\\ude47\\ude4b\\ude4d\\ude4e\\udea3\\udeb4-\\udeb6]|\\ud83e[\\udd26\\udd35\\udd37-\\udd39\\udd3d\\udd3e\\uddb8\\uddb9\\uddcd-\\uddcf\\uddd4\\uddd6-\\udddd])(?:\\ud83c[\\udffb-\\udfff])?\\u200d[\\u2640\\u2642]\\ufe0f?|(?:\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83c\\udff3\\ufe0f?\\u200d\\u26a7\\ufe0f?|\\ud83c\\udff3\\ufe0f?\\u200d\\ud83c\\udf08|\\ud83d\\ude36\\u200d\\ud83c\\udf2b\\ufe0f?|\\u2764\\ufe0f?\\u200d\\ud83d\\udd25|\\u2764\\ufe0f?\\u200d\\ud83e\\ude79|\\ud83c\\udff4\\u200d\\u2620\\ufe0f?|\\ud83d\\udc15\\u200d\\ud83e\\uddba|\\ud83d\\udc3b\\u200d\\u2744\\ufe0f?|\\ud83d\\udc41\\u200d\\ud83d\\udde8|\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc6f\\u200d\\u2640\\ufe0f?|\\ud83d\\udc6f\\u200d\\u2642\\ufe0f?|\\ud83d\\ude2e\\u200d\\ud83d\\udca8|\\ud83d\\ude35\\u200d\\ud83d\\udcab|\\ud83e\\udd3c\\u200d\\u2640\\ufe0f?|\\ud83e\\udd3c\\u200d\\u2642\\ufe0f?|\\ud83e\\uddde\\u200d\\u2640\\ufe0f?|\\ud83e\\uddde\\u200d\\u2642\\ufe0f?|\\ud83e\\udddf\\u200d\\u2640\\ufe0f?|\\ud83e\\udddf\\u200d\\u2642\\ufe0f?|\\ud83d\\udc08\\u200d\\u2b1b)|[#*0-9]\\ufe0f??\\u20e3|(?:[©®\\u2122\\u265f]\\ufe0f?)|(?:\\ud83c[\\udc04\\udd70\\udd71\\udd7e\\udd7f\\ude02\\ude1a\\ude2f\\ude37\\udf21\\udf24-\\udf2c\\udf36\\udf7d\\udf96\\udf97\\udf99-\\udf9b\\udf9e\\udf9f\\udfcd\\udfce\\udfd4-\\udfdf\\udff3\\udff5\\udff7]|\\ud83d[\\udc3f\\udc41\\udcfd\\udd49\\udd4a\\udd6f\\udd70\\udd73\\udd76-\\udd79\\udd87\\udd8a-\\udd8d\\udda5\\udda8\\uddb1\\uddb2\\uddbc\\uddc2-\\uddc4\\uddd1-\\uddd3\\udddc-\\uddde\\udde1\\udde3\\udde8\\uddef\\uddf3\\uddfa\\udecb\\udecd-\\udecf\\udee0-\\udee5\\udee9\\udef0\\udef3]|[\\u203c\\u2049\\u2139\\u2194-\\u2199\\u21a9\\u21aa\\u231a\\u231b\\u2328\\u23cf\\u23ed-\\u23ef\\u23f1\\u23f2\\u23f8-\\u23fa\\u24c2\\u25aa\\u25ab\\u25b6\\u25c0\\u25fb-\\u25fe\\u2600-\\u2604\\u260e\\u2611\\u2614\\u2615\\u2618\\u2620\\u2622\\u2623\\u2626\\u262a\\u262e\\u262f\\u2638-\\u263a\\u2640\\u2642\\u2648-\\u2653\\u2660\\u2663\\u2665\\u2666\\u2668\\u267b\\u267f\\u2692-\\u2697\\u2699\\u269b\\u269c\\u26a0\\u26a1\\u26a7\\u26aa\\u26ab\\u26b0\\u26b1\\u26bd\\u26be\\u26c4\\u26c5\\u26c8\\u26cf\\u26d1\\u26d3\\u26d4\\u26e9\\u26ea\\u26f0-\\u26f5\\u26f8\\u26fa\\u26fd\\u2702\\u2708\\u2709\\u270f\\u2712\\u2714\\u2716\\u271d\\u2721\\u2733\\u2734\\u2744\\u2747\\u2757\\u2763\\u2764\\u27a1\\u2934\\u2935\\u2b05-\\u2b07\\u2b1b\\u2b1c\\u2b50\\u2b55\\u3030\\u303d\\u3297\\u3299])(?:\\ufe0f?|(?!\\ufe0e))|(?:(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75\\udd90]|[\\u261d\\u26f7\\u26f9\\u270c\\u270d])(?:\\ufe0f?|(?!\\ufe0e))|(?:\\ud83c[\\udf85\\udfc2-\\udfc4\\udfc7\\udfca]|\\ud83d[\\udc42\\udc43\\udc46-\\udc50\\udc66-\\udc69\\udc6e\\udc70-\\udc78\\udc7c\\udc81-\\udc83\\udc85-\\udc87\\udcaa\\udd7a\\udd95\\udd96\\ude45-\\ude47\\ude4b-\\ude4f\\udea3\\udeb4-\\udeb6\\udec0\\udecc]|\\ud83e[\\udd0c\\udd0f\\udd18-\\udd1c\\udd1e\\udd1f\\udd26\\udd30-\\udd39\\udd3d\\udd3e\\udd77\\uddb5\\uddb6\\uddb8\\uddb9\\uddbb\\uddcd-\\uddcf\\uddd1-\\udddd\\udec3-\\udec5\\udef0-\\udef6]|[\\u270a\\u270b]))(?:\\ud83c[\\udffb-\\udfff])?|(?:\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc65\\udb40\\udc6e\\udb40\\udc67\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc73\\udb40\\udc63\\udb40\\udc74\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc77\\udb40\\udc6c\\udb40\\udc73\\udb40\\udc7f|\\ud83c\\udde6\\ud83c[\\udde8-\\uddec\\uddee\\uddf1\\uddf2\\uddf4\\uddf6-\\uddfa\\uddfc\\uddfd\\uddff]|\\ud83c\\udde7\\ud83c[\\udde6\\udde7\\udde9-\\uddef\\uddf1-\\uddf4\\uddf6-\\uddf9\\uddfb\\uddfc\\uddfe\\uddff]|\\ud83c\\udde8\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\uddee\\uddf0-\\uddf5\\uddf7\\uddfa-\\uddff]|\\ud83c\\udde9\\ud83c[\\uddea\\uddec\\uddef\\uddf0\\uddf2\\uddf4\\uddff]|\\ud83c\\uddea\\ud83c[\\udde6\\udde8\\uddea\\uddec\\udded\\uddf7-\\uddfa]|\\ud83c\\uddeb\\ud83c[\\uddee-\\uddf0\\uddf2\\uddf4\\uddf7]|\\ud83c\\uddec\\ud83c[\\udde6\\udde7\\udde9-\\uddee\\uddf1-\\uddf3\\uddf5-\\uddfa\\uddfc\\uddfe]|\\ud83c\\udded\\ud83c[\\uddf0\\uddf2\\uddf3\\uddf7\\uddf9\\uddfa]|\\ud83c\\uddee\\ud83c[\\udde8-\\uddea\\uddf1-\\uddf4\\uddf6-\\uddf9]|\\ud83c\\uddef\\ud83c[\\uddea\\uddf2\\uddf4\\uddf5]|\\ud83c\\uddf0\\ud83c[\\uddea\\uddec-\\uddee\\uddf2\\uddf3\\uddf5\\uddf7\\uddfc\\uddfe\\uddff]|\\ud83c\\uddf1\\ud83c[\\udde6-\\udde8\\uddee\\uddf0\\uddf7-\\uddfb\\uddfe]|\\ud83c\\uddf2\\ud83c[\\udde6\\udde8-\\udded\\uddf0-\\uddff]|\\ud83c\\uddf3\\ud83c[\\udde6\\udde8\\uddea-\\uddec\\uddee\\uddf1\\uddf4\\uddf5\\uddf7\\uddfa\\uddff]|\\ud83c\\uddf4\\ud83c\\uddf2|\\ud83c\\uddf5\\ud83c[\\udde6\\uddea-\\udded\\uddf0-\\uddf3\\uddf7-\\uddf9\\uddfc\\uddfe]|\\ud83c\\uddf6\\ud83c\\udde6|\\ud83c\\uddf7\\ud83c[\\uddea\\uddf4\\uddf8\\uddfa\\uddfc]|\\ud83c\\uddf8\\ud83c[\\udde6-\\uddea\\uddec-\\uddf4\\uddf7-\\uddf9\\uddfb\\uddfd-\\uddff]|\\ud83c\\uddf9\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\udded\\uddef-\\uddf4\\uddf7\\uddf9\\uddfb\\uddfc\\uddff]|\\ud83c\\uddfa\\ud83c[\\udde6\\uddec\\uddf2\\uddf3\\uddf8\\uddfe\\uddff]|\\ud83c\\uddfb\\ud83c[\\udde6\\udde8\\uddea\\uddec\\uddee\\uddf3\\uddfa]|\\ud83c\\uddfc\\ud83c[\\uddeb\\uddf8]|\\ud83c\\uddfd\\ud83c\\uddf0|\\ud83c\\uddfe\\ud83c[\\uddea\\uddf9]|\\ud83c\\uddff\\ud83c[\\udde6\\uddf2\\uddfc]|\\ud83c[\\udccf\\udd8e\\udd91-\\udd9a\\udde6-\\uddff\\ude01\\ude32-\\ude36\\ude38-\\ude3a\\ude50\\ude51\\udf00-\\udf20\\udf2d-\\udf35\\udf37-\\udf7c\\udf7e-\\udf84\\udf86-\\udf93\\udfa0-\\udfc1\\udfc5\\udfc6\\udfc8\\udfc9\\udfcf-\\udfd3\\udfe0-\\udff0\\udff4\\udff8-\\udfff]|\\ud83d[\\udc00-\\udc3e\\udc40\\udc44\\udc45\\udc51-\\udc65\\udc6a\\udc6f\\udc79-\\udc7b\\udc7d-\\udc80\\udc84\\udc88-\\udc8e\\udc90\\udc92-\\udca9\\udcab-\\udcfc\\udcff-\\udd3d\\udd4b-\\udd4e\\udd50-\\udd67\\udda4\\uddfb-\\ude44\\ude48-\\ude4a\\ude80-\\udea2\\udea4-\\udeb3\\udeb7-\\udebf\\udec1-\\udec5\\uded0-\\uded2\\uded5-\\uded7\\udedd-\\udedf\\udeeb\\udeec\\udef4-\\udefc\\udfe0-\\udfeb\\udff0]|\\ud83e[\\udd0d\\udd0e\\udd10-\\udd17\\udd20-\\udd25\\udd27-\\udd2f\\udd3a\\udd3c\\udd3f-\\udd45\\udd47-\\udd76\\udd78-\\uddb4\\uddb7\\uddba\\uddbc-\\uddcc\\uddd0\\uddde-\\uddff\\ude70-\\ude74\\ude78-\\ude7c\\ude80-\\ude86\\ude90-\\udeac\\udeb0-\\udeba\\udec0-\\udec2\\uded0-\\uded9\\udee0-\\udee7]|[\\u23e9-\\u23ec\\u23f0\\u23f3\\u267e\\u26ce\\u2705\\u2728\\u274c\\u274e\\u2753-\\u2755\\u2795-\\u2797\\u27b0\\u27bf\\ue50a])|\\ufe0f)';\r\nexport default originalString;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport emojiRegExp from '../../vendor/emoji/regex';\r\nimport {MessageEntity} from '../../layer';\r\n\r\nconst EmojiHelper = {\r\n  emojiMap: (code: string) => { return code; },\r\n  shortcuts: [] as any,\r\n  emojis: [] as any\r\n};\r\n\r\nexport const ALPHA_CHARS_REG_EXP = 'a-z' +\r\n  '\\\\u00c0-\\\\u00d6\\\\u00d8-\\\\u00f6\\\\u00f8-\\\\u00ff' + // Latin-1\r\n  '\\\\u0100-\\\\u024f' + // Latin Extended A and B\r\n  '\\\\u0253\\\\u0254\\\\u0256\\\\u0257\\\\u0259\\\\u025b\\\\u0263\\\\u0268\\\\u026f\\\\u0272\\\\u0289\\\\u028b' + // IPA Extensions\r\n  '\\\\u02bb' + // Hawaiian\r\n  '\\\\u0300-\\\\u036f' + // Combining diacritics\r\n  '\\\\u1e00-\\\\u1eff' + // Latin Extended Additional (mostly for Vietnamese)\r\n  '\\\\u0400-\\\\u04ff\\\\u0500-\\\\u0527' + // Cyrillic\r\n  '\\\\u2de0-\\\\u2dff\\\\ua640-\\\\ua69f' + // Cyrillic Extended A/B\r\n  '\\\\u0591-\\\\u05bf\\\\u05c1-\\\\u05c2\\\\u05c4-\\\\u05c5\\\\u05c7' +\r\n  '\\\\u05d0-\\\\u05ea\\\\u05f0-\\\\u05f4' + // Hebrew\r\n  '\\\\ufb1d-\\\\ufb28\\\\ufb2a-\\\\ufb36\\\\ufb38-\\\\ufb3c\\\\ufb3e\\\\ufb40-\\\\ufb41' +\r\n  '\\\\ufb43-\\\\ufb44\\\\ufb46-\\\\ufb4f' + // Hebrew Pres. Forms\r\n  '\\\\u0610-\\\\u061a\\\\u0620-\\\\u065f\\\\u066e-\\\\u06d3\\\\u06d5-\\\\u06dc' +\r\n  '\\\\u06de-\\\\u06e8\\\\u06ea-\\\\u06ef\\\\u06fa-\\\\u06fc\\\\u06ff' + // Arabic\r\n  '\\\\u0750-\\\\u077f\\\\u08a0\\\\u08a2-\\\\u08ac\\\\u08e4-\\\\u08fe' + // Arabic Supplement and Extended A\r\n  '\\\\ufb50-\\\\ufbb1\\\\ufbd3-\\\\ufd3d\\\\ufd50-\\\\ufd8f\\\\ufd92-\\\\ufdc7\\\\ufdf0-\\\\ufdfb' + // Pres. Forms A\r\n  '\\\\ufe70-\\\\ufe74\\\\ufe76-\\\\ufefc' + // Pres. Forms B\r\n  '\\\\u200c' + // Zero-Width Non-Joiner\r\n  '\\\\u0e01-\\\\u0e3a\\\\u0e40-\\\\u0e4e' + // Thai\r\n  '\\\\u1100-\\\\u11ff\\\\u3130-\\\\u3185\\\\uA960-\\\\uA97F\\\\uAC00-\\\\uD7AF\\\\uD7B0-\\\\uD7FF' + // Hangul (Korean)\r\n  '\\\\u3003\\\\u3005\\\\u303b' + // Kanji/Han iteration marks\r\n  '\\\\uff21-\\\\uff3a\\\\uff41-\\\\uff5a' + // full width Alphabet\r\n  '\\\\uff66-\\\\uff9f' + // half width Katakana\r\n  '\\\\uffa1-\\\\uffdc'; // half width Hangul (Korean)\r\nexport const ALPHA_NUMERIC_REG_EXP = '0-9\\_' + ALPHA_CHARS_REG_EXP;\r\nexport const DOMAIN_ADD_CHARS = '\\u00b7';\r\n// Based on Regular Expression for URL validation by Diego Perini\r\nexport const URL_ALPHANUMERIC_REG_EXP_PART = '[' + ALPHA_CHARS_REG_EXP + '0-9]';\r\nexport const URL_PROTOCOL_REG_EXP_PART = '((?:https?|ftp)://|mailto:)?';\r\nexport const URL_REG_EXP = URL_PROTOCOL_REG_EXP_PART +\r\n  // user:pass authentication\r\n  '(?:' + URL_ALPHANUMERIC_REG_EXP_PART + '{1,64}(?::' + URL_ALPHANUMERIC_REG_EXP_PART + '{0,64})?@)?' +\r\n  '(?:' +\r\n  // sindresorhus/ip-regexp\r\n  '(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}' +\r\n  '|' +\r\n  // host name\r\n  URL_ALPHANUMERIC_REG_EXP_PART + '[' + ALPHA_CHARS_REG_EXP + DOMAIN_ADD_CHARS + '0-9\\-]{0,64}' +\r\n  // domain name\r\n  '(?:\\\\.' + URL_ALPHANUMERIC_REG_EXP_PART + '[' + ALPHA_CHARS_REG_EXP + DOMAIN_ADD_CHARS + '0-9\\-]{0,64}){0,10}' +\r\n  // TLD identifier\r\n  '(?:\\\\.(xn--[0-9a-z]{2,16}|[' + ALPHA_CHARS_REG_EXP + ']{2,24}))' +\r\n  ')' +\r\n  // port number\r\n  '(?::\\\\d{2,5})?' +\r\n  // resource path\r\n  '(?:/(?:\\\\S{0,255}[^\\\\s.;,(\\\\[\\\\]{}<>\"\\'])?)?';\r\nexport const URL_PROTOCOL_REG_EXP = new RegExp('^' + URL_PROTOCOL_REG_EXP_PART.slice(0, -1), 'i');\r\nexport const USERNAME_REG_EXP = '[a-zA-Z\\\\d_]{5,32}';\r\n// export const TIMESTAMP_REG_EXP = '(?:\\\\s|^)((?:\\\\d{1,2}:)?(?:[0-5]?[0-9]):(?:[0-5][0-9]))(?:\\\\s|$)';\r\nexport const TIMESTAMP_REG_EXP = '(?:\\\\s|^)((?:(\\\\d{1,2}):(?:[0-5]?[0-9])|(?:\\\\d{1,2}|\\\\d{3,})):(?:[0-5][0-9]))(?:\\\\s|$)';\r\nexport const BOT_COMMAND_REG_EXP = '\\\\/([a-zA-Z\\\\d_]{1,32})(?:@(' + USERNAME_REG_EXP + '))?(\\\\b|$)';\r\nexport const FULL_REG_EXP = new RegExp('(^| )(@)(' + USERNAME_REG_EXP + ')|(' + URL_REG_EXP + ')|(\\\\n)|(' + emojiRegExp + ')|(^|[\\\\s\\\\(\\\\]])(#[' + ALPHA_NUMERIC_REG_EXP + ']{2,64})|(^|\\\\s)' + BOT_COMMAND_REG_EXP + '|' + TIMESTAMP_REG_EXP + '', 'i');\r\nexport const EMAIL_REG_EXP = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n// const markdownTestRegExp = /[`_*@~]/;\r\nexport const MARKDOWN_REG_EXP = /(^|\\s|\\n)(````?)([\\s\\S]+?)(````?)([\\s\\n\\.,:?!;]|$)|(^|\\s|\\x01)(`|~~|\\*\\*|__|_-_|\\|\\|)([^\\n]+?)\\7([\\x01\\s\\.,:?!;]|$)|@(\\d+)\\s*\\((.+?)\\)|(\\[(.+?)\\]\\((.+?)\\))/m;\r\nexport const SITE_HASHTAGS: {[siteName: string]: string} = {\r\n  'Telegram': 'tg://search_hashtag?hashtag={1}',\r\n  'Twitter': 'https://twitter.com/hashtag/{1}',\r\n  'Instagram': 'https://instagram.com/explore/tags/{1}/',\r\n  'Google Plus': 'https://plus.google.com/explore/{1}'\r\n};\r\n\r\n// export const SITE_MENTIONS: {[siteName in 'Telegram' | 'Twitter' | 'Instagram' | 'GitHub']: string} = {\r\n//   Telegram: '#{1}',\r\n//   Twitter: 'https://twitter.com/{1}',\r\n//   Instagram: 'https://instagram.com/{1}/',\r\n//   GitHub: 'https://github.com/{1}'\r\n// };\r\n\r\nexport const MARKDOWN_ENTITIES: {[markdown: string]: MessageEntity['_']} = {\r\n  '`': 'messageEntityCode',\r\n  '``': 'messageEntityPre',\r\n  '**': 'messageEntityBold',\r\n  '__': 'messageEntityItalic',\r\n  '~~': 'messageEntityStrike',\r\n  '_-_': 'messageEntityUnderline',\r\n  '||': 'messageEntitySpoiler'\r\n};\r\n\r\nexport const MARKDOWN_ENTITIES_TYPES = new Set(Object.values(MARKDOWN_ENTITIES));\r\n\r\nexport const PASS_CONFLICTING_ENTITIES: Set<MessageEntity['_']> = new Set([\r\n  'messageEntityEmoji',\r\n  'messageEntityLinebreak',\r\n  'messageEntityCaret'\r\n]);\r\nexport const PASS_SINGLE_CONFLICTING_ENTITIES = new Set(PASS_CONFLICTING_ENTITIES);\r\nfor(const i in MARKDOWN_ENTITIES) {\r\n  PASS_CONFLICTING_ENTITIES.add(MARKDOWN_ENTITIES[i]);\r\n}\r\n\r\nexport const PHONE_NUMBER_REG_EXP = /^\\+\\d+$/;\r\n\r\nexport const LOCAL_ENTITIES = new Set<MessageEntity['_']>([\r\n  'messageEntityLinebreak',\r\n  'messageEntityCaret',\r\n  'messageEntityHighlight',\r\n  'messageEntityBotCommand',\r\n  'messageEntityTimestamp'\r\n]);\r\n\r\n/* export function parseEmojis(text: string) {\r\n  return text.replace(/:([a-z0-9\\-\\+\\*_]+?):/gi, function (all, shortcut) {\r\n    var emojiCode = EmojiHelper.shortcuts[shortcut]\r\n    if (emojiCode !== undefined) {\r\n      return EmojiHelper.emojis[emojiCode][0]\r\n    }\r\n    return all\r\n  })\r\n} */\r\n\r\n\r\n/* export function replaceUrlEncodings(urlWithEncoded: string) {\r\n  return urlWithEncoded.replace(/(%[A-Z\\d]{2})+/g, (str) => {\r\n    try {\r\n      return decodeURIComponent(str);\r\n    } catch (e) {\r\n      return str;\r\n    }\r\n  });\r\n} */\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type addAnchorListener from '../../helpers/addAnchorListener';\r\nimport {PHONE_NUMBER_REG_EXP} from '.';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport matchUrlProtocol from './matchUrlProtocol';\r\nimport {T_ME_PREFIXES} from '../mtproto/mtproto_config';\r\n\r\nexport default function wrapUrl(url: string, unsafe?: number | boolean) {\r\n  if(!matchUrlProtocol(url)) {\r\n    url = 'https://' + url;\r\n  }\r\n\r\n  const out: {url: string, onclick?: Parameters<typeof addAnchorListener>[0]['name']} = {url};\r\n  let tgMeMatch, telescoPeMatch, tgMatch;\r\n  let onclick: typeof out['onclick'];\r\n  /* if(unsafe === 2) {\r\n    url = 'tg://unsafe_url?url=' + encodeURIComponent(url);\r\n  } else  */if((tgMeMatch = url.match(/^(?:https?:\\/\\/)?(?:(.+?)\\.)?(?:(?:web|k|z|a)\\.)?t(?:elegram)?\\.me(?:\\/(.+))?/))) {\r\n    const u = new URL(url);\r\n    let prefix = tgMeMatch[1];\r\n    if(prefix && T_ME_PREFIXES.has(tgMeMatch[1])) {\r\n      prefix = undefined;\r\n    }\r\n\r\n    if(prefix) {\r\n      u.pathname = prefix + (u.pathname === '/' ? '' : u.pathname);\r\n    }\r\n\r\n    const fullPath = u.pathname.slice(1);\r\n    const path = fullPath.split('/');\r\n\r\n    if(path[0] && path[0][0] === '$' && path[0].length > 1) {\r\n      onclick = 'invoice';\r\n    } else if(/^\\+/.test(fullPath) && !PHONE_NUMBER_REG_EXP.test(fullPath)) { // second regexp is for phone numbers (t.me/+38050...)\r\n      onclick = 'joinchat';\r\n    } else if(path[0]) switch(path[0]) {\r\n      case 'm':\r\n      case 'addlist':\r\n      case 'joinchat':\r\n      case 'addstickers':\r\n      case 'addemoji':\r\n      case 'voicechat':\r\n      case 'invoice':\r\n      case 'boost':\r\n      case 'giftcode':\r\n      case 'share':\r\n        if(path.length !== 1 && !prefix) {\r\n          onclick = path[0];\r\n          break;\r\n        }\r\n\r\n      default:\r\n        if(path.length <= 2 || path[1]?.match(/^\\d+(?:\\?(?:comment|thread)=\\d+)?$/) || path[1] === 's') {\r\n          onclick = 'im';\r\n          break;\r\n        }\r\n\r\n        break;\r\n    }\r\n  } else if((telescoPeMatch = url.match(/^(?:https?:\\/\\/)?telesco\\.pe\\/([^/?]+)\\/(\\d+)/))) {\r\n    onclick = 'im';\r\n  } else if((tgMatch = url.match(/tg:(?:\\/\\/)?(.+?)(?:\\?|$)/))) {\r\n    onclick = 'tg_' + tgMatch[1] as any;\r\n  }/*  else if(unsafe) {\r\n    url = 'tg://unsafe_url?url=' + encodeURIComponent(url);\r\n  } */\r\n\r\n  if(!(window as any)[onclick]) {\r\n    onclick = undefined;\r\n  }\r\n\r\n  out.onclick = onclick;\r\n  return out;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.wrapUrl = wrapUrl);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import I18n from '../../lib/langPack';\r\n\r\nexport default function setInnerHTML(elem: Element, html: string | DocumentFragment | Element) {\r\n  setDirection(elem);\r\n  if(html === undefined) {\r\n    elem.replaceChildren();\r\n  } else if(typeof(html) === 'string') {\r\n    if(!html) elem.replaceChildren();\r\n    else elem.textContent = html;\r\n  } else {\r\n    elem.replaceChildren(html);\r\n  }\r\n}\r\n\r\nexport function setDirection(elem: Element) {\r\n  // if(!I18n.isRTL) {\r\n  elem.setAttribute('dir', 'auto');\r\n  // }\r\n}\r\n\r\nexport function getDirection(): 'auto' {\r\n  return 'auto';\r\n}\r\n","export default function setBlankToAnchor(anchor: HTMLAnchorElement) {\r\n  anchor.target = '_blank';\r\n  anchor.rel = 'noopener noreferrer';\r\n  return anchor;\r\n}\r\n","let taskIdCounter = 1,\r\n  isCallbackScheduled = false,\r\n  isPerformingWork = false,\r\n  taskQueue = [],\r\n  currentTask = null,\r\n  shouldYieldToHost = null,\r\n  yieldInterval = 5,\r\n  deadline = 0,\r\n  maxYieldInterval = 300,\r\n  scheduleCallback = null,\r\n  scheduledCallback = null;\r\nconst maxSigned31BitInt = 1073741823;\r\nfunction setupScheduler() {\r\n  const channel = new MessageChannel(),\r\n    port = channel.port2;\r\n  scheduleCallback = () => port.postMessage(null);\r\n  channel.port1.onmessage = () => {\r\n    if (scheduledCallback !== null) {\r\n      const currentTime = performance.now();\r\n      deadline = currentTime + yieldInterval;\r\n      const hasTimeRemaining = true;\r\n      try {\r\n        const hasMoreWork = scheduledCallback(hasTimeRemaining, currentTime);\r\n        if (!hasMoreWork) {\r\n          scheduledCallback = null;\r\n        } else port.postMessage(null);\r\n      } catch (error) {\r\n        port.postMessage(null);\r\n        throw error;\r\n      }\r\n    }\r\n  };\r\n  if (navigator && navigator.scheduling && navigator.scheduling.isInputPending) {\r\n    const scheduling = navigator.scheduling;\r\n    shouldYieldToHost = () => {\r\n      const currentTime = performance.now();\r\n      if (currentTime >= deadline) {\r\n        if (scheduling.isInputPending()) {\r\n          return true;\r\n        }\r\n        return currentTime >= maxYieldInterval;\r\n      } else {\r\n        return false;\r\n      }\r\n    };\r\n  } else {\r\n    shouldYieldToHost = () => performance.now() >= deadline;\r\n  }\r\n}\r\nfunction enqueue(taskQueue, task) {\r\n  function findIndex() {\r\n    let m = 0;\r\n    let n = taskQueue.length - 1;\r\n    while (m <= n) {\r\n      const k = n + m >> 1;\r\n      const cmp = task.expirationTime - taskQueue[k].expirationTime;\r\n      if (cmp > 0) m = k + 1;else if (cmp < 0) n = k - 1;else return k;\r\n    }\r\n    return m;\r\n  }\r\n  taskQueue.splice(findIndex(), 0, task);\r\n}\r\nfunction requestCallback(fn, options) {\r\n  if (!scheduleCallback) setupScheduler();\r\n  let startTime = performance.now(),\r\n    timeout = maxSigned31BitInt;\r\n  if (options && options.timeout) timeout = options.timeout;\r\n  const newTask = {\r\n    id: taskIdCounter++,\r\n    fn,\r\n    startTime,\r\n    expirationTime: startTime + timeout\r\n  };\r\n  enqueue(taskQueue, newTask);\r\n  if (!isCallbackScheduled && !isPerformingWork) {\r\n    isCallbackScheduled = true;\r\n    scheduledCallback = flushWork;\r\n    scheduleCallback();\r\n  }\r\n  return newTask;\r\n}\r\nfunction cancelCallback(task) {\r\n  task.fn = null;\r\n}\r\nfunction flushWork(hasTimeRemaining, initialTime) {\r\n  isCallbackScheduled = false;\r\n  isPerformingWork = true;\r\n  try {\r\n    return workLoop(hasTimeRemaining, initialTime);\r\n  } finally {\r\n    currentTask = null;\r\n    isPerformingWork = false;\r\n  }\r\n}\r\nfunction workLoop(hasTimeRemaining, initialTime) {\r\n  let currentTime = initialTime;\r\n  currentTask = taskQueue[0] || null;\r\n  while (currentTask !== null) {\r\n    if (currentTask.expirationTime > currentTime && (!hasTimeRemaining || shouldYieldToHost())) {\r\n      break;\r\n    }\r\n    const callback = currentTask.fn;\r\n    if (callback !== null) {\r\n      currentTask.fn = null;\r\n      const didUserCallbackTimeout = currentTask.expirationTime <= currentTime;\r\n      callback(didUserCallbackTimeout);\r\n      currentTime = performance.now();\r\n      if (currentTask === taskQueue[0]) {\r\n        taskQueue.shift();\r\n      }\r\n    } else taskQueue.shift();\r\n    currentTask = taskQueue[0] || null;\r\n  }\r\n  return currentTask !== null;\r\n}\r\n\r\nconst sharedConfig = {\r\n  context: undefined,\r\n  registry: undefined\r\n};\r\nfunction setHydrateContext(context) {\r\n  sharedConfig.context = context;\r\n}\r\nfunction nextHydrateContext() {\r\n  return {\r\n    ...sharedConfig.context,\r\n    id: `${sharedConfig.context.id}${sharedConfig.context.count++}-`,\r\n    count: 0\r\n  };\r\n}\r\n\r\nconst equalFn = (a, b) => a === b;\r\nconst $PROXY = Symbol(\"solid-proxy\");\r\nconst $TRACK = Symbol(\"solid-track\");\r\nconst $DEVCOMP = Symbol(\"solid-dev-component\");\r\nconst signalOptions = {\r\n  equals: equalFn\r\n};\r\nlet ERROR = null;\r\nlet runEffects = runQueue;\r\nconst STALE = 1;\r\nconst PENDING = 2;\r\nconst UNOWNED = {\r\n  owned: null,\r\n  cleanups: null,\r\n  context: null,\r\n  owner: null\r\n};\r\nconst NO_INIT = {};\r\nvar Owner = null;\r\nlet Transition = null;\r\nlet Scheduler = null;\r\nlet ExternalSourceConfig = null;\r\nlet Listener = null;\r\nlet Updates = null;\r\nlet Effects = null;\r\nlet ExecCount = 0;\r\nfunction createRoot(fn, detachedOwner) {\r\n  const listener = Listener,\r\n    owner = Owner,\r\n    unowned = fn.length === 0,\r\n    current = detachedOwner === undefined ? owner : detachedOwner,\r\n    root = unowned ? UNOWNED : {\r\n      owned: null,\r\n      cleanups: null,\r\n      context: current ? current.context : null,\r\n      owner: current\r\n    },\r\n    updateFn = unowned ? fn : () => fn(() => untrack(() => cleanNode(root)));\r\n  Owner = root;\r\n  Listener = null;\r\n  try {\r\n    return runUpdates(updateFn, true);\r\n  } finally {\r\n    Listener = listener;\r\n    Owner = owner;\r\n  }\r\n}\r\nfunction createSignal(value, options) {\r\n  options = options ? Object.assign({}, signalOptions, options) : signalOptions;\r\n  const s = {\r\n    value,\r\n    observers: null,\r\n    observerSlots: null,\r\n    comparator: options.equals || undefined\r\n  };\r\n  const setter = value => {\r\n    if (typeof value === \"function\") {\r\n      if (Transition && Transition.running && Transition.sources.has(s)) value = value(s.tValue);else value = value(s.value);\r\n    }\r\n    return writeSignal(s, value);\r\n  };\r\n  return [readSignal.bind(s), setter];\r\n}\r\nfunction createComputed(fn, value, options) {\r\n  const c = createComputation(fn, value, true, STALE);\r\n  if (Scheduler && Transition && Transition.running) Updates.push(c);else updateComputation(c);\r\n}\r\nfunction createRenderEffect(fn, value, options) {\r\n  const c = createComputation(fn, value, false, STALE);\r\n  if (Scheduler && Transition && Transition.running) Updates.push(c);else updateComputation(c);\r\n}\r\nfunction createEffect(fn, value, options) {\r\n  runEffects = runUserEffects;\r\n  const c = createComputation(fn, value, false, STALE),\r\n    s = SuspenseContext && useContext(SuspenseContext);\r\n  if (s) c.suspense = s;\r\n  if (!options || !options.render) c.user = true;\r\n  Effects ? Effects.push(c) : updateComputation(c);\r\n}\r\nfunction createReaction(onInvalidate, options) {\r\n  let fn;\r\n  const c = createComputation(() => {\r\n      fn ? fn() : untrack(onInvalidate);\r\n      fn = undefined;\r\n    }, undefined, false, 0),\r\n    s = SuspenseContext && useContext(SuspenseContext);\r\n  if (s) c.suspense = s;\r\n  c.user = true;\r\n  return tracking => {\r\n    fn = tracking;\r\n    updateComputation(c);\r\n  };\r\n}\r\nfunction createMemo(fn, value, options) {\r\n  options = options ? Object.assign({}, signalOptions, options) : signalOptions;\r\n  const c = createComputation(fn, value, true, 0);\r\n  c.observers = null;\r\n  c.observerSlots = null;\r\n  c.comparator = options.equals || undefined;\r\n  if (Scheduler && Transition && Transition.running) {\r\n    c.tState = STALE;\r\n    Updates.push(c);\r\n  } else updateComputation(c);\r\n  return readSignal.bind(c);\r\n}\r\nfunction isPromise(v) {\r\n  return v && typeof v === \"object\" && \"then\" in v;\r\n}\r\nfunction createResource(pSource, pFetcher, pOptions) {\r\n  let source;\r\n  let fetcher;\r\n  let options;\r\n  if (arguments.length === 2 && typeof pFetcher === \"object\" || arguments.length === 1) {\r\n    source = true;\r\n    fetcher = pSource;\r\n    options = pFetcher || {};\r\n  } else {\r\n    source = pSource;\r\n    fetcher = pFetcher;\r\n    options = pOptions || {};\r\n  }\r\n  let pr = null,\r\n    initP = NO_INIT,\r\n    id = null,\r\n    loadedUnderTransition = false,\r\n    scheduled = false,\r\n    resolved = (\"initialValue\" in options),\r\n    dynamic = typeof source === \"function\" && createMemo(source);\r\n  const contexts = new Set(),\r\n    [value, setValue] = (options.storage || createSignal)(options.initialValue),\r\n    [error, setError] = createSignal(undefined),\r\n    [track, trigger] = createSignal(undefined, {\r\n      equals: false\r\n    }),\r\n    [state, setState] = createSignal(resolved ? \"ready\" : \"unresolved\");\r\n  if (sharedConfig.context) {\r\n    id = `${sharedConfig.context.id}${sharedConfig.context.count++}`;\r\n    let v;\r\n    if (options.ssrLoadFrom === \"initial\") initP = options.initialValue;else if (sharedConfig.load && (v = sharedConfig.load(id))) initP = v;\r\n  }\r\n  function loadEnd(p, v, error, key) {\r\n    if (pr === p) {\r\n      pr = null;\r\n      key !== undefined && (resolved = true);\r\n      if ((p === initP || v === initP) && options.onHydrated) queueMicrotask(() => options.onHydrated(key, {\r\n        value: v\r\n      }));\r\n      initP = NO_INIT;\r\n      if (Transition && p && loadedUnderTransition) {\r\n        Transition.promises.delete(p);\r\n        loadedUnderTransition = false;\r\n        runUpdates(() => {\r\n          Transition.running = true;\r\n          completeLoad(v, error);\r\n        }, false);\r\n      } else completeLoad(v, error);\r\n    }\r\n    return v;\r\n  }\r\n  function completeLoad(v, err) {\r\n    runUpdates(() => {\r\n      if (err === undefined) setValue(() => v);\r\n      setState(err !== undefined ? \"errored\" : resolved ? \"ready\" : \"unresolved\");\r\n      setError(err);\r\n      for (const c of contexts.keys()) c.decrement();\r\n      contexts.clear();\r\n    }, false);\r\n  }\r\n  function read() {\r\n    const c = SuspenseContext && useContext(SuspenseContext),\r\n      v = value(),\r\n      err = error();\r\n    if (err !== undefined && !pr) throw err;\r\n    if (Listener && !Listener.user && c) {\r\n      createComputed(() => {\r\n        track();\r\n        if (pr) {\r\n          if (c.resolved && Transition && loadedUnderTransition) Transition.promises.add(pr);else if (!contexts.has(c)) {\r\n            c.increment();\r\n            contexts.add(c);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    return v;\r\n  }\r\n  function load(refetching = true) {\r\n    if (refetching !== false && scheduled) return;\r\n    scheduled = false;\r\n    const lookup = dynamic ? dynamic() : source;\r\n    loadedUnderTransition = Transition && Transition.running;\r\n    if (lookup == null || lookup === false) {\r\n      loadEnd(pr, untrack(value));\r\n      return;\r\n    }\r\n    if (Transition && pr) Transition.promises.delete(pr);\r\n    const p = initP !== NO_INIT ? initP : untrack(() => fetcher(lookup, {\r\n      value: value(),\r\n      refetching\r\n    }));\r\n    if (!isPromise(p)) {\r\n      loadEnd(pr, p, undefined, lookup);\r\n      return p;\r\n    }\r\n    pr = p;\r\n    if (\"value\" in p) {\r\n      if (p.status === \"success\") loadEnd(pr, p.value, undefined, lookup);else loadEnd(pr, undefined, undefined, lookup);\r\n      return p;\r\n    }\r\n    scheduled = true;\r\n    queueMicrotask(() => scheduled = false);\r\n    runUpdates(() => {\r\n      setState(resolved ? \"refreshing\" : \"pending\");\r\n      trigger();\r\n    }, false);\r\n    return p.then(v => loadEnd(p, v, undefined, lookup), e => loadEnd(p, undefined, castError(e), lookup));\r\n  }\r\n  Object.defineProperties(read, {\r\n    state: {\r\n      get: () => state()\r\n    },\r\n    error: {\r\n      get: () => error()\r\n    },\r\n    loading: {\r\n      get() {\r\n        const s = state();\r\n        return s === \"pending\" || s === \"refreshing\";\r\n      }\r\n    },\r\n    latest: {\r\n      get() {\r\n        if (!resolved) return read();\r\n        const err = error();\r\n        if (err && !pr) throw err;\r\n        return value();\r\n      }\r\n    }\r\n  });\r\n  if (dynamic) createComputed(() => load(false));else load(false);\r\n  return [read, {\r\n    refetch: load,\r\n    mutate: setValue\r\n  }];\r\n}\r\nfunction createDeferred(source, options) {\r\n  let t,\r\n    timeout = options ? options.timeoutMs : undefined;\r\n  const node = createComputation(() => {\r\n    if (!t || !t.fn) t = requestCallback(() => setDeferred(() => node.value), timeout !== undefined ? {\r\n      timeout\r\n    } : undefined);\r\n    return source();\r\n  }, undefined, true);\r\n  const [deferred, setDeferred] = createSignal(Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value, options);\r\n  updateComputation(node);\r\n  setDeferred(() => Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value);\r\n  return deferred;\r\n}\r\nfunction createSelector(source, fn = equalFn, options) {\r\n  const subs = new Map();\r\n  const node = createComputation(p => {\r\n    const v = source();\r\n    for (const [key, val] of subs.entries()) if (fn(key, v) !== fn(key, p)) {\r\n      for (const c of val.values()) {\r\n        c.state = STALE;\r\n        if (c.pure) Updates.push(c);else Effects.push(c);\r\n      }\r\n    }\r\n    return v;\r\n  }, undefined, true, STALE);\r\n  updateComputation(node);\r\n  return key => {\r\n    const listener = Listener;\r\n    if (listener) {\r\n      let l;\r\n      if (l = subs.get(key)) l.add(listener);else subs.set(key, l = new Set([listener]));\r\n      onCleanup(() => {\r\n        l.delete(listener);\r\n        !l.size && subs.delete(key);\r\n      });\r\n    }\r\n    return fn(key, Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value);\r\n  };\r\n}\r\nfunction batch(fn) {\r\n  return runUpdates(fn, false);\r\n}\r\nfunction untrack(fn) {\r\n  if (!ExternalSourceConfig && Listener === null) return fn();\r\n  const listener = Listener;\r\n  Listener = null;\r\n  try {\r\n    if (ExternalSourceConfig) return ExternalSourceConfig.untrack(fn);\r\n    return fn();\r\n  } finally {\r\n    Listener = listener;\r\n  }\r\n}\r\nfunction on(deps, fn, options) {\r\n  const isArray = Array.isArray(deps);\r\n  let prevInput;\r\n  let defer = options && options.defer;\r\n  return prevValue => {\r\n    let input;\r\n    if (isArray) {\r\n      input = Array(deps.length);\r\n      for (let i = 0; i < deps.length; i++) input[i] = deps[i]();\r\n    } else input = deps();\r\n    if (defer) {\r\n      defer = false;\r\n      return prevValue;\r\n    }\r\n    const result = untrack(() => fn(input, prevInput, prevValue));\r\n    prevInput = input;\r\n    return result;\r\n  };\r\n}\r\nfunction onMount(fn) {\r\n  createEffect(() => untrack(fn));\r\n}\r\nfunction onCleanup(fn) {\r\n  if (Owner === null) ;else if (Owner.cleanups === null) Owner.cleanups = [fn];else Owner.cleanups.push(fn);\r\n  return fn;\r\n}\r\nfunction catchError(fn, handler) {\r\n  ERROR || (ERROR = Symbol(\"error\"));\r\n  Owner = createComputation(undefined, undefined, true);\r\n  Owner.context = {\r\n    ...Owner.context,\r\n    [ERROR]: [handler]\r\n  };\r\n  if (Transition && Transition.running) Transition.sources.add(Owner);\r\n  try {\r\n    return fn();\r\n  } catch (err) {\r\n    handleError(err);\r\n  } finally {\r\n    Owner = Owner.owner;\r\n  }\r\n}\r\nfunction getListener() {\r\n  return Listener;\r\n}\r\nfunction getOwner() {\r\n  return Owner;\r\n}\r\nfunction runWithOwner(o, fn) {\r\n  const prev = Owner;\r\n  const prevListener = Listener;\r\n  Owner = o;\r\n  Listener = null;\r\n  try {\r\n    return runUpdates(fn, true);\r\n  } catch (err) {\r\n    handleError(err);\r\n  } finally {\r\n    Owner = prev;\r\n    Listener = prevListener;\r\n  }\r\n}\r\nfunction enableScheduling(scheduler = requestCallback) {\r\n  Scheduler = scheduler;\r\n}\r\nfunction startTransition(fn) {\r\n  if (Transition && Transition.running) {\r\n    fn();\r\n    return Transition.done;\r\n  }\r\n  const l = Listener;\r\n  const o = Owner;\r\n  return Promise.resolve().then(() => {\r\n    Listener = l;\r\n    Owner = o;\r\n    let t;\r\n    if (Scheduler || SuspenseContext) {\r\n      t = Transition || (Transition = {\r\n        sources: new Set(),\r\n        effects: [],\r\n        promises: new Set(),\r\n        disposed: new Set(),\r\n        queue: new Set(),\r\n        running: true\r\n      });\r\n      t.done || (t.done = new Promise(res => t.resolve = res));\r\n      t.running = true;\r\n    }\r\n    runUpdates(fn, false);\r\n    Listener = Owner = null;\r\n    return t ? t.done : undefined;\r\n  });\r\n}\r\nconst [transPending, setTransPending] = /*@__PURE__*/createSignal(false);\r\nfunction useTransition() {\r\n  return [transPending, startTransition];\r\n}\r\nfunction resumeEffects(e) {\r\n  Effects.push.apply(Effects, e);\r\n  e.length = 0;\r\n}\r\nfunction createContext(defaultValue, options) {\r\n  const id = Symbol(\"context\");\r\n  return {\r\n    id,\r\n    Provider: createProvider(id),\r\n    defaultValue\r\n  };\r\n}\r\nfunction useContext(context) {\r\n  return Owner && Owner.context && Owner.context[context.id] !== undefined ? Owner.context[context.id] : context.defaultValue;\r\n}\r\nfunction children(fn) {\r\n  const children = createMemo(fn);\r\n  const memo = createMemo(() => resolveChildren(children()));\r\n  memo.toArray = () => {\r\n    const c = memo();\r\n    return Array.isArray(c) ? c : c != null ? [c] : [];\r\n  };\r\n  return memo;\r\n}\r\nlet SuspenseContext;\r\nfunction getSuspenseContext() {\r\n  return SuspenseContext || (SuspenseContext = createContext());\r\n}\r\nfunction enableExternalSource(factory, untrack = fn => fn()) {\r\n  if (ExternalSourceConfig) {\r\n    const {\r\n      factory: oldFactory,\r\n      untrack: oldUntrack\r\n    } = ExternalSourceConfig;\r\n    ExternalSourceConfig = {\r\n      factory: (fn, trigger) => {\r\n        const oldSource = oldFactory(fn, trigger);\r\n        const source = factory(x => oldSource.track(x), trigger);\r\n        return {\r\n          track: x => source.track(x),\r\n          dispose() {\r\n            source.dispose();\r\n            oldSource.dispose();\r\n          }\r\n        };\r\n      },\r\n      untrack: fn => oldUntrack(() => untrack(fn))\r\n    };\r\n  } else {\r\n    ExternalSourceConfig = {\r\n      factory,\r\n      untrack\r\n    };\r\n  }\r\n}\r\nfunction readSignal() {\r\n  const runningTransition = Transition && Transition.running;\r\n  if (this.sources && (runningTransition ? this.tState : this.state)) {\r\n    if ((runningTransition ? this.tState : this.state) === STALE) updateComputation(this);else {\r\n      const updates = Updates;\r\n      Updates = null;\r\n      runUpdates(() => lookUpstream(this), false);\r\n      Updates = updates;\r\n    }\r\n  }\r\n  if (Listener) {\r\n    const sSlot = this.observers ? this.observers.length : 0;\r\n    if (!Listener.sources) {\r\n      Listener.sources = [this];\r\n      Listener.sourceSlots = [sSlot];\r\n    } else {\r\n      Listener.sources.push(this);\r\n      Listener.sourceSlots.push(sSlot);\r\n    }\r\n    if (!this.observers) {\r\n      this.observers = [Listener];\r\n      this.observerSlots = [Listener.sources.length - 1];\r\n    } else {\r\n      this.observers.push(Listener);\r\n      this.observerSlots.push(Listener.sources.length - 1);\r\n    }\r\n  }\r\n  if (runningTransition && Transition.sources.has(this)) return this.tValue;\r\n  return this.value;\r\n}\r\nfunction writeSignal(node, value, isComp) {\r\n  let current = Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value;\r\n  if (!node.comparator || !node.comparator(current, value)) {\r\n    if (Transition) {\r\n      const TransitionRunning = Transition.running;\r\n      if (TransitionRunning || !isComp && Transition.sources.has(node)) {\r\n        Transition.sources.add(node);\r\n        node.tValue = value;\r\n      }\r\n      if (!TransitionRunning) node.value = value;\r\n    } else node.value = value;\r\n    if (node.observers && node.observers.length) {\r\n      runUpdates(() => {\r\n        for (let i = 0; i < node.observers.length; i += 1) {\r\n          const o = node.observers[i];\r\n          const TransitionRunning = Transition && Transition.running;\r\n          if (TransitionRunning && Transition.disposed.has(o)) continue;\r\n          if (TransitionRunning ? !o.tState : !o.state) {\r\n            if (o.pure) Updates.push(o);else Effects.push(o);\r\n            if (o.observers) markDownstream(o);\r\n          }\r\n          if (!TransitionRunning) o.state = STALE;else o.tState = STALE;\r\n        }\r\n        if (Updates.length > 10e5) {\r\n          Updates = [];\r\n          if (false) ;\r\n          throw new Error();\r\n        }\r\n      }, false);\r\n    }\r\n  }\r\n  return value;\r\n}\r\nfunction updateComputation(node) {\r\n  if (!node.fn) return;\r\n  cleanNode(node);\r\n  const time = ExecCount;\r\n  runComputation(node, Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value, time);\r\n  if (Transition && !Transition.running && Transition.sources.has(node)) {\r\n    queueMicrotask(() => {\r\n      runUpdates(() => {\r\n        Transition && (Transition.running = true);\r\n        Listener = Owner = node;\r\n        runComputation(node, node.tValue, time);\r\n        Listener = Owner = null;\r\n      }, false);\r\n    });\r\n  }\r\n}\r\nfunction runComputation(node, value, time) {\r\n  let nextValue;\r\n  const owner = Owner,\r\n    listener = Listener;\r\n  Listener = Owner = node;\r\n  try {\r\n    nextValue = node.fn(value);\r\n  } catch (err) {\r\n    if (node.pure) {\r\n      if (Transition && Transition.running) {\r\n        node.tState = STALE;\r\n        node.tOwned && node.tOwned.forEach(cleanNode);\r\n        node.tOwned = undefined;\r\n      } else {\r\n        node.state = STALE;\r\n        node.owned && node.owned.forEach(cleanNode);\r\n        node.owned = null;\r\n      }\r\n    }\r\n    node.updatedAt = time + 1;\r\n    return handleError(err);\r\n  } finally {\r\n    Listener = listener;\r\n    Owner = owner;\r\n  }\r\n  if (!node.updatedAt || node.updatedAt <= time) {\r\n    if (node.updatedAt != null && \"observers\" in node) {\r\n      writeSignal(node, nextValue, true);\r\n    } else if (Transition && Transition.running && node.pure) {\r\n      Transition.sources.add(node);\r\n      node.tValue = nextValue;\r\n    } else node.value = nextValue;\r\n    node.updatedAt = time;\r\n  }\r\n}\r\nfunction createComputation(fn, init, pure, state = STALE, options) {\r\n  const c = {\r\n    fn,\r\n    state: state,\r\n    updatedAt: null,\r\n    owned: null,\r\n    sources: null,\r\n    sourceSlots: null,\r\n    cleanups: null,\r\n    value: init,\r\n    owner: Owner,\r\n    context: Owner ? Owner.context : null,\r\n    pure\r\n  };\r\n  if (Transition && Transition.running) {\r\n    c.state = 0;\r\n    c.tState = state;\r\n  }\r\n  if (Owner === null) ;else if (Owner !== UNOWNED) {\r\n    if (Transition && Transition.running && Owner.pure) {\r\n      if (!Owner.tOwned) Owner.tOwned = [c];else Owner.tOwned.push(c);\r\n    } else {\r\n      if (!Owner.owned) Owner.owned = [c];else Owner.owned.push(c);\r\n    }\r\n  }\r\n  if (ExternalSourceConfig && c.fn) {\r\n    const [track, trigger] = createSignal(undefined, {\r\n      equals: false\r\n    });\r\n    const ordinary = ExternalSourceConfig.factory(c.fn, trigger);\r\n    onCleanup(() => ordinary.dispose());\r\n    const triggerInTransition = () => startTransition(trigger).then(() => inTransition.dispose());\r\n    const inTransition = ExternalSourceConfig.factory(c.fn, triggerInTransition);\r\n    c.fn = x => {\r\n      track();\r\n      return Transition && Transition.running ? inTransition.track(x) : ordinary.track(x);\r\n    };\r\n  }\r\n  return c;\r\n}\r\nfunction runTop(node) {\r\n  const runningTransition = Transition && Transition.running;\r\n  if ((runningTransition ? node.tState : node.state) === 0) return;\r\n  if ((runningTransition ? node.tState : node.state) === PENDING) return lookUpstream(node);\r\n  if (node.suspense && untrack(node.suspense.inFallback)) return node.suspense.effects.push(node);\r\n  const ancestors = [node];\r\n  while ((node = node.owner) && (!node.updatedAt || node.updatedAt < ExecCount)) {\r\n    if (runningTransition && Transition.disposed.has(node)) return;\r\n    if (runningTransition ? node.tState : node.state) ancestors.push(node);\r\n  }\r\n  for (let i = ancestors.length - 1; i >= 0; i--) {\r\n    node = ancestors[i];\r\n    if (runningTransition) {\r\n      let top = node,\r\n        prev = ancestors[i + 1];\r\n      while ((top = top.owner) && top !== prev) {\r\n        if (Transition.disposed.has(top)) return;\r\n      }\r\n    }\r\n    if ((runningTransition ? node.tState : node.state) === STALE) {\r\n      updateComputation(node);\r\n    } else if ((runningTransition ? node.tState : node.state) === PENDING) {\r\n      const updates = Updates;\r\n      Updates = null;\r\n      runUpdates(() => lookUpstream(node, ancestors[0]), false);\r\n      Updates = updates;\r\n    }\r\n  }\r\n}\r\nfunction runUpdates(fn, init) {\r\n  if (Updates) return fn();\r\n  let wait = false;\r\n  if (!init) Updates = [];\r\n  if (Effects) wait = true;else Effects = [];\r\n  ExecCount++;\r\n  try {\r\n    const res = fn();\r\n    completeUpdates(wait);\r\n    return res;\r\n  } catch (err) {\r\n    if (!wait) Effects = null;\r\n    Updates = null;\r\n    handleError(err);\r\n  }\r\n}\r\nfunction completeUpdates(wait) {\r\n  if (Updates) {\r\n    if (Scheduler && Transition && Transition.running) scheduleQueue(Updates);else runQueue(Updates);\r\n    Updates = null;\r\n  }\r\n  if (wait) return;\r\n  let res;\r\n  if (Transition) {\r\n    if (!Transition.promises.size && !Transition.queue.size) {\r\n      const sources = Transition.sources;\r\n      const disposed = Transition.disposed;\r\n      Effects.push.apply(Effects, Transition.effects);\r\n      res = Transition.resolve;\r\n      for (const e of Effects) {\r\n        \"tState\" in e && (e.state = e.tState);\r\n        delete e.tState;\r\n      }\r\n      Transition = null;\r\n      runUpdates(() => {\r\n        for (const d of disposed) cleanNode(d);\r\n        for (const v of sources) {\r\n          v.value = v.tValue;\r\n          if (v.owned) {\r\n            for (let i = 0, len = v.owned.length; i < len; i++) cleanNode(v.owned[i]);\r\n          }\r\n          if (v.tOwned) v.owned = v.tOwned;\r\n          delete v.tValue;\r\n          delete v.tOwned;\r\n          v.tState = 0;\r\n        }\r\n        setTransPending(false);\r\n      }, false);\r\n    } else if (Transition.running) {\r\n      Transition.running = false;\r\n      Transition.effects.push.apply(Transition.effects, Effects);\r\n      Effects = null;\r\n      setTransPending(true);\r\n      return;\r\n    }\r\n  }\r\n  const e = Effects;\r\n  Effects = null;\r\n  if (e.length) runUpdates(() => runEffects(e), false);\r\n  if (res) res();\r\n}\r\nfunction runQueue(queue) {\r\n  for (let i = 0; i < queue.length; i++) runTop(queue[i]);\r\n}\r\nfunction scheduleQueue(queue) {\r\n  for (let i = 0; i < queue.length; i++) {\r\n    const item = queue[i];\r\n    const tasks = Transition.queue;\r\n    if (!tasks.has(item)) {\r\n      tasks.add(item);\r\n      Scheduler(() => {\r\n        tasks.delete(item);\r\n        runUpdates(() => {\r\n          Transition.running = true;\r\n          runTop(item);\r\n        }, false);\r\n        Transition && (Transition.running = false);\r\n      });\r\n    }\r\n  }\r\n}\r\nfunction runUserEffects(queue) {\r\n  let i,\r\n    userLength = 0;\r\n  for (i = 0; i < queue.length; i++) {\r\n    const e = queue[i];\r\n    if (!e.user) runTop(e);else queue[userLength++] = e;\r\n  }\r\n  if (sharedConfig.context) {\r\n    if (sharedConfig.count) {\r\n      sharedConfig.effects || (sharedConfig.effects = []);\r\n      sharedConfig.effects.push(...queue.slice(0, userLength));\r\n      return;\r\n    } else if (sharedConfig.effects) {\r\n      queue = [...sharedConfig.effects, ...queue];\r\n      userLength += sharedConfig.effects.length;\r\n      delete sharedConfig.effects;\r\n    }\r\n    setHydrateContext();\r\n  }\r\n  for (i = 0; i < userLength; i++) runTop(queue[i]);\r\n}\r\nfunction lookUpstream(node, ignore) {\r\n  const runningTransition = Transition && Transition.running;\r\n  if (runningTransition) node.tState = 0;else node.state = 0;\r\n  for (let i = 0; i < node.sources.length; i += 1) {\r\n    const source = node.sources[i];\r\n    if (source.sources) {\r\n      const state = runningTransition ? source.tState : source.state;\r\n      if (state === STALE) {\r\n        if (source !== ignore && (!source.updatedAt || source.updatedAt < ExecCount)) runTop(source);\r\n      } else if (state === PENDING) lookUpstream(source, ignore);\r\n    }\r\n  }\r\n}\r\nfunction markDownstream(node) {\r\n  const runningTransition = Transition && Transition.running;\r\n  for (let i = 0; i < node.observers.length; i += 1) {\r\n    const o = node.observers[i];\r\n    if (runningTransition ? !o.tState : !o.state) {\r\n      if (runningTransition) o.tState = PENDING;else o.state = PENDING;\r\n      if (o.pure) Updates.push(o);else Effects.push(o);\r\n      o.observers && markDownstream(o);\r\n    }\r\n  }\r\n}\r\nfunction cleanNode(node) {\r\n  let i;\r\n  if (node.sources) {\r\n    while (node.sources.length) {\r\n      const source = node.sources.pop(),\r\n        index = node.sourceSlots.pop(),\r\n        obs = source.observers;\r\n      if (obs && obs.length) {\r\n        const n = obs.pop(),\r\n          s = source.observerSlots.pop();\r\n        if (index < obs.length) {\r\n          n.sourceSlots[s] = index;\r\n          obs[index] = n;\r\n          source.observerSlots[index] = s;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  if (Transition && Transition.running && node.pure) {\r\n    if (node.tOwned) {\r\n      for (i = node.tOwned.length - 1; i >= 0; i--) cleanNode(node.tOwned[i]);\r\n      delete node.tOwned;\r\n    }\r\n    reset(node, true);\r\n  } else if (node.owned) {\r\n    for (i = node.owned.length - 1; i >= 0; i--) cleanNode(node.owned[i]);\r\n    node.owned = null;\r\n  }\r\n  if (node.cleanups) {\r\n    for (i = node.cleanups.length - 1; i >= 0; i--) node.cleanups[i]();\r\n    node.cleanups = null;\r\n  }\r\n  if (Transition && Transition.running) node.tState = 0;else node.state = 0;\r\n}\r\nfunction reset(node, top) {\r\n  if (!top) {\r\n    node.tState = 0;\r\n    Transition.disposed.add(node);\r\n  }\r\n  if (node.owned) {\r\n    for (let i = 0; i < node.owned.length; i++) reset(node.owned[i]);\r\n  }\r\n}\r\nfunction castError(err) {\r\n  if (err instanceof Error) return err;\r\n  return new Error(typeof err === \"string\" ? err : \"Unknown error\", {\r\n    cause: err\r\n  });\r\n}\r\nfunction runErrors(err, fns, owner) {\r\n  try {\r\n    for (const f of fns) f(err);\r\n  } catch (e) {\r\n    handleError(e, owner && owner.owner || null);\r\n  }\r\n}\r\nfunction handleError(err, owner = Owner) {\r\n  const fns = ERROR && owner && owner.context && owner.context[ERROR];\r\n  const error = castError(err);\r\n  if (!fns) {\r\n    console.error(\"solid error\", error);\r\n    return;\r\n  }\r\n  if (Effects) Effects.push({\r\n    fn() {\r\n      runErrors(error, fns, owner);\r\n    },\r\n    state: STALE\r\n  });else runErrors(error, fns, owner);\r\n}\r\nfunction resolveChildren(children) {\r\n  if (typeof children === \"function\" && !children.length) return resolveChildren(children());\r\n  if (Array.isArray(children)) {\r\n    const results = [];\r\n    for (let i = 0; i < children.length; i++) {\r\n      const result = resolveChildren(children[i]);\r\n      Array.isArray(result) ? results.push.apply(results, result) : results.push(result);\r\n    }\r\n    return results;\r\n  }\r\n  return children;\r\n}\r\nfunction createProvider(id, options) {\r\n  return function provider(props) {\r\n    let res;\r\n    createRenderEffect(() => res = untrack(() => {\r\n      Owner.context = {\r\n        ...Owner.context,\r\n        [id]: props.value\r\n      };\r\n      return children(() => props.children);\r\n    }), undefined);\r\n    return res;\r\n  };\r\n}\r\nfunction onError(fn) {\r\n  ERROR || (ERROR = Symbol(\"error\"));\r\n  if (Owner === null) ;else if (Owner.context === null || !Owner.context[ERROR]) {\r\n    Owner.context = {\r\n      ...Owner.context,\r\n      [ERROR]: [fn]\r\n    };\r\n    mutateContext(Owner, ERROR, [fn]);\r\n  } else Owner.context[ERROR].push(fn);\r\n}\r\nfunction mutateContext(o, key, value) {\r\n  if (o.owned) {\r\n    for (let i = 0; i < o.owned.length; i++) {\r\n      if (o.owned[i].context === o.context) mutateContext(o.owned[i], key, value);\r\n      if (!o.owned[i].context) {\r\n        o.owned[i].context = o.context;\r\n        mutateContext(o.owned[i], key, value);\r\n      } else if (!o.owned[i].context[key]) {\r\n        o.owned[i].context[key] = value;\r\n        mutateContext(o.owned[i], key, value);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction observable(input) {\r\n  return {\r\n    subscribe(observer) {\r\n      if (!(observer instanceof Object) || observer == null) {\r\n        throw new TypeError(\"Expected the observer to be an object.\");\r\n      }\r\n      const handler = typeof observer === \"function\" ? observer : observer.next && observer.next.bind(observer);\r\n      if (!handler) {\r\n        return {\r\n          unsubscribe() {}\r\n        };\r\n      }\r\n      const dispose = createRoot(disposer => {\r\n        createEffect(() => {\r\n          const v = input();\r\n          untrack(() => handler(v));\r\n        });\r\n        return disposer;\r\n      });\r\n      if (getOwner()) onCleanup(dispose);\r\n      return {\r\n        unsubscribe() {\r\n          dispose();\r\n        }\r\n      };\r\n    },\r\n    [Symbol.observable || \"@@observable\"]() {\r\n      return this;\r\n    }\r\n  };\r\n}\r\nfunction from(producer) {\r\n  const [s, set] = createSignal(undefined, {\r\n    equals: false\r\n  });\r\n  if (\"subscribe\" in producer) {\r\n    const unsub = producer.subscribe(v => set(() => v));\r\n    onCleanup(() => \"unsubscribe\" in unsub ? unsub.unsubscribe() : unsub());\r\n  } else {\r\n    const clean = producer(set);\r\n    onCleanup(clean);\r\n  }\r\n  return s;\r\n}\r\n\r\nconst FALLBACK = Symbol(\"fallback\");\r\nfunction dispose(d) {\r\n  for (let i = 0; i < d.length; i++) d[i]();\r\n}\r\nfunction mapArray(list, mapFn, options = {}) {\r\n  let items = [],\r\n    mapped = [],\r\n    disposers = [],\r\n    len = 0,\r\n    indexes = mapFn.length > 1 ? [] : null;\r\n  onCleanup(() => dispose(disposers));\r\n  return () => {\r\n    let newItems = list() || [],\r\n      i,\r\n      j;\r\n    newItems[$TRACK];\r\n    return untrack(() => {\r\n      let newLen = newItems.length,\r\n        newIndices,\r\n        newIndicesNext,\r\n        temp,\r\n        tempdisposers,\r\n        tempIndexes,\r\n        start,\r\n        end,\r\n        newEnd,\r\n        item;\r\n      if (newLen === 0) {\r\n        if (len !== 0) {\r\n          dispose(disposers);\r\n          disposers = [];\r\n          items = [];\r\n          mapped = [];\r\n          len = 0;\r\n          indexes && (indexes = []);\r\n        }\r\n        if (options.fallback) {\r\n          items = [FALLBACK];\r\n          mapped[0] = createRoot(disposer => {\r\n            disposers[0] = disposer;\r\n            return options.fallback();\r\n          });\r\n          len = 1;\r\n        }\r\n      }\r\n      else if (len === 0) {\r\n        mapped = new Array(newLen);\r\n        for (j = 0; j < newLen; j++) {\r\n          items[j] = newItems[j];\r\n          mapped[j] = createRoot(mapper);\r\n        }\r\n        len = newLen;\r\n      } else {\r\n        temp = new Array(newLen);\r\n        tempdisposers = new Array(newLen);\r\n        indexes && (tempIndexes = new Array(newLen));\r\n        for (start = 0, end = Math.min(len, newLen); start < end && items[start] === newItems[start]; start++);\r\n        for (end = len - 1, newEnd = newLen - 1; end >= start && newEnd >= start && items[end] === newItems[newEnd]; end--, newEnd--) {\r\n          temp[newEnd] = mapped[end];\r\n          tempdisposers[newEnd] = disposers[end];\r\n          indexes && (tempIndexes[newEnd] = indexes[end]);\r\n        }\r\n        newIndices = new Map();\r\n        newIndicesNext = new Array(newEnd + 1);\r\n        for (j = newEnd; j >= start; j--) {\r\n          item = newItems[j];\r\n          i = newIndices.get(item);\r\n          newIndicesNext[j] = i === undefined ? -1 : i;\r\n          newIndices.set(item, j);\r\n        }\r\n        for (i = start; i <= end; i++) {\r\n          item = items[i];\r\n          j = newIndices.get(item);\r\n          if (j !== undefined && j !== -1) {\r\n            temp[j] = mapped[i];\r\n            tempdisposers[j] = disposers[i];\r\n            indexes && (tempIndexes[j] = indexes[i]);\r\n            j = newIndicesNext[j];\r\n            newIndices.set(item, j);\r\n          } else disposers[i]();\r\n        }\r\n        for (j = start; j < newLen; j++) {\r\n          if (j in temp) {\r\n            mapped[j] = temp[j];\r\n            disposers[j] = tempdisposers[j];\r\n            if (indexes) {\r\n              indexes[j] = tempIndexes[j];\r\n              indexes[j](j);\r\n            }\r\n          } else mapped[j] = createRoot(mapper);\r\n        }\r\n        mapped = mapped.slice(0, len = newLen);\r\n        items = newItems.slice(0);\r\n      }\r\n      return mapped;\r\n    });\r\n    function mapper(disposer) {\r\n      disposers[j] = disposer;\r\n      if (indexes) {\r\n        const [s, set] = createSignal(j);\r\n        indexes[j] = set;\r\n        return mapFn(newItems[j], s);\r\n      }\r\n      return mapFn(newItems[j]);\r\n    }\r\n  };\r\n}\r\nfunction indexArray(list, mapFn, options = {}) {\r\n  let items = [],\r\n    mapped = [],\r\n    disposers = [],\r\n    signals = [],\r\n    len = 0,\r\n    i;\r\n  onCleanup(() => dispose(disposers));\r\n  return () => {\r\n    const newItems = list() || [];\r\n    newItems[$TRACK];\r\n    return untrack(() => {\r\n      if (newItems.length === 0) {\r\n        if (len !== 0) {\r\n          dispose(disposers);\r\n          disposers = [];\r\n          items = [];\r\n          mapped = [];\r\n          len = 0;\r\n          signals = [];\r\n        }\r\n        if (options.fallback) {\r\n          items = [FALLBACK];\r\n          mapped[0] = createRoot(disposer => {\r\n            disposers[0] = disposer;\r\n            return options.fallback();\r\n          });\r\n          len = 1;\r\n        }\r\n        return mapped;\r\n      }\r\n      if (items[0] === FALLBACK) {\r\n        disposers[0]();\r\n        disposers = [];\r\n        items = [];\r\n        mapped = [];\r\n        len = 0;\r\n      }\r\n      for (i = 0; i < newItems.length; i++) {\r\n        if (i < items.length && items[i] !== newItems[i]) {\r\n          signals[i](() => newItems[i]);\r\n        } else if (i >= items.length) {\r\n          mapped[i] = createRoot(mapper);\r\n        }\r\n      }\r\n      for (; i < items.length; i++) {\r\n        disposers[i]();\r\n      }\r\n      len = signals.length = disposers.length = newItems.length;\r\n      items = newItems.slice(0);\r\n      return mapped = mapped.slice(0, len);\r\n    });\r\n    function mapper(disposer) {\r\n      disposers[i] = disposer;\r\n      const [s, set] = createSignal(newItems[i]);\r\n      signals[i] = set;\r\n      return mapFn(s, i);\r\n    }\r\n  };\r\n}\r\n\r\nlet hydrationEnabled = false;\r\nfunction enableHydration() {\r\n  hydrationEnabled = true;\r\n}\r\nfunction createComponent(Comp, props) {\r\n  if (hydrationEnabled) {\r\n    if (sharedConfig.context) {\r\n      const c = sharedConfig.context;\r\n      setHydrateContext(nextHydrateContext());\r\n      const r = untrack(() => Comp(props || {}));\r\n      setHydrateContext(c);\r\n      return r;\r\n    }\r\n  }\r\n  return untrack(() => Comp(props || {}));\r\n}\r\nfunction trueFn() {\r\n  return true;\r\n}\r\nconst propTraps = {\r\n  get(_, property, receiver) {\r\n    if (property === $PROXY) return receiver;\r\n    return _.get(property);\r\n  },\r\n  has(_, property) {\r\n    if (property === $PROXY) return true;\r\n    return _.has(property);\r\n  },\r\n  set: trueFn,\r\n  deleteProperty: trueFn,\r\n  getOwnPropertyDescriptor(_, property) {\r\n    return {\r\n      configurable: true,\r\n      enumerable: true,\r\n      get() {\r\n        return _.get(property);\r\n      },\r\n      set: trueFn,\r\n      deleteProperty: trueFn\r\n    };\r\n  },\r\n  ownKeys(_) {\r\n    return _.keys();\r\n  }\r\n};\r\nfunction resolveSource(s) {\r\n  return !(s = typeof s === \"function\" ? s() : s) ? {} : s;\r\n}\r\nfunction resolveSources() {\r\n  for (let i = 0, length = this.length; i < length; ++i) {\r\n    const v = this[i]();\r\n    if (v !== undefined) return v;\r\n  }\r\n}\r\nfunction mergeProps(...sources) {\r\n  let proxy = false;\r\n  for (let i = 0; i < sources.length; i++) {\r\n    const s = sources[i];\r\n    proxy = proxy || !!s && $PROXY in s;\r\n    sources[i] = typeof s === \"function\" ? (proxy = true, createMemo(s)) : s;\r\n  }\r\n  if (proxy) {\r\n    return new Proxy({\r\n      get(property) {\r\n        for (let i = sources.length - 1; i >= 0; i--) {\r\n          const v = resolveSource(sources[i])[property];\r\n          if (v !== undefined) return v;\r\n        }\r\n      },\r\n      has(property) {\r\n        for (let i = sources.length - 1; i >= 0; i--) {\r\n          if (property in resolveSource(sources[i])) return true;\r\n        }\r\n        return false;\r\n      },\r\n      keys() {\r\n        const keys = [];\r\n        for (let i = 0; i < sources.length; i++) keys.push(...Object.keys(resolveSource(sources[i])));\r\n        return [...new Set(keys)];\r\n      }\r\n    }, propTraps);\r\n  }\r\n  const sourcesMap = {};\r\n  const defined = Object.create(null);\r\n  for (let i = sources.length - 1; i >= 0; i--) {\r\n    const source = sources[i];\r\n    if (!source) continue;\r\n    const sourceKeys = Object.getOwnPropertyNames(source);\r\n    for (let i = sourceKeys.length - 1; i >= 0; i--) {\r\n      const key = sourceKeys[i];\r\n      if (key === \"__proto__\" || key === \"constructor\") continue;\r\n      const desc = Object.getOwnPropertyDescriptor(source, key);\r\n      if (!defined[key]) {\r\n        defined[key] = desc.get ? {\r\n          enumerable: true,\r\n          configurable: true,\r\n          get: resolveSources.bind(sourcesMap[key] = [desc.get.bind(source)])\r\n        } : desc.value !== undefined ? desc : undefined;\r\n      } else {\r\n        const sources = sourcesMap[key];\r\n        if (sources) {\r\n          if (desc.get) sources.push(desc.get.bind(source));else if (desc.value !== undefined) sources.push(() => desc.value);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  const target = {};\r\n  const definedKeys = Object.keys(defined);\r\n  for (let i = definedKeys.length - 1; i >= 0; i--) {\r\n    const key = definedKeys[i],\r\n      desc = defined[key];\r\n    if (desc && desc.get) Object.defineProperty(target, key, desc);else target[key] = desc ? desc.value : undefined;\r\n  }\r\n  return target;\r\n}\r\nfunction splitProps(props, ...keys) {\r\n  if ($PROXY in props) {\r\n    const blocked = new Set(keys.length > 1 ? keys.flat() : keys[0]);\r\n    const res = keys.map(k => {\r\n      return new Proxy({\r\n        get(property) {\r\n          return k.includes(property) ? props[property] : undefined;\r\n        },\r\n        has(property) {\r\n          return k.includes(property) && property in props;\r\n        },\r\n        keys() {\r\n          return k.filter(property => property in props);\r\n        }\r\n      }, propTraps);\r\n    });\r\n    res.push(new Proxy({\r\n      get(property) {\r\n        return blocked.has(property) ? undefined : props[property];\r\n      },\r\n      has(property) {\r\n        return blocked.has(property) ? false : property in props;\r\n      },\r\n      keys() {\r\n        return Object.keys(props).filter(k => !blocked.has(k));\r\n      }\r\n    }, propTraps));\r\n    return res;\r\n  }\r\n  const otherObject = {};\r\n  const objects = keys.map(() => ({}));\r\n  for (const propName of Object.getOwnPropertyNames(props)) {\r\n    const desc = Object.getOwnPropertyDescriptor(props, propName);\r\n    const isDefaultDesc = !desc.get && !desc.set && desc.enumerable && desc.writable && desc.configurable;\r\n    let blocked = false;\r\n    let objectIndex = 0;\r\n    for (const k of keys) {\r\n      if (k.includes(propName)) {\r\n        blocked = true;\r\n        isDefaultDesc ? objects[objectIndex][propName] = desc.value : Object.defineProperty(objects[objectIndex], propName, desc);\r\n      }\r\n      ++objectIndex;\r\n    }\r\n    if (!blocked) {\r\n      isDefaultDesc ? otherObject[propName] = desc.value : Object.defineProperty(otherObject, propName, desc);\r\n    }\r\n  }\r\n  return [...objects, otherObject];\r\n}\r\nfunction lazy(fn) {\r\n  let comp;\r\n  let p;\r\n  const wrap = props => {\r\n    const ctx = sharedConfig.context;\r\n    if (ctx) {\r\n      const [s, set] = createSignal();\r\n      sharedConfig.count || (sharedConfig.count = 0);\r\n      sharedConfig.count++;\r\n      (p || (p = fn())).then(mod => {\r\n        setHydrateContext(ctx);\r\n        sharedConfig.count--;\r\n        set(() => mod.default);\r\n        setHydrateContext();\r\n      });\r\n      comp = s;\r\n    } else if (!comp) {\r\n      const [s] = createResource(() => (p || (p = fn())).then(mod => mod.default));\r\n      comp = s;\r\n    }\r\n    let Comp;\r\n    return createMemo(() => (Comp = comp()) && untrack(() => {\r\n      if (false) ;\r\n      if (!ctx) return Comp(props);\r\n      const c = sharedConfig.context;\r\n      setHydrateContext(ctx);\r\n      const r = Comp(props);\r\n      setHydrateContext(c);\r\n      return r;\r\n    }));\r\n  };\r\n  wrap.preload = () => p || ((p = fn()).then(mod => comp = () => mod.default), p);\r\n  return wrap;\r\n}\r\nlet counter = 0;\r\nfunction createUniqueId() {\r\n  const ctx = sharedConfig.context;\r\n  return ctx ? `${ctx.id}${ctx.count++}` : `cl-${counter++}`;\r\n}\r\n\r\nconst narrowedError = name => `Stale read from <${name}>.`;\r\nfunction For(props) {\r\n  const fallback = \"fallback\" in props && {\r\n    fallback: () => props.fallback\r\n  };\r\n  return createMemo(mapArray(() => props.each, props.children, fallback || undefined));\r\n}\r\nfunction Index(props) {\r\n  const fallback = \"fallback\" in props && {\r\n    fallback: () => props.fallback\r\n  };\r\n  return createMemo(indexArray(() => props.each, props.children, fallback || undefined));\r\n}\r\nfunction Show(props) {\r\n  const keyed = props.keyed;\r\n  const condition = createMemo(() => props.when, undefined, {\r\n    equals: (a, b) => keyed ? a === b : !a === !b\r\n  });\r\n  return createMemo(() => {\r\n    const c = condition();\r\n    if (c) {\r\n      const child = props.children;\r\n      const fn = typeof child === \"function\" && child.length > 0;\r\n      return fn ? untrack(() => child(keyed ? c : () => {\r\n        if (!untrack(condition)) throw narrowedError(\"Show\");\r\n        return props.when;\r\n      })) : child;\r\n    }\r\n    return props.fallback;\r\n  }, undefined, undefined);\r\n}\r\nfunction Switch(props) {\r\n  let keyed = false;\r\n  const equals = (a, b) => (keyed ? a[1] === b[1] : !a[1] === !b[1]) && a[2] === b[2];\r\n  const conditions = children(() => props.children),\r\n    evalConditions = createMemo(() => {\r\n      let conds = conditions();\r\n      if (!Array.isArray(conds)) conds = [conds];\r\n      for (let i = 0; i < conds.length; i++) {\r\n        const c = conds[i].when;\r\n        if (c) {\r\n          keyed = !!conds[i].keyed;\r\n          return [i, c, conds[i]];\r\n        }\r\n      }\r\n      return [-1];\r\n    }, undefined, {\r\n      equals\r\n    });\r\n  return createMemo(() => {\r\n    const [index, when, cond] = evalConditions();\r\n    if (index < 0) return props.fallback;\r\n    const c = cond.children;\r\n    const fn = typeof c === \"function\" && c.length > 0;\r\n    return fn ? untrack(() => c(keyed ? when : () => {\r\n      if (untrack(evalConditions)[0] !== index) throw narrowedError(\"Match\");\r\n      return cond.when;\r\n    })) : c;\r\n  }, undefined, undefined);\r\n}\r\nfunction Match(props) {\r\n  return props;\r\n}\r\nlet Errors;\r\nfunction resetErrorBoundaries() {\r\n  Errors && [...Errors].forEach(fn => fn());\r\n}\r\nfunction ErrorBoundary(props) {\r\n  let err;\r\n  if (sharedConfig.context && sharedConfig.load) err = sharedConfig.load(sharedConfig.context.id + sharedConfig.context.count);\r\n  const [errored, setErrored] = createSignal(err, undefined);\r\n  Errors || (Errors = new Set());\r\n  Errors.add(setErrored);\r\n  onCleanup(() => Errors.delete(setErrored));\r\n  return createMemo(() => {\r\n    let e;\r\n    if (e = errored()) {\r\n      const f = props.fallback;\r\n      return typeof f === \"function\" && f.length ? untrack(() => f(e, () => setErrored())) : f;\r\n    }\r\n    return catchError(() => props.children, setErrored);\r\n  }, undefined, undefined);\r\n}\r\n\r\nconst suspenseListEquals = (a, b) => a.showContent === b.showContent && a.showFallback === b.showFallback;\r\nconst SuspenseListContext = createContext();\r\nfunction SuspenseList(props) {\r\n  let [wrapper, setWrapper] = createSignal(() => ({\r\n      inFallback: false\r\n    })),\r\n    show;\r\n  const listContext = useContext(SuspenseListContext);\r\n  const [registry, setRegistry] = createSignal([]);\r\n  if (listContext) {\r\n    show = listContext.register(createMemo(() => wrapper()().inFallback));\r\n  }\r\n  const resolved = createMemo(prev => {\r\n    const reveal = props.revealOrder,\r\n      tail = props.tail,\r\n      {\r\n        showContent = true,\r\n        showFallback = true\r\n      } = show ? show() : {},\r\n      reg = registry(),\r\n      reverse = reveal === \"backwards\";\r\n    if (reveal === \"together\") {\r\n      const all = reg.every(inFallback => !inFallback());\r\n      const res = reg.map(() => ({\r\n        showContent: all && showContent,\r\n        showFallback\r\n      }));\r\n      res.inFallback = !all;\r\n      return res;\r\n    }\r\n    let stop = false;\r\n    let inFallback = prev.inFallback;\r\n    const res = [];\r\n    for (let i = 0, len = reg.length; i < len; i++) {\r\n      const n = reverse ? len - i - 1 : i,\r\n        s = reg[n]();\r\n      if (!stop && !s) {\r\n        res[n] = {\r\n          showContent,\r\n          showFallback\r\n        };\r\n      } else {\r\n        const next = !stop;\r\n        if (next) inFallback = true;\r\n        res[n] = {\r\n          showContent: next,\r\n          showFallback: !tail || next && tail === \"collapsed\" ? showFallback : false\r\n        };\r\n        stop = true;\r\n      }\r\n    }\r\n    if (!stop) inFallback = false;\r\n    res.inFallback = inFallback;\r\n    return res;\r\n  }, {\r\n    inFallback: false\r\n  });\r\n  setWrapper(() => resolved);\r\n  return createComponent(SuspenseListContext.Provider, {\r\n    value: {\r\n      register: inFallback => {\r\n        let index;\r\n        setRegistry(registry => {\r\n          index = registry.length;\r\n          return [...registry, inFallback];\r\n        });\r\n        return createMemo(() => resolved()[index], undefined, {\r\n          equals: suspenseListEquals\r\n        });\r\n      }\r\n    },\r\n    get children() {\r\n      return props.children;\r\n    }\r\n  });\r\n}\r\nfunction Suspense(props) {\r\n  let counter = 0,\r\n    show,\r\n    ctx,\r\n    p,\r\n    flicker,\r\n    error;\r\n  const [inFallback, setFallback] = createSignal(false),\r\n    SuspenseContext = getSuspenseContext(),\r\n    store = {\r\n      increment: () => {\r\n        if (++counter === 1) setFallback(true);\r\n      },\r\n      decrement: () => {\r\n        if (--counter === 0) setFallback(false);\r\n      },\r\n      inFallback,\r\n      effects: [],\r\n      resolved: false\r\n    },\r\n    owner = getOwner();\r\n  if (sharedConfig.context && sharedConfig.load) {\r\n    const key = sharedConfig.context.id + sharedConfig.context.count;\r\n    let ref = sharedConfig.load(key);\r\n    if (ref) {\r\n      if (typeof ref !== \"object\" || ref.status !== \"success\") p = ref;else sharedConfig.gather(key);\r\n    }\r\n    if (p && p !== \"$$f\") {\r\n      const [s, set] = createSignal(undefined, {\r\n        equals: false\r\n      });\r\n      flicker = s;\r\n      p.then(() => {\r\n        if (sharedConfig.done) return set();\r\n        sharedConfig.gather(key);\r\n        setHydrateContext(ctx);\r\n        set();\r\n        setHydrateContext();\r\n      }, err => {\r\n        error = err;\r\n        set();\r\n      });\r\n    }\r\n  }\r\n  const listContext = useContext(SuspenseListContext);\r\n  if (listContext) show = listContext.register(store.inFallback);\r\n  let dispose;\r\n  onCleanup(() => dispose && dispose());\r\n  return createComponent(SuspenseContext.Provider, {\r\n    value: store,\r\n    get children() {\r\n      return createMemo(() => {\r\n        if (error) throw error;\r\n        ctx = sharedConfig.context;\r\n        if (flicker) {\r\n          flicker();\r\n          return flicker = undefined;\r\n        }\r\n        if (ctx && p === \"$$f\") setHydrateContext();\r\n        const rendered = createMemo(() => props.children);\r\n        return createMemo(prev => {\r\n          const inFallback = store.inFallback(),\r\n            {\r\n              showContent = true,\r\n              showFallback = true\r\n            } = show ? show() : {};\r\n          if ((!inFallback || p && p !== \"$$f\") && showContent) {\r\n            store.resolved = true;\r\n            dispose && dispose();\r\n            dispose = ctx = p = undefined;\r\n            resumeEffects(store.effects);\r\n            return rendered();\r\n          }\r\n          if (!showFallback) return;\r\n          if (dispose) return prev;\r\n          return createRoot(disposer => {\r\n            dispose = disposer;\r\n            if (ctx) {\r\n              setHydrateContext({\r\n                id: ctx.id + \"f\",\r\n                count: 0\r\n              });\r\n              ctx = undefined;\r\n            }\r\n            return props.fallback;\r\n          }, owner);\r\n        });\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nconst DEV = undefined;\r\n\r\nexport { $DEVCOMP, $PROXY, $TRACK, DEV, ErrorBoundary, For, Index, Match, Show, Suspense, SuspenseList, Switch, batch, cancelCallback, catchError, children, createComponent, createComputed, createContext, createDeferred, createEffect, createMemo, createReaction, createRenderEffect, createResource, createRoot, createSelector, createSignal, createUniqueId, enableExternalSource, enableHydration, enableScheduling, equalFn, from, getListener, getOwner, indexArray, lazy, mapArray, mergeProps, observable, on, onCleanup, onError, onMount, requestCallback, resetErrorBoundaries, runWithOwner, sharedConfig, splitProps, startTransition, untrack, useContext, useTransition };\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {Database} from '.';\r\nimport {ActiveAccountNumber} from '../../lib/accounts/types';\r\nimport {MOUNT_CLASS_TO} from '../debug';\r\n\r\nexport type AccountDatabase = Database<'session' | 'stickerSets' | 'users' | 'chats' | 'messages' | 'dialogs'>;\r\nexport type CommonDatabase = Database<'session' | 'localStorage'>;\r\n\r\nexport const getOldDatabaseState = (): AccountDatabase => ({\r\n  name: `tweb`,\r\n  version: 7,\r\n  stores: [\r\n    {\r\n      name: 'session'\r\n    },\r\n    {\r\n      name: 'stickerSets'\r\n    },\r\n    {\r\n      name: 'users'\r\n    },\r\n    {\r\n      name: 'chats'\r\n    },\r\n    {\r\n      name: 'dialogs'\r\n    },\r\n    {\r\n      name: 'messages'\r\n    }\r\n  ]\r\n});\r\n\r\nexport const getCommonDatabaseState = (): CommonDatabase => ({\r\n  name: `tweb-common`,\r\n  version: 8,\r\n  stores: [\r\n    {\r\n      name: 'session'\r\n    },\r\n    {\r\n      name: 'localStorage', // not used (\r\n      encryptedName: 'localStorage__encrypted'\r\n    }\r\n  ]\r\n});\r\n\r\nexport const getDatabaseState = (\r\n  accountNumber: ActiveAccountNumber\r\n): Database<'session' | 'stickerSets' | 'users' | 'chats' | 'messages' | 'dialogs'> => ({\r\n  name: `tweb-account-${accountNumber}`,\r\n  version: 8,\r\n  stores: [\r\n    {\r\n      name: 'session',\r\n      encryptedName: 'session__encrypted'\r\n    },\r\n    {\r\n      name: 'stickerSets',\r\n      encryptedName: 'stickerSets__encrypted'\r\n    },\r\n    {\r\n      name: 'users',\r\n      encryptedName: 'users__encrypted'\r\n    },\r\n    {\r\n      name: 'chats',\r\n      encryptedName: 'chats__encrypted'\r\n    },\r\n    {\r\n      name: 'dialogs',\r\n      encryptedName: 'dialogs__encrypted'\r\n    },\r\n    {\r\n      name: 'messages',\r\n      encryptedName: 'messages__encrypted'\r\n    }\r\n  ]\r\n});\r\n\r\nMOUNT_CLASS_TO.getDatabaseState = getDatabaseState;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport noop from './noop';\r\n\r\nexport interface CancellablePromise<T> extends Promise<T> {\r\n  resolve?: (value: T) => void,\r\n  reject?: (...args: any[]) => void,\r\n  cancel?: (reason?: any) => void,\r\n\r\n  notify?: (...args: any[]) => void,\r\n  notifyAll?: (...args: any[]) => void,\r\n  lastNotify?: any,\r\n  listeners?: Array<(...args: any[]) => void>,\r\n  addNotifyListener?: (callback: (...args: any[]) => void) => void,\r\n\r\n  isFulfilled?: boolean,\r\n  isRejected?: boolean,\r\n\r\n  onFinish?: () => void,\r\n  _resolve?: (value: T) => void,\r\n  _reject?: (...args: any[]) => void\r\n}\r\n\r\nconst deferredHelper = {\r\n  isFulfilled: false,\r\n  isRejected: false,\r\n\r\n  notify: () => {},\r\n  notifyAll: function(...args: any[]) {\r\n    this.lastNotify = args;\r\n    this.listeners?.forEach((callback: any) => callback(...args));\r\n  },\r\n\r\n  addNotifyListener: function(callback: (...args: any[]) => void) {\r\n    if(this.lastNotify) {\r\n      callback(...this.lastNotify);\r\n    }\r\n\r\n    (this.listeners ??= []).push(callback);\r\n  },\r\n\r\n  resolve: function(value) {\r\n    if(this.isFulfilled || this.isRejected) return;\r\n\r\n    this.isFulfilled = true;\r\n    this._resolve(value);\r\n    this.onFinish();\r\n  },\r\n\r\n  reject: function(...args) {\r\n    if(this.isRejected || this.isFulfilled) return;\r\n\r\n    this.isRejected = true;\r\n    this._reject(...args);\r\n    this.onFinish();\r\n  },\r\n\r\n  onFinish: function() {\r\n    this.notify = this.notifyAll = this.lastNotify = null;\r\n    if(this.listeners) this.listeners.length = 0;\r\n\r\n    if(this.cancel) {\r\n      this.cancel = noop;\r\n    }\r\n  }\r\n} as CancellablePromise<any>;\r\n\r\nexport default function deferredPromise<T>() {\r\n  let resolve: (value: T) => void, reject: (...args: any[]) => void;\r\n  const deferred: CancellablePromise<T> = new Promise<T>((_resolve, _reject) => {\r\n    resolve = _resolve, reject = _reject;\r\n  });\r\n\r\n  Object.assign(deferred, deferredHelper);\r\n  deferred._resolve = resolve;\r\n  deferred._reject = reject;\r\n\r\n  return deferred;\r\n}\r\n\r\nexport function bindPromiseToDeferred<T>(promise: Promise<T>, deferred: CancellablePromise<T>) {\r\n  promise.then(deferred.resolve.bind(deferred), deferred.reject.bind(deferred));\r\n}\r\n\r\n(self as any).deferredPromise = deferredPromise;\r\n","// * Jolly Cobra's schedulers\r\n\r\nimport {AnyToVoidFunction} from '../../types';\r\n\r\nexport default function throttleWith<F extends AnyToVoidFunction>(\r\n  schedulerFn: AnyToVoidFunction,\r\n  fn: F,\r\n  shouldRunFirst = false\r\n) {\r\n  let isPending: boolean;\r\n  let waiting: number;\r\n  let args: Parameters<F>;\r\n\r\n  const ret = (..._args: Parameters<F>) => {\r\n    isPending = true;\r\n    args = _args;\r\n\r\n    if(waiting) {\r\n      return;\r\n    }\r\n\r\n    if(shouldRunFirst) {\r\n      isPending = false;\r\n      // @ts-ignore\r\n      fn(...args);\r\n    }\r\n\r\n    const _waiting = waiting = Math.random();\r\n    schedulerFn(() => {\r\n      if(waiting !== _waiting) {\r\n        return;\r\n      }\r\n\r\n      ret.clear();\r\n      if(!isPending) {\r\n        return;\r\n      }\r\n\r\n      isPending = false;\r\n      // @ts-ignore\r\n      fn(...args);\r\n    });\r\n  };\r\n\r\n  ret.clear = () => {\r\n    waiting = undefined;\r\n  };\r\n\r\n  return ret;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {Database} from '../../config/databases';\r\nimport Modes from '../../config/modes';\r\nimport makeError from '../../helpers/makeError';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\nimport {logger} from '../logger';\r\n\r\n/**\r\n * https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/createIndex\r\n */\r\nexport type IDBIndex = {\r\n  indexName: string,\r\n  keyPath: string,\r\n  objectParameters: IDBIndexParameters\r\n};\r\n\r\nexport type IDBStore = {\r\n  name: string,\r\n  encryptedName?: string,\r\n  indexes?: IDBIndex[]\r\n};\r\n\r\nexport type IDBOptions = {\r\n  name?: string,\r\n  storeName: string,\r\n  stores?: IDBStore[],\r\n  version?: number\r\n};\r\n\r\nconst DEBUG = false;\r\n\r\nexport class IDB {\r\n  private static INSTANCES: IDB[] = [];\r\n  private openDbPromise: MaybePromise<IDBDatabase>;\r\n  private db: IDBDatabase;\r\n  private storageIsAvailable: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private name: string;\r\n  private version: number;\r\n  private stores: IDBStore[];\r\n\r\n  constructor(db: Database<any>) {\r\n    safeAssign(this, db);\r\n\r\n    if(Modes.test) {\r\n      this.name += '_test';\r\n    }\r\n\r\n    this.storageIsAvailable = true;\r\n    this.log = logger(['IDB', db.name].join('-'));\r\n    this.log('constructor');\r\n\r\n    this.openDatabase(true);\r\n\r\n    IDB.INSTANCES.push(this);\r\n  }\r\n\r\n  public isAvailable() {\r\n    return this.storageIsAvailable;\r\n  }\r\n\r\n  public openDatabase(createNew = false): IDB['openDbPromise'] {\r\n    if(this.openDbPromise && !createNew) {\r\n      return this.openDbPromise;\r\n    }\r\n\r\n    const createIndexes = (os: IDBObjectStore, store: IDBStore) => {\r\n      const indexNames = Array.from(os.indexNames);\r\n      for(const indexName of indexNames) {\r\n        os.deleteIndex(indexName);\r\n      }\r\n\r\n      if(!store.indexes?.length) {\r\n        return;\r\n      }\r\n\r\n      for(const index of store.indexes) {\r\n        if(os.indexNames.contains(index.indexName)) {\r\n          continue;\r\n        }\r\n\r\n        os.createIndex(index.indexName, index.keyPath, index.objectParameters);\r\n      }\r\n    };\r\n\r\n    const createObjectStore = (db: IDBDatabase, store: IDBStore) => {\r\n      const os = db.createObjectStore(store.name);\r\n      createIndexes(os, store);\r\n    };\r\n\r\n    try {\r\n      var request = indexedDB.open(this.name, this.version);\r\n      if(!request) {\r\n        return Promise.reject();\r\n      }\r\n    } catch(error) {\r\n      this.log.error('error opening db', (error as Error).message);\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    let finished = false;\r\n    setTimeout(() => {\r\n      if(!finished) {\r\n        request.onerror(makeError('IDB_CREATE_TIMEOUT') as any as Event);\r\n      }\r\n    }, 3000);\r\n\r\n    return this.openDbPromise = new Promise<IDBDatabase>((resolve, reject) => {\r\n      request.onsuccess = (event) => {\r\n        finished = true;\r\n        const db = request.result;\r\n        let calledNew = false;\r\n\r\n        this.log('Opened');\r\n\r\n        db.onerror = (error) => {\r\n          this.storageIsAvailable = false;\r\n          this.log.error('Error creating/accessing IndexedDB database', error);\r\n          reject(error);\r\n        };\r\n\r\n        db.onclose = (e) => {\r\n          this.log.error('closed:', e);\r\n          !calledNew && this.openDatabase();\r\n        };\r\n\r\n        db.onabort = (e) => {\r\n          this.log.error('abort:', e);\r\n          const transaction = e.target as IDBTransaction;\r\n\r\n          this.openDatabase(calledNew = true);\r\n\r\n          if(transaction.onerror) {\r\n            transaction.onerror(e);\r\n          }\r\n\r\n          db.close();\r\n        };\r\n\r\n        db.onversionchange = (e) => {\r\n          this.log.error('onversionchange, lol?');\r\n        };\r\n\r\n        resolve(this.db = db);\r\n      };\r\n\r\n      request.onerror = (event) => {\r\n        finished = true;\r\n        this.storageIsAvailable = false;\r\n        this.log.error('Error creating/accessing IndexedDB database', event);\r\n        reject(event);\r\n      };\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        finished = true;\r\n        this.log.warn('performing idb upgrade from', event.oldVersion, 'to', event.newVersion);\r\n\r\n        const target = event.target as IDBOpenDBRequest;\r\n        const db = target.result;\r\n        this.stores.forEach((store) => {\r\n          /* if(db.objectStoreNames.contains(store.name)) {\r\n            //if(event.oldVersion === 1) {\r\n              db.deleteObjectStore(store.name);\r\n            //}\r\n          } */\r\n\r\n          if(!db.objectStoreNames.contains(store.name)) {\r\n            createObjectStore(db, store);\r\n          } else {\r\n            const txn = target.transaction;\r\n            const os = txn.objectStore(store.name);\r\n            createIndexes(os, store);\r\n          }\r\n\r\n          if(store.encryptedName && !db.objectStoreNames.contains(store.encryptedName)) {\r\n            db.createObjectStore(store.encryptedName);\r\n          }\r\n        });\r\n      };\r\n    }).then((db) => this.openDbPromise = db);\r\n  }\r\n\r\n  // * can't return promise here since some connections can be opened in other threads and it won't resolve\r\n  public async closeDatabase() {\r\n    if(!this.db) {\r\n      return;\r\n    }\r\n\r\n    // * overwrite handler to prevent reopening\r\n    this.db.onclose = () => {};\r\n    this.db.close();\r\n  }\r\n\r\n  public static create<T extends Database<any>>(db: T) {\r\n    return this.INSTANCES.find((instance) => instance.name === db.name) ?? new IDB(db);\r\n  }\r\n\r\n  public static closeDatabases(preserve?: IDB) {\r\n    this.INSTANCES.forEach((storage) => {\r\n      if(preserve && preserve === storage) {\r\n        return;\r\n      }\r\n\r\n      storage.closeDatabase();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ! WARNING ! function requires at least one opened connection\r\n   */\r\n  /* public static clearObjectStores() {\r\n    const storage = this.STORAGES[0];\r\n    this.closeDatabases(storage);\r\n\r\n    const names = Array.from(storage.db.objectStoreNames);\r\n    const promises = names.map((name) => storage.clear(name));\r\n    return Promise.all(promises);\r\n  } */\r\n\r\n  /* public static deleteDatabase() {\r\n    this.closeDatabases();\r\n\r\n    const storages = this.STORAGES;\r\n    const dbNames = Array.from(new Set(storages.map((storage) => storage.name)));\r\n    const promises = dbNames.map((dbName) => {\r\n      this.deleteDatabaseByName(dbName);\r\n    });\r\n\r\n    return Promise.all(promises);\r\n  } */\r\n\r\n  /**\r\n   * Promise will be resolved only when all connections are closed \\\r\n   * You can skip waiting since it'll be deleted after all connections are closed\r\n   */\r\n  public static deleteDatabaseByName(dbName: string) {\r\n    return new Promise<void>((resolve, reject) => {\r\n      this.INSTANCES.forEach((storage) => {\r\n        if(storage.name === dbName) {\r\n          return storage.closeDatabase();\r\n        }\r\n      });\r\n\r\n      const request = indexedDB.deleteDatabase(dbName);\r\n      request.onerror = () => reject();\r\n      request.onsuccess = () => resolve();\r\n    });\r\n  }\r\n}\r\n\r\nnamespace IDBStorage {\r\n  export type Entries = Array<[IDBValidKey, any]>\r\n}\r\n\r\nclass IDBStorage<T extends Database<any>, StoreName extends string = T['stores'][number]['name']> {\r\n  private log: ReturnType<typeof logger>;\r\n  private storeName: T['stores'][0]['name'];\r\n  private idb: IDB;\r\n\r\n  constructor(db: T, storeName: T['stores'][0]['name' | 'encryptedName']) {\r\n    this.storeName = storeName;\r\n    this.log = logger(['IDB', db.name, storeName].join('-'));\r\n    this.idb = IDB.create(db);\r\n  }\r\n\r\n  public close() {\r\n    return this.idb.closeDatabase();\r\n  }\r\n\r\n  public delete(entryName: string | string[], storeName?: StoreName): Promise<void> {\r\n    // return Promise.resolve();\r\n    const isArray = Array.isArray(entryName);\r\n    if(!isArray) {\r\n      entryName = [].concat(entryName);\r\n    }\r\n\r\n    return this.getObjectStore('readwrite', (objectStore) => {\r\n      const promises = (entryName as string[]).map((entryName) => objectStore.delete(entryName));\r\n      return isArray ? promises : promises[0];\r\n    }, DEBUG ? 'delete: ' + (entryName as string[]).join(', ') : '', storeName);\r\n  }\r\n\r\n  public clear(storeName?: StoreName): Promise<void> {\r\n    return this.getObjectStore('readwrite', (objectStore) => objectStore.clear(), DEBUG ? 'clear' : '', storeName);\r\n  }\r\n\r\n  public save(entryName: string | string[], value: any | any[], storeName?: StoreName) {\r\n    // const handleError = (error: Error) => {\r\n    //   this.log.error('save: transaction error:', entryName, value, db, error, error && error.name);\r\n    //   if((!error || error.name === 'InvalidStateError')/*  && false */) {\r\n    //     setTimeout(() => {\r\n    //       this.save(entryName, value);\r\n    //     }, 2e3);\r\n    //   } else {\r\n    //     //console.error('IndexedDB saveFile transaction error:', error, error && error.name);\r\n    //   }\r\n    // };\r\n\r\n    const isArray = Array.isArray(entryName);\r\n    if(!isArray) {\r\n      entryName = [].concat(entryName);\r\n      value = [].concat(value);\r\n    }\r\n\r\n    return this.getObjectStore('readwrite', (objectStore) => {\r\n      const promises = (entryName as string[]).map((entryName, idx) => objectStore.put(value[idx], entryName));\r\n      return isArray ? promises : promises[0];\r\n    }, DEBUG ? 'save: ' + (entryName as string[]).join(', ') : '', storeName);\r\n  }\r\n\r\n  // public saveFile(fileName: string, blob: Blob | Uint8Array) {\r\n  //   //return Promise.resolve(blobConstruct([blob]));\r\n  //   if(!(blob instanceof Blob)) {\r\n  //     blob = blobConstruct(blob);\r\n  //   }\r\n\r\n  //   return this.save(fileName, blob);\r\n  // }\r\n\r\n  /* public saveFileBase64(db: IDBDatabase, fileName: string, blob: Blob | any): Promise<Blob> {\r\n    if(this.getBlobSize(blob) > 10 * 1024 * 1024) {\r\n      return Promise.reject();\r\n    }\r\n\r\n    if(!(blob instanceof Blob)) {\r\n      var safeMimeType = blobSafeMimeType(blob.type || 'image/jpeg');\r\n      var address = 'data:' + safeMimeType + ';base64,' + bytesToBase64(blob);\r\n      return this.storagePutB64String(db, fileName, address).then(() => {\r\n        return blob;\r\n      });\r\n    }\r\n\r\n    try {\r\n      var reader = new FileReader();\r\n    } catch (e) {\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject();\r\n    }\r\n\r\n    let promise = new Promise<Blob>((resolve, reject) => {\r\n      reader.onloadend = () => {\r\n        this.storagePutB64String(db, fileName, reader.result as string).then(() => {\r\n          resolve(blob);\r\n        }, reject);\r\n      }\r\n\r\n      reader.onerror = reject;\r\n    });\r\n\r\n\r\n    try {\r\n      reader.readAsDataURL(blob);\r\n    } catch (e) {\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject();\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public storagePutB64String(db: IDBDatabase, fileName: string, b64string: string) {\r\n    try {\r\n      var objectStore = db.transaction([this.storeName], 'readwrite')\r\n        .objectStore(this.storeName);\r\n      var request = objectStore.put(b64string, fileName);\r\n    } catch(error) {\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      request.onsuccess = function(event) {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = reject;\r\n    });\r\n  }\r\n\r\n  public getBlobSize(blob: any) {\r\n    return blob.size || blob.byteLength || blob.length;\r\n  } */\r\n\r\n  public get<T>(entryName: string[], storeName?: StoreName): Promise<T[]>;\r\n  public get<T>(entryName: string, storeName?: StoreName): Promise<T>;\r\n  public get<T>(entryName: string | string[], storeName?: StoreName): Promise<T> | Promise<T[]> {\r\n    // return Promise.reject();\r\n\r\n    const isArray = Array.isArray(entryName);\r\n    if(!isArray) {\r\n      if(!entryName) {\r\n        return undefined;\r\n      }\r\n\r\n      entryName = [].concat(entryName);\r\n    } else if(!entryName.length) {\r\n      return Promise.resolve([]) as any;\r\n    }\r\n\r\n    return this.getObjectStore<T>('readonly', (objectStore) => {\r\n      const promises = (entryName as string[]).map((entryName) => objectStore.get(entryName));\r\n      return isArray ? promises : promises[0];\r\n    }, DEBUG ? 'get: ' + (entryName as string[]).join(', ') : '', storeName);\r\n  }\r\n\r\n  private async getObjectStore<T>(\r\n    mode: IDBTransactionMode,\r\n    callback: (objectStore: IDBObjectStore, onComplete: () => void, onError: () => void) => IDBRequest | IDBRequest[],\r\n    log?: string,\r\n    storeName = this.storeName\r\n  ) {\r\n    let perf: number;\r\n\r\n    if(log) {\r\n      perf = performance.now();\r\n      this.log(log + ': start');\r\n    }\r\n\r\n    const timeout = setTimeout(() => {\r\n      this.log.error('transaction not finished', transaction, log);\r\n    }, 10000);\r\n\r\n    const _db = this.idb.openDatabase();\r\n    const db = _db instanceof Promise ? await _db : _db;\r\n\r\n    let resolve: (value: T) => void, reject: (reason?: any) => void;\r\n    const promise = new Promise<T>((a, b) => [resolve, reject] = [a, b]);\r\n\r\n    // * https://developer.chrome.com/blog/indexeddb-durability-mode-now-defaults-to-relaxed\r\n    const transaction = db.transaction([storeName], mode, {durability: 'relaxed'});\r\n\r\n    const onError = () => {\r\n      clearTimeout(timeout);\r\n      reject(transaction.error);\r\n    };\r\n\r\n    const onComplete = (/* what: string */) => {\r\n      clearTimeout(timeout);\r\n\r\n      if(log) {\r\n        this.log(log + ': end', performance.now() - perf/* , what */);\r\n      }\r\n\r\n      const results = requests.map((r) => r.result);\r\n      resolve(isArray ? results : results[0]);\r\n\r\n      if(log) {\r\n        this.log(log + ': resolved', isArray ? results : results[0]);\r\n      }\r\n    };\r\n\r\n    transaction.onerror = onError;\r\n\r\n    // * have to wait while clearing or setting something\r\n    const waitForTransactionComplete = mode === 'readwrite';\r\n    if(waitForTransactionComplete) {\r\n      transaction.oncomplete = () => onComplete(/* 'transaction' */);\r\n    }\r\n\r\n    const callbackResult = callback(transaction.objectStore(storeName), onComplete, onError);\r\n    const isArray = Array.isArray(callbackResult);\r\n    const requests: IDBRequest[] = isArray ? callbackResult : [].concat(callbackResult) as any;\r\n\r\n    if(waitForTransactionComplete) {\r\n      return promise;\r\n    }\r\n\r\n    const length = requests.length;\r\n    let left = length;\r\n\r\n    const onRequestFinished = () => {\r\n      if(transaction.error) {\r\n        return;\r\n      }\r\n\r\n      if(!--left) {\r\n        onComplete(/* 'requests' */);\r\n      }\r\n    };\r\n\r\n    for(let i = 0; i < length; ++i) {\r\n      const request = requests[i];\r\n      request.onerror = onError;\r\n      request.onsuccess = onRequestFinished;\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public getAll<T>(storeName?: StoreName): Promise<T[]> {\r\n    return this.getObjectStore<T[]>('readonly', (objectStore) => objectStore.getAll(), DEBUG ? 'getAll' : '', storeName);\r\n  }\r\n\r\n  public getAllEntries(storeName?: StoreName) {\r\n    const entries: IDBStorage.Entries = [];\r\n    return new Promise<IDBStorage.Entries>((resolve, reject) => {\r\n      this.getObjectStore<T[]>('readonly', (objectStore, onComplete, onError) => {\r\n        const request = objectStore.openCursor();\r\n        request.onsuccess = (event) => {\r\n          const cursor = (event.target as IDBRequest<IDBCursorWithValue | null>).result;\r\n          if(cursor) {\r\n            entries.push([cursor.key, cursor.value])\r\n            cursor.continue();\r\n          } else {\r\n            onComplete();\r\n            resolve(entries);\r\n          }\r\n        };\r\n        request.onerror = onError;\r\n        return [];\r\n      }, DEBUG ? 'getAllEntries' : '', storeName).catch(reject);\r\n    });\r\n  }\r\n\r\n  /* public getAllKeys(): Promise<Array<string>> {\r\n    console.time('getAllEntries');\r\n    return this.openDatabase().then((db) => {\r\n      var objectStore = db.transaction([this.storeName], 'readonly')\r\n        .objectStore(this.storeName);\r\n      var request = objectStore.getAllKeys();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        request.onsuccess = function(event) {\r\n          // @ts-ignore\r\n          var result = event.target.result;\r\n          resolve(result);\r\n          console.timeEnd('getAllEntries');\r\n        }\r\n\r\n        request.onerror = reject;\r\n      });\r\n    });\r\n  } */\r\n\r\n  /* public isFileExists(fileName: string): Promise<boolean> {\r\n    console.time('isFileExists');\r\n    return this.openDatabase().then((db) => {\r\n      var objectStore = db.transaction([this.storeName], 'readonly')\r\n        .objectStore(this.storeName);\r\n      var request = objectStore.openCursor(fileName);\r\n\r\n      return new Promise((resolve, reject) => {\r\n        request.onsuccess = function(event) {\r\n          // @ts-ignore\r\n          var cursor = event.target.result;\r\n          resolve(!!cursor);\r\n          console.timeEnd('isFileExists');\r\n        }\r\n\r\n        request.onerror = reject;\r\n      });\r\n    });\r\n  } */\r\n\r\n  /* public getFileWriter(fileName: string, mimeType: string) {\r\n    var fakeWriter = FileManager.getFakeFileWriter(mimeType, (blob) => {\r\n      return this.saveFile(fileName, blob);\r\n    });\r\n\r\n    return Promise.resolve(fakeWriter);\r\n  } */\r\n}\r\n\r\nexport default IDBStorage;\r\n","export default class StaticUtilityClass {\r\n  constructor() {\r\n    throw new Error('Cannot instantiate a static utility class');\r\n  }\r\n}\r\n","import deferredPromise from '../../helpers/cancellablePromise';\r\n\r\nimport StaticUtilityClass from '../staticUtilityClass';\r\n\r\n\r\nexport default class DeferredIsUsingPasscode extends StaticUtilityClass {\r\n  private static deferred = deferredPromise<void>();\r\n  private static value: boolean;\r\n\r\n  public static resolveDeferred(value: boolean) {\r\n    this.value = value;\r\n    this.deferred?.resolve();\r\n    this.deferred = undefined;\r\n  }\r\n\r\n  public static async isUsingPasscode() {\r\n    if(this.deferred) await this.deferred;\r\n\r\n    if(typeof this.value !== 'boolean') throw new Error('Is using passcode is not boolean WTF?');\r\n\r\n    return this.value;\r\n  }\r\n\r\n  /**\r\n   * Mainly for Service worker\r\n   */\r\n  public static resetDeferred() {\r\n    this.value = undefined;\r\n    this.deferred = deferredPromise();\r\n  }\r\n}\r\n","export default function toArray<T>(value: T | T[]): T[] {\r\n  return Array.isArray(value) ? value : [value];\r\n}\r\n","export default function convertToUint8Array(bytes: Uint8Array | ArrayBuffer | number[] | string): Uint8Array {\r\n  if(bytes instanceof Uint8Array) {\r\n    return bytes;\r\n  } else if(typeof(bytes) === 'string') {\r\n    return new TextEncoder().encode(bytes);\r\n  }\r\n\r\n  return new Uint8Array(bytes);\r\n}\r\n","export default function formatBytesPure(bytes: number, decimals: number | 'auto' = 'auto') {\r\n  if(bytes === 0) return `0 B`;\r\n\r\n  const strictDecimals = decimals === 'auto';\r\n\r\n  const k = 1024;\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  const _decimals = decimals === 'auto' ? Math.max(0, i - 1) : decimals;\r\n\r\n  const dm = Math.max(0, _decimals);\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n\r\n  const fixed = (bytes / Math.pow(k, i)).toFixed(dm);\r\n  return [sizes[i], strictDecimals ? fixed : parseFloat(fixed)].reverse().join(' ');\r\n}\r\n","export default function asyncThrottle<Callaback extends(...args: any[]) => Promise<void>>(\r\n  callback: Callaback,\r\n  timeoutMs: number\r\n  // shouldRunFirst = false // TO BE IMPLEMENTED:) but default to false\r\n) {\r\n  type Args = Parameters<Callaback>\r\n\r\n  let lastArgs: Args;\r\n  let timeoutId: number;\r\n  let wasCalledWhileRunning = false;\r\n\r\n  function runAfterTimeout() {\r\n    timeoutId = self.setTimeout(() => {\r\n      wasCalledWhileRunning = false; // reset before executing callback\r\n\r\n      callback(...lastArgs)?.then(() => {\r\n        timeoutId = undefined;\r\n        if(wasCalledWhileRunning) runAfterTimeout();\r\n      });\r\n    }, timeoutMs);\r\n  }\r\n\r\n  const result = (...args: Args) => {\r\n    lastArgs = args;\r\n    wasCalledWhileRunning = true;\r\n\r\n    if(timeoutId) return;\r\n\r\n    runAfterTimeout();\r\n  };\r\n\r\n  result.clear = () => {\r\n    self.clearTimeout(timeoutId);\r\n    lastArgs = undefined;\r\n    timeoutId = undefined;\r\n    wasCalledWhileRunning = false;\r\n  };\r\n\r\n  return result;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CryptoMethods} from './crypto_methods';\r\nimport SuperMessagePort from '../mtproto/superMessagePort';\r\nimport {Awaited} from '../../types';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {IS_WORKER} from '../../helpers/context';\r\n\r\n\r\ntype CryptoEvent = {\r\n  invoke: <T extends keyof CryptoMethods>(payload: {method: T, args: Parameters<CryptoMethods[T]>}) =>\r\n    SuperMessagePort.TransferableResultValue<ReturnType<CryptoMethods[T]>>,\r\n  port: (payload: void, source: MessageEventSource, event: MessageEvent) => void,\r\n  terminate: () => void\r\n};\r\n\r\nexport class CryptoMessagePort<Master extends boolean = false> extends SuperMessagePort<CryptoEvent, CryptoEvent, Master> {\r\n  private lastIndex: number;\r\n\r\n  constructor() {\r\n    super('CRYPTO');\r\n    this.lastIndex = -1;\r\n  }\r\n\r\n  // TODO: Transfer transferables on result tasks?\r\n  public invokeCryptoNew<T extends keyof CryptoMethods>({method, args, transfer}: {\r\n    method: T,\r\n    args: Parameters<CryptoMethods[T]>,\r\n    transfer?: Transferable[]\r\n  }): Promise<Awaited<SuperMessagePort.TransferableResultValue<ReturnType<CryptoMethods[T]>>>> {\r\n    const payload = {method, args};\r\n    const listeners = this.listeners['invoke'];\r\n    if(listeners?.size) { // already in worker\r\n      // try {\r\n      let result: any = listeners.values().next().value.callback(payload);\r\n      if(!IS_WORKER && !(result instanceof Promise)) {\r\n        result = Promise.resolve(result);\r\n      }\r\n\r\n      return result;\r\n      // } catch(err) {\r\n      //   return Promise.reject(err);\r\n      // }\r\n    }\r\n\r\n    const sendPortIndex = method === 'aes-encrypt' || method === 'aes-decrypt' ?\r\n      this.lastIndex = (this.lastIndex + 1) % this.sendPorts.length :\r\n      0;\r\n    // @ts-ignore\r\n    return this.invoke('invoke', payload, undefined, this.sendPorts[sendPortIndex], transfer);\r\n  }\r\n\r\n  public invokeCrypto<T extends keyof CryptoMethods>(method: T, ...args: Parameters<CryptoMethods[T]>) {\r\n    return this.invokeCryptoNew({method, args});\r\n  }\r\n\r\n  public sendToOnePort(port: MessagePort) {\r\n    this.invokeVoid('port', undefined, this.sendPorts[0], [port]);\r\n  }\r\n}\r\n\r\nconst cryptoMessagePort = new CryptoMessagePort<false>();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.cryptoMessagePort = cryptoMessagePort);\r\nexport default cryptoMessagePort;\r\n","import deferredPromise from '../../helpers/cancellablePromise';\r\nimport StaticUtilityClass from '../staticUtilityClass';\r\n\r\n\r\nexport default class EncryptionKeyStore extends StaticUtilityClass {\r\n  private static key: CryptoKey | null = null;\r\n\r\n  private static deferred = deferredPromise<void>();\r\n\r\n  public static async get() {\r\n    if(this.deferred) await this.deferred;\r\n    return this.key;\r\n  }\r\n\r\n  public static async getAsBase64() {\r\n    const key = await this.get();\r\n    if(!key) return null;\r\n\r\n    const exportedKey = await crypto.subtle.exportKey('raw', key);\r\n    const base64Key = btoa(String.fromCharCode(...new Uint8Array(exportedKey)));\r\n\r\n    return base64Key;\r\n  }\r\n\r\n  public static save(key: CryptoKey | null) {\r\n    this.key = key;\r\n    this.deferred?.resolve();\r\n    this.deferred = undefined;\r\n  }\r\n\r\n  /**\r\n   * Mainly for Service Worker\r\n   */\r\n  public static resetDeferred() {\r\n    this.key = null;\r\n    this.deferred = deferredPromise();\r\n  }\r\n}\r\n","import {Database} from '../config/databases';\r\nimport DEBUG from '../config/debug';\r\nimport toArray from '../helpers/array/toArray';\r\nimport convertToUint8Array from '../helpers/bytes/convertToUint8Array';\r\nimport {IS_WORKER} from '../helpers/context';\r\nimport formatBytesPure from '../helpers/formatBytesPure';\r\nimport asyncThrottle from '../helpers/schedulers/asyncThrottle';\r\n\r\nimport cryptoMessagePort from './crypto/cryptoMessagePort';\r\nimport IDBStorage from './files/idb';\r\nimport {logger, Logger} from './logger';\r\nimport MTProtoMessagePort from './mtproto/mtprotoMessagePort';\r\nimport EncryptionKeyStore from './passcode/keyStore';\r\n\r\n\r\nexport interface StorageLayer\r\n{\r\n  save: (entryName: string | string[], value: any | any[]) => Promise<unknown>;\r\n  get: <T>(entryNames: string[]) => Promise<T[]>;\r\n  getAllEntries: () => Promise<IDBStorage.Entries>;\r\n  getAll: <T>() => Promise<T[]>;\r\n  delete: (entryName: string | string[]) => Promise<void>;\r\n  clear: () => Promise<void>;\r\n};\r\n\r\ntype StoredData = Record<string, any>;\r\n\r\nexport default class EncryptedStorageLayer<T extends Database<any>> implements StorageLayer\r\n{\r\n  private static STORAGE_KEY = 'data';\r\n  // private static STORAGE_THROTTLE_TIME_MS = 250;\r\n  /**\r\n   * Having a delay here can break the app after logout, due to the fact that some updates might be queued in here before the\r\n   * storages were disabled, and the after timeout it will save the data anyway (that might have been cleared for logout)\r\n   */\r\n  private static STORAGE_THROTTLE_TIME_MS = 0;\r\n\r\n  private static instances = new Map<string, EncryptedStorageLayer<Database<any>>>();\r\n\r\n  private storage: IDBStorage<T>;\r\n  private data: StoredData;\r\n\r\n  private log: Logger;\r\n\r\n  private loadingDataPromise: Promise<unknown>;\r\n\r\n  private constructor(private db: T, private encryptedStoreName: T['stores'][number]['encryptedName']) {\r\n    this.storage = new IDBStorage(db, encryptedStoreName);\r\n    this.log = logger(`encrypted-storage-${encryptedStoreName}`)\r\n  }\r\n\r\n  public static getInstance<T extends Database<any>>(db: T, encryptedStoreName: T['stores'][number]['encryptedName']): EncryptedStorageLayer<T> {\r\n    const key = this.getStorageKey(db.name, encryptedStoreName);\r\n    if(this.instances.has(key)) return this.instances.get(key) as EncryptedStorageLayer<T>;\r\n\r\n    const instance = new EncryptedStorageLayer(db, encryptedStoreName);\r\n    this.instances.set(key, instance);\r\n    return instance;\r\n  }\r\n\r\n  private static getStorageKey(dbName: string, storeName: string) {\r\n    return `${dbName}**${storeName}`;\r\n  }\r\n\r\n  private static async encrypt(data: StoredData): Promise<Uint8Array | null> {\r\n    if(!Object.keys(data).length) return null;\r\n\r\n    const key = await EncryptionKeyStore.get();\r\n    const dataAsBuffer = convertToUint8Array(JSON.stringify(data));\r\n\r\n    const result = await cryptoMessagePort.invokeCryptoNew({\r\n      method: 'aes-local-encrypt',\r\n      args: [{\r\n        key,\r\n        data: dataAsBuffer\r\n      }],\r\n      transfer: [dataAsBuffer.buffer]\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private static async decrypt(data: Uint8Array): Promise<StoredData> {\r\n    const key = await EncryptionKeyStore.get();\r\n\r\n    const result = await cryptoMessagePort.invokeCryptoNew({\r\n      method: 'aes-local-decrypt',\r\n      args: [{\r\n        key,\r\n        encryptedData: data\r\n      }],\r\n      transfer: [data.buffer]\r\n    });\r\n\r\n    const decoded = new TextDecoder().decode(result);\r\n    return JSON.parse(decoded);\r\n  }\r\n\r\n  public loadEncrypted() {\r\n    (async() => {\r\n      this.loadingDataPromise = this.loadFromIDB();\r\n      await this.loadingDataPromise;\r\n      this.loadingDataPromise = undefined;\r\n    })();\r\n  }\r\n\r\n  public async loadDecrypted(data: StoredData) {\r\n    this.log('loading decrypted', data);\r\n    this.data = data;\r\n    await this.saveToIDB();\r\n  }\r\n\r\n  private waitToLoad() {\r\n    if(this.loadingDataPromise) return this.loadingDataPromise;\r\n  }\r\n\r\n  private saveToIDB = async() => {\r\n    await this.waitToLoad();\r\n\r\n    const startTime = performance.now();\r\n\r\n\r\n    const encryptedData = await EncryptedStorageLayer.encrypt(this.data);\r\n    const encryptedDataSize = encryptedData.length;\r\n\r\n    const encryptionTime = performance.now();\r\n\r\n    await this.storage.save(EncryptedStorageLayer.STORAGE_KEY, encryptedData);\r\n\r\n\r\n    const endTime = performance.now();\r\n\r\n    if(DEBUG && IS_WORKER) {\r\n      /**\r\n       * The time it takes is very random, it might be because of the busy-ness of the crypto worker and the indexed DB\r\n       *\r\n       * Can be a log for 5.5 KB in 8ms, and then another for 40 KB in just 3ms\r\n       * Or a whole MegaByte in just 20ms which is not proportional at all\r\n       */\r\n      const f = (n: number) => n.toFixed(2);\r\n      const port = MTProtoMessagePort.getInstance<false>();\r\n      port.invokeVoid('log', `[${this.db.name}-${this.encryptedStoreName}] Encrypted and saved ` +\r\n        `${encryptedDataSize} bytes (${formatBytesPure(encryptedDataSize, 2)}) of data in ${f(endTime - startTime)}ms ` +\r\n        `-- (encrypted in ${f(encryptionTime - startTime)}ms, saved in ${f(endTime - encryptionTime)}ms)`)\r\n    }\r\n  };\r\n\r\n  private saveToIDBThrottled = asyncThrottle(\r\n    () => this.saveToIDB(),\r\n    EncryptedStorageLayer.STORAGE_THROTTLE_TIME_MS\r\n  );\r\n\r\n  private async loadFromIDB() {\r\n    try\r\n    {\r\n      const storageData = await this.storage.get(EncryptedStorageLayer.STORAGE_KEY);\r\n\r\n      if(storageData === null) throw null;\r\n      if(!(storageData instanceof Uint8Array)) throw new Error('Stored data in encrypted store is not a Uint8Array'); // Should not happen but anyway))\r\n\r\n      const decrypted = await EncryptedStorageLayer.decrypt(storageData);\r\n      this.data = decrypted;\r\n    }\r\n    catch(error)\r\n    {\r\n      if(error) this.log(error);\r\n      this.data = {};\r\n    }\r\n\r\n    return this.data;\r\n  }\r\n\r\n  public async reEncrypt() {\r\n    await this.saveToIDB();\r\n  }\r\n\r\n  public async save(entryName: string | string[], value: any | any[]): Promise<void> {\r\n    await this.waitToLoad();\r\n\r\n    const names = toArray(entryName);\r\n    const values = toArray(value);\r\n\r\n    names.forEach((name, idx) => {\r\n      this.data[name] = values[idx];\r\n    });\r\n\r\n    this.saveToIDBThrottled();\r\n  }\r\n\r\n  public async get<T>(entryNames: string[]): Promise<T[]> {\r\n    await this.waitToLoad();\r\n\r\n    return entryNames.map((entryName) => this.data[entryName]);\r\n  }\r\n\r\n  public async getAllEntries(): Promise<IDBStorage.Entries> {\r\n    await this.waitToLoad();\r\n\r\n    return Object.entries(this.data);\r\n  }\r\n\r\n  public async getAll<T>(): Promise<T[]> {\r\n    await this.waitToLoad();\r\n\r\n    return Object.values(this.data);\r\n  }\r\n\r\n  public async delete(entryName: string | string[]): Promise<void> {\r\n    await this.waitToLoad();\r\n\r\n    const names = toArray(entryName);\r\n    names.forEach(name => {\r\n      delete this.data[name];\r\n    });\r\n\r\n    this.saveToIDBThrottled();\r\n  }\r\n\r\n  public async clear(): Promise<void> {\r\n    // await this.waitToLoad();\r\n\r\n    this.data = {};\r\n    await this.storage.clear();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {Database} from '../config/databases';\r\nimport DEBUG, {MOUNT_CLASS_TO} from '../config/debug';\r\n// import DATABASE_SESSION from \"../config/databases/session\";\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {IS_WORKER} from '../helpers/context';\r\nimport throttleWith from '../helpers/schedulers/throttleWith';\r\n// import { WorkerTaskTemplate } from \"../types\";\r\nimport IDBStorage from './files/idb';\r\nimport {logger} from './logger';\r\nimport DeferredIsUsingPasscode from './passcode/deferredIsUsingPasscode';\r\nimport EncryptedStorageLayer, {StorageLayer} from './encryptedStorageLayer';\r\n\r\nfunction noop() {}\r\n\r\n/* export interface LocalStorageProxySetTask extends WorkerTaskTemplate {\r\n  type: 'localStorageProxy',\r\n  payload: {\r\n    type: 'set',\r\n    keys: string[],\r\n    values: any[]\r\n  }\r\n};\r\n\r\nexport interface LocalStorageProxyDeleteTask extends WorkerTaskTemplate {\r\n  type: 'localStorageProxy',\r\n  payload: {\r\n    type: 'delete',\r\n    keys: string[]\r\n  }\r\n}; */\r\n\r\nconst THROTTLE_TIME = 16;\r\n\r\n/* Storage extends {[name: string]: any} *//* Storage extends Record<string, any> */\r\nexport default class AppStorage<\r\n  Storage extends Record<string, any>,\r\n  T extends Database<any>\r\n> {\r\n  private static STORAGES: AppStorage<any, Database<any>>[] = [];\r\n\r\n  private storage: StorageLayer;\r\n\r\n  // private cache: Partial<{[key: string]: Storage[typeof key]}> = {};\r\n  private cache: Partial<Storage>;\r\n  private useStorage: boolean;\r\n  private savingFreezed: boolean;\r\n\r\n  private getPromises: Map<keyof Storage, CancellablePromise<Storage[keyof Storage]>>;\r\n  private getThrottled: () => void;\r\n\r\n  private keysToSet: Set<keyof Storage>;\r\n  private saveThrottled: () => void;\r\n  private saveDeferred: CancellablePromise<void>;\r\n\r\n  private keysToDelete: Set<keyof Storage>;\r\n  private deleteThrottled: () => void;\r\n  private deleteDeferred: CancellablePromise<void>;\r\n\r\n  private isEncryptable: boolean;\r\n  private encryptedStoreName?: T['stores'][number]['encryptedName'];\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private db: T, private storeName: T['stores'][number]['name']) {\r\n    this.log = logger(`AS-${db.name}-${storeName}`);\r\n\r\n    this.cache = {};\r\n    this.getPromises = new Map();\r\n    this.keysToSet = new Set();\r\n    this.saveDeferred = deferredPromise();\r\n    this.keysToDelete = new Set();\r\n    this.deleteDeferred = deferredPromise();\r\n\r\n    const store = db.stores.find(store => store.name === storeName);\r\n    this.isEncryptable = !!store?.encryptedName;\r\n    this.encryptedStoreName = store?.encryptedName;\r\n\r\n    if(AppStorage.STORAGES.length) {\r\n      this.useStorage = AppStorage.STORAGES[0].useStorage;\r\n    } else {\r\n      this.useStorage = true;\r\n    }\r\n\r\n    this.savingFreezed = false;\r\n\r\n    AppStorage.STORAGES.push(this);\r\n\r\n    this.saveThrottled = throttleWith(queueMicrotask, this._save, /* THROTTLE_TIME,  */false);\r\n    this.deleteThrottled = throttleWith(queueMicrotask, this._delete, /* THROTTLE_TIME,  */false);\r\n    this.getThrottled = throttleWith(queueMicrotask, this._get, /* THROTTLE_TIME,  */false);\r\n  }\r\n\r\n\r\n  private async getStorage(): Promise<StorageLayer> {\r\n    if(this.storage) return this.storage;\r\n\r\n    const isEncryptable = this.isEncryptable ?\r\n      await DeferredIsUsingPasscode.isUsingPasscode() :\r\n      false;\r\n\r\n    const storage = this.storage = isEncryptable ?\r\n      EncryptedStorageLayer.getInstance(this.db, this.encryptedStoreName) :\r\n      new IDBStorage(this.db, this.storeName);\r\n\r\n    if(storage instanceof EncryptedStorageLayer) storage.loadEncrypted();\r\n\r\n    return storage;\r\n  }\r\n\r\n  private _save = async() => {\r\n    const deferred = this.saveDeferred;\r\n    this.saveDeferred = deferredPromise();\r\n\r\n    const set = this.keysToSet;\r\n    if(set.size) {\r\n      const keys = Array.from(set.values()) as string[];\r\n      set.clear();\r\n\r\n      const values = keys.map((key) => this.cache[key]);\r\n      try {\r\n        // console.log('setItem: will set', key/* , value */);\r\n        // await this.cacheStorage.delete(key); // * try to prevent memory leak in Chrome leading to 'Unexpected internal error.'\r\n        // await this.storage.save(key, new Response(value, {headers: {'Content-Type': 'application/json'}}));\r\n\r\n        /* if(db === DATABASE_SESSION && !('localStorage' in self)) { // * support legacy Webogram's localStorage\r\n          self.postMessage({\r\n            type: 'localStorageProxy',\r\n            payload: {\r\n              type: 'set',\r\n              keys,\r\n              values\r\n            }\r\n          } as LocalStorageProxySetTask);\r\n        } */\r\n\r\n        const storage = await this.getStorage();\r\n        storage.save(keys, values);\r\n        // console.log('setItem: have set', key/* , value */);\r\n      } catch(e) {\r\n        // this.useCS = false;\r\n        this.log.error('set error', e, keys, values);\r\n      }\r\n    }\r\n\r\n    deferred.resolve();\r\n\r\n    if(set.size) {\r\n      this.saveThrottled();\r\n    }\r\n  };\r\n\r\n  private _delete = async() => {\r\n    const deferred = this.deleteDeferred;\r\n    this.deleteDeferred = deferredPromise();\r\n\r\n    const set = this.keysToDelete;\r\n    if(set.size) {\r\n      const keys = Array.from(set.values()) as string[];\r\n      set.clear();\r\n\r\n      try {\r\n        /* if(db === DATABASE_SESSION && !('localStorage' in self)) { // * support legacy Webogram's localStorage\r\n          self.postMessage({\r\n            type: 'localStorageProxy',\r\n            payload: {\r\n              type: 'delete',\r\n              keys\r\n            }\r\n          } as LocalStorageProxyDeleteTask);\r\n        } */\r\n\r\n        const storage = await this.getStorage();\r\n        storage.delete(keys);\r\n      } catch(e) {\r\n        this.log.error('delete error', e, keys);\r\n      }\r\n    }\r\n\r\n    deferred.resolve();\r\n\r\n    if(set.size) {\r\n      this.deleteThrottled();\r\n    }\r\n  };\r\n\r\n  private _get = async() => {\r\n    const keys = Array.from(this.getPromises.keys());\r\n\r\n    const storage = await this.getStorage();\r\n    storage.get(keys as string[]).then((values) => {\r\n      for(let i = 0, length = keys.length; i < length; ++i) {\r\n        const key = keys[i];\r\n        const deferred = this.getPromises.get(key);\r\n        if(deferred) {\r\n          // @ts-ignore\r\n          deferred.resolve(this.cache[key] = values[i]);\r\n          this.getPromises.delete(key);\r\n        }\r\n      }\r\n\r\n      // console.log('[AS]: get time', keys, performance.now() - perf);\r\n    }, (error: ApiError) => {\r\n      const ignoreErrors: Set<ErrorType> = new Set(['NO_ENTRY_FOUND', 'STORAGE_OFFLINE']);\r\n      if(!ignoreErrors.has(error.type)) {\r\n        this.useStorage = false;\r\n        this.log.error('get error', error, keys, this.storeName);\r\n      }\r\n\r\n      for(let i = 0, length = keys.length; i < length; ++i) {\r\n        const key = keys[i];\r\n        const deferred = this.getPromises.get(key);\r\n        if(deferred) {\r\n          // deferred.reject(error);\r\n          deferred.resolve(undefined);\r\n          this.getPromises.delete(key);\r\n        }\r\n      }\r\n    }).finally(() => {\r\n      if(this.getPromises.size) {\r\n        this.getThrottled();\r\n      }\r\n    });\r\n  };\r\n\r\n  public isAvailable() {\r\n    return this.useStorage;\r\n  }\r\n\r\n  public getCache() {\r\n    return this.cache;\r\n  }\r\n\r\n  public getFromCache<T extends keyof Storage>(key: T) {\r\n    return this.cache[key];\r\n  }\r\n\r\n  public setToCache(key: keyof Storage, value: Storage[typeof key]) {\r\n    return this.cache[key] = value;\r\n  }\r\n\r\n  public async get<T extends keyof Storage>(key: T, useCache = true): Promise<Storage[T]> {\r\n    if(this.cache.hasOwnProperty(key) && useCache) {\r\n      return this.getFromCache(key);\r\n    } else if(this.useStorage) {\r\n      const r = this.getPromises.get(key);\r\n      if(r) return r as any;\r\n\r\n      const p = deferredPromise<Storage[T]>();\r\n      this.getPromises.set(key, p as any);\r\n\r\n      this.getThrottled();\r\n\r\n      return p;\r\n    }/*  else {\r\n      throw 'something went wrong';\r\n    } */\r\n  }\r\n\r\n  public async getAll(): Promise<any[]> {\r\n    const storage = await this.getStorage();\r\n    return storage.getAll().catch(() => [] as any[]);\r\n  }\r\n\r\n  public async getAllEntries() {\r\n    const storage = await this.getStorage();\r\n    return storage.getAllEntries().catch(() => [] as IDBStorage.Entries);\r\n  }\r\n\r\n  private warnAboutSaving() {\r\n    // TODO: Save data only in worker\r\n    // if(DEBUG && typeof window !== 'undefined' && this.isEncryptable) {\r\n    //   const message = 'Encryptable storages should not be used in a window client, only in the shared worker. This avoids data mismatches when the lock screen feature is activated';\r\n    //   this.log.error(message);\r\n    //   throw new Error(message);\r\n    // }\r\n  }\r\n\r\n  public set(obj: Partial<Storage>, onlyLocal = false) {\r\n    // console.log('storageSetValue', obj, callback, arguments);\r\n\r\n    const canUseStorage = this.useStorage && !onlyLocal && !this.savingFreezed;\r\n\r\n    this.warnAboutSaving();\r\n\r\n    let setSomething = false;\r\n    for(const key in obj) {\r\n      if(obj.hasOwnProperty(key)) {\r\n        const value = obj[key];\r\n        this.setToCache(key, value);\r\n\r\n        // let perf = /* DEBUG */false ? performance.now() : 0;\r\n        // value = JSON.stringify(value);\r\n\r\n        // if(perf) {\r\n        //   let elapsedTime = performance.now() - perf;\r\n        //   if(elapsedTime > 10) {\r\n        //     console.warn('LocalStorage set: stringify time by JSON.stringify:', elapsedTime, key);\r\n        //   }\r\n        // }\r\n\r\n        /* perf = performance.now();\r\n        value = stringify(value);\r\n        console.log('LocalStorage set: stringify time by own stringify:', performance.now() - perf); */\r\n\r\n        if(canUseStorage) {\r\n          this.keysToSet.add(key);\r\n          this.keysToDelete.delete(key);\r\n          this.saveThrottled();\r\n        }\r\n\r\n        setSomething = true;\r\n      }\r\n    }\r\n\r\n    return canUseStorage && setSomething ? this.saveDeferred : Promise.resolve();\r\n  }\r\n\r\n  public delete(key: keyof Storage, saveLocal = false) {\r\n    /* if(!this.cache.hasOwnProperty(key)) {\r\n      return;\r\n    } */\r\n\r\n    this.warnAboutSaving();\r\n\r\n    // ! it is needed here\r\n    key = '' + (key as string);\r\n\r\n    if(!saveLocal) {\r\n      delete this.cache[key];\r\n    }\r\n\r\n    if(this.useStorage) {\r\n      this.keysToSet.delete(key);\r\n      this.keysToDelete.add(key);\r\n      this.deleteThrottled();\r\n    }\r\n\r\n    return this.useStorage ? this.deleteDeferred : Promise.resolve();\r\n  }\r\n\r\n  public async clear(saveLocal = false) {\r\n    if(!saveLocal) {\r\n      for(const i in this.cache) {\r\n        delete this.cache[i];\r\n      }\r\n    }\r\n\r\n    try\r\n    {\r\n      const currentStorage = await this.getStorage();\r\n      await currentStorage.clear();\r\n\r\n      if(currentStorage instanceof EncryptedStorageLayer)\r\n      {\r\n        const otherStorage = new IDBStorage(this.db, this.storeName);\r\n        await otherStorage.clear();\r\n      }\r\n      else if(this.isEncryptable)\r\n      {\r\n        const otherStorage = EncryptedStorageLayer.getInstance(this.db, this.encryptedStoreName);\r\n        await otherStorage.clear();\r\n      }\r\n    }\r\n    catch{}\r\n  }\r\n\r\n  public async unfreezeAsync(callback: () => Promise<unknown>) {\r\n    const prevFreezed = this.savingFreezed;\r\n    this.savingFreezed = false;\r\n    try {\r\n      await callback();\r\n    } catch(err) {\r\n      console.error('unfreezeAsync callback error:', err);\r\n    }\r\n    this.savingFreezed = prevFreezed;\r\n  }\r\n\r\n  // public close() { // This closes the whole database, not the store!\r\n  //   return this.getStorage().then(storage => storage.close());\r\n  // }\r\n\r\n  public static toggleStorage(enabled: boolean, clearWrite: boolean) {\r\n    return Promise.all(this.STORAGES.map((storage) => {\r\n      storage.useStorage = enabled;\r\n\r\n      if(!IS_WORKER || !clearWrite) {\r\n        return;\r\n      }\r\n\r\n      if(!enabled) {\r\n        storage.keysToSet.clear();\r\n        storage.keysToDelete.clear();\r\n        storage.getPromises.forEach((deferred) => deferred.resolve(undefined));\r\n        storage.getPromises.clear();\r\n      } else {\r\n        return storage.set(storage.cache);\r\n      }\r\n    })).catch(noop);\r\n  }\r\n\r\n  public static freezeSaving<T extends Database<any>>(callback: () => any, names: T['stores'][number]['name'][]) {\r\n    this.STORAGES.forEach((storage) => storage.savingFreezed = true);\r\n    try {\r\n      callback();\r\n    } catch(err) {\r\n      console.error('freezeSaving callback error:', err);\r\n    }\r\n    this.STORAGES.forEach((storage) => storage.savingFreezed = false);\r\n  }\r\n\r\n  public static async freezeSavingAsync(callback: () => Promise<unknown>) {\r\n    this.STORAGES.forEach((storage) => storage.savingFreezed = true);\r\n    try {\r\n      await callback();\r\n    } catch(err) {\r\n      console.error('freezeSavingAsync callback error:', err);\r\n    }\r\n    this.STORAGES.forEach((storage) => storage.savingFreezed = false);\r\n  }\r\n\r\n  private async toggleEncrypted(shouldEncrypt: boolean) {\r\n    if(!this.isEncryptable) return;\r\n\r\n    const isEncrypted = this.storage instanceof EncryptedStorageLayer;\r\n    if(shouldEncrypt === isEncrypted) return;\r\n\r\n    const entries = await this.getAllEntries();\r\n\r\n    await this.storage.clear();\r\n\r\n    if(shouldEncrypt) {\r\n      const storage = this.storage = EncryptedStorageLayer.getInstance(this.db, this.encryptedStoreName);\r\n      const data = Object.fromEntries(entries);\r\n\r\n      await storage.loadDecrypted(data);\r\n    } else {\r\n      const storage = this.storage = new IDBStorage(this.db, this.storeName);\r\n      const keys = entries.map(entry => entry[0] as string);\r\n      const values = entries.map(entry => entry[1]);\r\n\r\n      await storage.save(keys, values);\r\n    }\r\n  }\r\n\r\n  private async reEncrypt() {\r\n    if(!(this.storage instanceof EncryptedStorageLayer)) return;\r\n\r\n    await this.storage.reEncrypt();\r\n  }\r\n\r\n  public static async toggleEncryptedForAll(shouldEncrypt: boolean) {\r\n    // this.freezeSaving()\r\n    this.freezeSavingAsync(async() => {\r\n      await Promise.all(\r\n        this.STORAGES.map((storage) => storage.toggleEncrypted(shouldEncrypt))\r\n      );\r\n    });\r\n  }\r\n\r\n  public static async reEncryptEncrypted() {\r\n    this.freezeSavingAsync(async() => {\r\n      await Promise.all(\r\n        this.STORAGES.map((storage) => storage.reEncrypt())\r\n      );\r\n    });\r\n  }\r\n\r\n  /* public deleteDatabase() {\r\n    return IDBStorage.deleteDatabase().catch(noop);\r\n  } */\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.AppStorage = AppStorage);\r\n","import {LangPackDifference} from '../layer';\r\nimport {CommonDatabase, getCommonDatabaseState} from '../config/databases/state';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {StateSettings} from '../config/state';\r\n\r\nimport AppStorage from './storage';\r\nimport {ActiveAccountNumber} from './accounts/types';\r\nimport DeferredIsUsingPasscode from './passcode/deferredIsUsingPasscode';\r\n\r\nexport type PasscodeStorageValue = {\r\n  /**\r\n   * Have different random hash salt per user to prevent precomputed attacks\r\n   *\r\n   * Used to randomize the verification hash\r\n   */\r\n  verificationSalt: Uint8Array;\r\n  /**\r\n   * Hash used just to verify whether the passcode is correct, the hash for encryption will not be stored anywhere except in memory\r\n   */\r\n  verificationHash: Uint8Array;\r\n  /**\r\n   * Salt used for getting a cryptographic key derived from passcode that will be used for encryption (instead of passing raw passcode between processes)\r\n   *\r\n   * Used to randomize the encryption per user\r\n   */\r\n  encryptionSalt: Uint8Array;\r\n};\r\n\r\ntype AppStorageValue = {\r\n  langPack: LangPackDifference;\r\n  settings: StateSettings;\r\n  notificationsCount: Partial<Record<ActiveAccountNumber, number>>;\r\n  passcode: PasscodeStorageValue;\r\n};\r\n\r\nclass CommonStateStorage extends AppStorage<AppStorageValue, CommonDatabase> {\r\n  constructor() {\r\n    super(getCommonDatabaseState(), 'session');\r\n  }\r\n}\r\n\r\nconst commonStateStorage = new CommonStateStorage();\r\n\r\ncommonStateStorage.get('settings', false).then((settings) => {\r\n  DeferredIsUsingPasscode.resolveDeferred(settings?.passcode?.enabled || false);\r\n});\r\n\r\nMOUNT_CLASS_TO.commonStateStorage = commonStateStorage;\r\nexport default commonStateStorage;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type lang from '../lang';\r\nimport type langSign from '../langSign';\r\nimport type {State} from '../config/state';\r\nimport DEBUG, {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {HelpCountriesList, HelpCountry, LangPackDifference, LangPackString} from '../layer';\r\nimport App from '../config/app';\r\nimport rootScope from './rootScope';\r\nimport {IS_MOBILE} from '../environment/userAgent';\r\nimport deepEqual from '../helpers/object/deepEqual';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport capitalizeFirstLetter from '../helpers/string/capitalizeFirstLetter';\r\nimport matchUrlProtocol from './richTextProcessor/matchUrlProtocol';\r\nimport wrapUrl from './richTextProcessor/wrapUrl';\r\nimport {setDirection} from '../helpers/dom/setInnerHTML';\r\nimport setBlankToAnchor from './richTextProcessor/setBlankToAnchor';\r\nimport {createSignal} from 'solid-js';\r\nimport commonStateStorage from './commonStateStorage';\r\n\r\nexport const langPack: {[actionType: string]: LangPackKey} = {\r\n  'messageActionChatCreate': 'ActionCreateGroup',\r\n  'messageActionChatCreateYou': 'ActionYouCreateGroup',\r\n  'messageActionChatEditTitle': 'ActionChangedTitle',\r\n  'messageActionChatEditPhoto': 'ActionChangedPhoto',\r\n  'messageActionChatEditVideo': 'ActionChangedVideo',\r\n  'messageActionChatDeletePhoto': 'ActionRemovedPhoto',\r\n  'messageActionChatReturn': 'ActionAddUserSelf',\r\n  'messageActionChatReturnYou': 'ActionAddUserSelfYou',\r\n  'messageActionChatJoined': 'ActionAddUserSelfMega',\r\n  'messageActionChatJoinedYou': 'ChannelMegaJoined',\r\n  'messageActionChatAddUser': 'ActionAddUser',\r\n  'messageActionChatAddUsers': 'ActionAddUser',\r\n  'messageActionChatLeave': 'ActionLeftUser',\r\n  'messageActionChatLeaveYou': 'YouLeft',\r\n  'messageActionChatDeleteUser': 'ActionKickUser',\r\n  'messageActionChatJoinedByLink': 'ActionInviteUser',\r\n  'messageActionPinMessage': 'Chat.Service.Group.UpdatedPinnedMessage',\r\n  'messageActionContactSignUp': 'Chat.Service.PeerJoinedTelegram',\r\n  'messageActionChannelCreate': 'ActionCreateChannel',\r\n  'messageActionChannelEditTitle': 'Chat.Service.Channel.UpdatedTitle',\r\n  'messageActionChannelEditPhoto': 'Chat.Service.Channel.UpdatedPhoto',\r\n  'messageActionChannelEditVideo': 'Chat.Service.Channel.UpdatedVideo',\r\n  'messageActionChannelDeletePhoto': 'Chat.Service.Channel.RemovedPhoto',\r\n  'messageActionHistoryClear': 'HistoryCleared',\r\n  'messageActionDiscussionStarted': 'DiscussionStarted',\r\n  'messageActionChannelJoined': 'ChannelJoined',\r\n\r\n  'messageActionChannelMigrateFrom': 'ActionMigrateFromGroup',\r\n\r\n  'messageActionPhoneCall.video_in_ok': 'ChatList.Service.VideoCall.incoming',\r\n  'messageActionPhoneCall.video_out_ok': 'ChatList.Service.VideoCall.outgoing',\r\n  'messageActionPhoneCall.video_missed': 'ChatList.Service.VideoCall.Missed',\r\n  'messageActionPhoneCall.video_cancelled': 'ChatList.Service.VideoCall.Cancelled',\r\n  'messageActionPhoneCall.in_ok': 'ChatList.Service.Call.incoming',\r\n  'messageActionPhoneCall.out_ok': 'ChatList.Service.Call.outgoing',\r\n  'messageActionPhoneCall.missed': 'ChatList.Service.Call.Missed',\r\n  'messageActionPhoneCall.cancelled': 'ChatList.Service.Call.Cancelled',\r\n\r\n  'messageActionGroupCall.started': 'Chat.Service.VoiceChatStarted.Channel',\r\n  'messageActionGroupCall.started_by': 'Chat.Service.VoiceChatStarted',\r\n  'messageActionGroupCall.started_byYou': 'Chat.Service.VoiceChatStartedYou',\r\n  'messageActionGroupCall.ended': 'Chat.Service.VoiceChatFinished.Channel',\r\n  'messageActionGroupCall.ended_by': 'Chat.Service.VoiceChatFinished',\r\n  'messageActionGroupCall.ended_byYou': 'Chat.Service.VoiceChatFinishedYou',\r\n\r\n  'messageActionBotAllowed': 'Chat.Service.BotPermissionAllowed'\r\n};\r\n\r\nexport type LangPackKey = /* string |  */keyof typeof lang | keyof typeof langSign;\r\n\r\nexport type FormatterArgument = string | number | Node | FormatterArgument[];\r\nexport type FormatterArguments = FormatterArgument[];\r\n\r\nexport const UNSUPPORTED_LANG_PACK_KEY: LangPackKey = IS_MOBILE ? 'Message.Unsupported.Mobile' : 'Message.Unsupported.Desktop';\r\n\r\nnamespace I18n {\r\n  export const strings: Map<LangPackKey, LangPackString> = new Map();\r\n  export const countriesList: HelpCountry[] = [];\r\n  let pluralRules: Intl.PluralRules;\r\n\r\n  let cacheLangPackPromise: Promise<LangPackDifference>;\r\n  export let lastRequestedLangCode: string;\r\n  export let lastRequestedNormalizedLangCode: string;\r\n  export let lastAppliedLangCode: string;\r\n  export let requestedServerLanguage = false;\r\n  export let timeFormat: State['settings']['timeFormat'];\r\n  export let isRTL = false;\r\n\r\n  export const [langCodeNormalized, setLangCodeNormalized] = createSignal<TranslatableLanguageISO>();\r\n\r\n  export function setRTL(rtl: boolean) {\r\n    isRTL = rtl;\r\n  }\r\n\r\n  function setLangCode(langCode: string) {\r\n    lastRequestedLangCode = langCode;\r\n    lastRequestedNormalizedLangCode = langCode.split('-')[0];\r\n    setLangCodeNormalized(lastRequestedNormalizedLangCode.split('-')[0] as any);\r\n  }\r\n\r\n  export function getCacheLangPack(): Promise<LangPackDifference> {\r\n    if(cacheLangPackPromise) return cacheLangPackPromise;\r\n    return cacheLangPackPromise = Promise.all([\r\n      commonStateStorage.get('langPack') as Promise<LangPackDifference>,\r\n      polyfillPromise\r\n    ]).then(([langPack]) => {\r\n      if(!langPack/*  || true */) {\r\n        return loadLocalLangPack();\r\n      } else if(DEBUG && false) {\r\n        return getLangPack(langPack.lang_code);\r\n      }/*  else if(langPack.appVersion !== App.langPackVersion) {\r\n        return getLangPack(langPack.lang_code);\r\n      } */\r\n\r\n      if(!lastRequestedLangCode) {\r\n        setLangCode(langPack.lang_code);\r\n      }\r\n\r\n      applyLangPack(langPack);\r\n      return langPack;\r\n    }).finally(() => {\r\n      cacheLangPackPromise = undefined;\r\n    });\r\n  }\r\n\r\n  function updateAmPm() {\r\n    if(timeFormat === 'h12') {\r\n      try {\r\n        const dateTimeFormat = getDateTimeFormat({hour: 'numeric', minute: 'numeric', hour12: true});\r\n        const date = new Date();\r\n        date.setHours(0);\r\n        const amText = dateTimeFormat.format(date);\r\n        amPmCache.am = amText.split(/\\s/)[1];\r\n        date.setHours(12);\r\n        const pmText = dateTimeFormat.format(date);\r\n        amPmCache.pm = pmText.split(/\\s/)[1];\r\n      } catch(err) {\r\n        console.error('cannot get am/pm', err);\r\n        amPmCache = {am: 'AM', pm: 'PM'};\r\n      }\r\n    }\r\n  }\r\n\r\n  export function setTimeFormat(\r\n    format: State['settings']['timeFormat'],\r\n    haveToUpdate = !!timeFormat && timeFormat !== format\r\n  ) {\r\n    timeFormat = format;\r\n\r\n    updateAmPm();\r\n\r\n    if(haveToUpdate) {\r\n      cachedDateTimeFormats.clear();\r\n      const elements = Array.from(document.querySelectorAll(`.i18n`)) as HTMLElement[];\r\n      elements.forEach((element) => {\r\n        const instance = weakMap.get(element);\r\n\r\n        if(instance instanceof IntlDateElement) {\r\n          instance.update();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  export function loadLocalLangPack() {\r\n    const defaultCode = App.langPackCode;\r\n    setLangCode(defaultCode);\r\n    return Promise.all([\r\n      import('../lang'),\r\n      import('../langSign'),\r\n      import('../countries')\r\n    ]).then(([lang, langSign, countries]) => {\r\n      const strings: LangPackString[] = [];\r\n      formatLocalStrings(lang.default, strings);\r\n      formatLocalStrings(langSign.default, strings);\r\n\r\n      const langPack: LangPackDifference = {\r\n        _: 'langPackDifference',\r\n        from_version: 0,\r\n        lang_code: defaultCode,\r\n        strings,\r\n        version: 0,\r\n        local: true,\r\n        countries: countries.default\r\n      };\r\n      return saveLangPack(langPack);\r\n    });\r\n  }\r\n\r\n  export function loadLangPack(langCode: string, web?: boolean) {\r\n    web = true;\r\n    requestedServerLanguage = true;\r\n    const managers = rootScope.managers;\r\n    return Promise.all([\r\n      managers.apiManager.invokeApiCacheable('langpack.getLangPack', {\r\n        lang_code: langCode,\r\n        lang_pack: web ? 'web' : App.langPack\r\n      }),\r\n      !web && managers.apiManager.invokeApiCacheable('langpack.getLangPack', {\r\n        lang_code: langCode,\r\n        lang_pack: 'android'\r\n      }),\r\n      import('../lang'),\r\n      import('../langSign'),\r\n      managers.apiManager.invokeApiCacheable('help.getCountriesList', {\r\n        lang_code: langCode,\r\n        hash: 0\r\n      }) as Promise<HelpCountriesList.helpCountriesList>,\r\n      polyfillPromise\r\n    ]);\r\n  }\r\n\r\n  export function getStrings(langCode: string, strings: string[]) {\r\n    return rootScope.managers.apiManager.invokeApi('langpack.getStrings', {\r\n      lang_pack: App.langPack,\r\n      lang_code: langCode,\r\n      keys: strings\r\n    });\r\n  }\r\n\r\n  export function formatLocalStrings(strings: any, pushTo: LangPackString[] = []) {\r\n    for(const i in strings) {\r\n      // @ts-ignore\r\n      const v = strings[i];\r\n      if(typeof(v) === 'string') {\r\n        pushTo.push({\r\n          _: 'langPackString',\r\n          key: i,\r\n          value: v\r\n        });\r\n      } else {\r\n        pushTo.push({\r\n          _: 'langPackStringPluralized',\r\n          key: i,\r\n          ...v\r\n        });\r\n      }\r\n    }\r\n\r\n    return pushTo;\r\n  }\r\n\r\n  export function getLangPack(langCode: string, web?: boolean) {\r\n    setLangCode(langCode);\r\n    return loadLangPack(langCode, web).then(([langPack1, langPack2, localLangPack1, localLangPack2, countries, _]) => {\r\n      let strings: LangPackString[] = [];\r\n\r\n      [localLangPack1, localLangPack2].forEach((l) => {\r\n        formatLocalStrings(l.default as any, strings);\r\n      });\r\n\r\n      strings = strings.concat(...[langPack1.strings, langPack2.strings].filter(Boolean));\r\n\r\n      langPack1.strings = strings;\r\n      langPack1.countries = countries;\r\n      return saveLangPack(langPack1);\r\n    });\r\n  }\r\n\r\n  export function saveLangPack(langPack: LangPackDifference) {\r\n    langPack.appVersion = App.langPackVersion;\r\n\r\n    return commonStateStorage.set({langPack}).then(() => {\r\n      applyLangPack(langPack);\r\n      return langPack;\r\n    });\r\n  }\r\n\r\n  export const polyfillPromise = (function checkIfPolyfillNeeded() {\r\n    if(typeof(Intl) !== 'undefined' && typeof(Intl.PluralRules) !== 'undefined'/*  && false */) {\r\n      return Promise.resolve();\r\n    } else {\r\n      return import('./pluralPolyfill').then((_Intl) => {\r\n        (window as any).Intl = Object.assign(typeof(Intl) !== 'undefined' ? Intl : {}, _Intl.default);\r\n      });\r\n    }\r\n  })();\r\n\r\n  export function applyLangPack(langPack: LangPackDifference) {\r\n    const currentLangCode = lastRequestedLangCode;\r\n    if(langPack.lang_code !== currentLangCode) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      pluralRules = new Intl.PluralRules(lastRequestedNormalizedLangCode);\r\n    } catch(err) {\r\n      console.error('pluralRules error', err);\r\n      pluralRules = new Intl.PluralRules(lastRequestedNormalizedLangCode.split('-', 1)[0]);\r\n    }\r\n\r\n    try {\r\n      pluralRules = new Intl.PluralRules(langPack.lang_code);\r\n    } catch(err) {\r\n      console.error('pluralRules error', err);\r\n      pluralRules = new Intl.PluralRules(langPack.lang_code.split('-', 1)[0]);\r\n    }\r\n\r\n    strings.clear();\r\n\r\n    for(const string of langPack.strings) {\r\n      strings.set(string.key as LangPackKey, string);\r\n    }\r\n\r\n    if(langPack.countries) {\r\n      countriesList.length = 0;\r\n      countriesList.push(...langPack.countries.countries);\r\n\r\n      langPack.countries.countries.forEach((country) => {\r\n        if(country.name) {\r\n          const langPackKey: any = country.default_name;\r\n          strings.set(langPackKey, {\r\n            _: 'langPackString',\r\n            key: langPackKey,\r\n            value: country.name\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    if(lastAppliedLangCode !== currentLangCode) {\r\n      if(lastAppliedLangCode && rootScope.myId) {\r\n        rootScope.managers.appReactionsManager.resetAvailableReactions();\r\n        rootScope.managers.appUsersManager.indexMyself();\r\n        rootScope.managers.dialogsStorage.indexMyDialog();\r\n      }\r\n\r\n      lastAppliedLangCode = currentLangCode;\r\n      cachedDateTimeFormats.clear();\r\n      updateAmPm();\r\n      rootScope.dispatchEvent('language_change', currentLangCode);\r\n    }\r\n\r\n    const elements = Array.from(document.querySelectorAll(`.i18n`)) as HTMLElement[];\r\n    elements.forEach((element) => {\r\n      const instance = weakMap.get(element);\r\n\r\n      if(instance) {\r\n        instance.update();\r\n      }\r\n    });\r\n  }\r\n\r\n  function pushNextArgument(out: ReturnType<typeof superFormatter>, args: FormatterArguments, indexHolder: {i: number}, i?: number) {\r\n    const arg = args[i === undefined ? indexHolder.i++ : i];\r\n    if(Array.isArray(arg)) {\r\n      out.push(...arg as any);\r\n    } else {\r\n      out.push(arg);\r\n    }\r\n  }\r\n\r\n  export function superFormatter(input: string, args?: FormatterArguments, indexHolder?: {i: number}): Exclude<FormatterArgument, FormatterArgument[]>[] {\r\n    if(!indexHolder) { // set starting index for arguments without order\r\n      indexHolder = {i: 0};\r\n      const indexes = input.match(/(%|un)\\d+/g);\r\n      if(indexes?.length) {\r\n        indexHolder.i = Math.max(...indexes.map((str) => +str.replace(/\\D/g, '')));\r\n      }\r\n    }\r\n\r\n    const out: ReturnType<typeof superFormatter> = [];\r\n    const regExp = /(\\*\\*|__)(.+?)\\1|(\\n)|(\\[.+?\\]\\(.*?\\))|un\\d|%\\d\\$.|%\\S/g;\r\n\r\n    let lastIndex = 0;\r\n    input.replace(regExp, (match, p1: any, p2: any, p3: any, p4: string, offset: number, string: string) => {\r\n      // console.table({match, p1, p2, offset, string});\r\n\r\n      if(offset > lastIndex) {\r\n        out.push(string.slice(lastIndex, offset));\r\n      }\r\n\r\n      if(p1) {\r\n        // offset += p1.length;\r\n        let element: HTMLElement;\r\n        switch(p1) {\r\n          case '**': {\r\n            element = document.createElement('b');\r\n            break;\r\n          }\r\n\r\n          case '__': {\r\n            element = document.createElement('i');\r\n            break;\r\n          }\r\n        }\r\n\r\n        element.append(...superFormatter(p2, args, indexHolder) as any);\r\n        out.push(element);\r\n      } else if(p3) {\r\n        out.push(document.createElement('br'));\r\n      } else if(p4) {\r\n        const idx = p4.lastIndexOf(']');\r\n        const text = p4.slice(1, idx);\r\n\r\n        const url = p4.slice(idx + 2, p4.length - 1);\r\n        let a: HTMLAnchorElement;\r\n        if(url && matchUrlProtocol(url)) {\r\n          a = document.createElement('a');\r\n          const wrappedUrl = wrapUrl(url);\r\n          a.href = wrappedUrl.url;\r\n          if(wrappedUrl.onclick) a.setAttribute('onclick', wrappedUrl.onclick + '(this)');\r\n          setBlankToAnchor(a);\r\n        } else {\r\n          a = args[indexHolder.i++] as HTMLAnchorElement;\r\n\r\n          if(a instanceof DocumentFragment) { // right after wrapRichText\r\n            a = a.firstChild as any;\r\n          }\r\n\r\n          if(typeof(a) !== 'string') {\r\n            a.textContent = ''; // reset content\r\n          }\r\n        }\r\n\r\n        const formatted = superFormatter(text, args, indexHolder) as any;\r\n        if(typeof(a) === 'string') {\r\n          out.push(...formatted);\r\n        } else {\r\n          a.append(...formatted);\r\n          out.push(a);\r\n        }\r\n      } else if(args) {\r\n        const index = match.replace(/\\D/g, '');\r\n        pushNextArgument(\r\n          out,\r\n          args,\r\n          indexHolder,\r\n          !index || Number.isNaN(+index) ? undefined : Math.min(args.length - 1, +index - 1)\r\n        );\r\n      }\r\n\r\n      lastIndex = offset + match.length;\r\n      return '';\r\n    });\r\n\r\n    if(lastIndex !== input.length) {\r\n      out.push(input.slice(lastIndex));\r\n    }\r\n\r\n    return out;\r\n  }\r\n\r\n  export function format(key: LangPackKey, plain: true, args?: FormatterArguments): string;\r\n  export function format(key: LangPackKey, plain?: false, args?: FormatterArguments): ReturnType<typeof superFormatter>;\r\n  export function format(key: LangPackKey, plain = false, args?: FormatterArguments): ReturnType<typeof superFormatter> | string {\r\n    const str = strings.get(key);\r\n    let input: string;\r\n    if(str) {\r\n      if(str._ === 'langPackStringPluralized' && args?.length) {\r\n        let v = args[0] as number | string;\r\n        if(typeof(v) === 'string') v = +v.replace(/\\D/g, '');\r\n        const s = pluralRules.select(v);\r\n        // @ts-ignore\r\n        input = str[s + '_value'] || str['other_value'];\r\n      } else if(str._ === 'langPackString') {\r\n        input = str.value;\r\n      } else {\r\n        // input = '[' + key + ']';\r\n        input = key;\r\n      }\r\n    } else {\r\n      // input = '[' + key + ']';\r\n      input = key;\r\n    }\r\n\r\n    const result = superFormatter(input, args);\r\n    if(plain) { // * let's try a hack now... (don't want to replace []() entity)\r\n      return result.map((item) => item instanceof Node ? item.textContent : item).join('');\r\n    } else {\r\n      return result;\r\n    }\r\n\r\n    /* if(plain) {\r\n      if(args?.length) {\r\n        const regExp = /un\\d|%\\d\\$.|%./g;\r\n        let i = 0;\r\n        input = input.replace(regExp, (match, offset, string) => {\r\n          return '' + args[i++];\r\n        });\r\n      }\r\n\r\n      return input;\r\n    } else {\r\n      return superFormatter(input, args);\r\n    } */\r\n  }\r\n\r\n  export const weakMap: WeakMap<HTMLElement, IntlElementBase<IntlElementBaseOptions>> = new WeakMap();\r\n\r\n  export type IntlElementBaseOptions = {\r\n    element?: HTMLElement,\r\n    property?: 'innerText' | 'innerHTML' | 'placeholder' | 'textContent',\r\n  };\r\n\r\n  abstract class IntlElementBase<Options extends IntlElementBaseOptions> {\r\n    public element: IntlElementBaseOptions['element'];\r\n    public property: IntlElementBaseOptions['property'];\r\n\r\n    constructor(options?: Options) {\r\n      this.element = options?.element || document.createElement('span');\r\n      this.element.classList.add('i18n');\r\n\r\n      this.property = options?.property;\r\n\r\n      weakMap.set(this.element, this);\r\n    }\r\n\r\n    abstract update(options?: Options): void;\r\n  }\r\n\r\n  export type IntlElementOptions = IntlElementBaseOptions & {\r\n    key?: LangPackKey,\r\n    args?: FormatterArguments\r\n  };\r\n  export class IntlElement extends IntlElementBase<IntlElementOptions> {\r\n    public key: IntlElementOptions['key'];\r\n    public args: IntlElementOptions['args'];\r\n\r\n    constructor(options: IntlElementOptions = {}) {\r\n      super({...options, property: options.property ?? 'innerHTML'});\r\n\r\n      if(options?.key) {\r\n        this.update(options);\r\n      }\r\n    }\r\n\r\n    public update(options?: IntlElementOptions) {\r\n      safeAssign(this, options);\r\n\r\n      if(!this.key) {\r\n        this.element.replaceChildren();\r\n        return;\r\n      }\r\n\r\n      if(this.property === 'innerHTML') {\r\n        this.element.replaceChildren(...format(this.key, false, this.args) as any);\r\n        if(this.args?.length) {\r\n          this.element.normalize();\r\n        }\r\n      } else {\r\n        // @ts-ignore\r\n        const v = this.element[this.property];\r\n        const formatted = format(this.key, true, this.args);\r\n\r\n        // * hasOwnProperty won't work here\r\n        if(v === undefined) this.element.dataset[this.property] = formatted;\r\n        else (this.element as HTMLInputElement)[this.property] = formatted;\r\n      }\r\n    }\r\n\r\n    public compareAndUpdate(options?: IntlElementOptions) {\r\n      if(this.key === options.key && deepEqual(this.args, options.args)) {\r\n        return;\r\n      }\r\n\r\n      return this.update(options);\r\n    }\r\n  }\r\n\r\n  const cachedDateTimeFormats: Map<string, Intl.DateTimeFormat> = new Map();\r\n  export function getDateTimeFormat(options: Intl.DateTimeFormatOptions = {}) {\r\n    const json = JSON.stringify(options);\r\n    let dateTimeFormat = cachedDateTimeFormats.get(json);\r\n    if(!dateTimeFormat) {\r\n      dateTimeFormat = new Intl.DateTimeFormat(lastRequestedNormalizedLangCode + '-u-hc-' + timeFormat, options);\r\n      cachedDateTimeFormats.set(json, dateTimeFormat);\r\n    }\r\n\r\n    return dateTimeFormat;\r\n  }\r\n\r\n  export let amPmCache = {am: 'AM', pm: 'PM'};\r\n  export type IntlDateElementOptions = IntlElementBaseOptions & {\r\n    date?: Date,\r\n    options: Intl.DateTimeFormatOptions\r\n  };\r\n  export class IntlDateElement extends IntlElementBase<IntlDateElementOptions> {\r\n    public date: IntlDateElementOptions['date'];\r\n    public options: IntlDateElementOptions['options'];\r\n\r\n    constructor(options: IntlDateElementOptions) {\r\n      super({...options, property: options.property ?? 'textContent'});\r\n      setDirection(this.element);\r\n\r\n      if(options?.date) {\r\n        this.update(options);\r\n      }\r\n    }\r\n\r\n    public update(options?: IntlDateElementOptions) {\r\n      safeAssign(this, options);\r\n\r\n      let text: string;\r\n      if(this.options.hour && this.options.minute && Object.keys(this.options).length === 2/*  && false */) {\r\n        const hours = this.date.getHours();\r\n        text = ('0' + (timeFormat === 'h12' ? (hours % 12) || 12 : hours)).slice(-2) + ':' + ('0' + this.date.getMinutes()).slice(-2);\r\n        // if(this.options.second) {\r\n        //   text += ':' + ('0' + this.date.getSeconds()).slice(-2);\r\n        // }\r\n\r\n        if(timeFormat === 'h12') {\r\n          text += ' ' + (hours < 12 ? amPmCache.am : amPmCache.pm);\r\n        }\r\n      } else {\r\n        // * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Locale/hourCycle#adding_an_hour_cycle_via_the_locale_string\r\n        const dateTimeFormat = getDateTimeFormat(this.options);\r\n        text = capitalizeFirstLetter(dateTimeFormat.format(this.date));\r\n      }\r\n\r\n      (this.element as any)[this.property] = text;\r\n    }\r\n  }\r\n\r\n  export function i18n(key: LangPackKey, args?: FormatterArguments) {\r\n    return new IntlElement({key, args}).element;\r\n  }\r\n\r\n  export function i18n_(options: IntlElementOptions) {\r\n    return new IntlElement(options).element;\r\n  }\r\n\r\n  export function _i18n(element: HTMLElement, key: LangPackKey, args?: FormatterArguments, property?: IntlElementOptions['property']) {\r\n    return new IntlElement({element, key, args, property}).element;\r\n  }\r\n}\r\n\r\nexport {I18n};\r\nexport default I18n;\r\n\r\nconst i18n = I18n.i18n;\r\nexport {i18n};\r\n\r\nconst i18n_ = I18n.i18n_;\r\nexport {i18n_};\r\n\r\nconst _i18n = I18n._i18n;\r\nexport {_i18n};\r\n\r\nexport function joinElementsWith<T extends Node | string | Array<Node | string>>(\r\n  elements: T[],\r\n  joiner: T | string | ((isLast: boolean) => T)\r\n): T[] {\r\n  const arr = elements.slice(0, 1) as T[];\r\n  for(let i = 1; i < elements.length; ++i) {\r\n    const isLast = (elements.length - 1) === i;\r\n    arr.push(typeof(joiner) === 'function' ? (joiner as any)(isLast) : joiner);\r\n    arr.push(elements[i]);\r\n  }\r\n\r\n  return arr;\r\n}\r\n\r\n\r\nexport function join(elements: (Node | string)[], useLast: boolean, plain: true): string;\r\nexport function join(elements: (Node | string)[], useLast?: boolean, plain?: false): (string | Node)[];\r\nexport function join(elements: (Node | string)[], useLast: boolean, plain: boolean): string | (string | Node)[];\r\nexport function join(elements: (Node | string)[], useLast = true, plain?: boolean): string | (string | Node)[] {\r\n  const joined = joinElementsWith(elements, (isLast) => {\r\n    const langPackKey: LangPackKey = isLast && useLast ? 'AutoDownloadSettings.LastDelimeter' : 'AutoDownloadSettings.Delimeter';\r\n    return plain ? I18n.format(langPackKey, true) : i18n(langPackKey);\r\n  });\r\n\r\n  return plain ? joined.join('') : joined;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.I18n = I18n);\r\n","export default function isAnyChat(peerId: PeerId) {\r\n  return +peerId < 0;\r\n}\r\n","export default function isUser(peerId: PeerId) {\r\n  return +peerId >= 0;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport isAnyChat from '../lib/appManagers/utils/peers/isAnyChat';\r\nimport isUser from '../lib/appManagers/utils/peers/isUser';\r\n\r\nString.prototype.toUserId = function() {\r\n  return (+this).toUserId();\r\n};\r\n\r\nString.prototype.toChatId = function() {\r\n  return (+this).toChatId();\r\n};\r\n\r\nString.prototype.toPeerId = function(isChat?: boolean) {\r\n  return (+this).toPeerId(isChat);\r\n};\r\n\r\nString.prototype.isPeerId = function(): this is string {\r\n  return /^[\\d-]/.test(this.toString());\r\n};\r\n\r\n// * don't return just 'this', because Firefox returns empty `Number` class\r\nNumber.prototype.toUserId = function() {\r\n  return +this;\r\n};\r\n\r\nNumber.prototype.toChatId = function() {\r\n  return Math.abs(this as any);\r\n};\r\n\r\n// * don't return just 'this', because Firefox returns empty `Number` class\r\nNumber.prototype.toPeerId = function(isChat?: boolean) {\r\n  return isChat === undefined ? +this : (isChat ? -Math.abs(this as number) : +this);\r\n};\r\n\r\nNumber.prototype.isPeerId = function(): this is number {\r\n  return true;\r\n};\r\n\r\n[\r\n  ['isUser' as const, isUser],\r\n  ['isAnyChat' as const, isAnyChat]\r\n].forEach((value) => {\r\n  const newMethod = Array.isArray(value) ? value[0] : value;\r\n  const originMethod = Array.isArray(value) ? value[1] : value;\r\n  // @ts-ignore\r\n  String.prototype[newMethod] = function() {\r\n    // @ts-ignore\r\n    // eslint-disable-next-line no-useless-call\r\n    return originMethod.call(null, this.toString());\r\n  };\r\n\r\n  // @ts-ignore\r\n  Number.prototype[newMethod] = function() {\r\n    // * don't use just 'this', because Firefox returns empty `Number` class\r\n    // @ts-ignore\r\n    // eslint-disable-next-line no-useless-call\r\n    return originMethod.call(null, +this);\r\n  };\r\n});\r\n\r\ndeclare global {\r\n  interface String {\r\n    toUserId(): UserId;\r\n    toChatId(): ChatId;\r\n    toPeerId(isChat?: boolean): PeerId;\r\n    isPeerId(): this is string;\r\n\r\n    isUser(): boolean;\r\n    isAnyChat(): boolean;\r\n  }\r\n\r\n  interface Number {\r\n    toUserId(): UserId;\r\n    toChatId(): ChatId;\r\n    toPeerId(isChat?: boolean): PeerId;\r\n    isPeerId(): this is PeerId;\r\n\r\n    isUser(): boolean;\r\n    isAnyChat(): boolean;\r\n  }\r\n}\r\n\r\nexport {};\r\n","export default function bufferConcats(...args: (ArrayBuffer | Uint8Array | number[])[]) {\r\n  const length = args.reduce((acc, v) => acc + ((v as ArrayBuffer).byteLength || (v as Uint8Array).length), 0);\r\n\r\n  const tmp = new Uint8Array(length);\r\n\r\n  let lastLength = 0;\r\n  args.forEach((b) => {\r\n    tmp.set(b instanceof ArrayBuffer ? new Uint8Array(b) : b, lastLength);\r\n    lastLength += (b as ArrayBuffer).byteLength || (b as Uint8Array).length;\r\n  });\r\n\r\n  return tmp/* .buffer */;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport bufferConcats from '../helpers/bytes/bufferConcats';\r\n\r\nUint8Array.prototype.concat = function(...args: Array<Uint8Array | ArrayBuffer | number[]>) {\r\n  return bufferConcats(this, ...args);\r\n};\r\n\r\n/* Uint8Array.prototype.toString = function() {\r\n  return String.fromCharCode.apply(null, [...this]);\r\n}; */\r\n\r\nUint8Array.prototype.toJSON = function() {\r\n  return [...this];\r\n  // return {type: 'bytes', value: [...this]};\r\n};\r\n\r\nPromise.prototype.finally = Promise.prototype.finally || function<T>(this: Promise<T>, fn: () => any) {\r\n  const onFinally = (callback: typeof fn) => Promise.resolve(fn()).then(callback);\r\n  return this.then(\r\n    (result) => onFinally(() => result),\r\n    (reason) => onFinally(() => Promise.reject(reason))\r\n  );\r\n};\r\n\r\ndeclare global {\r\n  interface Uint8Array {\r\n    concat: (...args: Array<Uint8Array | ArrayBuffer | number[]>) => Uint8Array,\r\n    // toString: () => string,\r\n    toJSON: () => number[],\r\n    // toJSON: () => {type: 'bytes', value: number[]},\r\n  }\r\n\r\n  interface Promise<T> {\r\n    finally: (onfinally?: () => void) => Promise<T>;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {WorkerTaskVoidTemplate} from '../../types';\r\n\r\nexport interface ConvertWebPTask extends WorkerTaskVoidTemplate {\r\n  type: 'convertWebp',\r\n  payload: {\r\n    fileName: string,\r\n    bytes: Uint8Array\r\n  }\r\n};\r\n\r\nexport class WebpWorkerController {\r\n  private worker: Worker;\r\n  private convertPromises: {[fileName: string]: CancellablePromise<Uint8Array>} = {};\r\n\r\n  private init() {\r\n    this.worker = new Worker(new URL('./webp.worker.ts', import.meta.url), {type: 'module'});\r\n    this.worker.addEventListener('message', (e) => {\r\n      const task = e.data as ConvertWebPTask;\r\n      const payload = task.payload;\r\n\r\n      const promise = this.convertPromises[payload.fileName];\r\n      if(promise) {\r\n        payload.bytes ? promise.resolve(payload.bytes) : promise.reject();\r\n        delete this.convertPromises[payload.fileName];\r\n      }\r\n    });\r\n  }\r\n\r\n  private postMessage(data: ConvertWebPTask) {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    this.worker.postMessage(data);\r\n  }\r\n\r\n  public convert(fileName: string, bytes: Uint8Array) {\r\n    if(this.convertPromises.hasOwnProperty(fileName)) {\r\n      return this.convertPromises[fileName];\r\n    }\r\n\r\n    const convertPromise = deferredPromise<Uint8Array>();\r\n\r\n    this.postMessage({type: 'convertWebp', payload: {fileName, bytes}});\r\n\r\n    return this.convertPromises[fileName] = convertPromise;\r\n  }\r\n}\r\n\r\nconst webpWorkerController = new WebpWorkerController();\r\nMOUNT_CLASS_TO.webpWorkerController = webpWorkerController;\r\nexport default webpWorkerController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {CommonDatabase, getCommonDatabaseState} from '../config/databases/state';\r\nimport Modes from '../config/modes';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {IS_WORKER} from '../helpers/context';\r\nimport makeError from '../helpers/makeError';\r\nimport {StringKey, WorkerTaskTemplate} from '../types';\r\nimport EncryptedStorageLayer from './encryptedStorageLayer';\r\nimport {logger} from './logger';\r\nimport MTProtoMessagePort from './mtproto/mtprotoMessagePort';\r\nimport DeferredIsUsingPasscode from './passcode/deferredIsUsingPasscode';\r\n\r\n\r\nclass LocalStorage<Storage extends Record<string, any>> {\r\n  private prefix = '';\r\n  private cache: Partial<Storage> = {};\r\n  private useStorage = true;\r\n\r\n  constructor() {\r\n    if(Modes.test) {\r\n      this.prefix = 't_';\r\n    }\r\n  }\r\n\r\n  public get<T extends keyof Storage>(key: T, useCache = true): Storage[T] {\r\n    if(this.cache.hasOwnProperty(key) && useCache) {\r\n      return this.cache[key];\r\n    } else if(this.useStorage) {\r\n      let value: Storage[T];\r\n      try {\r\n        value = localStorage.getItem(this.prefix + (key as string)) as any;\r\n      } catch(err) {\r\n        this.useStorage = false;\r\n        throw makeError('STORAGE_OFFLINE');\r\n      }\r\n\r\n      if(value !== null) {\r\n        try {\r\n          value = JSON.parse(value);\r\n        } catch(err) {\r\n          // console.error(err);\r\n        }\r\n      } else {\r\n        value = undefined;\r\n      }\r\n\r\n      return value;\r\n    } else {\r\n      throw makeError('STORAGE_OFFLINE');\r\n    }\r\n  }\r\n\r\n  public set(obj: Partial<Storage>, onlyLocal = false) {\r\n    let lastError: any;\r\n    for(const key in obj) {\r\n      if(obj.hasOwnProperty(key)) {\r\n        const value = obj[key];\r\n        this.cache[key] = value;\r\n\r\n        if(!onlyLocal) {\r\n          try {\r\n            if(!this.useStorage) {\r\n              throw makeError('STORAGE_OFFLINE');\r\n            }\r\n\r\n            const stringified = JSON.stringify(value);\r\n            localStorage.setItem(this.prefix + key, stringified);\r\n          } catch(err) {\r\n            this.useStorage = false;\r\n            lastError = err;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if(lastError) {\r\n      throw lastError;\r\n    }\r\n  }\r\n\r\n  public delete(key: keyof Storage, saveLocal = false) {\r\n    // ! it is needed here\r\n    key = '' + (key as string);\r\n\r\n    if(!saveLocal) {\r\n      delete this.cache[key];\r\n    }\r\n\r\n    // if(this.useStorage) {\r\n    try {\r\n      localStorage.removeItem(this.prefix + (key as string));\r\n    } catch(err) {\r\n\r\n    }\r\n    // }\r\n  }\r\n\r\n  public clear(preserveKeys: (keyof Storage)[] = []) {\r\n    try {\r\n      const obj: Partial<Storage> = {};\r\n      if(preserveKeys?.length) {\r\n        preserveKeys.forEach((key) => {\r\n          const value = this.get(key);\r\n          if(value !== undefined) {\r\n            obj[key] = value;\r\n          }\r\n        });\r\n      }\r\n\r\n      localStorage.clear();\r\n\r\n      if(preserveKeys?.length) {\r\n        this.set(obj);\r\n      }\r\n    } catch(err) {\r\n\r\n    }\r\n  }\r\n\r\n  public toggleStorage(enabled: boolean, clearWrite: boolean) {\r\n    this.useStorage = enabled;\r\n\r\n    if(!clearWrite) {\r\n      return;\r\n    }\r\n\r\n    if(enabled) {\r\n      return this.set(this.cache);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface LocalStorageProxyTask extends WorkerTaskTemplate {\r\n  type: 'localStorageProxy',\r\n  payload: {\r\n    type: 'set' | 'get' | 'delete' | 'clear' | 'toggleStorage',\r\n    args: any[]\r\n  }\r\n};\r\n\r\ntype EncryptedLocalStorageProxyTaskType = 'save' | 'get' | 'delete';\r\n\r\nexport interface LocalStorageEncryptedProxyTaskPayload {\r\n  type: EncryptedLocalStorageProxyTaskType;\r\n  args: Parameters<EncryptedStorageLayer<any>[EncryptedLocalStorageProxyTaskType]>;\r\n};\r\n\r\nexport default class LocalStorageController<Storage extends Record<string, any>> {\r\n  private static STORAGES: LocalStorageController<any>[] = [];\r\n\r\n  private static ENCRYPTION_DB = getCommonDatabaseState();\r\n  private static ENCRYPTION_DB_STORE_NAME = 'localStorage__encrypted' as const;\r\n\r\n  private log = logger('[local-storage-controller]');\r\n\r\n  private storage: LocalStorage<Storage>;\r\n  private encryptedStorage: EncryptedStorageLayer<CommonDatabase>;\r\n\r\n  private encryptableKeys: Set<keyof Storage>;\r\n  private encryptionDeferred: CancellablePromise<void>;\r\n\r\n  constructor(encryptableKeys: (keyof Storage)[] = []) {\r\n    LocalStorageController.STORAGES.push(this);\r\n    this.encryptableKeys = new Set(encryptableKeys);\r\n\r\n    if(!IS_WORKER) {\r\n      this.storage = new LocalStorage();\r\n    }\r\n  }\r\n\r\n  private async getEncryptedStorage() {\r\n    if(this.encryptedStorage) return this.encryptedStorage;\r\n\r\n    this.encryptedStorage = EncryptedStorageLayer.getInstance(\r\n      LocalStorageController.ENCRYPTION_DB, LocalStorageController.ENCRYPTION_DB_STORE_NAME\r\n    );\r\n\r\n    this.encryptedStorage.loadEncrypted();\r\n\r\n    return this.encryptedStorage;\r\n  }\r\n\r\n  private async shouldUseEncryptableStorage(key: keyof Storage) {\r\n    const isEncryptable = this.encryptableKeys.has(key);\r\n    if(isEncryptable === false) return false;\r\n\r\n    return DeferredIsUsingPasscode.isUsingPasscode();\r\n  }\r\n\r\n  public async localStorageProxy<T>(type: LocalStorageProxyTask['payload']['type'], ...args: LocalStorageProxyTask['payload']['args']): Promise<T> {\r\n    if(IS_WORKER) {\r\n      const port = MTProtoMessagePort.getInstance<false>();\r\n      return port.invoke('localStorageProxy', {type, args});\r\n    }\r\n\r\n    args = Array.prototype.slice.call(args);\r\n\r\n    // @ts-ignore\r\n    return this.storage[type].apply(this.storage, args as any);\r\n  }\r\n\r\n  public async encryptedStorageProxy<T extends EncryptedLocalStorageProxyTaskType>(\r\n    type: T,\r\n    ...args: Parameters<EncryptedStorageLayer<any>[T]>\r\n  ): Promise<Awaited<ReturnType<EncryptedStorageLayer<any>[T]>>> {\r\n    if(!IS_WORKER) {\r\n      const port = MTProtoMessagePort.getInstance<true>();\r\n      return port.invoke('localStorageEncryptedProxy', {type, args});\r\n    }\r\n\r\n    const encryptedStorage = await this.getEncryptedStorage();\r\n    // @ts-ignore\r\n    return encryptedStorage[type](...args);\r\n  }\r\n\r\n  private async waitEncryptionToFinish() {\r\n    if(this.encryptionDeferred) await this.encryptionDeferred;\r\n  }\r\n\r\n\r\n  public async get<Key extends keyof Storage>(key: StringKey<Key>, useCache?: boolean) {\r\n    await this.waitEncryptionToFinish();\r\n\r\n    if(await this.shouldUseEncryptableStorage(key)) {\r\n      const result = await this.encryptedStorageProxy('get', [key]); // uses cache by default\r\n      return result[0] as Storage[Key];\r\n    }\r\n\r\n    return this.localStorageProxy<Storage[Key]>('get', key, useCache);\r\n  }\r\n\r\n  public async set(obj: Partial<Storage>) {\r\n    await this.waitEncryptionToFinish();\r\n\r\n    obj = {...obj};\r\n\r\n    const encryptableKeys = Object.keys(obj).filter(key => this.encryptableKeys.has(key));\r\n\r\n    if(encryptableKeys.length && await this.shouldUseEncryptableStorage(encryptableKeys[0])) {\r\n      const values = encryptableKeys.map((key) => obj[key]);\r\n      await this.encryptedStorageProxy('save', encryptableKeys, values);\r\n      encryptableKeys.forEach((key) => {\r\n        delete obj[key];\r\n      });\r\n    }\r\n\r\n    if(Object.keys(obj).length) {\r\n      return this.localStorageProxy<void>('set', obj);\r\n    }\r\n  }\r\n\r\n  public async delete(key: StringKey<keyof Storage>) {\r\n    await this.waitEncryptionToFinish();\r\n\r\n    if(await this.shouldUseEncryptableStorage(key)) {\r\n      return this.encryptedStorageProxy('delete', key);\r\n    }\r\n\r\n    return this.localStorageProxy<void>('delete', key);\r\n  }\r\n\r\n  public toggleStorage(enabled: boolean, clearWrite: boolean) {\r\n    return this.localStorageProxy<void>('toggleStorage', enabled, clearWrite);\r\n  }\r\n\r\n  private warnAboutEncrypting(methodName: string) {\r\n    if(IS_WORKER) return false;\r\n\r\n    this.log.warn(`${methodName} should not be called in a window client, call it only in the MTProto worker`);\r\n    return true;\r\n  }\r\n\r\n  public async encryptEncryptable() {\r\n    if(this.warnAboutEncrypting('encryptEncryptable')) return;\r\n\r\n    this.encryptionDeferred = deferredPromise();\r\n\r\n    const encryptableKeys = Array.from(this.encryptableKeys.values());\r\n    const values = await Promise.all(encryptableKeys.map((key) => this.localStorageProxy('get', key)));\r\n\r\n    const filteredEntries = encryptableKeys\r\n    /*                    */.map((key, idx) => [key, values[idx]])\r\n    /*                    */.filter((entry) => entry[1]);\r\n\r\n    const data = Object.fromEntries(filteredEntries);\r\n\r\n    this.encryptedStorage = EncryptedStorageLayer.getInstance(\r\n      LocalStorageController.ENCRYPTION_DB, LocalStorageController.ENCRYPTION_DB_STORE_NAME\r\n    );\r\n    await this.encryptedStorage.loadDecrypted(data);\r\n\r\n    // Let window clients have the values in cache while we delete them, they might not have the values yet tho\r\n    await Promise.all(filteredEntries.map(([key]) => this.localStorageProxy('set', key, /* onlyLocal = */true)));\r\n\r\n    await Promise.all(filteredEntries.map(([key]) => this.localStorageProxy('delete', key)));\r\n\r\n    this.encryptionDeferred?.resolve();\r\n    this.encryptionDeferred = undefined;\r\n  }\r\n\r\n  public async reEncryptEncryptable() {\r\n    if(this.warnAboutEncrypting('reEncryptEncryptable')) return;\r\n\r\n    this.encryptionDeferred = deferredPromise();\r\n\r\n    const encryptedStorage = await this.getEncryptedStorage();\r\n    await encryptedStorage.reEncrypt();\r\n\r\n    this.encryptionDeferred?.resolve();\r\n    this.encryptionDeferred = undefined;\r\n  }\r\n\r\n  public async decryptEncryptable() {\r\n    if(this.warnAboutEncrypting('decryptEncryptable')) return;\r\n\r\n    this.encryptionDeferred = deferredPromise();\r\n\r\n    const encryptedStorage = await this.getEncryptedStorage();\r\n\r\n    const entries = await encryptedStorage.getAllEntries();\r\n    const filteredEntries = entries.filter((entry) => this.encryptableKeys.has(entry[0] as any)); // just in case\r\n\r\n    const data = Object.fromEntries(filteredEntries);\r\n\r\n    await this.localStorageProxy('set', data);\r\n    await encryptedStorage.clear();\r\n\r\n    this.encryptionDeferred?.resolve();\r\n    this.encryptionDeferred = undefined;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DcId} from '../types';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\nimport type {AppInstance} from './mtproto/singleInstance';\r\nimport type {UserAuth} from './mtproto/mtproto_config';\r\nimport LocalStorageController from './localStorage';\r\nimport {AccountSessionData} from './accounts/types';\r\n\r\n\r\ntype StorageValues = {\r\n  state_id: number,\r\n\r\n  account1: AccountSessionData,\r\n  account2: AccountSessionData,\r\n  account3: AccountSessionData,\r\n  account4: AccountSessionData,\r\n\r\n  encryption_key?: string, // Will be quickly set and removed when switching between accounts\r\n\r\n  server_time_offset: number,\r\n  xt_instance: AppInstance,\r\n  kz_version: 'K' | 'Z',\r\n  tgme_sync: {\r\n    canRedirect: boolean,\r\n    ts: number\r\n  },\r\n  k_build: number,\r\n\r\n  // auth options\r\n  number_of_accounts?: number, // When the storage is encrypted\r\n  previous_account?: number, // only for back button when logging in to another account\r\n  current_account?: number, // 1 if not set\r\n  should_animate_auth?: number,\r\n  should_animate_main?: number\r\n}\r\n\r\n/**\r\n * @deprecated use these keys only for going to and from 'A' (a.k.a. 'Z') version\r\n */\r\ntype DeprecatedStorageValues = {\r\n  dc: DcId,\r\n  user_auth: UserAuth,\r\n\r\n  dc1_auth_key: string,\r\n  dc2_auth_key: string,\r\n  dc3_auth_key: string,\r\n  dc4_auth_key: string,\r\n  dc5_auth_key: string,\r\n\r\n  dc1_server_salt: string,\r\n  dc2_server_salt: string,\r\n  dc3_server_salt: string,\r\n  dc4_server_salt: string,\r\n  dc5_server_salt: string,\r\n\r\n  dc1_hash: string, // WebA only\r\n  dc2_hash: string, // WebA only\r\n  dc3_hash: string, // WebA only\r\n  dc4_hash: string, // WebA only\r\n  dc5_hash: string, // WebA only\r\n\r\n  auth_key_fingerprint: string // = dc${App.baseDcId}_auth_key.slice(0, 8)\r\n};\r\n\r\nconst sessionStorage = new LocalStorageController<StorageValues & DeprecatedStorageValues>([\r\n  'account1',\r\n  'account2',\r\n  'account3',\r\n  'account4',\r\n  'auth_key_fingerprint',\r\n  'user_auth',\r\n  'dc'\r\n]);\r\n\r\nMOUNT_CLASS_TO.appStorage = sessionStorage;\r\nexport default sessionStorage;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nexport default function cancelEvent(event?: Event) {\r\n  event ||= window.event;\r\n  if(event) {\r\n    // 'input' event will have cancelable=false, but we still need to preventDefault\r\n    // if(!event.cancelable) {\r\n    //   return false;\r\n    // }\r\n\r\n    // @ts-ignore\r\n    event = event.originalEvent || event;\r\n\r\n    try {\r\n      if(event.stopPropagation) event.stopPropagation();\r\n      if(event.preventDefault) event.preventDefault();\r\n      event.returnValue = false;\r\n      event.cancelBubble = true;\r\n    } catch(err) {}\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\n\r\nexport default function isSwipingBackSafari(e: TouchEvent | MouseEvent) {\r\n  return IS_MOBILE_SAFARI && e instanceof TouchEvent && e.touches[0].clientX < 30;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\r\nimport {logger} from '../lib/logger';\r\nimport blurActiveElement from '../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport isSwipingBackSafari from '../helpers/dom/isSwipingBackSafari';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\n\r\nexport type NavigationItem = {\r\n  type: 'left' | 'right' | 'im' | 'chat' | 'popup' | 'media' | 'menu' |\r\n    'esg' | 'multiselect' | 'input-helper' | 'autocomplete-helper' | 'markup' |\r\n    'global-search' | 'voice' | 'mobile-search' | 'filters' | 'global-search-focus' |\r\n    'toast' | 'dropdown' | 'forum' | 'stories' | 'stories-focus' | 'topbar-search' |\r\n    'settings-popup',\r\n  onPop: (canAnimate: boolean) => boolean | void,\r\n  onEscape?: () => boolean,\r\n  noHistory?: boolean,\r\n  noBlurOnPop?: boolean,\r\n};\r\n\r\nexport class AppNavigationController {\r\n  private navigations: Array<NavigationItem>;\r\n  private id: number;\r\n  private manual: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private debug: boolean;\r\n  private currentHash: string; // have to start with # if not empty\r\n  private overriddenHash: string; // have to start with # if not empty\r\n  private isPossibleSwipe: boolean;\r\n  public onHashChange: () => void;\r\n\r\n  constructor() {\r\n    this.navigations = [];\r\n    this.id = Date.now();\r\n    this.manual = false;\r\n    this.log = logger('NC');\r\n    this.debug = true;\r\n    this.currentHash = window.location.hash;\r\n    this.overriddenHash = '';\r\n    this.isPossibleSwipe = false;\r\n\r\n    window.addEventListener('popstate', this.onPopState);\r\n    window.addEventListener('keydown', this.onKeyDown, {capture: true, passive: false});\r\n\r\n    if(IS_MOBILE_SAFARI) {\r\n      const options = {passive: true};\r\n      window.addEventListener('touchstart', this.onTouchStart, options);\r\n    }\r\n\r\n    history.scrollRestoration = 'manual';\r\n\r\n    this.pushState(); // * push init state\r\n  }\r\n\r\n  private onPopState = (e: PopStateEvent) => {\r\n    const hash = window.location.hash;\r\n    const id: number = e.state;\r\n    this.debug && this.log('popstate', e, this.isPossibleSwipe, hash);\r\n    if(hash !== this.currentHash) {\r\n      this.debug && this.log.warn(`hash changed, new=${hash}, current=${this.currentHash}, overridden=${this.overriddenHash}`);\r\n      // fix for returning to wrong hash (e.g. chat -> archive -> chat -> 3x back)\r\n      if(id === this.id && this.overriddenHash && this.overriddenHash !== hash) {\r\n        this.overrideHash(this.overriddenHash);\r\n      } else if(id/*  === this.id */ && !this.overriddenHash && hash) {\r\n        this.overrideHash();\r\n      } else {\r\n        this.currentHash = hash;\r\n        this.onHashChange && this.onHashChange();\r\n        // this.replaceState();\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(id !== this.id/*  && !this.navigations.length */) {\r\n      this.pushState();\r\n\r\n      if(!this.navigations.length) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const item = this.navigations.pop();\r\n    if(!item) {\r\n      this.pushState();\r\n      return;\r\n    }\r\n\r\n    this.manual = !this.isPossibleSwipe;\r\n    this.handleItem(item, this.navigations.length);\r\n    // this.pushState(); // * prevent adding forward arrow\r\n  };\r\n\r\n  private onKeyDown = (e: KeyboardEvent) => {\r\n    const item = this.navigations[this.navigations.length - 1];\r\n    if(!item) return;\r\n    if(e.key === 'Escape' && (item.onEscape ? item.onEscape() : true)) {\r\n      cancelEvent(e);\r\n      this.back(item.type);\r\n    }\r\n  };\r\n\r\n  private onTouchStart = (e: TouchEvent) => {\r\n    if(e.touches.length > 1) return;\r\n    this.debug && this.log('touchstart');\r\n\r\n    if(isSwipingBackSafari(e)) {\r\n      this.isPossibleSwipe = true;\r\n\r\n      window.addEventListener('touchend', () => {\r\n        setTimeout(() => {\r\n          this.isPossibleSwipe = false;\r\n        }, 100);\r\n      }, {passive: true, once: true});\r\n    }\r\n\r\n    /* const detach = () => {\r\n      window.removeEventListener('touchend', onTouchEnd);\r\n      window.removeEventListener('touchmove', onTouchMove);\r\n    };\r\n\r\n    let moved = false;\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      this.debug && this.log('touchmove');\r\n      if(e.touches.length > 1) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      moved = true;\r\n    };\r\n\r\n    const onTouchEnd = (e: TouchEvent) => {\r\n      this.debug && this.log('touchend');\r\n      if(e.touches.length > 1 || !moved) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      isPossibleSwipe = true;\r\n      doubleRaf().then(() => {\r\n        isPossibleSwipe = false;\r\n      });\r\n\r\n      detach();\r\n    };\r\n\r\n    window.addEventListener('touchend', onTouchEnd, options);\r\n    window.addEventListener('touchmove', onTouchMove, options); */\r\n  };\r\n\r\n  public overrideHash(hash: string = '') {\r\n    if(hash && hash[0] !== '#') hash = '#' + hash;\r\n    else if(hash === '#') hash = '';\r\n\r\n    if(this.currentHash === hash) {\r\n      return;\r\n    }\r\n\r\n    this.overriddenHash = this.currentHash = hash;\r\n    this.replaceState();\r\n    this.pushState();\r\n  }\r\n\r\n  private handleItem(item: NavigationItem, wasIndex = this.navigations.indexOf(item)) {\r\n    const good = item.onPop(!this.manual ? false : undefined);\r\n    this.debug && this.log('popstate, navigation:', item, this.navigations);\r\n    if(good === false) { // insert item on the same place, because .push can have different index if new item has appeared\r\n      this.spliceItems(Math.min(this.navigations.length, wasIndex), 0, item);\r\n    } else if(!item.noBlurOnPop) {\r\n      blurActiveElement(); // no better place for it\r\n    }\r\n\r\n    this.manual = false;\r\n  }\r\n\r\n  public findItemByType(type: NavigationItem['type']) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        return {item, index: i};\r\n      }\r\n    }\r\n  }\r\n\r\n  public back(type?: NavigationItem['type']) {\r\n    if(type) {\r\n      const ret = this.findItemByType(type);\r\n      if(ret) {\r\n        this.backByItem(ret.item, ret.index);\r\n        return;\r\n      }\r\n    }\r\n\r\n    history.back();\r\n  }\r\n\r\n  public backByItem(item: NavigationItem, index = this.navigations.indexOf(item)) {\r\n    if(index === -1) {\r\n      return;\r\n    }\r\n\r\n    this.manual = true;\r\n    // ! commented because 'popstate' event will be fired with delay\r\n    // if(index !== (this.navigations.length - 1)) {\r\n    this.navigations.splice(index, 1);\r\n    this.handleItem(item, index);\r\n    // }\r\n  }\r\n\r\n  private onItemAdded(item: NavigationItem) {\r\n    this.debug && this.log('onItemAdded', item, this.navigations);\r\n\r\n    if(!item.noHistory) {\r\n      this.pushState();\r\n    }\r\n  }\r\n\r\n  public pushItem(item: NavigationItem) {\r\n    this.navigations.push(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public unshiftItem(item: NavigationItem) {\r\n    this.navigations.unshift(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public spliceItems(index: number, length: number, ...items: NavigationItem[]) {\r\n    this.navigations.splice(index, length, ...items);\r\n    items.forEach((item) => {\r\n      this.onItemAdded(item);\r\n    });\r\n  }\r\n\r\n  public pushState() {\r\n    this.debug && this.log('push');\r\n    this.manual = false;\r\n    history.pushState(this.id, '');\r\n  }\r\n\r\n  public replaceState() {\r\n    this.debug && this.log.warn('replace');\r\n\r\n    const url = location.origin + location.pathname + location.search + this.overriddenHash;\r\n    history.replaceState(this.id, '', url);\r\n  }\r\n\r\n  public removeItem(item: NavigationItem) {\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    indexOfAndSplice(this.navigations, item);\r\n  }\r\n\r\n  public removeByType(type: NavigationItem['type'], single = false) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        this.navigations.splice(i, 1);\r\n\r\n        if(single) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst appNavigationController = new AppNavigationController();\r\nMOUNT_CLASS_TO.appNavigationController = appNavigationController;\r\nexport default appNavigationController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport appNavigationController from '../../components/appNavigationController';\r\n\r\nexport class AppRuntimeManager {\r\n  public reload(removeHash = true) {\r\n    try {\r\n      appNavigationController.spliceItems(0, Infinity);\r\n      removeHash && appNavigationController.overrideHash();\r\n      location.reload();\r\n    } catch(e) {};\r\n\r\n    // if(window.chrome && chrome.runtime && chrome.runtime.reload) {\r\n    //   chrome.runtime.reload();\r\n    // }\r\n  }\r\n\r\n  public close() {\r\n    try {\r\n      window.close();\r\n    } catch(e) {}\r\n  }\r\n\r\n  /**\r\n   * Better to call from event\r\n   */\r\n  public focus() {\r\n    // // @ts-ignore\r\n    // if(window.navigator.mozApps && document.hidden) {\r\n    //   // Get app instance and launch it to bring app to foreground\r\n    //   // @ts-ignore\r\n    //   window.navigator.mozApps.getSelf().onsuccess = function() {\r\n    //     this.result.launch();\r\n    //   };\r\n    // } else {\r\n    //   // @ts-ignore\r\n    //   if(window.chrome && chrome.app && chrome.app.window) {\r\n    //     // @ts-ignore\r\n    //     chrome.app.window.current().focus();\r\n    //   }\r\n\r\n    window.focus();\r\n    // }\r\n  }\r\n}\r\n\r\nconst appRuntimeManager = new AppRuntimeManager();\r\nexport default appRuntimeManager;\r\n","export default function copy<T>(obj: T): T {\r\n  // in case of premitives\r\n  if(obj === null || typeof(obj) !== 'object') {\r\n    return obj;\r\n  }\r\n\r\n  // date objects should be\r\n  if(obj instanceof Date) {\r\n    return new Date(obj.getTime()) as any;\r\n  }\r\n\r\n  // handle Array\r\n  if(Array.isArray(obj)) {\r\n    // @ts-ignore\r\n    const clonedArr: T = obj.map((el) => copy(el)) as any as T;\r\n    return clonedArr;\r\n  }\r\n\r\n  if(ArrayBuffer.isView(obj)) {\r\n    // @ts-ignore\r\n    return obj.slice();\r\n  }\r\n\r\n  // lastly, handle objects\r\n  // @ts-ignore\r\n  const clonedObj = new obj.constructor();\r\n  for(var prop in obj) {\r\n    if(obj.hasOwnProperty(prop)) {\r\n      clonedObj[prop] = copy(obj[prop]);\r\n    }\r\n  }\r\n  return clonedObj;\r\n}\r\n","import Modes from '../config/modes';\r\n\r\nconst IS_SHARED_WORKER_SUPPORTED = typeof(SharedWorker) !== 'undefined' && !Modes.noSharedWorker/*  && false */;\r\n\r\nexport default IS_SHARED_WORKER_SUPPORTED;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport EventListenerBase from './eventListenerBase';\r\n\r\nconst FOCUS_EVENT_NAME = IS_TOUCH_SUPPORTED ? 'touchstart' : 'mousemove';\r\nconst DO_NOT_IDLE = false;\r\n\r\nexport class IdleController extends EventListenerBase<{\r\n  change: (idle: boolean) => void\r\n}> {\r\n  private _isIdle: boolean;\r\n\r\n  private focusPromise: Promise<void>;\r\n  private focusResolve: () => void;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._isIdle = true;\r\n    this.focusPromise = Promise.resolve();\r\n    this.focusResolve = () => {};\r\n\r\n    window.addEventListener('blur', () => {\r\n      this.isIdle = true;\r\n\r\n      window.addEventListener('focus', () => {\r\n        this.isIdle = false;\r\n      }, {once: true});\r\n    });\r\n\r\n    // * Prevent setting online after reloading page\r\n    window.addEventListener(FOCUS_EVENT_NAME, () => {\r\n      this.isIdle = false;\r\n    }, {once: true, passive: true});\r\n\r\n    this.addEventListener('change', (idle) => {\r\n      if(idle) {\r\n        this.focusPromise = new Promise((resolve) => {\r\n          this.focusResolve = resolve;\r\n        });\r\n      } else {\r\n        this.focusResolve();\r\n      }\r\n    });\r\n  }\r\n\r\n  public getFocusPromise() {\r\n    return this.focusPromise;\r\n  }\r\n\r\n  public get isIdle() {\r\n    return this._isIdle;\r\n  }\r\n\r\n  public set isIdle(value: boolean) {\r\n    if(this._isIdle === value) {\r\n      return;\r\n    }\r\n\r\n    if(DO_NOT_IDLE && value) {\r\n      return;\r\n    }\r\n\r\n    this._isIdle = value;\r\n    this.dispatchEvent('change', value);\r\n  }\r\n}\r\n\r\nconst idleController = new IdleController();\r\nexport default idleController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../../config/app';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport tabId from '../../config/tabId';\r\nimport IS_SHARED_WORKER_SUPPORTED from '../../environment/sharedWorkerSupport';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport idleController from '../../helpers/idleController';\r\nimport {logger} from '../logger';\r\nimport rootScope from '../rootScope';\r\nimport sessionStorage from '../sessionStorage';\r\nimport apiManagerProxy from './mtprotoworker';\r\n\r\nexport type AppInstance = {\r\n  id: number,\r\n  idle: boolean,\r\n  time: number\r\n};\r\n\r\nexport type InstanceDeactivateReason = 'version' | 'tabs';\r\n\r\nconst CHECK_INSTANCE_INTERVAL = 5000;\r\nconst DEACTIVATE_TIMEOUT = 30000;\r\nconst MULTIPLE_TABS_THRESHOLD = 20000;\r\nconst IS_MULTIPLE_TABS_SUPPORTED = IS_SHARED_WORKER_SUPPORTED;\r\n\r\nexport class SingleInstance extends EventListenerBase<{\r\n  activated: () =>  void,\r\n  deactivated: (reason: InstanceDeactivateReason) => void\r\n}> {\r\n  private instanceId: number;\r\n  private started: boolean;\r\n  private masterInstance: boolean;\r\n  private deactivateTimeout: number;\r\n  private deactivated: InstanceDeactivateReason;\r\n  private log = logger('INSTANCE');\r\n\r\n  constructor() {\r\n    super(false);\r\n\r\n    this.log = logger('INSTANCE');\r\n    this.instanceId = tabId;\r\n  }\r\n\r\n  public get deactivatedReason() {\r\n    return this.deactivated;\r\n  }\r\n\r\n  public start() {\r\n    this.reset();\r\n\r\n    if(!this.started/*  && !Config.Navigator.mobile && !Config.Modes.packed */) {\r\n      this.started = true;\r\n\r\n      idleController.addEventListener('change', this.checkInstance);\r\n      apiManagerProxy.setInterval(this.checkInstance, CHECK_INSTANCE_INTERVAL);\r\n\r\n      try {\r\n        document.documentElement.addEventListener('beforeunload', this.clearInstance);\r\n      } catch(e) {}\r\n\r\n      return this.checkInstance();\r\n    }\r\n  }\r\n\r\n  private reset() {\r\n    this.masterInstance = false;\r\n    this.clearDeactivateTimeout();\r\n    this.deactivated = undefined;\r\n  }\r\n\r\n  private clearInstance = () => {\r\n    if(this.masterInstance && !this.deactivated) {\r\n      this.log.warn('clear master instance');\r\n      sessionStorage.delete('xt_instance');\r\n    }\r\n  };\r\n\r\n  public activateInstance() {\r\n    if(this.deactivated) {\r\n      this.reset();\r\n      this.checkInstance(false);\r\n      this.dispatchEvent('activated');\r\n    }\r\n  }\r\n\r\n  private deactivateInstance(reason: InstanceDeactivateReason) {\r\n    if(this.masterInstance || this.deactivated) {\r\n      return;\r\n    }\r\n\r\n    this.log.warn('deactivate', reason);\r\n    this.clearDeactivateTimeout();\r\n    this.deactivated = reason;\r\n\r\n    this.dispatchEvent('deactivated', reason);\r\n  }\r\n\r\n  private clearDeactivateTimeout() {\r\n    if(this.deactivateTimeout) {\r\n      clearTimeout(this.deactivateTimeout);\r\n      this.deactivateTimeout = 0;\r\n    }\r\n  }\r\n\r\n  private checkInstance = async(idle = idleController.isIdle) => {\r\n    if(this.deactivated) {\r\n      return;\r\n    }\r\n\r\n    const time = Date.now();\r\n    const newInstance: AppInstance = {\r\n      id: this.instanceId,\r\n      idle,\r\n      time\r\n    };\r\n\r\n    const [curInstance, build = App.build] = await Promise.all([\r\n      sessionStorage.get('xt_instance', false),\r\n      sessionStorage.get('k_build', false)\r\n    ]);\r\n\r\n    if(build > App.build) {\r\n      this.masterInstance = false;\r\n      rootScope.managers.networkerFactory.stopAll();\r\n      this.deactivateInstance('version');\r\n      apiManagerProxy.toggleStorages(false, false);\r\n      return;\r\n    } else if(IS_MULTIPLE_TABS_SUPPORTED) {\r\n      sessionStorage.set({xt_instance: newInstance});\r\n      return;\r\n    }\r\n\r\n    // this.log('check instance', newInstance, curInstance)\r\n    if(!idle ||\r\n        !curInstance ||\r\n        curInstance.id === this.instanceId ||\r\n        curInstance.time < (time - MULTIPLE_TABS_THRESHOLD)) {\r\n      sessionStorage.set({xt_instance: newInstance});\r\n\r\n      if(!this.masterInstance) {\r\n        this.masterInstance = true;\r\n        rootScope.managers.networkerFactory.startAll();\r\n        this.log.warn('now master instance', newInstance);\r\n      }\r\n\r\n      this.clearDeactivateTimeout();\r\n    } else if(this.masterInstance) {\r\n      this.masterInstance = false;\r\n      rootScope.managers.networkerFactory.stopAll();\r\n      this.log.warn('now idle instance', newInstance);\r\n      this.deactivateTimeout ||= window.setTimeout(() => this.deactivateInstance('tabs'), DEACTIVATE_TIMEOUT);\r\n    }\r\n  };\r\n}\r\n\r\nconst singleInstance = new SingleInstance();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.singleInstance = singleInstance);\r\nexport default singleInstance;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MESSAGE_ID_OFFSET} from '../../../mtproto/mtproto_config';\r\n\r\nexport default function clearMessageId(messageId: number, toServer?: boolean) {\r\n  if(messageId === undefined) {\r\n    return;\r\n  }\r\n\r\n  messageId = +messageId.toFixed(0);\r\n  if(!toServer) {\r\n    return messageId;\r\n  }\r\n\r\n  return messageId < MESSAGE_ID_OFFSET ? messageId : messageId % MESSAGE_ID_OFFSET;\r\n  // const q = MESSAGE_ID_OFFSET;\r\n  // if(messageId < q) { // id 0 -> mid 0xFFFFFFFF, so 0xFFFFFFFF must convert to 0\r\n  //   return messageId;\r\n  // }\r\n\r\n  // const l = MESSAGE_ID_INCREMENT - 1;\r\n  // const used = messageId & l;\r\n  // if(used !== l) {\r\n  //   messageId -= used + 1;\r\n  // }\r\n\r\n  // return toServer ? (messageId - q) / MESSAGE_ID_INCREMENT : messageId;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport clearMessageId from './clearMessageId';\r\n\r\n/**\r\n * * will ignore outgoing offset\r\n */\r\nexport default function getServerMessageId(messageId: number) {\r\n  return clearMessageId(messageId, true);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type {PushNotificationObject} from '../serviceWorker/push';\r\nimport type {ServicePushPingTaskPayload} from '../serviceWorker/serviceMessagePort';\r\nimport type {NotificationSettings} from '../appManagers/uiNotificationsManager';\r\nimport type ServiceMessagePort from '../serviceWorker/serviceMessagePort';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {logger} from '../logger';\r\nimport I18n, {LangPackKey} from '../langPack';\r\nimport {IS_MOBILE} from '../../environment/userAgent';\r\nimport appRuntimeManager from '../appManagers/appRuntimeManager';\r\nimport copy from '../../helpers/object/copy';\r\nimport singleInstance from './singleInstance';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport getServerMessageId from '../appManagers/utils/messageId/getServerMessageId';\r\n\r\nexport type PushSubscriptionNotifyType = 'init' | 'subscribe' | 'unsubscribe';\r\nexport type PushSubscriptionNotifyEvent = `push_${PushSubscriptionNotifyType}`;\r\n\r\nexport type PushSubscriptionNotify = {\r\n  tokenType: number,\r\n  tokenValue: string\r\n};\r\n\r\nconst PING_PUSH_INTERVAL = 10000;\r\n\r\nexport class WebPushApiManager extends EventListenerBase<{\r\n  push_notification_click: (n: PushNotificationObject) => void,\r\n  push_init: (n: PushSubscriptionNotify) => void,\r\n  push_subscribe: (n: PushSubscriptionNotify) => void,\r\n  push_unsubscribe: (n: PushSubscriptionNotify) => void\r\n}> {\r\n  public isAvailable = true;\r\n  private isPushEnabled = false;\r\n  private localNotificationsAvailable = true;\r\n  private started = false;\r\n  private settings: NotificationSettings & {baseUrl?: string} = {} as any;\r\n  private isAliveTO: any;\r\n  private isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n  private userVisibleOnly = this.isFirefox ? false : true;\r\n  private log = logger('PUSH-API');\r\n\r\n  public serviceMessagePort: ServiceMessagePort<true>;\r\n\r\n  constructor() {\r\n    super(false);\r\n\r\n    if(!('PushManager' in window) ||\r\n      !('Notification' in window) ||\r\n      !('serviceWorker' in navigator)) {\r\n      this.log.warn('Push messaging is not supported.');\r\n      this.isAvailable = false;\r\n      this.localNotificationsAvailable = false;\r\n    }\r\n\r\n    if(this.isAvailable && Notification.permission === 'denied') {\r\n      this.log.warn('The user has blocked notifications.');\r\n    }\r\n  }\r\n\r\n  public start() {\r\n    if(!this.started) {\r\n      this.started = true;\r\n      this.getSubscription();\r\n      this.setUpServiceWorkerChannel();\r\n    }\r\n  }\r\n\r\n  public setLocalNotificationsDisabled() {\r\n    this.localNotificationsAvailable = false;\r\n  }\r\n\r\n  public getSubscription() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.getSubscription().then((subscription) => {\r\n        this.isPushEnabled = !!subscription;\r\n        this.pushSubscriptionNotify('init', subscription);\r\n      }).catch((err) => {\r\n        this.log.error('Error during getSubscription()', err);\r\n      });\r\n    });\r\n  }\r\n\r\n  public subscribe = () => {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.subscribe({userVisibleOnly: this.userVisibleOnly}).then((subscription) => {\r\n        // The subscription was successful\r\n        this.isPushEnabled = true;\r\n        this.pushSubscriptionNotify('subscribe', subscription);\r\n      }).catch((e) => {\r\n        if(Notification.permission === 'denied') {\r\n          this.log('Permission for Notifications was denied');\r\n        } else {\r\n          this.log('Unable to subscribe to push.', e);\r\n          if(!this.userVisibleOnly) {\r\n            this.userVisibleOnly = true;\r\n            setTimeout(this.subscribe, 0);\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public unsubscribe() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.getSubscription().then((subscription) => {\r\n        this.isPushEnabled = false;\r\n\r\n        if(subscription) {\r\n          this.pushSubscriptionNotify('unsubscribe', subscription);\r\n\r\n          setTimeout(() => {\r\n            subscription.unsubscribe().then((successful) => {\r\n              this.isPushEnabled = false;\r\n            }).catch((e) => {\r\n              this.log.error('Unsubscription error: ', e);\r\n            });\r\n          }, 3000);\r\n        }\r\n      }).catch((e) => {\r\n        this.log.error('Error thrown while unsubscribing from ' +\r\n          'push messaging.', e);\r\n      });\r\n    });\r\n  }\r\n\r\n  public forceUnsubscribe() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.getSubscription().then((subscription) => {\r\n        this.log.warn('force unsubscribe', subscription);\r\n        if(!subscription) {\r\n          return;\r\n        }\r\n\r\n        subscription.unsubscribe().then((successful) => {\r\n          this.log.warn('force unsubscribe successful', successful);\r\n          this.isPushEnabled = false;\r\n        }).catch((e) => {\r\n          this.log.error('Unsubscription error: ', e);\r\n        });\r\n      }).catch((e) => {\r\n        this.log.error('Error thrown while unsubscribing from ' +\r\n          'push messaging.', e);\r\n      });\r\n    });\r\n  }\r\n\r\n  public isAliveNotify = () => {\r\n    if(!this.isAvailable || singleInstance.deactivatedReason) {\r\n      return;\r\n    }\r\n\r\n    this.settings.baseUrl = (location.href || '').replace(/#.*$/, '');\r\n\r\n    const lang: ServicePushPingTaskPayload['lang'] = {} as any;\r\n    const ACTIONS_LANG_MAP: Record<keyof ServicePushPingTaskPayload['lang'], LangPackKey> = {\r\n      push_action_mute1d: IS_MOBILE ? 'PushNotification.Action.Mute1d.Mobile' : 'PushNotification.Action.Mute1d',\r\n      push_action_settings: IS_MOBILE ? 'PushNotification.Action.Settings.Mobile' : 'PushNotification.Action.Settings',\r\n      push_message_nopreview: 'PushNotification.Message.NoPreview'\r\n    };\r\n\r\n    for(const action in ACTIONS_LANG_MAP) {\r\n      lang[action as keyof typeof ACTIONS_LANG_MAP] = I18n.format(ACTIONS_LANG_MAP[action as keyof typeof ACTIONS_LANG_MAP], true);\r\n    }\r\n\r\n    this.serviceMessagePort.invokeVoid('pushPing', {\r\n      localNotifications: this.localNotificationsAvailable,\r\n      lang: lang,\r\n      settings: this.settings\r\n    });\r\n\r\n    this.isAliveTO = setTimeout(this.isAliveNotify, PING_PUSH_INTERVAL);\r\n  }\r\n\r\n  public setSettings(newSettings: WebPushApiManager['settings']) {\r\n    this.settings = copy(newSettings);\r\n    clearTimeout(this.isAliveTO);\r\n    this.isAliveNotify();\r\n  }\r\n\r\n  public hidePushNotifications() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    this.serviceMessagePort.invokeVoid('notificationsClear', undefined);\r\n  }\r\n\r\n  public setUpServiceWorkerChannel() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    this.serviceMessagePort.addEventListener('pushClick', (payload) => {\r\n      if(singleInstance.deactivatedReason) {\r\n        appRuntimeManager.reload();\r\n        return;\r\n      }\r\n\r\n      this.dispatchEvent('push_notification_click', payload);\r\n    });\r\n\r\n    navigator.serviceWorker.ready.then(this.isAliveNotify);\r\n  }\r\n\r\n  public pushSubscriptionNotify(event: PushSubscriptionNotifyType, subscription?: PushSubscription) {\r\n    if(subscription) {\r\n      const subscriptionObj: PushSubscriptionJSON = subscription.toJSON();\r\n      if(!subscriptionObj ||\r\n        !subscriptionObj.endpoint ||\r\n        !subscriptionObj.keys ||\r\n        !subscriptionObj.keys.p256dh ||\r\n        !subscriptionObj.keys.auth) {\r\n        this.log.warn('Invalid push subscription', subscriptionObj);\r\n        this.unsubscribe();\r\n        this.isAvailable = false;\r\n        this.pushSubscriptionNotify(event);\r\n        return;\r\n      }\r\n\r\n      this.log.warn('Push', event, subscriptionObj);\r\n      this.dispatchEvent(('push_' + event) as PushSubscriptionNotifyEvent, {\r\n        tokenType: 10,\r\n        tokenValue: JSON.stringify(subscriptionObj)\r\n      });\r\n    } else {\r\n      this.log.warn('Push', event, false);\r\n      this.dispatchEvent(('push_' + event) as PushSubscriptionNotifyEvent, false as any);\r\n    }\r\n  }\r\n\r\n  public ignorePushByMid(peerId: PeerId, mid: number) {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    this.serviceMessagePort.invokeVoid('shownNotification', peerId + '_' + getServerMessageId(mid));\r\n  }\r\n}\r\n\r\nconst webPushApiManager = new WebPushApiManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.webPushApiManager = webPushApiManager);\r\nexport default webPushApiManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function loadScript(url: string) {\r\n  const script = document.createElement('script');\r\n  const promise = new Promise<HTMLScriptElement>((resolve) => {\r\n    script.onload = script.onerror = () => {\r\n      resolve(script);\r\n    };\r\n  });\r\n  script.src = url;\r\n  document.body.appendChild(script);\r\n  return promise;\r\n}\r\n","export default function tsNow(seconds?: true) {\r\n  const t = Date.now();\r\n  return seconds ? t / 1000 | 0 : t;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../../config/app';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport Modes from '../../config/modes';\r\nimport loadScript from '../../helpers/dom/loadScript';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport sessionStorage from '../sessionStorage';\r\n\r\nexport class TelegramMeWebManager {\r\n  private disabled = /* false &&  */(Modes.test || !App.domains.includes(location.hostname));\r\n\r\n  public setAuthorized(canRedirect: boolean) {\r\n    if(this.disabled) {\r\n      return;\r\n    }\r\n\r\n    return sessionStorage.get('tgme_sync').then((curValue) => {\r\n      const ts = tsNow(true);\r\n      if(\r\n        canRedirect &&\r\n        curValue?.canRedirect === canRedirect &&\r\n        (curValue.ts + 86400) > ts\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      sessionStorage.set({\r\n        tgme_sync: {\r\n          canRedirect,\r\n          ts\r\n        }\r\n      });\r\n\r\n      const path = `_websync_?authed=${canRedirect ? '1' : '0'}&version=${encodeURIComponent(App.version + ' ' + App.suffix)}`;\r\n      const urls = [\r\n        '//telegram.me/' + path,\r\n        '//t.me/' + path\r\n      ];\r\n\r\n      const promises = urls.map((url) => {\r\n        return loadScript(url).then((script) => {\r\n          script.remove();\r\n        });\r\n      });\r\n\r\n      return Promise.all(promises);\r\n    });\r\n  }\r\n}\r\n\r\nconst telegramMeWebManager = new TelegramMeWebManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.telegramMeWebManager = telegramMeWebManager);\r\nexport default telegramMeWebManager;\r\n","import {IS_FIREFOX} from './userAgent';\r\n\r\nconst IS_WEBRTC_SUPPORTED = !!(typeof(RTCPeerConnection) !== 'undefined' && !IS_FIREFOX);\r\n\r\nexport default IS_WEBRTC_SUPPORTED;\r\n","import IS_WEBRTC_SUPPORTED from './webrtcSupport';\r\n\r\nconst IS_CALL_SUPPORTED = IS_WEBRTC_SUPPORTED;\r\n\r\nexport default IS_CALL_SUPPORTED;\r\n","import {IS_SAFARI} from './userAgent';\r\n\r\n/*\r\n * This is used as a workaround for a memory leak in Safari caused by using Transferable objects to\r\n * transfer data between WebWorkers and the main thread.\r\n * https://github.com/mapbox/mapbox-gl-js/issues/8771\r\n *\r\n * This should be removed once the underlying Safari issue is fixed.\r\n */\r\n\r\nlet CAN_USE_TRANSFERABLES: boolean;\r\nif(!IS_SAFARI) CAN_USE_TRANSFERABLES = true;\r\nelse {\r\n  try {\r\n    const match = navigator.userAgent.match(/Version\\/(.+?) /);\r\n    CAN_USE_TRANSFERABLES = +match[1] >= 14;\r\n  } catch(err) {\r\n    CAN_USE_TRANSFERABLES = false;\r\n  }\r\n}\r\n\r\nexport default CAN_USE_TRANSFERABLES;\r\n","const IS_GEOLOCATION_SUPPORTED = !!navigator?.geolocation?.getCurrentPosition && false;\r\n\r\nexport default IS_GEOLOCATION_SUPPORTED;\r\n","import IS_WEBRTC_SUPPORTED from './webrtcSupport';\r\n\r\nconst IS_GROUP_CALL_SUPPORTED = IS_WEBRTC_SUPPORTED;\r\n\r\nexport default IS_GROUP_CALL_SUPPORTED;\r\n","const IS_WEBP_SUPPORTED = document.createElement('canvas').toDataURL('image/webp').startsWith('data:image/webp');\r\n\r\nexport default IS_WEBP_SUPPORTED;\r\n","import IS_WEBP_SUPPORTED from './webpSupport';\r\n\r\nconst IMAGE_MIME_TYPES_SUPPORTED = new Set([\r\n  'image/jpeg',\r\n  'image/png',\r\n  'image/bmp'\r\n]);\r\n\r\nif(IS_WEBP_SUPPORTED) {\r\n  IMAGE_MIME_TYPES_SUPPORTED.add('image/webp');\r\n}\r\n\r\nconst possible: [string, string][] = [\r\n  ['image/jxl', 'data:image/jxl;base64,/woIAAAMABKIAgC4AF3lEgAAFSqjjBu8nOv58kOHxbSN6wxttW1hSaLIODZJJ3BIEkkaoCUzGM6qJAE='],\r\n  ['image/avif', 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=']\r\n];\r\n\r\nconst promises = possible.map(([mime, data]) => {\r\n  const img = new Image();\r\n  const promise = new Promise<string>((resolve) => {\r\n    img.onload = img.onerror = () => {\r\n      const supported = img.height === 2;\r\n      resolve(supported ? mime : undefined);\r\n    };\r\n  });\r\n  img.src = data;\r\n  return promise;\r\n});\r\n\r\nexport const IMAGE_MIME_TYPES_SUPPORTED_PROMISE = Promise.all(promises).then((mimeTypes) => mimeTypes.filter(Boolean));\r\n\r\nexport default IMAGE_MIME_TYPES_SUPPORTED;\r\n","import {IS_SAFARI, IS_APPLE_MOBILE} from './userAgent';\r\n\r\nconst video = document.createElement('video');\r\nconst IS_WEBM_SUPPORTED = !!video.canPlayType('video/webm') && !IS_SAFARI && !IS_APPLE_MOBILE;\r\n// mov is not supported in Chrome on macOS\r\nconst IS_MOV_SUPPORTED = !!video.canPlayType('video/quicktime') || IS_SAFARI || IS_APPLE_MOBILE;\r\nconst IS_H265_SUPPORTED = !!video.canPlayType('video/mp4; codecs=\"hev1\"');\r\nconst IS_AV1_SUPPORTED = !IS_SAFARI;\r\n\r\nexport {\r\n  IS_WEBM_SUPPORTED,\r\n  IS_MOV_SUPPORTED,\r\n  IS_H265_SUPPORTED,\r\n  IS_AV1_SUPPORTED\r\n};\r\n","import {IS_MOV_SUPPORTED} from './videoSupport';\r\n\r\nexport type VIDEO_MIME_TYPE = 'image/gif' | 'video/mp4' | 'video/webm' | 'video/quicktime';\r\nconst VIDEO_MIME_TYPES_SUPPORTED: Set<VIDEO_MIME_TYPE> = new Set([\r\n  'image/gif', // have to display it as video\r\n  'video/mp4',\r\n  'video/webm'\r\n]);\r\n\r\nif(IS_MOV_SUPPORTED) {\r\n  VIDEO_MIME_TYPES_SUPPORTED.add('video/quicktime');\r\n}\r\n\r\nexport default VIDEO_MIME_TYPES_SUPPORTED;\r\n","import {IS_FIREFOX} from './userAgent';\r\n\r\nconst IS_PARALLAX_SUPPORTED = !IS_FIREFOX && false;\r\n\r\nexport default IS_PARALLAX_SUPPORTED;\r\n","const IS_SCREEN_SHARING_SUPPORTED = !!('getDisplayMedia' in (navigator?.mediaDevices || {}));\r\n\r\nexport default IS_SCREEN_SHARING_SUPPORTED;\r\n","const IS_VIBRATE_SUPPORTED = !!navigator?.vibrate;\r\n\r\nexport default IS_VIBRATE_SUPPORTED;\r\n","const audio = document.createElement('audio');\r\nconst IS_OPUS_SUPPORTED = !!(audio.canPlayType && audio.canPlayType('audio/ogg;').replace(/no/, ''))/*  && false */;\r\n\r\nexport default IS_OPUS_SUPPORTED;\r\n","let IS_APPLE_MX = false;\r\n\r\ntry {\r\n  // Awesome detect from https://stackoverflow.com/a/65412357\r\n  const ctx = document.createElement('canvas').getContext('webgl');\r\n  const extension = ctx.getExtension('WEBGL_debug_renderer_info');\r\n  const renderer: string = extension && ctx.getParameter(extension.UNMASKED_RENDERER_WEBGL) || '';\r\n  if((renderer.match(/Apple/) && !renderer.match(/Apple GPU/)) ||\r\n    ctx.getSupportedExtensions().indexOf('WEBGL_compressed_texture_s3tc_srgb') === -1) {\r\n    IS_APPLE_MX = true;\r\n  }\r\n} catch(err) {\r\n\r\n}\r\n\r\nexport default IS_APPLE_MX;\r\n","const IS_LIVE_STREAM_SUPPORTED = 'serviceWorker' in navigator;\r\n\r\nexport default IS_LIVE_STREAM_SUPPORTED;\r\n","import IS_CALL_SUPPORTED from './callSupport';\r\nimport CAN_USE_TRANSFERABLES from './canUseTransferables';\r\nimport IS_CANVAS_FILTER_SUPPORTED from './canvasFilterSupport';\r\nimport IS_EMOJI_SUPPORTED from './emojiSupport';\r\nimport IS_GEOLOCATION_SUPPORTED from './geolocationSupport';\r\nimport IS_GROUP_CALL_SUPPORTED from './groupCallSupport';\r\nimport IMAGE_MIME_TYPES_SUPPORTED from './imageMimeTypesSupport';\r\nimport MEDIA_MIME_TYPES_SUPPORTED from './mediaMimeTypesSupport';\r\nimport IS_PARALLAX_SUPPORTED from './parallaxSupport';\r\nimport IS_SCREEN_SHARING_SUPPORTED from './screenSharingSupport';\r\nimport IS_TOUCH_SUPPORTED from './touchSupport';\r\nimport IS_VIBRATE_SUPPORTED from './vibrateSupport';\r\nimport VIDEO_MIME_TYPES_SUPPORTED from './videoMimeTypesSupport';\r\nimport IS_WEBP_SUPPORTED from './webpSupport';\r\nimport IS_WEBRTC_SUPPORTED from './webrtcSupport';\r\nimport * as userAgent from './userAgent';\r\nimport IS_OPUS_SUPPORTED from './opusSupport';\r\nimport IS_SHARED_WORKER_SUPPORTED from './sharedWorkerSupport';\r\nimport IS_APPLE_MX from './appleMx';\r\nimport IS_LIVE_STREAM_SUPPORTED from './liveStreamSupport';\r\nimport * as IS_VIDEO_SUPPORTED from './videoSupport';\r\n\r\nconst ENVIRONMENT = {\r\n  CAN_USE_TRANSFERABLES,\r\n  IS_APPLE_MX,\r\n  IS_CALL_SUPPORTED,\r\n  IS_CANVAS_FILTER_SUPPORTED,\r\n  IS_EMOJI_SUPPORTED,\r\n  IS_GEOLOCATION_SUPPORTED,\r\n  IS_GROUP_CALL_SUPPORTED,\r\n  IS_PARALLAX_SUPPORTED,\r\n  IS_SCREEN_SHARING_SUPPORTED,\r\n  IS_TOUCH_SUPPORTED,\r\n  ...IS_VIDEO_SUPPORTED,\r\n  IS_VIBRATE_SUPPORTED,\r\n  IS_OPUS_SUPPORTED,\r\n  IS_SHARED_WORKER_SUPPORTED,\r\n  IS_WEBP_SUPPORTED,\r\n  IS_WEBRTC_SUPPORTED,\r\n  IS_LIVE_STREAM_SUPPORTED,\r\n  IMAGE_MIME_TYPES_SUPPORTED,\r\n  MEDIA_MIME_TYPES_SUPPORTED,\r\n  VIDEO_MIME_TYPES_SUPPORTED,\r\n  ...userAgent\r\n};\r\n\r\nexport default ENVIRONMENT;\r\n","// https://stackoverflow.com/a/61676104\r\nexport default function getTimeFormat(): 'h12' | 'h23' {\r\n  const t = document.createElement('input');\r\n  t.type = 'time';\r\n  t.value = '15:00';\r\n  t.style.visibility = 'hidden';\r\n  document.body.append(t);\r\n  const offsetWidth = t.offsetWidth;\r\n  t.remove();\r\n  const timeFormat = offsetWidth > 110 ? 'h12' : 'h23';\r\n  // console.log('timeFormat', timeFormat, offsetWidth);\r\n  return timeFormat;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {LiteModeKey} from '../helpers/liteMode';\r\nimport type {AppMediaPlaybackController} from '../components/appMediaPlaybackController';\r\nimport type {TopPeerType, MyTopPeer} from '../lib/appManagers/appUsersManager';\r\nimport type {AccountThemes, AutoDownloadSettings, BaseTheme, NotifyPeer, PeerNotifySettings, Theme, ThemeSettings, WallPaper} from '../layer';\r\nimport type DialogsStorage from '../lib/storages/dialogs';\r\nimport type FiltersStorage from '../lib/storages/filters';\r\nimport type {AuthState, Modify} from '../types';\r\nimport {IS_MOBILE} from '../environment/userAgent';\r\nimport getTimeFormat from '../helpers/getTimeFormat';\r\nimport {nextRandomUint} from '../helpers/random';\r\nimport App from './app';\r\nimport {MTAppConfig} from '../lib/mtproto/appConfig';\r\nimport {ShortcutKey as PasscodeLockShortcutKey} from '../components/sidebarLeft/tabs/passcodeLock/shortcutBuilder';\r\n\r\nconst STATE_VERSION = App.version;\r\nconst BUILD = App.build;\r\n\r\n// ! DEPRECATED\r\nexport type Background = {\r\n  type?: 'color' | 'image' | 'default', // ! DEPRECATED\r\n  blur: boolean,\r\n  highlightingColor?: string,\r\n  color?: string,\r\n  slug?: string,        // image slug\r\n  intensity?: number,   // pattern intensity\r\n  id: string | number,  // wallpaper id\r\n};\r\n\r\nexport type AppTheme = Modify<Theme, {\r\n  name: 'day' | 'night' | 'system',\r\n  settings?: Modify<ThemeSettings, {\r\n    highlightingColor: string\r\n  }>\r\n}>;\r\n\r\nexport type AutoDownloadPeerTypeSettings = {\r\n  contacts: boolean,\r\n  private: boolean,\r\n  groups: boolean,\r\n  channels: boolean\r\n};\r\n\r\nexport type StateSettings = {\r\n  messagesTextSize: number,\r\n  distanceUnit: 'kilometers' | 'miles',\r\n  sendShortcut: 'enter' | 'ctrlEnter',\r\n  animationsEnabled?: boolean, // ! DEPRECATED\r\n  autoDownload: {\r\n    contacts?: boolean, // ! DEPRECATED\r\n    private?: boolean, // ! DEPRECATED\r\n    groups?: boolean, // ! DEPRECATED\r\n    channels?: boolean, // ! DEPRECATED\r\n    photo: AutoDownloadPeerTypeSettings,\r\n    video: AutoDownloadPeerTypeSettings,\r\n    file: AutoDownloadPeerTypeSettings\r\n  },\r\n  autoDownloadNew: AutoDownloadSettings,\r\n  autoPlay?: { // ! DEPRECATED\r\n    gifs: boolean,\r\n    videos: boolean\r\n  },\r\n  stickers: {\r\n    suggest: 'all' | 'installed' | 'none',\r\n    dynamicPackOrder: boolean,\r\n    loop: boolean\r\n  },\r\n  emoji: {\r\n    suggest: boolean,\r\n    big: boolean\r\n  },\r\n  background?: Background, // ! DEPRECATED\r\n  themes: AppTheme[],\r\n  theme: AppTheme['name'],\r\n  notifications: {\r\n    sound: boolean\r\n  },\r\n  nightTheme?: boolean, // ! DEPRECATED\r\n  timeFormat: 'h12' | 'h23',\r\n  liteMode: {[key in LiteModeKey]: boolean},\r\n  savedAsForum: boolean,\r\n  notifyAllAccounts: boolean,\r\n  tabsInSidebar: boolean,\r\n  seenTooltips: {\r\n    storySound: boolean\r\n  },\r\n  playbackParams: ReturnType<AppMediaPlaybackController['getPlaybackParams']>,\r\n  translations: {\r\n    peers: {[peerId: PeerId]: string},\r\n    enabledPeers: {[peerId: PeerId]: boolean},\r\n    enabled: boolean,\r\n    showInMenu: boolean,\r\n    doNotTranslate: TranslatableLanguageISO[]\r\n  },\r\n  chatContextMenuHintWasShown: boolean,\r\n  passcode: {\r\n    enabled: boolean,\r\n    autoLockTimeoutMins: number, // number | null is not working, gets reset after reloading the page\r\n    lockShortcutEnabled: boolean,\r\n    lockShortcut: PasscodeLockShortcutKey[],\r\n    canAttemptAgainOn: number | null\r\n  }\r\n};\r\n\r\nexport type State = {\r\n  allDialogsLoaded: DialogsStorage['allDialogsLoaded'],\r\n  pinnedOrders: DialogsStorage['pinnedOrders'],\r\n  // contactsList: UserId[],\r\n  contactsListCachedTime: number,\r\n  updates: Partial<{\r\n    seq: number,\r\n    pts: number,\r\n    date: number\r\n  }>,\r\n  // filters?: FiltersStorage['filters'], // ! DEPRECATED\r\n  filtersArr?: FiltersStorage['filtersArr'],\r\n  maxSeenMsgId: number,\r\n  stateCreatedTime: number,\r\n  recentEmoji: string[],\r\n  recentCustomEmoji: DocId[],\r\n  topPeersCache: {\r\n    [type in TopPeerType]?: {\r\n      peers: MyTopPeer[],\r\n      cachedTime: number\r\n    }\r\n  },\r\n  recentSearch: PeerId[],\r\n  version: typeof STATE_VERSION,\r\n  build: typeof BUILD,\r\n  authState: AuthState,\r\n  hiddenPinnedMessages: {[peerId: PeerId]: number},\r\n  hideChatJoinRequests: {[peerId: PeerId]: number},\r\n  // stateId?: number, // ! DEPRECATED\r\n  notifySettings: {[k in Exclude<NotifyPeer['_'], 'notifyPeer'>]?: PeerNotifySettings.peerNotifySettings},\r\n  confirmedWebViews: BotId[],\r\n  hiddenSimilarChannels: number[],\r\n  appConfig: MTAppConfig,\r\n  accountThemes: AccountThemes.accountThemes,\r\n  shownUploadSpeedTimestamp?: number,\r\n  // playbackParams?: StateSettings['playbackParams'], // ! MIGRATED TO SETTINGS\r\n  // chatContextMenuHintWasShown?: StateSettings['chatContextMenuHintWasShown'], // ! MIGRATED TO SETTINGS\r\n  // seenTooltips?: StateSettings['seenTooltips'], // ! MIGRATED TO SETTINGS\r\n  // translations?: StateSettings['translations'], // ! MIGRATED TO SETTINGS\r\n  settings?: StateSettings // ! DEPRECATED, BUT DON'T REMOVE BEFORE FULL MIGRATION\r\n};\r\n\r\nexport type CommonState = {\r\n  settings: StateSettings\r\n};\r\n\r\n// const BACKGROUND_DAY_MOBILE: Background = {\r\n//   blur: false,\r\n//   slug: '',\r\n//   color: '#dbddbb,#6ba587,#d5d88d,#88b884',\r\n//   highlightingColor: 'hsla(86.4, 43.846153%, 45.117647%, .4)',\r\n//   intensity: 0,\r\n//   id: '1'\r\n// };\r\n\r\n// const BACKGROUND_NIGHT_MOBILE: Background = {\r\n//   blur: false,\r\n//   slug: '',\r\n//   color: '#0f0f0f',\r\n//   highlightingColor: 'hsla(0, 0%, 3.82353%, 0.4)',\r\n//   intensity: 0,\r\n//   id: '-1'\r\n// };\r\n\r\nexport const DEFAULT_THEME: Theme = {\r\n  _: 'theme',\r\n  access_hash: '',\r\n  id: '',\r\n  settings: [{\r\n    _: 'themeSettings',\r\n    pFlags: {},\r\n    base_theme: {_: 'baseThemeClassic'},\r\n    accent_color: 0x3390ec,\r\n    message_colors: [0x5CA853],\r\n    wallpaper: {\r\n      _: 'wallPaper',\r\n      pFlags: {\r\n        default: true,\r\n        pattern: true\r\n      },\r\n      access_hash: '',\r\n      document: undefined,\r\n      id: '',\r\n      slug: 'pattern',\r\n      settings: {\r\n        _: 'wallPaperSettings',\r\n        pFlags: {},\r\n        intensity: 50,\r\n        background_color: 0xdbddbb,\r\n        second_background_color: 0x6ba587,\r\n        third_background_color: 0xd5d88d,\r\n        fourth_background_color: 0x88b884\r\n      }\r\n    }\r\n  }, {\r\n    _: 'themeSettings',\r\n    pFlags: {},\r\n    base_theme: {_: 'baseThemeNight'},\r\n    accent_color: 0x8774E1,\r\n    message_colors: [0x8774E1],\r\n    wallpaper: {\r\n      _: 'wallPaper',\r\n      pFlags: {\r\n        default: true,\r\n        pattern: true,\r\n        dark: true\r\n      },\r\n      access_hash: '',\r\n      document: undefined,\r\n      id: '',\r\n      slug: 'pattern',\r\n      settings: {\r\n        _: 'wallPaperSettings',\r\n        pFlags: {},\r\n        intensity: -50,\r\n        background_color: 0xfec496,\r\n        second_background_color: 0xdd6cb9,\r\n        third_background_color: 0x962fbf,\r\n        fourth_background_color: 0x4f5bd5\r\n      }\r\n    }\r\n  }],\r\n  slug: '',\r\n  title: '',\r\n  emoticon: '🏠',\r\n  pFlags: {default: true}\r\n};\r\n\r\nconst makeDefaultAppTheme = (\r\n  name: AppTheme['name'],\r\n  baseTheme: BaseTheme['_'],\r\n  highlightingColor: string\r\n): AppTheme => {\r\n  return {\r\n    ...DEFAULT_THEME,\r\n    name,\r\n    settings: {\r\n      ...DEFAULT_THEME.settings.find((s) => s.base_theme._ === baseTheme),\r\n      highlightingColor\r\n    }\r\n  };\r\n};\r\n\r\nexport const SETTINGS_INIT: StateSettings = {\r\n  messagesTextSize: 16,\r\n  distanceUnit: 'kilometers',\r\n  sendShortcut: 'enter',\r\n  autoDownload: {\r\n    photo: {\r\n      contacts: true,\r\n      private: true,\r\n      groups: true,\r\n      channels: true\r\n    },\r\n    video: {\r\n      contacts: true,\r\n      private: true,\r\n      groups: true,\r\n      channels: true\r\n    },\r\n    file: {\r\n      contacts: true,\r\n      private: true,\r\n      groups: true,\r\n      channels: true\r\n    }\r\n  },\r\n  autoDownloadNew: {\r\n    _: 'autoDownloadSettings',\r\n    file_size_max: 3145728,\r\n    pFlags: {\r\n      video_preload_large: true,\r\n      audio_preload_next: true\r\n    },\r\n    photo_size_max: 1048576,\r\n    video_size_max: 15728640,\r\n    video_upload_maxbitrate: 100,\r\n    small_queue_active_operations_max: 0,\r\n    large_queue_active_operations_max: 0\r\n  },\r\n  stickers: {\r\n    suggest: 'all',\r\n    dynamicPackOrder: true,\r\n    loop: true\r\n  },\r\n  emoji: {\r\n    suggest: true,\r\n    big: true\r\n  },\r\n  themes: [\r\n    makeDefaultAppTheme('day', 'baseThemeClassic', 'hsla(86.4, 43.846153%, 45.117647%, .4)'),\r\n    makeDefaultAppTheme('night', 'baseThemeNight', 'hsla(299.142857, 44.166666%, 37.470588%, .4)')\r\n  ],\r\n  theme: 'system',\r\n  notifications: {\r\n    sound: false\r\n  },\r\n  timeFormat: getTimeFormat(),\r\n  liteMode: {\r\n    all: false,\r\n    animations: false,\r\n    chat: false,\r\n    chat_background: false,\r\n    chat_spoilers: false,\r\n    effects: false,\r\n    effects_premiumstickers: false,\r\n    effects_reactions: false,\r\n    effects_emoji: false,\r\n    emoji: false,\r\n    emoji_messages: false,\r\n    emoji_panel: false,\r\n    gif: false,\r\n    stickers: false,\r\n    stickers_chat: false,\r\n    stickers_panel: false,\r\n    video: false\r\n  },\r\n  savedAsForum: false,\r\n  notifyAllAccounts: true,\r\n  tabsInSidebar: false,\r\n  playbackParams: {\r\n    volume: 1,\r\n    muted: false,\r\n    playbackRate: 1,\r\n    playbackRates: {\r\n      voice: 1,\r\n      video: 1,\r\n      audio: 1\r\n    },\r\n    loop: false,\r\n    round: false\r\n  },\r\n  chatContextMenuHintWasShown: false,\r\n  seenTooltips: {\r\n    storySound: false\r\n  },\r\n  translations: {\r\n    peers: {},\r\n    enabledPeers: {},\r\n    enabled: true,\r\n    showInMenu: true,\r\n    doNotTranslate: []\r\n  },\r\n  passcode: {\r\n    enabled: false,\r\n    autoLockTimeoutMins: 0,\r\n    lockShortcutEnabled: false,\r\n    lockShortcut: ['Alt'],\r\n    canAttemptAgainOn: null\r\n  }\r\n};\r\n\r\nexport const STATE_INIT: State = {\r\n  allDialogsLoaded: {},\r\n  pinnedOrders: {},\r\n  // contactsList: [],\r\n  contactsListCachedTime: 0,\r\n  updates: {},\r\n  filtersArr: [],\r\n  maxSeenMsgId: 0,\r\n  stateCreatedTime: Date.now(),\r\n  recentEmoji: [],\r\n  recentCustomEmoji: [],\r\n  topPeersCache: {},\r\n  recentSearch: [],\r\n  version: STATE_VERSION,\r\n  build: BUILD,\r\n  authState: {\r\n    _: IS_MOBILE ? 'authStateSignIn' : 'authStateSignQr'\r\n  },\r\n  hiddenPinnedMessages: {},\r\n  hideChatJoinRequests: {},\r\n  // stateId: nextRandomUint(32),\r\n  notifySettings: {},\r\n  confirmedWebViews: [],\r\n  hiddenSimilarChannels: [],\r\n  appConfig: {} as any,\r\n  accountThemes: {} as any\r\n};\r\n\r\nexport const COMMON_STATE_INIT: CommonState = {\r\n  settings: SETTINGS_INIT\r\n};\r\n","export default function compareVersion(v1: string, v2: string): number {\r\n  v1 = v1.split(' ', 1)[0];\r\n  v2 = v2.split(' ', 1)[0];\r\n  const s1 = v1.split('.');\r\n  const s2 = v2.split('.');\r\n\r\n  for(let i = 0; i < s1.length; ++i) {\r\n    const v1 = +s1[i];\r\n    const v2 = +s2[i];\r\n    if(v1 > v2) return 1;\r\n    else if(v1 < v2) return -1;\r\n  }\r\n\r\n  return 0;\r\n}\r\n","export default function isObject<T extends Record<any, any>>(object: any): object is T {\r\n  return typeof(object) === 'object' && object !== null;\r\n}\r\n","import copy from './copy';\r\nimport isObject from './isObject';\r\n\r\nexport default function validateInitObject(\r\n  initObject: any,\r\n  currentObject: any,\r\n  onReplace?: (key: string) => void,\r\n  previousKey?: string,\r\n  ignorePaths?: Set<string>,\r\n  path?: string\r\n) {\r\n  for(const key in initObject) {\r\n    const _path = path ? `${path}.${key}` : key;\r\n    if(ignorePaths?.has(_path)) {\r\n      continue;\r\n    }\r\n\r\n    if(typeof(currentObject[key]) !== typeof(initObject[key])) {\r\n      currentObject[key] = copy(initObject[key]);\r\n      onReplace?.(previousKey || key);\r\n    } else if(isObject(initObject[key])) {\r\n      validateInitObject(initObject[key], currentObject[key], onReplace, previousKey || key, ignorePaths, _path);\r\n    }\r\n  }\r\n}\r\n","import {logger} from '../lib/logger';\r\nimport dT from './dT';\r\n\r\nexport function recordPromise<T extends Promise<any>>(promise: T, description: string, log?: ReturnType<typeof logger> | Console) {\r\n  const perf = performance.now();\r\n  (log || console).warn(dT(), 'start', description);\r\n  promise.then(() => {\r\n    (log || console).warn(dT(), 'end', description, performance.now() - perf);\r\n  });\r\n  return promise;\r\n}\r\n\r\nexport function recordPromiseBound(log: ReturnType<typeof logger> | Console) {\r\n  return (...args: [Parameters<typeof recordPromise>[0], Parameters<typeof recordPromise>[1]]) => {\r\n    return recordPromise(...args, log);\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {ChatSavedPosition} from './appManagers/appImManager';\r\nimport type {AppDraftsManager} from './appManagers/appDraftsManager';\r\nimport type {State} from '../config/state';\r\nimport AppStorage from './storage';\r\nimport {AccountDatabase, getDatabaseState, getOldDatabaseState} from '../config/databases/state';\r\nimport {ActiveAccountNumber} from './accounts/types';\r\n\r\nexport default class StateStorage extends AppStorage<{\r\n  chatPositions: {\r\n    [peerId_threadId: string]: ChatSavedPosition\r\n  },\r\n  drafts: AppDraftsManager['drafts']\r\n} & State, AccountDatabase> {\r\n  constructor(accountNumber: ActiveAccountNumber | 'old') {\r\n    const db = accountNumber === 'old' ?\r\n      getOldDatabaseState() :\r\n      getDatabaseState(accountNumber);\r\n\r\n    super(db, 'session');\r\n  }\r\n}\r\n","import {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport App from '../../config/app';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport type {TrueDcId} from '../../types';\r\n\r\nimport sessionStorage from '../sessionStorage';\r\nimport DeferredIsUsingPasscode from '../passcode/deferredIsUsingPasscode';\r\nimport StaticUtilityClass from '../staticUtilityClass';\r\n\r\nimport {AccountSessionData, ActiveAccountNumber} from './types';\r\nimport {MAX_ACCOUNTS} from './constants';\r\n\r\nexport class AccountController extends StaticUtilityClass {\r\n  static async getTotalAccounts() {\r\n    const promises = ([1, 2, 3, 4] as const).map((accountNumber) => sessionStorage.get(`account${accountNumber}`));\r\n\r\n    const allAccountsData = await Promise.all(promises);\r\n\r\n    return allAccountsData.filter((accountData) => !!accountData?.userId).length;\r\n  }\r\n\r\n  static async getUnencryptedTotalAccounts() {\r\n    return sessionStorage.get('number_of_accounts');\r\n  }\r\n\r\n  static async getUserIds() {\r\n    const promises = ([1, 2, 3, 4] as const).map((accountNumber) => sessionStorage.get(`account${accountNumber}`));\r\n\r\n    const allAccountsData = await Promise.all(promises);\r\n\r\n    return allAccountsData.map((accountData) => accountData?.userId).filter(Boolean);\r\n  }\r\n\r\n  static async get(accountNumber: ActiveAccountNumber) {\r\n    const data = await sessionStorage.get(`account${accountNumber}`);\r\n    this.fillFingerprint(data);\r\n    return data;\r\n  }\r\n\r\n  static fillFingerprint(data: AccountSessionData) {\r\n    if(data && !data.auth_key_fingerprint) {\r\n      const key = `dc${App.baseDcId}_auth_key` as const;\r\n      const value = data[key];\r\n      data.auth_key_fingerprint = value ? data[key].slice(0, 8) : undefined;\r\n    }\r\n  }\r\n\r\n  static async update(accountNumber: ActiveAccountNumber, data: Partial<AccountSessionData>, overrideAll = false) {\r\n    const prevData = await this.get(accountNumber);\r\n    this.fillFingerprint(data as AccountSessionData);\r\n\r\n    const updatedData = {\r\n      ...(overrideAll ? {} : prevData),\r\n      ...data\r\n    };\r\n\r\n    await sessionStorage.set({\r\n      [`account${accountNumber}`]: updatedData\r\n    });\r\n\r\n    if(accountNumber === 1) {\r\n      await this.updateStorageForLegacy(updatedData);\r\n    }\r\n\r\n    (async() => {\r\n      sessionStorage.set({\r\n        number_of_accounts: await this.getTotalAccounts()\r\n      });\r\n    })();\r\n\r\n    return updatedData;\r\n  }\r\n\r\n  /**\r\n   * Shifts 4 -> 3, 3 -> 2 ... depending on which account you need to delete\r\n   * @param upTo Account to delete basically\r\n   */\r\n  static async shiftAccounts(upTo: ActiveAccountNumber) {\r\n    for(let i = upTo; i <= MAX_ACCOUNTS; i++) {\r\n      await sessionStorage.delete(`account${i as ActiveAccountNumber}`);\r\n      if(i < MAX_ACCOUNTS) {\r\n        const toMove = await this.get((i + 1) as ActiveAccountNumber);\r\n        toMove?.userId && (await this.update(i as ActiveAccountNumber, toMove, true));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use `null` when needing to remove the values (e.g. when enabling passcode)\r\n   */\r\n  static async updateStorageForLegacy(accountData: Partial<AccountSessionData> | null) {\r\n    if(accountData !== null && await DeferredIsUsingPasscode.isUsingPasscode()) return; // We can't expose keys if there's a passcode set\r\n\r\n    if(accountData === null) accountData = {};\r\n\r\n    const obj: Parameters<typeof sessionStorage['set']>[0] = {};\r\n    const toClear: (keyof typeof obj)[] = [];\r\n\r\n    const set = <T extends keyof typeof obj>(key: T, value: typeof obj[T]) => {\r\n      if(value) obj[key] = value;\r\n      else toClear.push(key);\r\n    };\r\n\r\n    for(let i = 1; i <= 5; i++) {\r\n      const authKeyKey = `dc${i as TrueDcId}_auth_key` as const;\r\n      const serverSaltKey = `dc${i as TrueDcId}_server_salt` as const;\r\n\r\n      set(authKeyKey, accountData[authKeyKey]);\r\n      set(serverSaltKey, accountData[serverSaltKey]);\r\n    }\r\n\r\n    accountData['auth_key_fingerprint'] && set('auth_key_fingerprint', accountData['auth_key_fingerprint']);\r\n    set('user_auth', accountData['userId'] && {\r\n      date: tsNow(true),\r\n      id: accountData.userId,\r\n      dcID: accountData.dcId || 0\r\n    });\r\n    set('dc', accountData.dcId);\r\n\r\n    await Promise.all([\r\n      sessionStorage.set(obj),\r\n      Promise.all(toClear.map((key) => sessionStorage.delete(key)))\r\n    ]);\r\n  }\r\n}\r\n\r\nMOUNT_CLASS_TO.AccountController = AccountController;\r\n\r\nexport default AccountController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {Chat} from '../../../../layer';\r\nimport type {Dialog} from '../../appMessagesManager';\r\nimport type {User} from '../../appUsersManager';\r\nimport {AccountDatabase, getDatabaseState, getOldDatabaseState} from '../../../../config/databases/state';\r\nimport AppStorage from '../../../storage';\r\nimport {ActiveAccountNumber} from '../../../accounts/types';\r\n\r\nexport type StoragesStorages = {\r\n  users: AppStorage<Record<UserId, User>, AccountDatabase>,\r\n  chats: AppStorage<Record<ChatId, Chat>, AccountDatabase>,\r\n  dialogs: AppStorage<Record<PeerId, Dialog>, AccountDatabase>\r\n};\r\n\r\nexport default function createStorages(accountNumber: ActiveAccountNumber) {\r\n  const names: (keyof StoragesStorages)[] = ['users', 'chats', 'dialogs'];\r\n  const storages: StoragesStorages = {} as any;\r\n  for(const name of names) {\r\n    // @ts-ignore\r\n    storages[name] = new AppStorage(accountNumber === undefined ? getOldDatabaseState() : getDatabaseState(accountNumber), name);\r\n  }\r\n\r\n  return storages;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../../../../config/app';\r\nimport DEBUG from '../../../../config/debug';\r\nimport {CommonState as StateCommon, State, COMMON_STATE_INIT, STATE_INIT} from '../../../../config/state';\r\nimport compareVersion from '../../../../helpers/compareVersion';\r\nimport copy from '../../../../helpers/object/copy';\r\nimport validateInitObject from '../../../../helpers/object/validateInitObject';\r\nimport {UserAuth} from '../../../mtproto/mtproto_config';\r\nimport sessionStorage from '../../../sessionStorage';\r\nimport {recordPromiseBound} from '../../../../helpers/recordPromise';\r\nimport {StoragesResults} from '../storages/loadStorages';\r\nimport {LogTypes, logger} from '../../../logger';\r\nimport {AccountSessionData, ActiveAccountNumber} from '../../../accounts/types';\r\nimport StateStorage from '../../../stateStorage';\r\nimport AccountController from '../../../accounts/accountController';\r\nimport commonStateStorage from '../../../commonStateStorage';\r\nimport {TrueDcId} from '../../../../types';\r\nimport {getOldDatabaseState} from '../../../../config/databases/state';\r\nimport {IDB} from '../../../files/idb';\r\nimport createStorages from '../storages/createStorages';\r\nimport isObject from '../../../../helpers/object/isObject';\r\n\r\nexport type LoadStateResult = {\r\n  state: State,\r\n  common: StateCommon,\r\n  resetStorages: Map<keyof StoragesResults, (PeerId | UserId | ChatId)[]>,\r\n  newVersion: string,\r\n  oldVersion: string,\r\n  pushedKeys: Set<keyof State>,\r\n  userId: UserId\r\n  refetchStorages?: boolean\r\n};\r\n\r\nconst TEST_MULTI_MIGRATION = false;\r\n\r\nconst REFRESH_EVERY = 24 * 60 * 60 * 1000; // 1 day\r\n// const REFRESH_EVERY = 1e3;\r\n// const REFRESH_EVERY_WEEK = 24 * 60 * 60 * 1000 * 7; // 7 days\r\n\r\nconst STATE_VERSION = STATE_INIT.version;\r\nconst BUILD = STATE_INIT.build;\r\n\r\nconst ALL_KEYS = Object.keys(STATE_INIT) as any as Array<keyof State>;\r\nconst COMMON_KEYS = Object.keys(COMMON_STATE_INIT) as any as Array<keyof StateCommon>;\r\n\r\nconst REFRESH_KEYS: Array<keyof State> = [\r\n  'contactsListCachedTime',\r\n  'stateCreatedTime',\r\n  'maxSeenMsgId',\r\n  'filtersArr'\r\n];\r\n\r\n// const REFRESH_KEYS_WEEK = ['dialogs', 'allDialogsLoaded', 'updates', 'pinnedOrders'] as any as Array<keyof State>;\r\n\r\nfunction AnyStateWriter<S>(log: ReturnType<typeof logger>, keys: string[], init: S) {\r\n  const pushedKeys: Set<keyof S> = new Set();\r\n  const pushToState = <T extends keyof S>(key: T, value: S[T]) => {\r\n    state[key] = value;\r\n    pushedKeys.add(key);\r\n  };\r\n\r\n  const replaceState = (_state: S) => {\r\n    pushedKeys.clear();\r\n    state = _state;\r\n    (Object.keys(state) as any as Array<keyof S>).forEach((key) => pushedKeys.add(key));\r\n  };\r\n\r\n  let state: S = {} as any;\r\n\r\n  const readFromArray = (arr: any[]) => {\r\n    // ! then can't store false values\r\n    for(let i = 0, length = keys.length; i < length; ++i) {\r\n      const key = keys[i];\r\n      const value = arr[i];\r\n      if(value !== undefined) {\r\n        // @ts-ignore\r\n        state[key] = value;\r\n      } else {\r\n        // @ts-ignore\r\n        pushToState(key, copy(init[key]));\r\n      }\r\n    }\r\n  };\r\n\r\n  return {\r\n    push: pushToState,\r\n    replace: replaceState,\r\n    readFromArray,\r\n    get state() {\r\n      return state;\r\n    },\r\n    set state(_state: S) {\r\n      state = _state;\r\n    },\r\n    pushedKeys,\r\n    log\r\n  };\r\n}\r\n\r\nfunction StateWriter(log: ReturnType<typeof logger>) {\r\n  const w = AnyStateWriter<State>(log, ALL_KEYS, STATE_INIT);\r\n\r\n  const resetStorages: Map<keyof StoragesResults, []> = new Map();\r\n  const resetState = ({\r\n    preserveKeys = []\r\n    // preserveCommonKeys = []\r\n  }: Partial<{\r\n    preserveKeys: (keyof State)[]\r\n    // preserveCommonKeys: typeof COMMON_KEYS[number][]\r\n  }> = {}) => {\r\n    preserveKeys.push('authState'/* , 'stateId' */);\r\n    const preserve: Map<keyof State, State[keyof State]> = new Map(\r\n      preserveKeys.map((key) => [key, w.state[key]])\r\n    );\r\n\r\n    w.state = copy(STATE_INIT);\r\n\r\n    preserve.forEach((value, key) => {\r\n      // @ts-ignore\r\n      w.state[key] = value;\r\n    });\r\n\r\n    const r: (keyof StoragesResults)[] = ['chats', 'dialogs', 'users'];\r\n    for(const key of r) {\r\n      resetStorages.set(key, []);\r\n    }\r\n\r\n    w.replace(w.state);\r\n  };\r\n\r\n  return {\r\n    ...w,\r\n    get state() {\r\n      return w.state;\r\n    },\r\n    set state(_state) {\r\n      w.state = _state;\r\n    },\r\n    resetStorages,\r\n    reset: resetState\r\n  };\r\n}\r\n\r\nfunction CommonStateWriter(log: ReturnType<typeof logger>) {\r\n  const w = AnyStateWriter<StateCommon>(log, COMMON_KEYS, COMMON_STATE_INIT);\r\n  return w;\r\n}\r\n\r\nconst STATE_STEPS = {\r\n  REFRESH: (writer: ReturnType<typeof StateWriter>) => {\r\n    const time = Date.now();\r\n    if((writer.state.stateCreatedTime + REFRESH_EVERY) < time) {\r\n      if(DEBUG) {\r\n        writer.log('will refresh state', writer.state.stateCreatedTime, time);\r\n      }\r\n\r\n      REFRESH_KEYS.forEach((key) => {\r\n        writer.push(key, copy(STATE_INIT[key]));\r\n      });\r\n    }\r\n  },\r\n  VALIDATE: <T>(writer: ReturnType<typeof AnyStateWriter<T>>, init: T) => {\r\n    const SKIP_VALIDATING_PATHS: Set<string> = new Set([\r\n      'settings.themes'\r\n    ]);\r\n    validateInitObject(init, writer.state, (missingKey) => {\r\n      writer.push(missingKey as keyof typeof init, writer.state[missingKey as keyof typeof init]);\r\n    }, undefined, SKIP_VALIDATING_PATHS);\r\n  },\r\n  VERSION: (writer: ReturnType<typeof StateWriter>) => {\r\n    let newVersion: string, oldVersion: string;\r\n    if(writer.state.version !== STATE_VERSION || writer.state.build !== BUILD/*  || true */) {\r\n      if(writer.state.build < 526) { // * drop all previous migrations\r\n        writer.reset();\r\n      } else if(writer.state.build < 562) { // * drop filtersArr\r\n        writer.push('filtersArr', copy(STATE_INIT.filtersArr));\r\n      }\r\n\r\n      if(compareVersion(writer.state.version, STATE_VERSION) !== 0) {\r\n        newVersion = STATE_VERSION;\r\n        oldVersion = writer.state.version;\r\n      }\r\n\r\n      writer.push('appConfig', copy(STATE_INIT.appConfig));\r\n      writer.push('version', STATE_VERSION);\r\n      writer.push('build', BUILD);\r\n    }\r\n\r\n    return {newVersion, oldVersion};\r\n  },\r\n  CHANGED_AUTH: async(writer: ReturnType<typeof StateWriter>) => {\r\n    const [authKeyFingerprint, baseDcAuthKey] = await Promise.all([\r\n      sessionStorage.get('auth_key_fingerprint'),\r\n      sessionStorage.get(`dc${App.baseDcId}_auth_key`)\r\n    ]);\r\n\r\n    if(!baseDcAuthKey) {\r\n      return;\r\n    }\r\n\r\n    const _authKeyFingerprint = baseDcAuthKey.slice(0, 8);\r\n    if(!authKeyFingerprint) { // * migration, preserve settings\r\n      writer.reset(/* {preserveCommonKeys: ['settings']} */);\r\n    } else if(authKeyFingerprint !== _authKeyFingerprint) {\r\n      writer.reset();\r\n    }\r\n\r\n    if(authKeyFingerprint !== _authKeyFingerprint) {\r\n      await sessionStorage.set({\r\n        auth_key_fingerprint: _authKeyFingerprint\r\n      });\r\n    }\r\n  }\r\n  // STATE_ID: async(writer: ReturnType<typeof StateWriter>) => {\r\n  //   const stateId = await sessionStorage.get('state_id');\r\n  //   if(writer.state.stateId !== stateId) {\r\n  //     if(stateId !== undefined) {\r\n  //       writer.reset([]);\r\n  //     }\r\n\r\n  //     await sessionStorage.set({\r\n  //       state_id: writer.state.stateId\r\n  //     });\r\n  //   }\r\n  // }\r\n};\r\n\r\nasync function loadStateForAccount(accountNumber: ActiveAccountNumber): Promise<LoadStateResult> {\r\n  const log = logger(`STATE-LOADER-ACCOUNT-${accountNumber}`);\r\n  const stateStorage = new StateStorage(accountNumber);\r\n\r\n  const [accountData, ...arr] = await Promise.all([\r\n    AccountController.get(accountNumber),\r\n    ...COMMON_KEYS.map((key) => commonStateStorage.get(key)),\r\n    ...ALL_KEYS.map((key) => stateStorage.get(key))\r\n  ]);\r\n\r\n  const commonWriter = CommonStateWriter(log);\r\n  commonWriter.readFromArray(arr.splice(0, COMMON_KEYS.length));\r\n\r\n  const writer = StateWriter(log);\r\n  writer.readFromArray(arr);\r\n\r\n  if(accountData?.userId) {\r\n    writer.state.authState = {_: 'authStateSignedIn'};\r\n  }\r\n\r\n  // await STATE_STEPS.STATE_ID(writer);\r\n  if(accountNumber === 1) await STATE_STEPS.CHANGED_AUTH(writer);\r\n  STATE_STEPS.REFRESH(writer);\r\n  STATE_STEPS.VALIDATE(writer, STATE_INIT);\r\n  STATE_STEPS.VALIDATE(commonWriter, COMMON_STATE_INIT);\r\n  const {newVersion, oldVersion} = STATE_STEPS.VERSION(writer);\r\n\r\n  return {\r\n    state: writer.state,\r\n    pushedKeys: writer.pushedKeys,\r\n    newVersion,\r\n    oldVersion,\r\n    resetStorages: writer.resetStorages,\r\n    common: commonWriter.state,\r\n    userId: accountData?.userId\r\n  };\r\n}\r\n\r\nasync function loadOldState(): Promise<LoadStateResult> {\r\n  const log = logger('STATE-LOADER');\r\n  const stateStorage = new StateStorage('old');\r\n\r\n  const totalPerf = performance.now();\r\n  const recordPromise = recordPromiseBound(log);\r\n\r\n  const migrateToStateKeys = [\r\n    'playbackParams',\r\n    'chatContextMenuHintWasShown',\r\n    'seenTooltips',\r\n    'translations'\r\n  ];\r\n  const commonKeys = migrateToStateKeys.concat(COMMON_KEYS);\r\n\r\n  const arr = await Promise.all([\r\n    ...commonKeys.map((key) => (stateStorage as typeof commonStateStorage).get(key as any)),\r\n    ...ALL_KEYS.map((key) => recordPromise(stateStorage.get(key), 'state ' + key)),\r\n    (stateStorage as typeof commonStateStorage).get('langPack'),\r\n    recordPromise(sessionStorage.get('user_auth'), 'auth')\r\n  ]);\r\n\r\n  log.warn('promises', performance.now() - totalPerf);\r\n\r\n  const commonWriter = CommonStateWriter(log);\r\n  const migrateToStateSettingsValues = arr.splice(0, migrateToStateKeys.length);\r\n  const settingsKeyIndex = COMMON_KEYS.indexOf('settings');\r\n  if(isObject(arr[settingsKeyIndex])) { // * migrate values to settings\r\n    migrateToStateSettingsValues.forEach((value, i) => {\r\n      arr[settingsKeyIndex][migrateToStateKeys[i]] = value;\r\n    });\r\n  }\r\n  commonWriter.readFromArray(arr.splice(0, COMMON_KEYS.length));\r\n\r\n  const writer = StateWriter(log);\r\n  writer.readFromArray(arr.splice(0, ALL_KEYS.length));\r\n\r\n  const langPack = arr.shift();\r\n  const auth = arr.shift() as UserAuth | number;\r\n  if(auth) {\r\n    // ! Warning ! DON'T delete this\r\n    writer.state.authState = {_: 'authStateSignedIn'};\r\n  }\r\n\r\n  // await STATE_STEPS.STATE_ID(writer);\r\n  await STATE_STEPS.CHANGED_AUTH(writer);\r\n  STATE_STEPS.REFRESH(writer);\r\n  STATE_STEPS.VALIDATE(writer, STATE_INIT);\r\n  STATE_STEPS.VALIDATE(commonWriter, COMMON_STATE_INIT);\r\n  const {newVersion, oldVersion} = STATE_STEPS.VERSION(writer);\r\n\r\n  if(DEBUG) {\r\n    log('state res', writer.state, copy(writer.state));\r\n  }\r\n\r\n  log.warn('total', performance.now() - totalPerf);\r\n\r\n  // * set to pushed keys so it'll migrate to new state\r\n  for(const key in writer.state) {\r\n    writer.push(key as keyof State, writer.state[key as keyof State]);\r\n  }\r\n\r\n  // * migrate langPack\r\n  if(langPack) {\r\n    await commonStateStorage.set({langPack});\r\n  }\r\n\r\n  return {\r\n    state: writer.state,\r\n    pushedKeys: writer.pushedKeys,\r\n    newVersion,\r\n    oldVersion,\r\n    resetStorages: writer.resetStorages,\r\n    common: commonWriter.state,\r\n    userId: typeof(auth) === 'number' ? auth : (auth?.id ? +auth.id : undefined)\r\n  };\r\n}\r\n\r\nasync function moveAccessKeysToMultiAccountFormat() {\r\n  const data: Partial<AccountSessionData> = {};\r\n\r\n  const resetKeysPromise = (async() => {\r\n    const callbacks: (() => Promise<any>)[] = [];\r\n    for(let i = 1; i <= 5; i++) {\r\n      const authKeyKey = `dc${i as TrueDcId}_auth_key` as const;\r\n      const serverSaltKey = `dc${i as TrueDcId}_server_salt` as const;\r\n\r\n      [data[authKeyKey], data[serverSaltKey]] = await Promise.all([\r\n        sessionStorage.get(authKeyKey),\r\n        sessionStorage.get(serverSaltKey)\r\n      ]);\r\n\r\n      callbacks.push(() => {\r\n        return Promise.all([\r\n          sessionStorage.delete(authKeyKey),\r\n          sessionStorage.delete(serverSaltKey)\r\n        ]);\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      return Promise.all(callbacks.map((cb) => cb()));\r\n    };\r\n  })();\r\n\r\n  const [userAuth, fingerprint, resetKeys] = await Promise.all([\r\n    sessionStorage.get(`user_auth`),\r\n    sessionStorage.get(`auth_key_fingerprint`),\r\n    resetKeysPromise\r\n  ]);\r\n\r\n  // ! not clearing old keys for legacy\r\n  // * clear old keys\r\n  // await Promise.all([\r\n  //   sessionStorage.delete('user_auth'),\r\n  //   sessionStorage.delete('auth_key_fingerprint'),\r\n  //   resetKeys()\r\n  // ]);\r\n\r\n  data['auth_key_fingerprint'] = fingerprint;\r\n  data['userId'] = typeof(userAuth) === 'string' || typeof(userAuth) === 'number' ? +userAuth : (userAuth?.id ? +userAuth.id : undefined);\r\n\r\n  await AccountController.update(1, data, true);\r\n}\r\n\r\nasync function moveStoragesToMultiAccountFormat() {\r\n  const storages = createStorages(undefined);\r\n  const storagesNew = createStorages(1);\r\n  const [users, chats, dialogs] = await Promise.all([\r\n    storages.users.getAll(),\r\n    storages.chats.getAll(),\r\n    storages.dialogs.getAll()\r\n  ]);\r\n\r\n  const toObject = (arr: any[], prop: string) => {\r\n    return arr.reduce((acc, item) => {\r\n      acc[item[prop]] = item;\r\n      return acc;\r\n    }, {});\r\n  };\r\n\r\n  await Promise.all([\r\n    storagesNew.users.set(toObject(users, 'id')),\r\n    storagesNew.chats.set(toObject(chats, 'id')),\r\n    storagesNew.dialogs.set(toObject(dialogs, 'peerId'))\r\n  ]);\r\n}\r\n\r\nasync function checkIfHasMultiAccount() {\r\n  return !!(await AccountController.get(1));\r\n}\r\n\r\nfunction deleteOldDatabase() {\r\n  return IDB.deleteDatabaseByName(getOldDatabaseState().name);\r\n}\r\n\r\nasync function applyBuildVersionToStorage() {\r\n  const sessionBuild = await sessionStorage.get('k_build');\r\n  if(sessionBuild !== BUILD && (!sessionBuild || sessionBuild < BUILD)) {\r\n    await sessionStorage.set({k_build: BUILD});\r\n  }\r\n}\r\n\r\nasync function loadStateForAllAccounts() {\r\n  if(TEST_MULTI_MIGRATION) {\r\n    // * clear all storages to test migration\r\n    await Promise.all([1, 2, 3, 4].map(async(i) => {\r\n      const storages = createStorages(i as ActiveAccountNumber);\r\n      for(const key in storages) {\r\n        await storages[key as keyof typeof storages].clear();\r\n      }\r\n      await new StateStorage(i as ActiveAccountNumber).clear();\r\n    }));\r\n    await commonStateStorage.clear();\r\n  }\r\n\r\n  const perf = performance.now();\r\n  const hasMultiAccount = await checkIfHasMultiAccount() && !TEST_MULTI_MIGRATION;\r\n\r\n  // await pause(15000);\r\n\r\n  let stateForFirstAccount: LoadStateResult;\r\n\r\n  const restPromise = Promise.all([\r\n    loadStateForAccount(2),\r\n    loadStateForAccount(3),\r\n    loadStateForAccount(4)\r\n  ]);\r\n\r\n  if(!hasMultiAccount) {\r\n    stateForFirstAccount = await loadOldState();\r\n    await Promise.all([\r\n      moveAccessKeysToMultiAccountFormat(),\r\n      moveStoragesToMultiAccountFormat()\r\n    ]);\r\n    stateForFirstAccount.refetchStorages = true;\r\n\r\n    if(!TEST_MULTI_MIGRATION) {\r\n      deleteOldDatabase(); // * don't wait for the result\r\n    }\r\n  } else {\r\n    stateForFirstAccount = await loadStateForAccount(1);\r\n  }\r\n\r\n  applyBuildVersionToStorage();\r\n\r\n  const [...rest] = await restPromise;\r\n\r\n  if(DEBUG) {\r\n    console.log('loadStateForAllAccounts time', performance.now() - perf);\r\n  }\r\n\r\n  return {\r\n    1: stateForFirstAccount,\r\n    2: rest[0],\r\n    3: rest[1],\r\n    4: rest[2]\r\n  };\r\n}\r\n\r\nlet promise: ReturnType<typeof loadStateForAllAccounts>;\r\nexport default function loadStateForAllAccountsOnce() {\r\n  return promise ??= loadStateForAllAccounts();\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport IS_OPUS_SUPPORTED from '../environment/opusSupport';\r\nimport {IS_SAFARI} from '../environment/userAgent';\r\nimport {Modify} from '../types';\r\nimport {logger, LogTypes} from './logger';\r\nimport apiManagerProxy from './mtproto/mtprotoworker';\r\nimport type {ConvertWebPTask} from './webp/webpWorkerController';\r\n\r\ntype Result = {\r\n  bytes: Uint8Array,\r\n  waveform?: Uint8Array\r\n};\r\n\r\ntype Task = {\r\n  pages: Uint8Array,\r\n  withWaveform: boolean,\r\n  waveform?: Uint8Array,\r\n  callback: {resolve: (result: Result) => void, reject: (err: any) => void},\r\n  timeout: number\r\n};\r\n\r\nexport interface ConvertOpusTask extends Modify<ConvertWebPTask, {type: 'convertOpus'}> {\r\n  type: 'convertOpus'\r\n}\r\n\r\nexport class OpusDecodeController {\r\n  private worker: Worker;\r\n  private wavWorker: Worker;\r\n  private sampleRate = 48000;\r\n  private tasks: Array<Task> = [];\r\n  private keepAlive = false;\r\n  private log = logger('OPUS', LogTypes.Error);\r\n\r\n  public isPlaySupported() {\r\n    return IS_OPUS_SUPPORTED;\r\n  }\r\n\r\n  public loadWavWorker() {\r\n    if(this.wavWorker) return;\r\n\r\n    this.wavWorker = new Worker('waveWorker.min.js');\r\n    this.wavWorker.addEventListener('message', (e) => {\r\n      const data = e.data;\r\n\r\n      this.log('[WAV] got message:', data);\r\n      if(data && data.page) {\r\n        const bytes = data.page;\r\n        this.onTaskEnd(this.tasks.shift(), bytes);\r\n      }\r\n    });\r\n  }\r\n\r\n  public loadWorker() {\r\n    if(this.worker) return;\r\n\r\n    this.worker = new Worker('decoderWorker.min.js');\r\n    this.worker.addEventListener('message', (e) => {\r\n      const data = e.data;\r\n\r\n      this.log('[DECODER] got message', data);\r\n      if(data.type === 'done') {\r\n        // this.log('[DECODER] send done to wav');\r\n        this.wavWorker.postMessage({command: 'done'});\r\n\r\n        if(data.waveform) {\r\n          this.tasks[0].waveform = data.waveform;\r\n        }\r\n      } else { // e.data contains decoded buffers as float32 values\r\n        // this.log('[DECODER] send encode to wav');\r\n        this.wavWorker.postMessage({\r\n          command: 'encode',\r\n          buffers: e.data\r\n        }, IS_SAFARI ? undefined : data.map((typedArray: Uint8Array) => typedArray.buffer));\r\n      }\r\n    });\r\n  }\r\n\r\n  public setKeepAlive(keepAlive: boolean) {\r\n    this.keepAlive = keepAlive;\r\n    if(this.keepAlive) {\r\n      this.loadWorker();\r\n      this.loadWavWorker();\r\n    } else if(!this.tasks.length) {\r\n      this.terminateWorkers();\r\n    }\r\n  }\r\n\r\n  public onTaskEnd(task: Task, result?: Uint8Array) {\r\n    if(!result) {\r\n      task.callback.reject('timeout');\r\n    } else {\r\n      clearTimeout(task.timeout);\r\n      task.callback.resolve({bytes: result, waveform: task.waveform});\r\n    }\r\n\r\n    if(this.tasks.length) {\r\n      this.executeNewTask(this.tasks[0]);\r\n    }\r\n\r\n    this.terminateWorkers();\r\n  }\r\n\r\n  public terminateWorkers(kill = false) {\r\n    if((this.keepAlive || this.tasks.length) && !kill) return;\r\n\r\n    if(this.worker) {\r\n      this.worker.terminate();\r\n      this.worker = null;\r\n    }\r\n\r\n    if(this.wavWorker) {\r\n      this.wavWorker.terminate();\r\n      this.wavWorker = null;\r\n    }\r\n  }\r\n\r\n  public executeNewTask(task: Task) {\r\n    this.worker.postMessage({\r\n      command: 'init',\r\n      decoderSampleRate: this.sampleRate,\r\n      outputBufferSampleRate: this.sampleRate\r\n    });\r\n\r\n    this.wavWorker.postMessage({\r\n      command: 'init',\r\n      wavBitDepth: 16,\r\n      wavSampleRate: this.sampleRate\r\n    });\r\n\r\n    // console.log('sending command to worker:', task);\r\n    // setTimeout(() => {\r\n    this.log('[DECODER] send decode');\r\n    this.worker.postMessage({\r\n      command: 'decode',\r\n      pages: task.pages,\r\n      waveform: task.withWaveform\r\n    }, IS_SAFARI ? undefined : [task.pages.buffer]);\r\n    // }, 1e3);\r\n\r\n    task.timeout = window.setTimeout(() => {\r\n      this.log.error('decode timeout'/* , task */);\r\n\r\n      this.terminateWorkers(true);\r\n      if(this.tasks.length) {\r\n        this.loadWorker();\r\n        this.loadWavWorker();\r\n      }\r\n\r\n      this.onTaskEnd(this.tasks.shift());\r\n    }, 10e3);\r\n  }\r\n\r\n  public pushDecodeTask(pages: Uint8Array, withWaveform: boolean) {\r\n    return new Promise<Result>((resolve, reject) => {\r\n      const task = {\r\n        pages,\r\n        withWaveform,\r\n        callback: {resolve, reject},\r\n        timeout: 0\r\n      };\r\n\r\n      this.loadWorker();\r\n      this.loadWavWorker();\r\n\r\n      if(this.tasks.push(task) === 1) {\r\n        this.executeNewTask(task);\r\n      }\r\n    });\r\n  }\r\n\r\n  public async decode(typedArray: Uint8Array, withWaveform = false) {\r\n    return this.pushDecodeTask(typedArray, withWaveform).then(async(result) => {\r\n      const dataBlob = new Blob([result.bytes], {type: 'audio/wav'});\r\n      return {url: await apiManagerProxy.invoke('createObjectURL', dataBlob), waveform: result.waveform};\r\n    });\r\n  }\r\n}\r\n\r\nconst opusDecodeController = new OpusDecodeController();\r\nMOUNT_CLASS_TO.opusDecodeController = opusDecodeController;\r\nexport default opusDecodeController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n// https://www.iana.org/assignments/media-types/media-types.xhtml\r\nexport default function blobSafeMimeType(mimeType: string) {\r\n  if([\r\n    'image/jpeg',\r\n    'image/png',\r\n    'image/gif',\r\n    'image/svg+xml',\r\n    'image/webp',\r\n    'image/bmp',\r\n    'image/avif',\r\n    'image/jxl',\r\n    'video/mp4',\r\n    'video/webm',\r\n    'video/quicktime',\r\n    'audio/ogg',\r\n    'audio/mpeg',\r\n    'audio/mp4',\r\n    'audio/wav', // though it is not in list\r\n    'application/json',\r\n    'application/pdf'\r\n  ].indexOf(mimeType) === -1) {\r\n    return 'application/octet-stream';\r\n  }\r\n\r\n  return mimeType;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport toArray from '../array/toArray';\r\nimport blobSafeMimeType from './blobSafeMimeType';\r\n\r\nexport default function blobConstruct<T extends Uint8Array | string>(blobParts: Array<T> | T, mimeType: string = ''): Blob {\r\n  blobParts = toArray(blobParts);\r\n  const safeMimeType = blobSafeMimeType(mimeType);\r\n  const blob = new Blob(blobParts, {type: safeMimeType});\r\n  return blob;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { IS_WEB_WORKER } from \"../context\";\r\n\r\n// const id = IS_WEB_WORKER ? Math.random() * 0x1000 | 0 : 0;\r\nexport default function readBlobAs(blob: Blob, method: 'readAsText'): Promise<string>;\r\nexport default function readBlobAs(blob: Blob, method: 'readAsDataURL'): Promise<string>;\r\nexport default function readBlobAs(blob: Blob, method: 'readAsArrayBuffer'): Promise<ArrayBuffer>;\r\nexport default function readBlobAs(blob: Blob, method: 'readAsArrayBuffer' | 'readAsText' | 'readAsDataURL'): Promise<any> {\r\n  // const perf = performance.now();\r\n  return new Promise<any>((resolve) => {\r\n    const reader = new FileReader();\r\n    reader.addEventListener('loadend', (e) => {\r\n      // console.log(`readBlobAs [${id}] ${method} time ${performance.now() - perf}`);\r\n      resolve(e.target.result);\r\n    });\r\n    reader[method](blob);\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport readBlobAs from './readBlobAs';\r\n\r\nexport default function readBlobAsArrayBuffer(blob: Blob) {\r\n  return readBlobAs(blob, 'readAsArrayBuffer');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport readBlobAsArrayBuffer from './readBlobAsArrayBuffer';\r\n\r\nexport default function readBlobAsUint8Array(blob: Blob) {\r\n  return readBlobAsArrayBuffer(blob).then((buffer) => new Uint8Array(buffer));\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport StreamWriter from './streamWriter';\r\n\r\nexport default class MemoryWriter implements StreamWriter {\r\n  private bytes: Uint8Array;\r\n\r\n  constructor(\r\n    private mimeType: string,\r\n    private size: number,\r\n    private saveFileCallback?: (blob: Blob) => Promise<Blob>\r\n  ) {\r\n    this.bytes = new Uint8Array(size);\r\n  }\r\n\r\n  public async write(part: Uint8Array, offset: number) {\r\n    // sometimes file size can be bigger than the prov\r\n    const endOffset = offset + part.byteLength;\r\n    if(endOffset > this.bytes.byteLength) {\r\n      const newBytes = new Uint8Array(endOffset);\r\n      newBytes.set(this.bytes, 0);\r\n      this.bytes = newBytes;\r\n    }\r\n\r\n    this.bytes.set(part, offset);\r\n  };\r\n\r\n  public truncate() {\r\n    this.bytes = new Uint8Array();\r\n  }\r\n\r\n  public trim(size: number) {\r\n    this.bytes = this.bytes.slice(0, size);\r\n  }\r\n\r\n  public finalize(saveToStorage = true) {\r\n    const blob = blobConstruct(this.bytes, this.mimeType);\r\n\r\n    if(saveToStorage && this.saveFileCallback) {\r\n      this.saveFileCallback(blob);\r\n    }\r\n\r\n    return blob;\r\n  }\r\n\r\n  public getParts() {\r\n    return this.bytes;\r\n  }\r\n\r\n  public replaceParts(parts: Uint8Array) {\r\n    this.bytes = parts;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Modes from '../../config/modes';\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport makeError from '../../helpers/makeError';\r\nimport readBlobAsUint8Array from '../../helpers/blob/readBlobAsUint8Array';\r\n\r\nimport EncryptionKeyStore from '../passcode/keyStore';\r\nimport cryptoMessagePort from '../crypto/cryptoMessagePort';\r\nimport DeferredIsUsingPasscode from '../passcode/deferredIsUsingPasscode';\r\n\r\nimport MemoryWriter from './memoryWriter';\r\nimport FileStorage from './fileStorage';\r\n\r\n\r\ntype CacheStorageDbConfigEntry = {\r\n  encryptable: boolean;\r\n};\r\n\r\nconst cacheStorageDbConfig = {\r\n  cachedAssets: {\r\n    encryptable: false\r\n  },\r\n  cachedBackgrounds: {\r\n    encryptable: false\r\n  },\r\n  cachedFiles: {\r\n    encryptable: true\r\n  },\r\n  cachedStreamChunks: {\r\n    encryptable: true\r\n  },\r\n  cachedHlsQualityFiles: {\r\n    encryptable: true\r\n  },\r\n  cachedHlsStreamChunks: {\r\n    encryptable: true\r\n  }\r\n} satisfies Record<string, CacheStorageDbConfigEntry>;\r\n\r\nexport type CacheStorageDbName = keyof typeof cacheStorageDbConfig;\r\n\r\nexport default class CacheStorageController implements FileStorage {\r\n  private static STORAGES: CacheStorageController[] = [];\r\n  private openDbPromise: Promise<Cache>;\r\n  private config: CacheStorageDbConfigEntry;\r\n\r\n  private useStorage = true;\r\n\r\n  private static disabledPromise: CancellablePromise<void>;\r\n\r\n  // private log: ReturnType<typeof logger> = logger('CS');\r\n\r\n  constructor(private dbName: CacheStorageDbName) {\r\n    if(Modes.test) {\r\n      this.dbName += '_test';\r\n    }\r\n\r\n    if(CacheStorageController.STORAGES.length) {\r\n      this.useStorage = CacheStorageController.STORAGES[0].useStorage;\r\n    }\r\n\r\n    this.config = Object.entries(cacheStorageDbConfig).find(([name]) => name === dbName)?.[1];\r\n\r\n    this.openDatabase();\r\n    CacheStorageController.STORAGES.push(this);\r\n  }\r\n\r\n  private static async encrypt(blob: Blob) {\r\n    const key = await EncryptionKeyStore.get();\r\n    const dataAsBuffer = await readBlobAsUint8Array(blob);\r\n\r\n    const type = blob.type;\r\n\r\n    console.log('[my-debug] encryption started');\r\n    const result = await cryptoMessagePort.invokeCryptoNew({\r\n      method: 'aes-local-encrypt',\r\n      args: [{\r\n        key,\r\n        data: dataAsBuffer\r\n      }],\r\n      transfer: [dataAsBuffer.buffer]\r\n    });\r\n    console.log('[my-debug] encryption ended');\r\n\r\n    return new Blob([result], {type});\r\n  }\r\n\r\n  private static async decrypt(blob: Blob) {\r\n    const key = await EncryptionKeyStore.get();\r\n    const dataAsBuffer = await readBlobAsUint8Array(blob);\r\n\r\n    const type = blob.type;\r\n\r\n    console.log('[my-debug] decryption started');\r\n\r\n    const result = await cryptoMessagePort.invokeCryptoNew({\r\n      method: 'aes-local-decrypt',\r\n      args: [{\r\n        key,\r\n        encryptedData: dataAsBuffer\r\n      }],\r\n      transfer: [dataAsBuffer.buffer]\r\n    });\r\n\r\n    console.log('[my-debug] decryption ended');\r\n\r\n    return new Blob([result], {type});\r\n  }\r\n\r\n  private async waitToEnable() {\r\n    if(CacheStorageController.disabledPromise) await CacheStorageController.disabledPromise;\r\n  }\r\n\r\n  private openDatabase(): Promise<Cache> {\r\n    return this.openDbPromise ?? (this.openDbPromise = caches.open(this.dbName));\r\n  }\r\n\r\n  public delete(entryName: string) {\r\n    return this.timeoutOperation((cache) => cache.delete('/' + entryName));\r\n  }\r\n\r\n  public deleteAll() {\r\n    return caches.delete(this.dbName);\r\n  }\r\n\r\n  public async has(entryName: string) {\r\n    const response = await this.timeoutOperation((cache) => cache.match('/' + entryName));\r\n    return !!response;\r\n  }\r\n\r\n  public async get(entryName: string) {\r\n    await this.waitToEnable();\r\n\r\n    const response = await this.timeoutOperation((cache) => cache.match('/' + entryName));\r\n    if(!response) return undefined;\r\n\r\n    if(this.config?.encryptable && await DeferredIsUsingPasscode.isUsingPasscode()) {\r\n      return new Response(\r\n        await CacheStorageController.decrypt(await response.blob()),\r\n        {\r\n          headers: response.headers,\r\n          status: response.status,\r\n          statusText: response.statusText\r\n        }\r\n      );\r\n    }\r\n\r\n    return response;\r\n  }\r\n\r\n  public async save(entryName: string, response: Response) {\r\n    await this.waitToEnable();\r\n\r\n    let result = response;\r\n\r\n    if(this.config?.encryptable && await DeferredIsUsingPasscode.isUsingPasscode()) {\r\n      result = new Response(\r\n        await CacheStorageController.encrypt(await response.blob()),\r\n        {\r\n          headers: response.headers,\r\n          status: response.status,\r\n          statusText: response.statusText\r\n        }\r\n      );\r\n    }\r\n\r\n    return this.timeoutOperation((cache) => cache.put('/' + entryName, result));\r\n  }\r\n\r\n  public getFile(fileName: string, method: 'blob' | 'json' | 'text' = 'blob'): Promise<any> {\r\n    // if(method === 'blob') {\r\n    //   return Promise.reject(makeError('NO_ENTRY_FOUND'));\r\n    // }\r\n\r\n    // const str = `get fileName: ${fileName}`;\r\n    // console.time(str);\r\n    return this.get(fileName).then((response) => {\r\n      if(!response) {\r\n        // console.warn('getFile:', response, fileName);\r\n        throw makeError('NO_ENTRY_FOUND');\r\n      }\r\n\r\n      const promise = response[method]();\r\n      // promise.then(() => {\r\n      //   console.timeEnd(str);\r\n      // });\r\n      return promise;\r\n    });\r\n  }\r\n\r\n  public saveFile(fileName: string, blob: Blob | Uint8Array) {\r\n    // return Promise.resolve(blobConstruct([blob]));\r\n    if(!(blob instanceof Blob)) {\r\n      blob = blobConstruct(blob);\r\n    }\r\n\r\n    const response = new Response(blob, {\r\n      headers: {\r\n        'Content-Length': '' + blob.size\r\n      }\r\n    });\r\n\r\n    return this.save(fileName, response).then(() => blob as Blob);\r\n  }\r\n\r\n  public timeoutOperation<T>(callback: (cache: Cache) => Promise<T>) {\r\n    if(!this.useStorage) {\r\n      return Promise.reject(makeError('STORAGE_OFFLINE'));\r\n    }\r\n\r\n    return new Promise<T>(async(resolve, reject) => {\r\n      let rejected = false;\r\n      const timeout = setTimeout(() => {\r\n        reject();\r\n        // console.warn('CACHESTORAGE TIMEOUT');\r\n        rejected = true;\r\n      }, 15e3);\r\n\r\n      try {\r\n        const cache = await this.openDatabase();\r\n        if(!cache) {\r\n          this.useStorage = false;\r\n          this.openDbPromise = undefined;\r\n          throw 'no cache?';\r\n        }\r\n\r\n        const res = await callback(cache);\r\n\r\n        if(rejected) return;\r\n        resolve(res);\r\n      } catch(err) {\r\n        reject(err);\r\n      }\r\n\r\n      clearTimeout(timeout);\r\n    });\r\n  }\r\n\r\n  public prepareWriting(fileName: string, fileSize: number, mimeType: string) {\r\n    return {\r\n      deferred: deferredPromise<Blob>(),\r\n      getWriter: () => {\r\n        const writer = new MemoryWriter(mimeType, fileSize, (blob) => {\r\n          return this.saveFile(fileName, blob).catch(() => blob);\r\n        });\r\n\r\n        return writer;\r\n      }\r\n    };\r\n  }\r\n\r\n  public static toggleStorage(enabled: boolean, _clearWrite: boolean) {\r\n    this.STORAGES.forEach((storage) => {\r\n      storage.useStorage = enabled;\r\n    });\r\n    return Promise.resolve();\r\n  }\r\n\r\n  public static async deleteAllStorages() {\r\n    const storageNames = Object.keys(cacheStorageDbConfig) as CacheStorageDbName[];\r\n\r\n    await Promise.all(storageNames.map(async(storageName) => {\r\n      const storage = new CacheStorageController(storageName);\r\n      await storage.deleteAll();\r\n    }));\r\n  }\r\n\r\n\r\n  public static temporarilyToggle(enabled: boolean) {\r\n    if(enabled) {\r\n      this.disabledPromise?.resolve();\r\n      this.disabledPromise = undefined;\r\n    } else {\r\n      this.disabledPromise = deferredPromise();\r\n    }\r\n  }\r\n\r\n  public static async clearEncryptableStorages() {\r\n    const encryptableStorageNames = Object.entries(cacheStorageDbConfig)\r\n    .filter(([, {encryptable}]) => encryptable)\r\n    .map(([name]) => name) as CacheStorageDbName[];\r\n\r\n    await Promise.all(encryptableStorageNames.map(async(storageName) => {\r\n      // Make sure we have all encryptable storages in current thread, can't get from .STORAGES\r\n      const storage = new CacheStorageController(storageName);\r\n\r\n      // await storage.deleteAll();\r\n      await storage.timeoutOperation(async(cache) => {\r\n        const keys = await cache.keys();\r\n        await Promise.all(keys.map(request => cache.delete(request)));\r\n      });\r\n    }));\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport CacheStorageController from '../lib/files/cacheStorage';\r\nimport AppStorage from '../lib/storage';\r\nimport sessionStorage from '../lib/sessionStorage';\r\nimport noop from './noop';\r\n\r\nexport default function toggleStorages(enabled: boolean, clearWrite: boolean) {\r\n  return Promise.all([\r\n    AppStorage.toggleStorage(enabled, clearWrite),\r\n    CacheStorageController.toggleStorage(enabled, clearWrite),\r\n    sessionStorage.toggleStorage(enabled, clearWrite)\r\n  ]).then(noop, noop);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {WebPushApiManager} from '../mtproto/webPushApiManager';\r\nimport type {PushNotificationObject} from './push';\r\nimport type {MyUploadFile} from '../mtproto/apiFileManager';\r\nimport type {Document, InputFileLocation, InputGroupCall} from '../../layer';\r\nimport type {GroupCallRtmpState} from '../appManagers/appGroupCallsManager';\r\nimport type {ActiveAccountNumber} from '../accounts/types';\r\nimport type {getEnvironment} from '../../environment/utils';\r\nimport type {ToggleUsingPasscodePayload} from '../mtproto/mtprotoMessagePort';\r\nimport SuperMessagePort from '../mtproto/superMessagePort';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\n\r\nexport type ServicePushPingTaskPayload = {\r\n  localNotifications: boolean,\r\n  lang: {\r\n    push_action_mute1d: string\r\n    push_action_settings: string\r\n    push_message_nopreview: string\r\n  },\r\n  settings: WebPushApiManager['settings']\r\n};\r\n\r\nexport type ServiceRequestFilePartTaskPayload = {\r\n  docId: DocId,\r\n  dcId: number,\r\n  offset: number,\r\n  limit: number,\r\n  accountNumber: ActiveAccountNumber\r\n};\r\n\r\nexport type ServiceRequestRtmpPartTaskPayload = {\r\n  request: InputFileLocation.inputGroupCallStream,\r\n  dcId: number,\r\n  accountNumber: ActiveAccountNumber\r\n};\r\n\r\nexport type ServiceDownloadTaskPayload = {\r\n  headers: any,\r\n  id: string\r\n};\r\n\r\nexport type ServiceEvent = {\r\n  port: (payload: void, source: MessageEventSource, event: MessageEvent) => void\r\n};\r\n\r\nexport default class ServiceMessagePort<Master extends boolean = false> extends SuperMessagePort<{\r\n  // from main thread to service worker\r\n  environment: (environment: ReturnType<typeof getEnvironment>) => void,\r\n  notificationsClear: () => void,\r\n  toggleStorages: (payload: {enabled: boolean, clearWrite: boolean}) => void,\r\n  pushPing: (payload: ServicePushPingTaskPayload, source: MessageEventSource, event: MessageEvent) => void,\r\n  hello: (payload: void, source: MessageEventSource, event: MessageEvent) => void,\r\n  shownNotification: (payload: string) => void,\r\n  leaveRtmpCall: (payload: [Long, boolean]) => void,\r\n  toggleStreamInUse: (payload: {url: string, inUse: boolean, accountNumber: ActiveAccountNumber}) => void,\r\n  toggleCacheStorage: (value: boolean) => void,\r\n  toggleUsingPasscode: (payload: ToggleUsingPasscodePayload, source: MessageEventSource) => void,\r\n  saveEncryptionKey: (payload: CryptoKey) => void,\r\n\r\n  // from mtproto worker\r\n  download: (payload: ServiceDownloadTaskPayload) => void,\r\n  downloadChunk: (payload: {id: ServiceDownloadTaskPayload['id'], chunk: Uint8Array}) => void\r\n  downloadFinalize: (payload: ServiceDownloadTaskPayload['id']) => void,\r\n  downloadCancel: (payload: ServiceDownloadTaskPayload['id']) => void,\r\n}, {\r\n  // to main thread\r\n  pushClick: (payload: PushNotificationObject) => void,\r\n  hello: (payload: void, source: MessageEventSource) => void,\r\n  share: (payload: ShareData) => void,\r\n  rtmpStreamTime: (payload: {callId: Long, time: string}) => void,\r\n  rtmpStreamDestroyed: (payload: Long) => void,\r\n  downloadRequestReceived: (payload: string) => void,\r\n  serviceCryptoPort: (payload: undefined, source: MessageEventSource, event: MessageEvent) => void,\r\n\r\n  // to mtproto worker\r\n  requestFilePart: (payload: ServiceRequestFilePartTaskPayload) => MaybePromise<MyUploadFile>,\r\n  cancelFilePartRequests: (payload: {docId: DocId, accountNumber: ActiveAccountNumber}) => void,\r\n  requestRtmpState: (payload: {call: InputGroupCall, accountNumber: ActiveAccountNumber}) => MaybePromise<GroupCallRtmpState>,\r\n  requestRtmpPart: (payload: ServiceRequestRtmpPartTaskPayload) => MaybePromise<MyUploadFile>,\r\n  downloadDoc: (payload: {docId: DocId, accountNumber: ActiveAccountNumber}) => MaybePromise<Blob>,\r\n  requestDoc: (payload: {docId: DocId, accountNumber: ActiveAccountNumber}) => MaybePromise<Document.document>,\r\n  requestAltDocsByDoc: (payload: {docId: DocId, accountNumber: ActiveAccountNumber}) => MaybePromise<Document.document[]>,\r\n} & ServiceEvent, Master> {\r\n  constructor() {\r\n    super('SERVICE');\r\n\r\n    MOUNT_CLASS_TO && (MOUNT_CLASS_TO.serviceMessagePort = this);\r\n  }\r\n}\r\n","export const DEEP_PATH_JOINER = '\\x01';\r\n\r\nexport function joinDeepPath(...args: any[]) {\r\n  return args.join(DEEP_PATH_JOINER);\r\n}\r\n\r\nexport function splitDeepPath(path: string) {\r\n  return path.split(DEEP_PATH_JOINER);\r\n}\r\n\r\nexport default function setDeepProperty(\r\n  object: any,\r\n  key: string,\r\n  value?: any,\r\n  deleteIfUndefined?: boolean\r\n) {\r\n  const splitted = key.split(DEEP_PATH_JOINER);\r\n  const length = splitted.length;\r\n  let lastObject = object/* , fractalPart: string */; // fix fractal number key\r\n  for(let i = 0; i < length - 1; ++i) {\r\n    const part = splitted[i];\r\n    // if(fractalPart) {\r\n    //   part = fractalPart + '.' + part;\r\n    //   fractalPart = undefined;\r\n    // } else if(!Number.isNaN(+part)) {\r\n    //   fractalPart = part;\r\n    //   continue;\r\n    // }\r\n    lastObject = lastObject[part] ??= {};\r\n  }\r\n\r\n  const lastKey = /* (fractalPart ? fractalPart + '.' : '') +  */splitted[length - 1];\r\n  if(value === undefined && deleteIfUndefined/*  && arguments.length === 2 */) {\r\n    delete lastObject[lastKey];\r\n  } else {\r\n    lastObject[lastKey] = value;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {InputFileLocation, InputGeoPoint, InputStickerSet, InputWebFileLocation} from '../layer';\r\nimport type {DownloadOptions} from '../lib/mtproto/apiFileManager';\r\n\r\nconst FILENAME_JOINER = '_';\r\n\r\nexport function getFileNameByLocation(location: InputFileLocation | InputWebFileLocation, options?: Partial<{\r\n  fileName: string,\r\n  downloadId: string\r\n}>) {\r\n  const fileName = '';// (options?.fileName || '').split('.');\r\n  const ext = fileName[fileName.length - 1] || '';\r\n\r\n  let str: string;\r\n  switch(location._) {\r\n    case 'inputPhotoFileLocation': {\r\n      str = ['photo', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputDocumentFileLocation': {\r\n      str = ['document', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputPeerPhotoFileLocation':\r\n      str = ['peerPhoto', location.photo_id, location.pFlags.big ? 'big' : 'small'].join(FILENAME_JOINER);\r\n      break;\r\n\r\n    case 'inputStickerSetThumb': {\r\n      const id = (location.stickerset as InputStickerSet.inputStickerSetID).id ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetShortName).short_name ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetDice).emoticon ||\r\n        location.stickerset._;\r\n      str = ['stickerSetThumb', id, location.thumb_version].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputFileLocation': {\r\n      str = [location.volume_id, location.local_id].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputWebFileLocation': {\r\n      str = ['webFile', location.url].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputWebFileGeoPointLocation': {\r\n      const geoPoint = location.geo_point as InputGeoPoint.inputGeoPoint;\r\n      str = ['geoPoint', geoPoint.lat, geoPoint.long, location.w, location.h, location.zoom, location.scale].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      console.error('Unrecognized location:', location);\r\n      str = '';\r\n      break;\r\n    }\r\n  }\r\n\r\n  return str + (options?.downloadId ? '_download' : '') + (ext ? '.' + ext : ext);\r\n}\r\n\r\nexport type FileURLType = 'photo' | 'thumb' | 'document' | 'stream' | 'download' | 'hls';\r\nexport function getFileURL(type: FileURLType, options: DownloadOptions) {\r\n  // console.log('getFileURL', location);\r\n  // const perf = performance.now();\r\n  const encoded = encodeURIComponent(JSON.stringify(options));\r\n  // console.log('getFileURL encode:', performance.now() - perf, encoded);\r\n\r\n  return /* '/' +  */type + '/' + encoded;\r\n}\r\n","import {InputWebFileLocation} from '../../../../layer';\r\n\r\nexport default function isWebFileLocation(location: any): location is InputWebFileLocation {\r\n  return location?._.includes('inputWebFile');\r\n}\r\n","import type {MyPhoto} from '../../../appManagers/appPhotosManager';\r\nimport type {ThumbStorageMedia} from '../../thumbs';\r\nimport type {WebDocument} from '../../../../layer';\r\nimport {getFileNameByLocation} from '../../../../helpers/fileName';\r\nimport isWebFileLocation from '../../../appManagers/utils/webFiles/isWebFileLocation';\r\n\r\nexport default function getThumbKey(media: ThumbStorageMedia) {\r\n  if(isWebFileLocation(media)) {\r\n    return getFileNameByLocation(media);\r\n  }\r\n\r\n  return media._ + ((media as MyPhoto).id ?? (media as WebDocument).url);\r\n}\r\n","import type {ThumbCache} from '../../thumbs';\r\n\r\nexport default function generateEmptyThumb(type: string): ThumbCache {\r\n  return {downloaded: 0, url: '', type};\r\n}\r\n","export default function getStickerThumbKey(docId: DocId, toneIndex?: number | string) {\r\n  return docId + (toneIndex !== undefined ? '-' + toneIndex : '');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Awaited} from '../types';\r\n\r\nexport default function callbackify<T extends Awaited<any>, R>(\r\n  smth: T,\r\n  callback: (result: Awaited<T>) => R\r\n): T extends Promise<any> ? Promise<Awaited<R>> : R {\r\n  if(smth instanceof Promise) {\r\n    // @ts-ignore\r\n    return smth.then(callback);\r\n  } else {\r\n    return callback(smth as any) as any;\r\n  }\r\n}\r\n","import {MESSAGE_ID_OFFSET} from '../../../mtproto/mtproto_config';\r\n\r\nexport default function isLegacyMessageId(messageId: number) {\r\n  return typeof(messageId) === 'number' && messageId < MESSAGE_ID_OFFSET;\r\n}\r\n","import { $PROXY, $TRACK, getListener, batch, createSignal } from 'solid-js';\r\n\r\nconst $RAW = Symbol(\"store-raw\"),\r\n  $NODE = Symbol(\"store-node\"),\r\n  $HAS = Symbol(\"store-has\"),\r\n  $SELF = Symbol(\"store-self\");\r\nfunction wrap$1(value) {\r\n  let p = value[$PROXY];\r\n  if (!p) {\r\n    Object.defineProperty(value, $PROXY, {\r\n      value: p = new Proxy(value, proxyTraps$1)\r\n    });\r\n    if (!Array.isArray(value)) {\r\n      const keys = Object.keys(value),\r\n        desc = Object.getOwnPropertyDescriptors(value);\r\n      for (let i = 0, l = keys.length; i < l; i++) {\r\n        const prop = keys[i];\r\n        if (desc[prop].get) {\r\n          Object.defineProperty(value, prop, {\r\n            enumerable: desc[prop].enumerable,\r\n            get: desc[prop].get.bind(p)\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return p;\r\n}\r\nfunction isWrappable(obj) {\r\n  let proto;\r\n  return obj != null && typeof obj === \"object\" && (obj[$PROXY] || !(proto = Object.getPrototypeOf(obj)) || proto === Object.prototype || Array.isArray(obj));\r\n}\r\nfunction unwrap(item, set = new Set()) {\r\n  let result, unwrapped, v, prop;\r\n  if (result = item != null && item[$RAW]) return result;\r\n  if (!isWrappable(item) || set.has(item)) return item;\r\n  if (Array.isArray(item)) {\r\n    if (Object.isFrozen(item)) item = item.slice(0);else set.add(item);\r\n    for (let i = 0, l = item.length; i < l; i++) {\r\n      v = item[i];\r\n      if ((unwrapped = unwrap(v, set)) !== v) item[i] = unwrapped;\r\n    }\r\n  } else {\r\n    if (Object.isFrozen(item)) item = Object.assign({}, item);else set.add(item);\r\n    const keys = Object.keys(item),\r\n      desc = Object.getOwnPropertyDescriptors(item);\r\n    for (let i = 0, l = keys.length; i < l; i++) {\r\n      prop = keys[i];\r\n      if (desc[prop].get) continue;\r\n      v = item[prop];\r\n      if ((unwrapped = unwrap(v, set)) !== v) item[prop] = unwrapped;\r\n    }\r\n  }\r\n  return item;\r\n}\r\nfunction getNodes(target, symbol) {\r\n  let nodes = target[symbol];\r\n  if (!nodes) Object.defineProperty(target, symbol, {\r\n    value: nodes = Object.create(null)\r\n  });\r\n  return nodes;\r\n}\r\nfunction getNode(nodes, property, value) {\r\n  if (nodes[property]) return nodes[property];\r\n  const [s, set] = createSignal(value, {\r\n    equals: false,\r\n    internal: true\r\n  });\r\n  s.$ = set;\r\n  return nodes[property] = s;\r\n}\r\nfunction proxyDescriptor$1(target, property) {\r\n  const desc = Reflect.getOwnPropertyDescriptor(target, property);\r\n  if (!desc || desc.get || !desc.configurable || property === $PROXY || property === $NODE) return desc;\r\n  delete desc.value;\r\n  delete desc.writable;\r\n  desc.get = () => target[$PROXY][property];\r\n  return desc;\r\n}\r\nfunction trackSelf(target) {\r\n  getListener() && getNode(getNodes(target, $NODE), $SELF)();\r\n}\r\nfunction ownKeys(target) {\r\n  trackSelf(target);\r\n  return Reflect.ownKeys(target);\r\n}\r\nconst proxyTraps$1 = {\r\n  get(target, property, receiver) {\r\n    if (property === $RAW) return target;\r\n    if (property === $PROXY) return receiver;\r\n    if (property === $TRACK) {\r\n      trackSelf(target);\r\n      return receiver;\r\n    }\r\n    const nodes = getNodes(target, $NODE);\r\n    const tracked = nodes[property];\r\n    let value = tracked ? tracked() : target[property];\r\n    if (property === $NODE || property === $HAS || property === \"__proto__\") return value;\r\n    if (!tracked) {\r\n      const desc = Object.getOwnPropertyDescriptor(target, property);\r\n      if (getListener() && (typeof value !== \"function\" || target.hasOwnProperty(property)) && !(desc && desc.get)) value = getNode(nodes, property, value)();\r\n    }\r\n    return isWrappable(value) ? wrap$1(value) : value;\r\n  },\r\n  has(target, property) {\r\n    if (property === $RAW || property === $PROXY || property === $TRACK || property === $NODE || property === $HAS || property === \"__proto__\") return true;\r\n    getListener() && getNode(getNodes(target, $HAS), property)();\r\n    return property in target;\r\n  },\r\n  set() {\r\n    return true;\r\n  },\r\n  deleteProperty() {\r\n    return true;\r\n  },\r\n  ownKeys: ownKeys,\r\n  getOwnPropertyDescriptor: proxyDescriptor$1\r\n};\r\nfunction setProperty(state, property, value, deleting = false) {\r\n  if (!deleting && state[property] === value) return;\r\n  const prev = state[property],\r\n    len = state.length;\r\n  if (value === undefined) {\r\n    delete state[property];\r\n    if (state[$HAS] && state[$HAS][property] && prev !== undefined) state[$HAS][property].$();\r\n  } else {\r\n    state[property] = value;\r\n    if (state[$HAS] && state[$HAS][property] && prev === undefined) state[$HAS][property].$();\r\n  }\r\n  let nodes = getNodes(state, $NODE),\r\n    node;\r\n  if (node = getNode(nodes, property, prev)) node.$(() => value);\r\n  if (Array.isArray(state) && state.length !== len) {\r\n    for (let i = state.length; i < len; i++) (node = nodes[i]) && node.$();\r\n    (node = getNode(nodes, \"length\", len)) && node.$(state.length);\r\n  }\r\n  (node = nodes[$SELF]) && node.$();\r\n}\r\nfunction mergeStoreNode(state, value) {\r\n  const keys = Object.keys(value);\r\n  for (let i = 0; i < keys.length; i += 1) {\r\n    const key = keys[i];\r\n    setProperty(state, key, value[key]);\r\n  }\r\n}\r\nfunction updateArray(current, next) {\r\n  if (typeof next === \"function\") next = next(current);\r\n  next = unwrap(next);\r\n  if (Array.isArray(next)) {\r\n    if (current === next) return;\r\n    let i = 0,\r\n      len = next.length;\r\n    for (; i < len; i++) {\r\n      const value = next[i];\r\n      if (current[i] !== value) setProperty(current, i, value);\r\n    }\r\n    setProperty(current, \"length\", len);\r\n  } else mergeStoreNode(current, next);\r\n}\r\nfunction updatePath(current, path, traversed = []) {\r\n  let part,\r\n    prev = current;\r\n  if (path.length > 1) {\r\n    part = path.shift();\r\n    const partType = typeof part,\r\n      isArray = Array.isArray(current);\r\n    if (Array.isArray(part)) {\r\n      for (let i = 0; i < part.length; i++) {\r\n        updatePath(current, [part[i]].concat(path), traversed);\r\n      }\r\n      return;\r\n    } else if (isArray && partType === \"function\") {\r\n      for (let i = 0; i < current.length; i++) {\r\n        if (part(current[i], i)) updatePath(current, [i].concat(path), traversed);\r\n      }\r\n      return;\r\n    } else if (isArray && partType === \"object\") {\r\n      const {\r\n        from = 0,\r\n        to = current.length - 1,\r\n        by = 1\r\n      } = part;\r\n      for (let i = from; i <= to; i += by) {\r\n        updatePath(current, [i].concat(path), traversed);\r\n      }\r\n      return;\r\n    } else if (path.length > 1) {\r\n      updatePath(current[part], path, [part].concat(traversed));\r\n      return;\r\n    }\r\n    prev = current[part];\r\n    traversed = [part].concat(traversed);\r\n  }\r\n  let value = path[0];\r\n  if (typeof value === \"function\") {\r\n    value = value(prev, traversed);\r\n    if (value === prev) return;\r\n  }\r\n  if (part === undefined && value == undefined) return;\r\n  value = unwrap(value);\r\n  if (part === undefined || isWrappable(prev) && isWrappable(value) && !Array.isArray(value)) {\r\n    mergeStoreNode(prev, value);\r\n  } else setProperty(current, part, value);\r\n}\r\nfunction createStore(...[store, options]) {\r\n  const unwrappedStore = unwrap(store || {});\r\n  const isArray = Array.isArray(unwrappedStore);\r\n  const wrappedStore = wrap$1(unwrappedStore);\r\n  function setStore(...args) {\r\n    batch(() => {\r\n      isArray && args.length === 1 ? updateArray(unwrappedStore, args[0]) : updatePath(unwrappedStore, args);\r\n    });\r\n  }\r\n  return [wrappedStore, setStore];\r\n}\r\n\r\nfunction proxyDescriptor(target, property) {\r\n  const desc = Reflect.getOwnPropertyDescriptor(target, property);\r\n  if (!desc || desc.get || desc.set || !desc.configurable || property === $PROXY || property === $NODE) return desc;\r\n  delete desc.value;\r\n  delete desc.writable;\r\n  desc.get = () => target[$PROXY][property];\r\n  desc.set = v => target[$PROXY][property] = v;\r\n  return desc;\r\n}\r\nconst proxyTraps = {\r\n  get(target, property, receiver) {\r\n    if (property === $RAW) return target;\r\n    if (property === $PROXY) return receiver;\r\n    if (property === $TRACK) {\r\n      trackSelf(target);\r\n      return receiver;\r\n    }\r\n    const nodes = getNodes(target, $NODE);\r\n    const tracked = nodes[property];\r\n    let value = tracked ? tracked() : target[property];\r\n    if (property === $NODE || property === $HAS || property === \"__proto__\") return value;\r\n    if (!tracked) {\r\n      const desc = Object.getOwnPropertyDescriptor(target, property);\r\n      const isFunction = typeof value === \"function\";\r\n      if (getListener() && (!isFunction || target.hasOwnProperty(property)) && !(desc && desc.get)) value = getNode(nodes, property, value)();else if (value != null && isFunction && value === Array.prototype[property]) {\r\n        return (...args) => batch(() => Array.prototype[property].apply(receiver, args));\r\n      }\r\n    }\r\n    return isWrappable(value) ? wrap(value) : value;\r\n  },\r\n  has(target, property) {\r\n    if (property === $RAW || property === $PROXY || property === $TRACK || property === $NODE || property === $HAS || property === \"__proto__\") return true;\r\n    getListener() && getNode(getNodes(target, $HAS), property)();\r\n    return property in target;\r\n  },\r\n  set(target, property, value) {\r\n    batch(() => setProperty(target, property, unwrap(value)));\r\n    return true;\r\n  },\r\n  deleteProperty(target, property) {\r\n    batch(() => setProperty(target, property, undefined, true));\r\n    return true;\r\n  },\r\n  ownKeys: ownKeys,\r\n  getOwnPropertyDescriptor: proxyDescriptor\r\n};\r\nfunction wrap(value) {\r\n  let p = value[$PROXY];\r\n  if (!p) {\r\n    Object.defineProperty(value, $PROXY, {\r\n      value: p = new Proxy(value, proxyTraps)\r\n    });\r\n    const keys = Object.keys(value),\r\n      desc = Object.getOwnPropertyDescriptors(value);\r\n    const proto = Object.getPrototypeOf(value);\r\n    const isClass = value !== null && typeof value === \"object\" && !Array.isArray(value) && proto !== Object.prototype;\r\n    if (isClass) {\r\n      const descriptors = Object.getOwnPropertyDescriptors(proto);\r\n      keys.push(...Object.keys(descriptors));\r\n      Object.assign(desc, descriptors);\r\n    }\r\n    for (let i = 0, l = keys.length; i < l; i++) {\r\n      const prop = keys[i];\r\n      if (isClass && prop === \"constructor\") continue;\r\n      if (desc[prop].get) {\r\n        const get = desc[prop].get.bind(p);\r\n        Object.defineProperty(value, prop, {\r\n          get,\r\n          configurable: true\r\n        });\r\n      }\r\n      if (desc[prop].set) {\r\n        const og = desc[prop].set,\r\n          set = v => batch(() => og.call(p, v));\r\n        Object.defineProperty(value, prop, {\r\n          set,\r\n          configurable: true\r\n        });\r\n      }\r\n    }\r\n  }\r\n  return p;\r\n}\r\nfunction createMutable(state, options) {\r\n  const unwrappedStore = unwrap(state || {});\r\n  const wrappedStore = wrap(unwrappedStore);\r\n  return wrappedStore;\r\n}\r\nfunction modifyMutable(state, modifier) {\r\n  batch(() => modifier(unwrap(state)));\r\n}\r\n\r\nconst $ROOT = Symbol(\"store-root\");\r\nfunction applyState(target, parent, property, merge, key) {\r\n  const previous = parent[property];\r\n  if (target === previous) return;\r\n  const isArray = Array.isArray(target);\r\n  if (property !== $ROOT && (!isWrappable(target) || !isWrappable(previous) || isArray !== Array.isArray(previous) || key && target[key] !== previous[key])) {\r\n    setProperty(parent, property, target);\r\n    return;\r\n  }\r\n  if (isArray) {\r\n    if (target.length && previous.length && (!merge || key && target[0] && target[0][key] != null)) {\r\n      let i, j, start, end, newEnd, item, newIndicesNext, keyVal;\r\n      for (start = 0, end = Math.min(previous.length, target.length); start < end && (previous[start] === target[start] || key && previous[start] && target[start] && previous[start][key] === target[start][key]); start++) {\r\n        applyState(target[start], previous, start, merge, key);\r\n      }\r\n      const temp = new Array(target.length),\r\n        newIndices = new Map();\r\n      for (end = previous.length - 1, newEnd = target.length - 1; end >= start && newEnd >= start && (previous[end] === target[newEnd] || key && previous[start] && target[start] && previous[end][key] === target[newEnd][key]); end--, newEnd--) {\r\n        temp[newEnd] = previous[end];\r\n      }\r\n      if (start > newEnd || start > end) {\r\n        for (j = start; j <= newEnd; j++) setProperty(previous, j, target[j]);\r\n        for (; j < target.length; j++) {\r\n          setProperty(previous, j, temp[j]);\r\n          applyState(target[j], previous, j, merge, key);\r\n        }\r\n        if (previous.length > target.length) setProperty(previous, \"length\", target.length);\r\n        return;\r\n      }\r\n      newIndicesNext = new Array(newEnd + 1);\r\n      for (j = newEnd; j >= start; j--) {\r\n        item = target[j];\r\n        keyVal = key && item ? item[key] : item;\r\n        i = newIndices.get(keyVal);\r\n        newIndicesNext[j] = i === undefined ? -1 : i;\r\n        newIndices.set(keyVal, j);\r\n      }\r\n      for (i = start; i <= end; i++) {\r\n        item = previous[i];\r\n        keyVal = key && item ? item[key] : item;\r\n        j = newIndices.get(keyVal);\r\n        if (j !== undefined && j !== -1) {\r\n          temp[j] = previous[i];\r\n          j = newIndicesNext[j];\r\n          newIndices.set(keyVal, j);\r\n        }\r\n      }\r\n      for (j = start; j < target.length; j++) {\r\n        if (j in temp) {\r\n          setProperty(previous, j, temp[j]);\r\n          applyState(target[j], previous, j, merge, key);\r\n        } else setProperty(previous, j, target[j]);\r\n      }\r\n    } else {\r\n      for (let i = 0, len = target.length; i < len; i++) {\r\n        applyState(target[i], previous, i, merge, key);\r\n      }\r\n    }\r\n    if (previous.length > target.length) setProperty(previous, \"length\", target.length);\r\n    return;\r\n  }\r\n  const targetKeys = Object.keys(target);\r\n  for (let i = 0, len = targetKeys.length; i < len; i++) {\r\n    applyState(target[targetKeys[i]], previous, targetKeys[i], merge, key);\r\n  }\r\n  const previousKeys = Object.keys(previous);\r\n  for (let i = 0, len = previousKeys.length; i < len; i++) {\r\n    if (target[previousKeys[i]] === undefined) setProperty(previous, previousKeys[i], undefined);\r\n  }\r\n}\r\nfunction reconcile(value, options = {}) {\r\n  const {\r\n      merge,\r\n      key = \"id\"\r\n    } = options,\r\n    v = unwrap(value);\r\n  return state => {\r\n    if (!isWrappable(state) || !isWrappable(v)) return v;\r\n    const res = applyState(v, {\r\n      [$ROOT]: state\r\n    }, $ROOT, merge, key);\r\n    return res === undefined ? state : res;\r\n  };\r\n}\r\nconst producers = new WeakMap();\r\nconst setterTraps = {\r\n  get(target, property) {\r\n    if (property === $RAW) return target;\r\n    const value = target[property];\r\n    let proxy;\r\n    return isWrappable(value) ? producers.get(value) || (producers.set(value, proxy = new Proxy(value, setterTraps)), proxy) : value;\r\n  },\r\n  set(target, property, value) {\r\n    setProperty(target, property, unwrap(value));\r\n    return true;\r\n  },\r\n  deleteProperty(target, property) {\r\n    setProperty(target, property, undefined, true);\r\n    return true;\r\n  }\r\n};\r\nfunction produce(fn) {\r\n  return state => {\r\n    if (isWrappable(state)) {\r\n      let proxy;\r\n      if (!(proxy = producers.get(state))) {\r\n        producers.set(state, proxy = new Proxy(state, setterTraps));\r\n      }\r\n      fn(proxy);\r\n    }\r\n    return state;\r\n  };\r\n}\r\n\r\nconst DEV = undefined;\r\n\r\nexport { $RAW, DEV, createMutable, createStore, modifyMutable, produce, reconcile, unwrap };\r\n","import {createRoot} from 'solid-js';\r\nimport {createStore, reconcile, unwrap} from 'solid-js/store';\r\nimport {State} from '../config/state';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nconst [appState, _setAppState] = createRoot(() => createStore<State>({} as any));\r\n\r\nconst setAppState: typeof _setAppState = (...args: any[]) => {\r\n  const key = args[0];\r\n  // @ts-ignore\r\n  _setAppState(...args);\r\n  // @ts-ignore\r\n  rootScope.managers.appStateManager.setByKey(key, unwrap(appState[key]));\r\n};\r\n\r\nconst setAppStateSilent = (key: any, value?: any) => {\r\n  if(typeof(key) === 'object') {\r\n    _setAppState(key);\r\n    return;\r\n  }\r\n\r\n  _setAppState(key, reconcile(value));\r\n};\r\n\r\nconst useAppState = () => [appState, setAppState] as const;\r\n\r\nexport {\r\n  appState,\r\n  useAppState,\r\n  setAppState,\r\n  setAppStateSilent\r\n};\r\n","export default function getObjectKeysAndSort(object: {[key: string]: any} | Map<number, any>, sort: 'asc' | 'desc' = 'asc') {\r\n  if(!object) return [];\r\n  const ids = object instanceof Map ? [...object.keys()] : Object.keys(object).map((i) => +i);\r\n  if(sort === 'asc') return ids.sort((a, b) => a - b);\r\n  else return ids.sort((a, b) => b - a);\r\n}\r\n","// import {Accessor, createMemo} from 'solid-js';\r\nimport {Accessor, createMemo} from 'solid-js';\r\nimport {createStore, reconcile} from 'solid-js/store';\r\nimport {Chat, User} from '../layer';\r\n\r\ntype Peer = Chat | User;\r\n\r\nconst [state, setState] = createStore<{[peerId: PeerId]: Peer}>({});\r\n\r\ntype ValueOrGetter<T> = T | Accessor<T>;\r\n\r\nfunction createMemoOrReturn<T extends ValueOrGetter<any>, R, V = T extends Accessor<infer V> ? V : T>(valueOrGetter: T, callback: (value: V) => R): T extends Accessor<any> ? Accessor<R> : R {\r\n  // @ts-ignore\r\n  return typeof(valueOrGetter) === 'function' ? createMemo(() => callback((valueOrGetter as Accessor<T>)())) : callback(valueOrGetter);\r\n}\r\n\r\nexport function usePeer<T extends ValueOrGetter<PeerId>>(peerId: T) {\r\n  return createMemoOrReturn(peerId, (peerId) => state[peerId]);\r\n}\r\n\r\nexport function useChat<T extends ValueOrGetter<ChatId>>(chatId: T) {\r\n  return createMemoOrReturn<T, Chat>(chatId, (chatId) => state[chatId?.toPeerId(true)] as Chat);\r\n}\r\n\r\nexport function useUser<T extends ValueOrGetter<UserId>>(userId: T) {\r\n  return createMemoOrReturn<T, User>(userId, (userId) => state[userId?.toPeerId(false)] as User);\r\n}\r\n\r\nexport function reconcilePeer(peerId: PeerId, peer: Peer) {\r\n  setState(peerId, reconcile(peer));\r\n}\r\n\r\nexport function reconcilePeers(peers: {[peerId: PeerId]: Peer}) {\r\n  setState(/* reconcile */(peers));\r\n}\r\n","import {ActiveAccountNumber} from './types';\r\n\r\nexport function getValidatedAccount(input: string | number) {\r\n  input = parseInt((input || '1') + '');\r\n  return (input <= 4 && input >= 1 ? input : 1) as ActiveAccountNumber;\r\n}\r\n","import {getValidatedAccount} from './getValidatedAccount';\r\nimport {CURRENT_ACCOUNT_QUERY_PARAM} from './constants';\r\n\r\nexport function getCurrentAccountFromURL(urlString: string) {\r\n  const params = new URL(urlString).searchParams;\r\n  return getValidatedAccount(params.get(CURRENT_ACCOUNT_QUERY_PARAM) || '');\r\n}\r\n","import {getCurrentAccountFromURL} from './getCurrentAccountFromURL';\r\nimport {ActiveAccountNumber} from './types';\r\n\r\nexport const getCurrentAccount = (() => {\r\n  let result: ActiveAccountNumber;\r\n  return () => (result ??= getCurrentAccountFromURL(window.location.href));\r\n})();\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type createManagers from './createManagers';\r\nimport type {AckedResult} from '../mtproto/superMessagePort';\r\nimport {ModifyFunctionsToAsync} from '../../types';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport DEBUG, {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {getCurrentAccount} from '../accounts/getCurrentAccount';\r\nimport {ActiveAccountNumber} from '../accounts/types';\r\n\r\n// let stats: {\r\n//   [manager: string]: {\r\n//     [method: string]: {\r\n//       times: number[],\r\n//       byArgs: {\r\n//         [args: string]: number[]\r\n//       }\r\n//     }\r\n//   }\r\n// } = {};\r\n\r\n// let sentCount = 0;\r\n// let sentMethods: {[key: string]: number} = {};\r\n// let sentMethods2: {[key: string]: number} = {};\r\n// function collectStats(manager: string, method: string, args: any[], promise: Promise<any>) {\r\n//   ++sentCount;\r\n\r\n//   const key = [manager, method].join('-');\r\n//   if(!sentMethods[key]) sentMethods[key] = 0;\r\n//   ++sentMethods[key];\r\n\r\n//   const key2 = [('00000' + sentCount).slice(-5), key].join('-');\r\n\r\n//   const byManager = stats[manager] ??= {};\r\n//   const byMethod = byManager[method] ??= {times: [], byArgs: {}};\r\n\r\n//   const perf = performance.now();\r\n//   promise.catch(noop).finally(() => {\r\n//     const time = performance.now() - perf;\r\n//     byMethod.times.push(time);\r\n\r\n//     sentMethods2[key2] = time;\r\n\r\n//     try {\r\n//       const argsString = JSON.stringify(args);\r\n//       byMethod.byArgs[argsString].push(time);\r\n//     } catch(err) {}\r\n//   });\r\n// }\r\n\r\n// setInterval(() => {\r\n//   console.log(\r\n//     dT(),\r\n//     '[PROXY] stats',\r\n//     ...[\r\n//       stats,\r\n//       sentCount,\r\n//       sentMethods,\r\n//       sentMethods2\r\n//     ].map(copy),\r\n//     Object.entries(sentMethods).sort((a, b) => b[1] - a[1])\r\n//   );\r\n//   sentCount = 0;\r\n//   stats = {};\r\n//   sentMethods = {};\r\n//   sentMethods2 = {};\r\n// }, 2000);\r\n\r\nconst DEBUG_MANAGER_REQUESTS: {[managerName: string]: Set<string>} = {\r\n  // appProfileManager: new Set(['getProfile', 'getProfileByPeerId'])\r\n  // appPeersManager: new Set(['getPeer'])\r\n  // appChatsManager: new Set(['getChat'])\r\n  // appMessagesManager: new Set(['getMessageByPeer', 'getGroupsFirstMessage'])\r\n};\r\n\r\nfunction createProxy(/* source: T,  */name: string, accountNumber: ActiveAccountNumber, ack?: boolean) {\r\n  const proxy = new Proxy({}, {\r\n    get: (target, p, receiver) => {\r\n      // console.log('get', target, p, receiver);\r\n      // @ts-ignore\r\n      // const value = source[p];\r\n      // if(typeof(value) !== 'function') {\r\n      //   return value;\r\n      // }\r\n\r\n      return (...args: any[]) => {\r\n        const promise = apiManagerProxy.invoke('manager', {\r\n          name,\r\n          method: p as string,\r\n          args,\r\n          accountNumber\r\n        }, ack as any);\r\n\r\n        if(DEBUG) {\r\n          if(DEBUG_MANAGER_REQUESTS[name]?.has(p as any)) {\r\n            console.warn('manager request', name, p, args, ack);\r\n          }\r\n        }\r\n\r\n        // collectStats(name, p as string, args, promise);\r\n\r\n        return promise;\r\n\r\n        // @ts-ignore\r\n        // return Promise.resolve(value.call(source, ...args));\r\n      };\r\n    }\r\n  });\r\n\r\n  return proxy;\r\n}\r\n\r\ntype AA<T> = {\r\n  [key in keyof T]: T[key] extends (...args: infer A) => infer R ? (...args: A) => Promise<AckedResult<Awaited<R>>> : never\r\n};\r\n\r\ntype T = Awaited<ReturnType<typeof createManagers>>;\r\nexport type ProxiedManagers = {\r\n  [name in keyof T]?: ModifyFunctionsToAsync<T[name]>;\r\n};\r\n\r\ntype ProxiedAndAcknowledgedManagers = ProxiedManagers & {\r\n  acknowledged?: {\r\n    [name in keyof T]?: AA<T[name]>;\r\n  }\r\n};\r\n\r\nfunction createProxyProxy(proxied: any, accountNumber: ActiveAccountNumber, ack?: boolean) {\r\n  return new Proxy(proxied, {\r\n    get: (target, p, receiver) => {\r\n      // @ts-ignore\r\n      return target[p] ??= createProxy(p as string, accountNumber, ack);\r\n    }\r\n  });\r\n}\r\n\r\nexport function createProxiedManagersForAccount(accountNumber: ActiveAccountNumber): ProxiedManagers {\r\n  return createProxyProxy({}, accountNumber);\r\n}\r\n\r\nMOUNT_CLASS_TO.createProxiedManagersForAccount = createProxiedManagersForAccount;\r\n\r\nlet proxied: ProxiedAndAcknowledgedManagers;\r\nexport default function getProxiedManagers() {\r\n  if(proxied) {\r\n    return proxied;\r\n  }\r\n\r\n  proxied = createProxyProxy({}, getCurrentAccount(), false);\r\n  proxied.acknowledged = createProxyProxy({}, getCurrentAccount(), true);\r\n  return proxied;\r\n}\r\n","export default function limitSymbols(str: string, length: number, limitFrom = length + 10) {\r\n  str = str.trim();\r\n  if(str.length > limitFrom) {\r\n    str = str.slice(0, length)/* .replace(/\\s*$/, '') */ + '...';\r\n  }\r\n\r\n  return str;\r\n}\r\n","import {Chat, User} from '../../../../layer';\r\n\r\nexport default function getPeerActiveUsernames(peer: User | Chat) {\r\n  if(!peer) {\r\n    return [];\r\n  }\r\n\r\n  const usernames = (peer as Chat.channel).usernames;\r\n  if(usernames) {\r\n    return usernames\r\n    .filter((username) => username.pFlags.active)\r\n    // .sort((a, b) => +!!b.pFlags.editable - +!!a.pFlags.editable)\r\n    .map((username) => username.username);\r\n  }\r\n\r\n  return (peer as Chat.channel).username ? [(peer as Chat.channel).username] : [];\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n// From https://github.com/stephenmathieson/node-tlds/blob/master/index.js\r\nconst TLD = ['abogado', 'ac', 'academy', 'accountants', 'active', 'actor', 'ad', 'adult', 'ae', 'aero', 'af', 'ag', 'agency', 'ai', 'airforce', 'al', 'allfinanz', 'alsace', 'am', 'amsterdam', 'an', 'android', 'ao', 'apartments', 'aq', 'aquarelle', 'ar', 'archi', 'army', 'arpa', 'as', 'asia', 'associates', 'at', 'attorney', 'au', 'auction', 'audio', 'autos', 'aw', 'ax', 'axa', 'az', 'ba', 'band', 'bank', 'bar', 'barclaycard', 'barclays', 'bargains', 'bayern', 'bb', 'bd', 'be', 'beer', 'berlin', 'best', 'bf', 'bg', 'bh', 'bi', 'bid', 'bike', 'bingo', 'bio', 'biz', 'bj', 'black', 'blackfriday', 'bloomberg', 'blue', 'bm', 'bmw', 'bn', 'bnpparibas', 'bo', 'boo', 'boutique', 'br', 'brussels', 'bs', 'bt', 'budapest', 'build', 'builders', 'business', 'buzz', 'bv', 'bw', 'by', 'bz', 'bzh', 'ca', 'cab', 'cal', 'camera', 'camp', 'cancerresearch', 'canon', 'capetown', 'capital', 'caravan', 'cards', 'care', 'career', 'careers', 'cartier', 'casa', 'cash', 'cat', 'catering', 'cc', 'cd', 'center', 'ceo', 'cern', 'cf', 'cg', 'ch', 'channel', 'chat', 'cheap', 'christmas', 'chrome', 'church', 'ci', 'citic', 'city', 'ck', 'cl', 'claims', 'cleaning', 'click', 'clinic', 'clothing', 'club', 'cm', 'cn', 'co', 'coach', 'codes', 'coffee', 'college', 'cologne', 'com', 'community', 'company', 'computer', 'condos', 'construction', 'consulting', 'contractors', 'cooking', 'cool', 'coop', 'country', 'cr', 'credit', 'creditcard', 'cricket', 'crs', 'cruises', 'cu', 'cuisinella', 'cv', 'cw', 'cx', 'cy', 'cymru', 'cz', 'dabur', 'dad', 'dance', 'dating', 'day', 'dclk', 'de', 'deals', 'degree', 'delivery', 'democrat', 'dental', 'dentist', 'desi', 'design', 'dev', 'diamonds', 'diet', 'digital', 'direct', 'directory', 'discount', 'dj', 'dk', 'dm', 'dnp', 'do', 'docs', 'domains', 'doosan', 'durban', 'dvag', 'dz', 'eat', 'ec', 'edu', 'education', 'ee', 'eg', 'email', 'emerck', 'energy', 'engineer', 'engineering', 'enterprises', 'equipment', 'er', 'es', 'esq', 'estate', 'et', 'eu', 'eurovision', 'eus', 'events', 'everbank', 'exchange', 'expert', 'exposed', 'fail', 'farm', 'fashion', 'feedback', 'fi', 'finance', 'financial', 'firmdale', 'fish', 'fishing', 'fit', 'fitness', 'fj', 'fk', 'flights', 'florist', 'flowers', 'flsmidth', 'fly', 'fm', 'fo', 'foo', 'forsale', 'foundation', 'fr', 'frl', 'frogans', 'fund', 'furniture', 'futbol', 'ga', 'gal', 'gallery', 'garden', 'gb', 'gbiz', 'gd', 'ge', 'gent', 'gf', 'gg', 'ggee', 'gh', 'gi', 'gift', 'gifts', 'gives', 'gl', 'glass', 'gle', 'global', 'globo', 'gm', 'gmail', 'gmo', 'gmx', 'gn', 'goog', 'google', 'gop', 'gov', 'gp', 'gq', 'gr', 'graphics', 'gratis', 'green', 'gripe', 'gs', 'gt', 'gu', 'guide', 'guitars', 'guru', 'gw', 'gy', 'hamburg', 'hangout', 'haus', 'healthcare', 'help', 'here', 'hermes', 'hiphop', 'hiv', 'hk', 'hm', 'hn', 'holdings', 'holiday', 'homes', 'horse', 'host', 'hosting', 'house', 'how', 'hr', 'ht', 'hu', 'ibm', 'id', 'ie', 'ifm', 'il', 'im', 'immo', 'immobilien', 'in', 'industries', 'info', 'ing', 'ink', 'institute', 'insure', 'int', 'international', 'investments', 'io', 'iq', 'ir', 'irish', 'is', 'it', 'iwc', 'jcb', 'je', 'jetzt', 'jm', 'jo', 'jobs', 'joburg', 'jp', 'juegos', 'kaufen', 'kddi', 'ke', 'kg', 'kh', 'ki', 'kim', 'kitchen', 'kiwi', 'km', 'kn', 'koeln', 'kp', 'kr', 'krd', 'kred', 'kw', 'ky', 'kyoto', 'kz', 'la', 'lacaixa', 'land', 'lat', 'latrobe', 'lawyer', 'lb', 'lc', 'lds', 'lease', 'legal', 'lgbt', 'li', 'lidl', 'life', 'lighting', 'limited', 'limo', 'link', 'lk', 'loans', 'london', 'lotte', 'lotto', 'lr', 'ls', 'lt', 'ltda', 'lu', 'luxe', 'luxury', 'lv', 'ly', 'ma', 'madrid', 'maison', 'management', 'mango', 'market', 'marketing', 'marriott', 'mc', 'md', 'me', 'media', 'meet', 'melbourne', 'meme', 'memorial', 'menu', 'mg', 'mh', 'miami', 'mil', 'mini', 'mk', 'ml', 'mm', 'mn', 'mo', 'mobi', 'moda', 'moe', 'monash', 'money', 'mormon', 'mortgage', 'moscow', 'motorcycles', 'mov', 'mp', 'mq', 'mr', 'ms', 'mt', 'mu', 'museum', 'mv', 'mw', 'mx', 'my', 'mz', 'na', 'nagoya', 'name', 'navy', 'nc', 'ne', 'net', 'network', 'neustar', 'new', 'nexus', 'nf', 'ng', 'ngo', 'nhk', 'ni', 'nico', 'ninja', 'nl', 'no', 'np', 'nr', 'nra', 'nrw', 'ntt', 'nu', 'nyc', 'nz', 'okinawa', 'om', 'one', 'ong', 'onl', 'ooo', 'org', 'organic', 'osaka', 'otsuka', 'ovh', 'pa', 'paris', 'partners', 'parts', 'party', 'pe', 'pf', 'pg', 'ph', 'pharmacy', 'photo', 'photography', 'photos', 'physio', 'pics', 'pictures', 'pink', 'pizza', 'pk', 'pl', 'place', 'plumbing', 'pm', 'pn', 'pohl', 'poker', 'porn', 'post', 'pr', 'praxi', 'press', 'pro', 'prod', 'productions', 'prof', 'properties', 'property', 'ps', 'pt', 'pub', 'pw', 'py', 'qa', 'qpon', 'quebec', 're', 'realtor', 'recipes', 'red', 'rehab', 'reise', 'reisen', 'reit', 'ren', 'rentals', 'repair', 'report', 'republican', 'rest', 'restaurant', 'reviews', 'rich', 'rio', 'rip', 'ro', 'rocks', 'rodeo', 'rs', 'rsvp', 'ru', 'ruhr', 'rw', 'ryukyu', 'sa', 'saarland', 'sale', 'samsung', 'sarl', 'saxo', 'sb', 'sc', 'sca', 'scb', 'schmidt', 'schule', 'schwarz', 'science', 'scot', 'sd', 'se', 'services', 'sew', 'sexy', 'sg', 'sh', 'shiksha', 'shoes', 'shriram', 'si', 'singles', 'sj', 'sk', 'sky', 'sl', 'sm', 'sn', 'so', 'social', 'software', 'sohu', 'solar', 'solutions', 'soy', 'space', 'spiegel', 'sr', 'st', 'style', 'su', 'supplies', 'supply', 'support', 'surf', 'surgery', 'suzuki', 'sv', 'sx', 'sy', 'sydney', 'systems', 'sz', 'taipei', 'tatar', 'tattoo', 'tax', 'tc', 'td', 'technology', 'tel', 'temasek', 'tennis', 'tf', 'tg', 'th', 'tienda', 'tips', 'tires', 'tirol', 'tj', 'tk', 'tl', 'tm', 'tn', 'to', 'today', 'tokyo', 'tools', 'top', 'toshiba', 'town', 'toys', 'tp', 'tr', 'trade', 'training', 'travel', 'trust', 'tt', 'tui', 'tv', 'tw', 'tz', 'ua', 'ug', 'uk', 'university', 'uno', 'uol', 'us', 'uy', 'uz', 'va', 'vacations', 'vc', 've', 'vegas', 'ventures', 'versicherung', 'vet', 'vg', 'vi', 'viajes', 'video', 'villas', 'vision', 'vlaanderen', 'vn', 'vodka', 'vote', 'voting', 'voto', 'voyage', 'vu', 'wales', 'wang', 'watch', 'webcam', 'website', 'wed', 'wedding', 'wf', 'whoswho', 'wien', 'wiki', 'williamhill', 'wme', 'work', 'works', 'world', 'ws', 'wtc', 'wtf', '佛山', '集团', '在线', '한국', 'ভারত', '八卦', 'موقع', '公益', '公司', '移动', '我爱你', 'москва', 'қаз', 'онлайн', 'сайт', 'срб', '淡马锡', 'орг', '삼성', 'சிங்கப்பூர்', '商标', '商店', '商城', 'дети', 'мкд', '中文网', '中信', '中国', '中國', '谷歌', 'భారత్', 'ලංකා', 'ભારત', 'भारत', '网店', 'संगठन', '网络', 'укр', '香港', '台湾', '台灣', '手机', 'мон', 'الجزائر', 'عمان', 'ایران', 'امارات', 'بازار', 'الاردن', 'بھارت', 'المغرب', 'السعودية', 'مليسيا', 'شبكة', 'გე', '机构', '组织机构', 'ไทย', 'سورية', 'рус', 'рф', 'تونس', 'みんな', 'グーグル', '世界', 'ਭਾਰਤ', '网址', '游戏', 'vermögensberater', 'vermögensberatung', '企业', 'مصر', 'قطر', '广东', 'இலங்கை', 'இந்தியா', '新加坡', 'فلسطين', '政务', 'xxx', 'xyz', 'yachts', 'yandex', 'ye', 'yoga', 'yokohama', 'youtube', 'yt', 'za', 'zip', 'zm', 'zone', 'zuerich', 'zw'];\r\n\r\nexport default TLD;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nexport default function checkBrackets(url: string) {\r\n  var urlLength = url.length;\r\n  var urlOpenBrackets = url.split('(').length - 1;\r\n  var urlCloseBrackets = url.split(')').length - 1;\r\n  while(urlCloseBrackets > urlOpenBrackets &&\r\n    url.charAt(urlLength - 1) === ')') {\r\n    url = url.substr(0, urlLength - 1)\r\n    urlCloseBrackets--;\r\n    urlLength--;\r\n  }\r\n  if(urlOpenBrackets > urlCloseBrackets) {\r\n    url = url.replace(/\\)+$/, '');\r\n  }\r\n  return url;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {EMOJI_VERSION} from '../environment/emojiVersionsSupport';\r\n\r\nexport const EmojiVersions: {[version in EMOJI_VERSION]: {[emoji: string]: number}} = {'14':{'1f6dd':4867, '1f6de':4916, '1f6df':4923, '1f7f0':62832, '1f979':183, '1f9cc':1557, '1fa7b':61332, '1fa7c':61330, '1faa9':51093, '1faaa':61364, '1faab':61189, '1faac':51085, '1fab7':2651, '1fab8':2631, '1fab9':2672, '1faba':2673, '1fac3':1520, '1fac4':1521, '1fac5':1505, '1fad7':3793, '1fad8':3707, '1fad9':3804, '1fae0':111, '1fae1':136, '1fae2':132, '1fae3':133, '1fae4':174, '1fae5':142, '1fae6':1385, '1fae7':61353, '1faf0':1341, '1faf1':1332, '1faf2':1333, '1faf3':1334, '1faf4':1335, '1faf5':1351, '1faf6':1360, '1faf1-1f3fb-200d-1faf2-1f3fc':0, '1faf1-1f3fb-200d-1faf2-1f3fd':0, '1faf1-1f3fb-200d-1faf2-1f3fe':0, '1faf1-1f3fb-200d-1faf2-1f3ff':0, '1faf1-1f3fc-200d-1faf2-1f3fb':0, '1faf1-1f3fc-200d-1faf2-1f3fd':0, '1faf1-1f3fc-200d-1faf2-1f3fe':0, '1faf1-1f3fc-200d-1faf2-1f3ff':0, '1faf1-1f3fd-200d-1faf2-1f3fb':0, '1faf1-1f3fd-200d-1faf2-1f3fc':0, '1faf1-1f3fd-200d-1faf2-1f3fe':0, '1faf1-1f3fd-200d-1faf2-1f3ff':0, '1faf1-1f3fe-200d-1faf2-1f3fb':0, '1faf1-1f3fe-200d-1faf2-1f3fc':0, '1faf1-1f3fe-200d-1faf2-1f3fd':0, '1faf1-1f3fe-200d-1faf2-1f3ff':0, '1faf1-1f3ff-200d-1faf2-1f3fb':0, '1faf1-1f3ff-200d-1faf2-1f3fc':0, '1faf1-1f3ff-200d-1faf2-1f3fd':0, '1faf1-1f3ff-200d-1faf2-1f3fe':0, '1fac3-1f3fb':0, '1fac3-1f3fc':0, '1fac3-1f3fd':0, '1fac3-1f3fe':0, '1fac3-1f3ff':0, '1fac4-1f3fb':0, '1fac4-1f3fc':0, '1fac4-1f3fd':0, '1fac4-1f3fe':0, '1fac4-1f3ff':0, '1fac5-1f3fb':0, '1fac5-1f3fc':0, '1fac5-1f3fd':0, '1fac5-1f3fe':0, '1fac5-1f3ff':0, '1faf0-1f3fb':0, '1faf0-1f3fc':0, '1faf0-1f3fd':0, '1faf0-1f3fe':0, '1faf0-1f3ff':0, '1faf1-1f3fb':0, '1faf1-1f3fc':0, '1faf1-1f3fd':0, '1faf1-1f3fe':0, '1faf1-1f3ff':0, '1faf2-1f3fb':0, '1faf2-1f3fc':0, '1faf2-1f3fd':0, '1faf2-1f3fe':0, '1faf2-1f3ff':0, '1faf3-1f3fb':0, '1faf3-1f3fc':0, '1faf3-1f3fd':0, '1faf3-1f3fe':0, '1faf3-1f3ff':0, '1faf4-1f3fb':0, '1faf4-1f3fc':0, '1faf4-1f3fd':0, '1faf4-1f3fe':0, '1faf4-1f3ff':0, '1faf5-1f3fb':0, '1faf5-1f3fc':0, '1faf5-1f3fd':0, '1faf5-1f3fe':0, '1faf5-1f3ff':0, '1faf6-1f3fb':0, '1faf6-1f3fc':0, '1faf6-1f3fd':0, '1faf6-1f3fe':0, '1faf6-1f3ff':0}, '':{'2049':62835, '2122':62863, '2139':62888, '2194':62764, '2195':62763, '2196':62762, '2197':62756, '2198':62758, '2199':62760, '2328':61194, '2600':4990, '2601':4998, '2602':41013, '2603':41018, '2604':41020, '2611':62851, '2614':41014, '2615':3781, '2618':2667, '2620':1106, '2622':62753, '2623':62754, '2626':62783, '2638':62780, '2639':177, '2648':62788, '2649':62789, '2650':62796, '2651':62797, '2652':62798, '2653':62799, '2660':51095, '2663':51098, '2665':51096, '2666':51097, '2668':4865, '2692':61297, '2693':4922, '2694':61300, '2696':61311, '2697':61319, '2699':61309, '2702':61284, '2705':62850, '2708':4931, '2709':61245, '2712':61259, '2714':62852, '2716':62828, '2721':62779, '2728':51029, '2733':62858, '2734':62859, '2744':41017, '2747':62860, '2753':62836, '2754':62837, '2755':62838, '2757':62839, '2763':1137, '2764':1141, '2795':62829, '2796':62830, '2797':62831, '2934':62767, '2935':62768, '3030':62840, '3297':62912, '3299':62913, '0023-20e3':62864, '002a-20e3':62865, '0030-20e3':62866, '0031-20e3':62867, '0032-20e3':62868, '0033-20e3':62869, '0034-20e3':62870, '0035-20e3':62871, '0036-20e3':62872, '0037-20e3':62873, '0038-20e3':62874, '0039-20e3':62875, '00a9':62861, '00ae':62862, '1f004':51101, '1f0cf':51100, '1f170':62882, '1f171':62884, '1f17e':62893, '1f17f':62895, '1f18e':62883, '1f191':62885, '1f192':62886, '1f193':62887, '1f194':62889, '1f195':62891, '1f196':62892, '1f197':62894, '1f198':62896, '1f199':62897, '1f19a':62898, '1f1e6-1f1e8':71594, '1f1e6-1f1e9':71595, '1f1e6-1f1ea':71596, '1f1e6-1f1eb':71597, '1f1e6-1f1ec':71598, '1f1e6-1f1ee':71599, '1f1e6-1f1f1':71600, '1f1e6-1f1f2':71601, '1f1e6-1f1f4':71602, '1f1e6-1f1f6':71603, '1f1e6-1f1f7':71604, '1f1e6-1f1f8':71605, '1f1e6-1f1f9':71606, '1f1e6-1f1fa':71607, '1f1e6-1f1fc':71608, '1f1e6-1f1fd':71609, '1f1e6-1f1ff':71610, '1f1e7-1f1e6':71611, '1f1e7-1f1e7':71612, '1f1e7-1f1e9':71613, '1f1e7-1f1ea':71614, '1f1e7-1f1eb':71615, '1f1e7-1f1ec':71616, '1f1e7-1f1ed':71617, '1f1e7-1f1ee':71618, '1f1e7-1f1ef':71619, '1f1e7-1f1f1':71620, '1f1e7-1f1f2':71621, '1f1e7-1f1f3':71622, '1f1e7-1f1f4':71623, '1f1e7-1f1f6':71624, '1f1e7-1f1f7':71625, '1f1e7-1f1f8':71626, '1f1e7-1f1f9':71627, '1f1e7-1f1fb':71628, '1f1e7-1f1fc':71629, '1f1e7-1f1fe':71630, '1f1e7-1f1ff':71631, '1f1e8-1f1e6':71632, '1f1e8-1f1e8':71633, '1f1e8-1f1e9':71634, '1f1e8-1f1eb':71635, '1f1e8-1f1ec':71636, '1f1e8-1f1ed':71637, '1f1e8-1f1ee':71638, '1f1e8-1f1f0':71639, '1f1e8-1f1f1':71640, '1f1e8-1f1f2':71641, '1f1e8-1f1f3':71642, '1f1e8-1f1f4':71643, '1f1e8-1f1f5':71644, '1f1e8-1f1f7':71645, '1f1e8-1f1fa':71646, '1f1e8-1f1fb':71647, '1f1e8-1f1fc':71648, '1f1e8-1f1fd':71649, '1f1e8-1f1fe':71650, '1f1e8-1f1ff':71651, '1f1e9-1f1ea':71652, '1f1e9-1f1ec':71653, '1f1e9-1f1ef':71654, '1f1e9-1f1f0':71655, '1f1e9-1f1f2':71656, '1f1e9-1f1f4':71657, '1f1e9-1f1ff':71658, '1f1ea-1f1e6':71659, '1f1ea-1f1e8':71660, '1f1ea-1f1ea':71661, '1f1ea-1f1ec':71662, '1f1ea-1f1ed':71663, '1f1ea-1f1f7':71664, '1f1ea-1f1f8':71665, '1f1ea-1f1f9':71666, '1f1ea-1f1fa':71667, '1f1eb-1f1ee':71668, '1f1eb-1f1ef':71669, '1f1eb-1f1f0':71670, '1f1eb-1f1f2':71671, '1f1eb-1f1f4':71672, '1f1eb-1f1f7':71673, '1f1ec-1f1e6':71674, '1f1ec-1f1e7':71675, '1f1ec-1f1e9':71676, '1f1ec-1f1ea':71677, '1f1ec-1f1eb':71678, '1f1ec-1f1ec':71679, '1f1ec-1f1ed':71680, '1f1ec-1f1ee':71681, '1f1ec-1f1f1':71682, '1f1ec-1f1f2':71683, '1f1ec-1f1f3':71684, '1f1ec-1f1f5':71685, '1f1ec-1f1f6':71686, '1f1ec-1f1f7':71687, '1f1ec-1f1f8':71688, '1f1ec-1f1f9':71689, '1f1ec-1f1fa':71690, '1f1ec-1f1fc':71691, '1f1ec-1f1fe':71692, '1f1ed-1f1f0':71693, '1f1ed-1f1f2':71694, '1f1ed-1f1f3':71695, '1f1ed-1f1f7':71696, '1f1ed-1f1f9':71697, '1f1ed-1f1fa':71698, '1f1ee-1f1e8':71699, '1f1ee-1f1e9':71700, '1f1ee-1f1ea':71701, '1f1ee-1f1f1':71702, '1f1ee-1f1f2':71703, '1f1ee-1f1f3':71704, '1f1ee-1f1f4':71705, '1f1ee-1f1f6':71706, '1f1ee-1f1f7':71707, '1f1ee-1f1f8':71708, '1f1ee-1f1f9':71709, '1f1ef-1f1ea':71710, '1f1ef-1f1f2':71711, '1f1ef-1f1f4':71712, '1f1ef-1f1f5':71713, '1f1f0-1f1ea':71714, '1f1f0-1f1ec':71715, '1f1f0-1f1ed':71716, '1f1f0-1f1ee':71717, '1f1f0-1f1f2':71718, '1f1f0-1f1f3':71719, '1f1f0-1f1f5':71720, '1f1f0-1f1f7':71721, '1f1f0-1f1fc':71722, '1f1f0-1f1fe':71723, '1f1f0-1f1ff':71724, '1f1f1-1f1e6':71725, '1f1f1-1f1e7':71726, '1f1f1-1f1e8':71727, '1f1f1-1f1ee':71728, '1f1f1-1f1f0':71729, '1f1f1-1f1f7':71730, '1f1f1-1f1f8':71731, '1f1f1-1f1f9':71732, '1f1f1-1f1fa':71733, '1f1f1-1f1fb':71734, '1f1f1-1f1fe':71735, '1f1f2-1f1e6':71736, '1f1f2-1f1e8':71737, '1f1f2-1f1e9':71738, '1f1f2-1f1ea':71739, '1f1f2-1f1eb':71740, '1f1f2-1f1ec':71741, '1f1f2-1f1ed':71742, '1f1f2-1f1f0':71743, '1f1f2-1f1f1':71744, '1f1f2-1f1f2':71745, '1f1f2-1f1f3':71746, '1f1f2-1f1f4':71747, '1f1f2-1f1f5':71748, '1f1f2-1f1f6':71749, '1f1f2-1f1f7':71750, '1f1f2-1f1f8':71751, '1f1f2-1f1f9':71752, '1f1f2-1f1fa':71753, '1f1f2-1f1fb':71754, '1f1f2-1f1fc':71755, '1f1f2-1f1fd':71756, '1f1f2-1f1fe':71757, '1f1f2-1f1ff':71758, '1f1f3-1f1e6':71759, '1f1f3-1f1e8':71760, '1f1f3-1f1ea':71761, '1f1f3-1f1eb':71762, '1f1f3-1f1ec':71763, '1f1f3-1f1ee':71764, '1f1f3-1f1f1':71765, '1f1f3-1f1f4':71766, '1f1f3-1f1f5':71767, '1f1f3-1f1f7':71768, '1f1f3-1f1fa':71769, '1f1f3-1f1ff':71770, '1f1f4-1f1f2':71771, '1f1f5-1f1e6':71772, '1f1f5-1f1ea':71773, '1f1f5-1f1eb':71774, '1f1f5-1f1ec':71775, '1f1f5-1f1ed':71776, '1f1f5-1f1f0':71777, '1f1f5-1f1f1':71778, '1f1f5-1f1f2':71779, '1f1f5-1f1f3':71780, '1f1f5-1f1f7':71781, '1f1f5-1f1f8':71782, '1f1f5-1f1f9':71783, '1f1f5-1f1fc':71784, '1f1f5-1f1fe':71785, '1f1f6-1f1e6':71786, '1f1f7-1f1ea':71787, '1f1f7-1f1f4':71788, '1f1f7-1f1f8':71789, '1f1f7-1f1fa':71790, '1f1f7-1f1fc':71791, '1f1f8-1f1e6':71792, '1f1f8-1f1e7':71793, '1f1f8-1f1e8':71794, '1f1f8-1f1e9':71795, '1f1f8-1f1ea':71796, '1f1f8-1f1ec':71797, '1f1f8-1f1ed':71798, '1f1f8-1f1ee':71799, '1f1f8-1f1ef':71800, '1f1f8-1f1f0':71801, '1f1f8-1f1f1':71802, '1f1f8-1f1f2':71803, '1f1f8-1f1f3':71804, '1f1f8-1f1f4':71805, '1f1f8-1f1f7':71806, '1f1f8-1f1f8':71807, '1f1f8-1f1f9':71808, '1f1f8-1f1fb':71809, '1f1f8-1f1fd':71810, '1f1f8-1f1fe':71811, '1f1f8-1f1ff':71812, '1f1f9-1f1e6':71813, '1f1f9-1f1e8':71814, '1f1f9-1f1e9':71815, '1f1f9-1f1eb':71816, '1f1f9-1f1ec':71817, '1f1f9-1f1ed':71818, '1f1f9-1f1ef':71819, '1f1f9-1f1f0':71820, '1f1f9-1f1f1':71821, '1f1f9-1f1f2':71822, '1f1f9-1f1f3':71823, '1f1f9-1f1f4':71824, '1f1f9-1f1f7':71825, '1f1f9-1f1f9':71826, '1f1f9-1f1fb':71827, '1f1f9-1f1fc':71828, '1f1f9-1f1ff':71829, '1f1fa-1f1e6':71830, '1f1fa-1f1ec':71831, '1f1fa-1f1f2':71832, '1f1fa-1f1f3':71833, '1f1fa-1f1f8':71834, '1f1fa-1f1fe':71835, '1f1fa-1f1ff':71836, '1f1fb-1f1e6':71837, '1f1fb-1f1e8':71838, '1f1fb-1f1ea':71839, '1f1fb-1f1ec':71840, '1f1fb-1f1ee':71841, '1f1fb-1f1f3':71842, '1f1fb-1f1fa':71843, '1f1fc-1f1eb':71844, '1f1fc-1f1f8':71845, '1f1fd-1f1f0':71846, '1f1fe-1f1ea':71847, '1f1fe-1f1f9':71848, '1f1ff-1f1e6':71849, '1f1ff-1f1f2':71850, '1f1ff-1f1fc':71851, '1f201':62899, '1f202':62900, '1f21a':62906, '1f22f':62903, '1f232':62907, '1f233':62911, '1f234':62910, '1f235':62915, '1f236':62902, '1f237':62901, '1f238':62909, '1f239':62905, '1f23a':62914, '1f250':62904, '1f251':62908, '1f300':41010, '1f301':4857, '1f302':41012, '1f303':4858, '1f304':4860, '1f305':4861, '1f306':4862, '1f307':4863, '1f308':41011, '1f309':4864, '1f30a':41023, '1f30b':4815, '1f30c':4997, '1f30d':4806, '1f30e':4807, '1f30f':4808, '1f310':4809, '1f311':4977, '1f312':4978, '1f313':4979, '1f314':4980, '1f315':4981, '1f316':4982, '1f317':4983, '1f318':4984, '1f319':4985, '1f31a':4986, '1f31b':4987, '1f31c':4988, '1f31d':4991, '1f31e':4992, '1f31f':4995, '1f320':4996, '1f321':4989, '1f324':41001, '1f325':41002, '1f326':41003, '1f327':41004, '1f328':41005, '1f329':41006, '1f32a':41007, '1f32b':41008, '1f32c':41009, '1f32d':3725, '1f32e':3727, '1f32f':3728, '1f330':3708, '1f331':2659, '1f332':2661, '1f333':2662, '1f334':2663, '1f335':2664, '1f336':3698, '1f337':2658, '1f338':2649, '1f339':2653, '1f33a':2655, '1f33b':2656, '1f33c':2657, '1f33d':3697, '1f33e':2665, '1f33f':2666, '1f340':2668, '1f341':2669, '1f342':2670, '1f343':2671, '1f344':3705, '1f345':3690, '1f346':3694, '1f347':3674, '1f348':3675, '1f349':3676, '1f34a':3677, '1f34b':3678, '1f34c':3679, '1f34d':3680, '1f34e':3682, '1f34f':3683, '1f350':3684, '1f351':3685, '1f352':3686, '1f353':3687, '1f354':3722, '1f355':3724, '1f356':3718, '1f357':3719, '1f358':3744, '1f359':3745, '1f35a':3746, '1f35b':3747, '1f35c':3748, '1f35d':3749, '1f35e':3709, '1f35f':3723, '1f360':3750, '1f361':3756, '1f362':3751, '1f363':3752, '1f364':3753, '1f365':3754, '1f366':3765, '1f367':3766, '1f368':3767, '1f369':3768, '1f36a':3769, '1f36b':3774, '1f36c':3775, '1f36d':3776, '1f36e':3777, '1f36f':3778, '1f370':3771, '1f371':3743, '1f372':3735, '1f373':3733, '1f374':3801, '1f375':3783, '1f376':3784, '1f377':3786, '1f378':3787, '1f379':3788, '1f37a':3789, '1f37b':3790, '1f37c':3779, '1f37d':3800, '1f37e':3785, '1f37f':3739, '1f380':51040, '1f381':51041, '1f382':3770, '1f383':51024, '1f384':51025, '1f385':1527, '1f386':51026, '1f387':51027, '1f388':51030, '1f389':51031, '1f38a':51032, '1f38b':51033, '1f38c':71588, '1f38d':51034, '1f38e':51035, '1f38f':51036, '1f390':51037, '1f391':51038, '1f392':61134, '1f393':61147, '1f396':51045, '1f397':51042, '1f399':61167, '1f39a':61168, '1f39b':61169, '1f39e':61203, '1f39f':51043, '1f3a0':4866, '1f3a1':4868, '1f3a2':4869, '1f3a3':51072, '1f3a4':61170, '1f3a5':61202, '1f3a6':62819, '1f3a7':61171, '1f3a8':51105, '1f3a9':61146, '1f3aa':4871, '1f3ab':51044, '1f3ac':61205, '1f3ad':51103, '1f3ae':51086, '1f3af':51078, '1f3b0':51088, '1f3b1':51081, '1f3b2':51089, '1f3b3':51060, '1f3b4':51102, '1f3b5':61165, '1f3b6':61166, '1f3b7':61173, '1f3b8':61175, '1f3b9':61176, '1f3ba':61177, '1f3bb':61178, '1f3bc':61164, '1f3bd':51074, '1f3be':51058, '1f3bf':51075, '1f3c0':51054, '1f3c1':71586, '1f3c2':1600, '1f3c3-200d-2640':1584, '1f3c3-200d-2642':1583, '1f3c3':1582, '1f3c4-200d-2640':1606, '1f3c4-200d-2642':1605, '1f3c4':1604, '1f3c5':51047, '1f3c6':51046, '1f3c7':1598, '1f3c8':51056, '1f3c9':51057, '1f3ca-200d-2640':1612, '1f3ca-200d-2642':1611, '1f3ca':1610, '1f3cb-200d-2640':1618, '1f3cb-200d-2642':1617, '1f3cb':1616, '1f3cc-200d-2640':1603, '1f3cc-200d-2642':1602, '1f3cc':1601, '1f3cd':4902, '1f3ce':4901, '1f3cf':51061, '1f3d0':51055, '1f3d1':51062, '1f3d2':51063, '1f3d3':51065, '1f3d4':4813, '1f3d5':4817, '1f3d6':4818, '1f3d7':4824, '1f3d8':4829, '1f3d9':4859, '1f3da':4830, '1f3db':4823, '1f3dc':4819, '1f3dd':4820, '1f3de':4821, '1f3df':4822, '1f3e0':4831, '1f3e1':4832, '1f3e2':4833, '1f3e3':4834, '1f3e4':4835, '1f3e5':4836, '1f3e6':4837, '1f3e7':62729, '1f3e8':4838, '1f3e9':4839, '1f3ea':4840, '1f3eb':4841, '1f3ec':4842, '1f3ed':4843, '1f3ee':61216, '1f3ef':4844, '1f3f0':4845, '1f3f3-200d-1f308':71591, '1f3f3-200d-26a7':71592, '1f3f3':71590, '1f3f4-200d-2620':71593, '1f3f4-e0067-e0062-e0065-e006e-e0067-e007f':71852, '1f3f4-e0067-e0062-e0073-e0063-e0074-e007f':71853, '1f3f4-e0067-e0062-e0077-e006c-e0073-e007f':71854, '1f3f4':71589, '1f3f5':2652, '1f3f7':61234, '1f3f8':51066, '1f3f9':61303, '1f3fa':3805, '1f3fb':9525, '1f3fc':9526, '1f3fd':9527, '1f3fe':9528, '1f3ff':9529, '1f400':2576, '1f401':2575, '1f402':2556, '1f403':2557, '1f404':2558, '1f405':2547, '1f406':2548, '1f407':2579, '1f408-200d-2b1b':2544, '1f408':2543, '1f409':2618, '1f40a':2613, '1f40b':2622, '1f40c':2632, '1f40d':2616, '1f40e':2550, '1f40f':2563, '1f410':2565, '1f411':2564, '1f412':2531, '1f413':2596, '1f414':2595, '1f415-200d-1f9ba':2537, '1f415':2535, '1f416':2560, '1f417':2561, '1f418':2570, '1f419':2629, '1f41a':2630, '1f41b':2634, '1f41c':2635, '1f41d':2636, '1f41e':2638, '1f41f':2625, '1f420':2626, '1f421':2627, '1f422':2614, '1f423':2597, '1f424':2598, '1f425':2599, '1f426':2600, '1f427':2601, '1f428':2586, '1f429':2538, '1f42a':2566, '1f42b':2567, '1f42c':2623, '1f42d':2574, '1f42e':2555, '1f42f':2546, '1f430':2578, '1f431':2542, '1f432':2617, '1f433':2621, '1f434':2549, '1f435':2530, '1f436':2534, '1f437':2559, '1f438':2612, '1f439':2577, '1f43a':2539, '1f43b-200d-2744':2585, '1f43b':2584, '1f43c':2587, '1f43d':2562, '1f43e':2593, '1f43f':2580, '1f440':1381, '1f441-200d-1f5e8':1159, '1f441':1382, '1f442':1373, '1f443':1375, '1f444':1384, '1f445':1383, '1f446':1347, '1f447':1349, '1f448':1345, '1f449':1346, '1f44a':1355, '1f44b':1327, '1f44c':1336, '1f44d':1352, '1f44e':1353, '1f44f':1358, '1f450':1361, '1f451':61144, '1f452':61145, '1f453':61110, '1f454':61115, '1f455':61116, '1f456':61117, '1f457':61122, '1f458':61123, '1f459':61128, '1f45a':61129, '1f45b':61130, '1f45c':61131, '1f45d':61132, '1f45e':61136, '1f45f':61137, '1f460':61140, '1f461':61141, '1f462':61143, '1f463':1687, '1f464':1684, '1f465':1685, '1f466':1388, '1f467':1389, '1f468-200d-1f33e':1457, '1f468-200d-1f373':1460, '1f468-200d-1f37c':1524, '1f468-200d-1f393':1448, '1f468-200d-1f3a4':1478, '1f468-200d-1f3a8':1481, '1f468-200d-1f3eb':1451, '1f468-200d-1f3ed':1466, '1f468-200d-1f466-200d-1f466':1674, '1f468-200d-1f466':1673, '1f468-200d-1f467-200d-1f466':1676, '1f468-200d-1f467-200d-1f467':1677, '1f468-200d-1f467':1675, '1f468-200d-1f468-200d-1f466':1663, '1f468-200d-1f468-200d-1f466-200d-1f466':1666, '1f468-200d-1f468-200d-1f467':1664, '1f468-200d-1f468-200d-1f467-200d-1f466':1665, '1f468-200d-1f468-200d-1f467-200d-1f467':1667, '1f468-200d-1f469-200d-1f466':1658, '1f468-200d-1f469-200d-1f466-200d-1f466':1661, '1f468-200d-1f469-200d-1f467':1659, '1f468-200d-1f469-200d-1f467-200d-1f466':1660, '1f468-200d-1f469-200d-1f467-200d-1f467':1662, '1f468-200d-1f4bb':1475, '1f468-200d-1f4bc':1469, '1f468-200d-1f527':1463, '1f468-200d-1f52c':1472, '1f468-200d-1f680':1487, '1f468-200d-1f692':1490, '1f468-200d-1f9af':1574, '1f468-200d-1f9b0':1396, '1f468-200d-1f9b1':1397, '1f468-200d-1f9b2':1399, '1f468-200d-1f9b3':1398, '1f468-200d-1f9bc':1577, '1f468-200d-1f9bd':1580, '1f468-200d-2695':1445, '1f468-200d-2696':1454, '1f468-200d-2708':1484, '1f468-200d-2764-200d-1f468':1655, '1f468-200d-2764-200d-1f48b-200d-1f468':1651, '1f468':1392, '1f469-200d-1f33e':1458, '1f469-200d-1f373':1461, '1f469-200d-1f37c':1523, '1f469-200d-1f393':1449, '1f469-200d-1f3a4':1479, '1f469-200d-1f3a8':1482, '1f469-200d-1f3eb':1452, '1f469-200d-1f3ed':1467, '1f469-200d-1f466-200d-1f466':1679, '1f469-200d-1f466':1678, '1f469-200d-1f467-200d-1f466':1681, '1f469-200d-1f467-200d-1f467':1682, '1f469-200d-1f467':1680, '1f469-200d-1f469-200d-1f466':1668, '1f469-200d-1f469-200d-1f466-200d-1f466':1671, '1f469-200d-1f469-200d-1f467':1669, '1f469-200d-1f469-200d-1f467-200d-1f466':1670, '1f469-200d-1f469-200d-1f467-200d-1f467':1672, '1f469-200d-1f4bb':1476, '1f469-200d-1f4bc':1470, '1f469-200d-1f527':1464, '1f469-200d-1f52c':1473, '1f469-200d-1f680':1488, '1f469-200d-1f692':1491, '1f469-200d-1f9af':1575, '1f469-200d-1f9b0':1401, '1f469-200d-1f9b1':1403, '1f469-200d-1f9b2':1407, '1f469-200d-1f9b3':1405, '1f469-200d-1f9bc':1578, '1f469-200d-1f9bd':1581, '1f469-200d-2695':1446, '1f469-200d-2696':1455, '1f469-200d-2708':1485, '1f469-200d-2764-200d-1f468':1654, '1f469-200d-2764-200d-1f469':1656, '1f469-200d-2764-200d-1f48b-200d-1f468':1650, '1f469-200d-2764-200d-1f48b-200d-1f469':1652, '1f469':1400, '1f46a':1657, '1f46b':1647, '1f46c':1648, '1f46d':1646, '1f46e-200d-2640':1494, '1f46e-200d-2642':1493, '1f46e':1492, '1f46f-200d-2640':1590, '1f46f-200d-2642':1589, '1f46f':1588, '1f470-200d-2640':1518, '1f470-200d-2642':1517, '1f470':1516, '1f471-200d-2640':1409, '1f471-200d-2642':1410, '1f471':1391, '1f472':1511, '1f473-200d-2640':1510, '1f473-200d-2642':1509, '1f473':1508, '1f474':1412, '1f475':1413, '1f476':1386, '1f477-200d-2640':1504, '1f477-200d-2642':1503, '1f477':1502, '1f478':1507, '1f479':1109, '1f47a':1110, '1f47b':1111, '1f47c':1526, '1f47d':1112, '1f47e':1113, '1f47f':1104, '1f480':1105, '1f481-200d-2640':1428, '1f481-200d-2642':1427, '1f481':1426, '1f482-200d-2640':1500, '1f482-200d-2642':1499, '1f482':1498, '1f483':1585, '1f484':61152, '1f485':1366, '1f486-200d-2640':1560, '1f486-200d-2642':1559, '1f486':1558, '1f487-200d-2640':1563, '1f487-200d-2642':1562, '1f487':1561, '1f488':4870, '1f489':61326, '1f48a':61328, '1f48b':1127, '1f48c':1128, '1f48d':61153, '1f48e':61154, '1f48f':1649, '1f490':2648, '1f491':1653, '1f492':4846, '1f493':1133, '1f494':1138, '1f495':1135, '1f496':1131, '1f497':1132, '1f498':1129, '1f499':1145, '1f49a':1144, '1f49b':1143, '1f49c':1146, '1f49d':1130, '1f49e':1134, '1f49f':1136, '1f4a0':62946, '1f4a1':61214, '1f4a2':1151, '1f4a3':1157, '1f4a4':1163, '1f4a5':1152, '1f4a6':1154, '1f4a7':41022, '1f4a8':1155, '1f4a9':1107, '1f4aa':1368, '1f4ab':1153, '1f4ac':1158, '1f4ad':1162, '1f4ae':2650, '1f4af':1150, '1f4b0':61235, '1f4b1':62841, '1f4b2':62842, '1f4b3':61242, '1f4b4':61237, '1f4b5':61238, '1f4b6':61239, '1f4b7':61240, '1f4b8':61241, '1f4b9':61244, '1f4ba':4936, '1f4bb':61191, '1f4bc':61265, '1f4bd':61197, '1f4be':61198, '1f4bf':61199, '1f4c0':61200, '1f4c1':61266, '1f4c2':61267, '1f4c3':61227, '1f4c4':61229, '1f4c5':61269, '1f4c6':61270, '1f4c7':61273, '1f4c8':61274, '1f4c9':61275, '1f4ca':61276, '1f4cb':61277, '1f4cc':61278, '1f4cd':61279, '1f4ce':61280, '1f4cf':61282, '1f4d0':61283, '1f4d1':61232, '1f4d2':61226, '1f4d3':61225, '1f4d4':61218, '1f4d5':61219, '1f4d6':61220, '1f4d7':61221, '1f4d8':61222, '1f4d9':61223, '1f4da':61224, '1f4db':62847, '1f4dc':61228, '1f4dd':61264, '1f4de':61185, '1f4df':61186, '1f4e0':61187, '1f4e1':61325, '1f4e2':61159, '1f4e3':61160, '1f4e4':61249, '1f4e5':61250, '1f4e6':61251, '1f4e7':61246, '1f4e8':61247, '1f4e9':61248, '1f4ea':61253, '1f4eb':61252, '1f4ec':61254, '1f4ed':61255, '1f4ee':61256, '1f4ef':61161, '1f4f0':61230, '1f4f1':61182, '1f4f2':61183, '1f4f3':62823, '1f4f4':62824, '1f4f5':62751, '1f4f6':62822, '1f4f7':61207, '1f4f8':61208, '1f4f9':61209, '1f4fa':61206, '1f4fb':61172, '1f4fc':61210, '1f4fd':61204, '1f4ff':61151, '1f500':62801, '1f501':62802, '1f502':62803, '1f503':62769, '1f504':62770, '1f505':62820, '1f506':62821, '1f507':61155, '1f508':61156, '1f509':61157, '1f50a':61158, '1f50b':61188, '1f50c':61190, '1f50d':61211, '1f50e':61212, '1f50f':61290, '1f510':61291, '1f511':61292, '1f512':61288, '1f513':61289, '1f514':61162, '1f515':61163, '1f516':61233, '1f517':61313, '1f518':62947, '1f519':62771, '1f51a':62772, '1f51b':62773, '1f51c':62774, '1f51d':62775, '1f51e':62752, '1f51f':62876, '1f520':62877, '1f521':62878, '1f522':62879, '1f523':62880, '1f524':62881, '1f525':41021, '1f526':61215, '1f527':61306, '1f528':61294, '1f529':61308, '1f52a':3803, '1f52b':61301, '1f52c':61323, '1f52d':61324, '1f52e':51082, '1f52f':62787, '1f530':62848, '1f531':62846, '1f532':62949, '1f533':62948, '1f534':62916, '1f535':62920, '1f536':62940, '1f537':62941, '1f538':62942, '1f539':62943, '1f53a':62944, '1f53b':62945, '1f53c':62811, '1f53d':62813, '1f549':62778, '1f54a':2602, '1f54b':4854, '1f54c':4850, '1f54d':4852, '1f54e':62786, '1f550':4955, '1f551':4957, '1f552':4959, '1f553':4961, '1f554':4963, '1f555':4965, '1f556':4967, '1f557':4969, '1f558':4971, '1f559':4973, '1f55a':4975, '1f55b':4953, '1f55c':4956, '1f55d':4958, '1f55e':4960, '1f55f':4962, '1f560':4964, '1f561':4966, '1f562':4968, '1f563':4970, '1f564':4972, '1f565':4974, '1f566':4976, '1f567':4954, '1f56f':61213, '1f570':4952, '1f573':1156, '1f574':1587, '1f575-200d-2640':1497, '1f575-200d-2642':1496, '1f575':1495, '1f576':61111, '1f577':2641, '1f578':2642, '1f579':51087, '1f57a':1586, '1f587':61281, '1f58a':61261, '1f58b':61260, '1f58c':61262, '1f58d':61263, '1f590':1329, '1f595':1348, '1f596':1331, '1f5a4':1148, '1f5a5':61192, '1f5a8':61193, '1f5b1':61195, '1f5b2':61196, '1f5bc':51104, '1f5c2':61268, '1f5c3':61285, '1f5c4':61286, '1f5d1':61287, '1f5d2':61271, '1f5d3':61272, '1f5dc':61310, '1f5dd':61293, '1f5de':61231, '1f5e1':61299, '1f5e3':1683, '1f5e8':1160, '1f5ef':1161, '1f5f3':61257, '1f5fa':4810, '1f5fb':4816, '1f5fc':4847, '1f5fd':4848, '1f5fe':4811, '1f5ff':61362, '1f600':11, '1f601':14, '1f602':18, '1f603':12, '1f604':13, '1f605':16, '1f606':15, '1f607':114, '1f608':1103, '1f609':112, '1f60a':113, '1f60b':124, '1f60c':150, '1f60d':116, '1f60e':170, '1f60f':144, '1f610':139, '1f611':140, '1f612':145, '1f613':195, '1f614':151, '1f615':173, '1f616':192, '1f617':119, '1f618':118, '1f619':122, '1f61a':121, '1f61b':125, '1f61c':126, '1f61d':128, '1f61e':194, '1f61f':175, '1f620':1101, '1f621':1100, '1f622':189, '1f623':193, '1f624':199, '1f625':188, '1f626':184, '1f627':185, '1f628':186, '1f629':196, '1f62a':152, '1f62b':197, '1f62c':147, '1f62d':190, '1f62e-200d-1f4a8':148, '1f62e':178, '1f62f':179, '1f630':187, '1f631':191, '1f632':180, '1f633':181, '1f634':154, '1f635-200d-1f4ab':165, '1f635':164, '1f636-200d-1f32b':143, '1f636':141, '1f637':155, '1f638':1116, '1f639':1117, '1f63a':1115, '1f63b':1118, '1f63c':1119, '1f63d':1120, '1f63e':1123, '1f63f':1122, '1f640':1121, '1f641':176, '1f642':19, '1f643':110, '1f644':146, '1f645-200d-2640':1422, '1f645-200d-2642':1421, '1f645':1420, '1f646-200d-2640':1425, '1f646-200d-2642':1424, '1f646':1423, '1f647-200d-2640':1437, '1f647-200d-2642':1436, '1f647':1435, '1f648':1124, '1f649':1125, '1f64a':1126, '1f64b-200d-2640':1431, '1f64b-200d-2642':1430, '1f64b':1429, '1f64c':1359, '1f64d-200d-2640':1416, '1f64d-200d-2642':1415, '1f64d':1414, '1f64e-200d-2640':1419, '1f64e-200d-2642':1418, '1f64e':1417, '1f64f':1364, '1f680':4942, '1f681':4937, '1f682':4872, '1f683':4873, '1f684':4874, '1f685':4875, '1f686':4876, '1f687':4877, '1f688':4878, '1f689':4879, '1f68a':4880, '1f68b':4883, '1f68c':4884, '1f68d':4885, '1f68e':4886, '1f68f':4911, '1f690':4887, '1f691':4888, '1f692':4889, '1f693':4890, '1f694':4891, '1f695':4892, '1f696':4893, '1f697':4894, '1f698':4895, '1f699':4896, '1f69a':4898, '1f69b':4899, '1f69c':4900, '1f69d':4881, '1f69e':4882, '1f69f':4938, '1f6a0':4939, '1f6a1':4940, '1f6a2':4930, '1f6a3-200d-2640':1609, '1f6a3-200d-2642':1608, '1f6a3':1607, '1f6a4':4926, '1f6a5':4918, '1f6a6':4919, '1f6a7':4921, '1f6a8':4917, '1f6a9':71587, '1f6aa':61333, '1f6ab':62745, '1f6ac':61358, '1f6ad':62747, '1f6ae':62730, '1f6af':62748, '1f6b0':62731, '1f6b1':62749, '1f6b2':4907, '1f6b3':62746, '1f6b4-200d-2640':1621, '1f6b4-200d-2642':1620, '1f6b4':1619, '1f6b5-200d-2640':1624, '1f6b5-200d-2642':1623, '1f6b5':1622, '1f6b6-200d-2640':1566, '1f6b6-200d-2642':1565, '1f6b6':1564, '1f6b7':62750, '1f6b8':62743, '1f6b9':62733, '1f6ba':62734, '1f6bb':62735, '1f6bc':62736, '1f6bd':61340, '1f6be':62737, '1f6bf':61342, '1f6c0':1643, '1f6c1':61343, '1f6c2':62738, '1f6c3':62739, '1f6c4':62740, '1f6c5':62741, '1f6cb':61338, '1f6cc':1644, '1f6cd':61133, '1f6ce':4944, '1f6cf':61337, '1f6d0':62776, '1f6d1':4920, '1f6d2':61357, '1f6d5':4851, '1f6d6':4828, '1f6d7':61334, '1f6e0':61298, '1f6e1':61304, '1f6e2':4914, '1f6e3':4912, '1f6e4':4913, '1f6e5':4929, '1f6e9':4932, '1f6eb':4933, '1f6ec':4934, '1f6f0':4941, '1f6f3':4927, '1f6f4':4908, '1f6f5':4903, '1f6f6':4925, '1f6f7':51076, '1f6f8':4943, '1f6f9':4909, '1f6fa':4906, '1f6fb':4897, '1f6fc':4910, '1f7e0':62917, '1f7e1':62918, '1f7e2':62919, '1f7e3':62921, '1f7e4':62922, '1f7e5':62925, '1f7e6':62929, '1f7e7':62926, '1f7e8':62927, '1f7e9':62928, '1f7ea':62930, '1f7eb':62931, '1f90c':1337, '1f90d':1149, '1f90e':1147, '1f90f':1338, '1f910':137, '1f911':129, '1f912':156, '1f913':171, '1f914':135, '1f915':157, '1f916':1114, '1f917':130, '1f918':1343, '1f919':1344, '1f91a':1328, '1f91b':1356, '1f91c':1357, '1f91d':1363, '1f91e':1340, '1f91f':1342, '1f920':167, '1f921':1108, '1f922':158, '1f923':17, '1f924':153, '1f925':149, '1f926-200d-2640':1440, '1f926-200d-2642':1439, '1f926':1438, '1f927':160, '1f928':138, '1f929':117, '1f92a':127, '1f92b':134, '1f92c':1102, '1f92d':131, '1f92e':159, '1f92f':166, '1f930':1519, '1f931':1522, '1f932':1362, '1f933':1367, '1f934':1506, '1f935-200d-2640':1515, '1f935-200d-2642':1514, '1f935':1513, '1f936':1528, '1f937-200d-2640':1443, '1f937-200d-2642':1442, '1f937':1441, '1f938-200d-2640':1627, '1f938-200d-2642':1626, '1f938':1625, '1f939-200d-2640':1639, '1f939-200d-2642':1638, '1f939':1637, '1f93a':1597, '1f93c-200d-2640':1630, '1f93c-200d-2642':1629, '1f93c':1628, '1f93d-200d-2640':1633, '1f93d-200d-2642':1632, '1f93d':1631, '1f93e-200d-2640':1636, '1f93e-200d-2642':1635, '1f93e':1634, '1f93f':51073, '1f940':2654, '1f941':61180, '1f942':3791, '1f943':3792, '1f944':3802, '1f945':51069, '1f947':51048, '1f948':51049, '1f949':51050, '1f94a':51067, '1f94b':51068, '1f94c':51077, '1f94d':51064, '1f94e':51053, '1f94f':51059, '1f950':3710, '1f951':3693, '1f952':3700, '1f953':3721, '1f954':3695, '1f955':3696, '1f956':3711, '1f957':3738, '1f958':3734, '1f959':3730, '1f95a':3732, '1f95b':3780, '1f95c':3706, '1f95d':3689, '1f95e':3715, '1f95f':3757, '1f960':3758, '1f961':3759, '1f962':3799, '1f963':3737, '1f964':3794, '1f965':3692, '1f966':3702, '1f967':3773, '1f968':3713, '1f969':3720, '1f96a':3726, '1f96b':3742, '1f96c':3701, '1f96d':3681, '1f96e':3755, '1f96f':3714, '1f970':115, '1f971':198, '1f972':123, '1f973':168, '1f974':163, '1f975':161, '1f976':162, '1f977':1501, '1f978':169, '1f97a':182, '1f97b':61124, '1f97c':61113, '1f97d':61112, '1f97e':61138, '1f97f':61139, '1f980':3760, '1f981':2545, '1f982':2643, '1f983':2594, '1f984':2551, '1f985':2603, '1f986':2604, '1f987':2583, '1f988':2628, '1f989':2606, '1f98a':2540, '1f98b':2633, '1f98c':2553, '1f98d':2532, '1f98e':2615, '1f98f':2572, '1f990':3762, '1f991':3763, '1f992':2569, '1f993':2552, '1f994':2582, '1f995':2619, '1f996':2620, '1f997':2639, '1f998':2591, '1f999':2568, '1f99a':2610, '1f99b':2573, '1f99c':2611, '1f99d':2541, '1f99e':3761, '1f99f':2644, '1f9a0':2647, '1f9a1':2592, '1f9a2':2605, '1f9a3':2571, '1f9a4':2607, '1f9a5':2588, '1f9a6':2589, '1f9a7':2533, '1f9a8':2590, '1f9a9':2609, '1f9aa':3764, '1f9ab':2581, '1f9ac':2554, '1f9ad':2624, '1f9ae':2536, '1f9af':61312, '1f9b4':1380, '1f9b5':1371, '1f9b6':1372, '1f9b7':1379, '1f9b8-200d-2640':1532, '1f9b8-200d-2642':1531, '1f9b8':1530, '1f9b9-200d-2640':1535, '1f9b9-200d-2642':1534, '1f9b9':1533, '1f9ba':61114, '1f9bb':1374, '1f9bc':4905, '1f9bd':4904, '1f9be':1369, '1f9bf':1370, '1f9c0':3717, '1f9c1':3772, '1f9c2':3741, '1f9c3':3796, '1f9c4':3703, '1f9c5':3704, '1f9c6':3731, '1f9c7':3716, '1f9c8':3740, '1f9c9':3797, '1f9ca':3798, '1f9cb':3795, '1f9cd-200d-2640':1569, '1f9cd-200d-2642':1568, '1f9cd':1567, '1f9ce-200d-2640':1572, '1f9ce-200d-2642':1571, '1f9ce':1570, '1f9cf-200d-2640':1434, '1f9cf-200d-2642':1433, '1f9cf':1432, '1f9d0':172, '1f9d1-200d-1f33e':1456, '1f9d1-200d-1f373':1459, '1f9d1-200d-1f37c':1525, '1f9d1-200d-1f384':1529, '1f9d1-200d-1f393':1447, '1f9d1-200d-1f3a4':1477, '1f9d1-200d-1f3a8':1480, '1f9d1-200d-1f3eb':1450, '1f9d1-200d-1f3ed':1465, '1f9d1-200d-1f4bb':1474, '1f9d1-200d-1f4bc':1468, '1f9d1-200d-1f527':1462, '1f9d1-200d-1f52c':1471, '1f9d1-200d-1f680':1486, '1f9d1-200d-1f692':1489, '1f9d1-200d-1f91d-200d-1f9d1':1645, '1f9d1-200d-1f9af':1573, '1f9d1-200d-1f9b0':1402, '1f9d1-200d-1f9b1':1404, '1f9d1-200d-1f9b2':1408, '1f9d1-200d-1f9b3':1406, '1f9d1-200d-1f9bc':1576, '1f9d1-200d-1f9bd':1579, '1f9d1-200d-2695':1444, '1f9d1-200d-2696':1453, '1f9d1-200d-2708':1483, '1f9d1':1390, '1f9d2':1387, '1f9d3':1411, '1f9d4-200d-2640':1395, '1f9d4-200d-2642':1394, '1f9d4':1393, '1f9d5':1512, '1f9d6-200d-2640':1593, '1f9d6-200d-2642':1592, '1f9d6':1591, '1f9d7-200d-2640':1596, '1f9d7-200d-2642':1595, '1f9d7':1594, '1f9d8-200d-2640':1642, '1f9d8-200d-2642':1641, '1f9d8':1640, '1f9d9-200d-2640':1538, '1f9d9-200d-2642':1537, '1f9d9':1536, '1f9da-200d-2640':1541, '1f9da-200d-2642':1540, '1f9da':1539, '1f9db-200d-2640':1544, '1f9db-200d-2642':1543, '1f9db':1542, '1f9dc-200d-2640':1547, '1f9dc-200d-2642':1546, '1f9dc':1545, '1f9dd-200d-2640':1550, '1f9dd-200d-2642':1549, '1f9dd':1548, '1f9de-200d-2640':1553, '1f9de-200d-2642':1552, '1f9de':1551, '1f9df-200d-2640':1556, '1f9df-200d-2642':1555, '1f9df':1554, '1f9e0':1376, '1f9e1':1142, '1f9e2':61148, '1f9e3':61118, '1f9e4':61119, '1f9e5':61120, '1f9e6':61121, '1f9e7':51039, '1f9e8':51028, '1f9e9':51090, '1f9ea':61320, '1f9eb':61321, '1f9ec':61322, '1f9ed':4812, '1f9ee':61201, '1f9ef':61356, '1f9f0':61316, '1f9f1':4825, '1f9f2':61317, '1f9f3':4945, '1f9f4':61346, '1f9f5':51106, '1f9f6':51108, '1f9f7':61347, '1f9f8':51091, '1f9f9':61348, '1f9fa':61349, '1f9fb':61350, '1f9fc':61352, '1f9fd':61355, '1f9fe':61243, '1f9ff':51084, '1fa70':61142, '1fa71':61125, '1fa72':61126, '1fa73':61127, '1fa74':61135, '1fa78':61327, '1fa79':61329, '1fa7a':61331, '1fa80':51079, '1fa81':51080, '1fa82':4935, '1fa83':61302, '1fa84':51083, '1fa85':51092, '1fa86':51094, '1fa90':4993, '1fa91':61339, '1fa92':61345, '1fa93':61295, '1fa94':61217, '1fa95':61179, '1fa96':61149, '1fa97':61174, '1fa98':61181, '1fa99':61236, '1fa9a':61305, '1fa9b':61307, '1fa9c':61318, '1fa9d':61315, '1fa9e':61335, '1fa9f':61336, '1faa0':61341, '1faa1':51107, '1faa2':51109, '1faa3':61351, '1faa4':61344, '1faa5':61354, '1faa6':61360, '1faa7':61363, '1faa8':4826, '1fab0':2645, '1fab1':2646, '1fab2':2637, '1fab3':2640, '1fab4':2660, '1fab5':4827, '1fab6':2608, '1fac0':1377, '1fac1':1378, '1fac2':1686, '1fad0':3688, '1fad1':3699, '1fad2':3691, '1fad3':3712, '1fad4':3729, '1fad5':3736, '1fad6':3782, '203c':62834, '21a9':62765, '21aa':62766, '231a':4948, '231b':4946, '23cf':62818, '23e9':62805, '23ea':62809, '23eb':62812, '23ec':62814, '23ed':62806, '23ee':62810, '23ef':62807, '23f0':4949, '23f1':4950, '23f2':4951, '23f3':4947, '23f8':62815, '23f9':62816, '23fa':62817, '24c2':62890, '25aa':62938, '25ab':62939, '25b6':62804, '25c0':62808, '25fb':62935, '25fc':62934, '25fd':62937, '25fe':62936, '260e':61184, '261d':1350, '262a':62784, '262e':62785, '262f':62781, '263a':120, '264a':62790, '264b':62791, '264c':62792, '264d':62793, '264e':62794, '264f':62795, '265f':51099, '267b':62844, '267e':62833, '267f':62732, '269b':62777, '269c':62845, '26a0':62742, '26a1':41016, '26a7':62827, '26aa':62924, '26ab':62923, '26b0':61359, '26b1':61361, '26bd':51051, '26be':51052, '26c4':41019, '26c5':4999, '26c8':41000, '26ce':62800, '26cf':61296, '26d1':61150, '26d3':61314, '26d4':62744, '26e9':4853, '26ea':4849, '26f0':4814, '26f1':41015, '26f2':4855, '26f3':51070, '26f4':4928, '26f5':4924, '26f7':1599, '26f8':51071, '26f9-200d-2640':1615, '26f9-200d-2642':1614, '26f9':1613, '26fa':4856, '26fd':4915, '270a':1354, '270b':1330, '270c':1339, '270d':1365, '270f':61258, '271d':62782, '274c':62853, '274e':62854, '2764-200d-1f525':1139, '2764-200d-1fa79':1140, '27a1':62757, '27b0':62855, '27bf':62856, '2b05':62761, '2b06':62755, '2b07':62759, '2b1b':62932, '2b1c':62933, '2b50':4994, '2b55':62849, '303d':62857, '1f385-1f3fb':0, '1f385-1f3fc':0, '1f385-1f3fd':0, '1f385-1f3fe':0, '1f385-1f3ff':0, '1f3c2-1f3fb':0, '1f3c2-1f3fc':0, '1f3c2-1f3fd':0, '1f3c2-1f3fe':0, '1f3c2-1f3ff':0, '1f3c3-1f3fb-200d-2640':0, '1f3c3-1f3fc-200d-2640':0, '1f3c3-1f3fd-200d-2640':0, '1f3c3-1f3fe-200d-2640':0, '1f3c3-1f3ff-200d-2640':0, '1f3c3-1f3fb-200d-2642':0, '1f3c3-1f3fc-200d-2642':0, '1f3c3-1f3fd-200d-2642':0, '1f3c3-1f3fe-200d-2642':0, '1f3c3-1f3ff-200d-2642':0, '1f3c3-1f3fb':0, '1f3c3-1f3fc':0, '1f3c3-1f3fd':0, '1f3c3-1f3fe':0, '1f3c3-1f3ff':0, '1f3c4-1f3fb-200d-2640':0, '1f3c4-1f3fc-200d-2640':0, '1f3c4-1f3fd-200d-2640':0, '1f3c4-1f3fe-200d-2640':0, '1f3c4-1f3ff-200d-2640':0, '1f3c4-1f3fb-200d-2642':0, '1f3c4-1f3fc-200d-2642':0, '1f3c4-1f3fd-200d-2642':0, '1f3c4-1f3fe-200d-2642':0, '1f3c4-1f3ff-200d-2642':0, '1f3c4-1f3fb':0, '1f3c4-1f3fc':0, '1f3c4-1f3fd':0, '1f3c4-1f3fe':0, '1f3c4-1f3ff':0, '1f3c7-1f3fb':0, '1f3c7-1f3fc':0, '1f3c7-1f3fd':0, '1f3c7-1f3fe':0, '1f3c7-1f3ff':0, '1f3ca-1f3fb-200d-2640':0, '1f3ca-1f3fc-200d-2640':0, '1f3ca-1f3fd-200d-2640':0, '1f3ca-1f3fe-200d-2640':0, '1f3ca-1f3ff-200d-2640':0, '1f3ca-1f3fb-200d-2642':0, '1f3ca-1f3fc-200d-2642':0, '1f3ca-1f3fd-200d-2642':0, '1f3ca-1f3fe-200d-2642':0, '1f3ca-1f3ff-200d-2642':0, '1f3ca-1f3fb':0, '1f3ca-1f3fc':0, '1f3ca-1f3fd':0, '1f3ca-1f3fe':0, '1f3ca-1f3ff':0, '1f3cb-1f3fb-200d-2640':0, '1f3cb-1f3fc-200d-2640':0, '1f3cb-1f3fd-200d-2640':0, '1f3cb-1f3fe-200d-2640':0, '1f3cb-1f3ff-200d-2640':0, '1f3cb-1f3fb-200d-2642':0, '1f3cb-1f3fc-200d-2642':0, '1f3cb-1f3fd-200d-2642':0, '1f3cb-1f3fe-200d-2642':0, '1f3cb-1f3ff-200d-2642':0, '1f3cb-1f3fb':0, '1f3cb-1f3fc':0, '1f3cb-1f3fd':0, '1f3cb-1f3fe':0, '1f3cb-1f3ff':0, '1f3cc-1f3fb-200d-2640':0, '1f3cc-1f3fc-200d-2640':0, '1f3cc-1f3fd-200d-2640':0, '1f3cc-1f3fe-200d-2640':0, '1f3cc-1f3ff-200d-2640':0, '1f3cc-1f3fb-200d-2642':0, '1f3cc-1f3fc-200d-2642':0, '1f3cc-1f3fd-200d-2642':0, '1f3cc-1f3fe-200d-2642':0, '1f3cc-1f3ff-200d-2642':0, '1f3cc-1f3fb':0, '1f3cc-1f3fc':0, '1f3cc-1f3fd':0, '1f3cc-1f3fe':0, '1f3cc-1f3ff':0, '1f442-1f3fb':0, '1f442-1f3fc':0, '1f442-1f3fd':0, '1f442-1f3fe':0, '1f442-1f3ff':0, '1f443-1f3fb':0, '1f443-1f3fc':0, '1f443-1f3fd':0, '1f443-1f3fe':0, '1f443-1f3ff':0, '1f446-1f3fb':0, '1f446-1f3fc':0, '1f446-1f3fd':0, '1f446-1f3fe':0, '1f446-1f3ff':0, '1f447-1f3fb':0, '1f447-1f3fc':0, '1f447-1f3fd':0, '1f447-1f3fe':0, '1f447-1f3ff':0, '1f448-1f3fb':0, '1f448-1f3fc':0, '1f448-1f3fd':0, '1f448-1f3fe':0, '1f448-1f3ff':0, '1f449-1f3fb':0, '1f449-1f3fc':0, '1f449-1f3fd':0, '1f449-1f3fe':0, '1f449-1f3ff':0, '1f44a-1f3fb':0, '1f44a-1f3fc':0, '1f44a-1f3fd':0, '1f44a-1f3fe':0, '1f44a-1f3ff':0, '1f44b-1f3fb':0, '1f44b-1f3fc':0, '1f44b-1f3fd':0, '1f44b-1f3fe':0, '1f44b-1f3ff':0, '1f44c-1f3fb':0, '1f44c-1f3fc':0, '1f44c-1f3fd':0, '1f44c-1f3fe':0, '1f44c-1f3ff':0, '1f44d-1f3fb':0, '1f44d-1f3fc':0, '1f44d-1f3fd':0, '1f44d-1f3fe':0, '1f44d-1f3ff':0, '1f44e-1f3fb':0, '1f44e-1f3fc':0, '1f44e-1f3fd':0, '1f44e-1f3fe':0, '1f44e-1f3ff':0, '1f44f-1f3fb':0, '1f44f-1f3fc':0, '1f44f-1f3fd':0, '1f44f-1f3fe':0, '1f44f-1f3ff':0, '1f450-1f3fb':0, '1f450-1f3fc':0, '1f450-1f3fd':0, '1f450-1f3fe':0, '1f450-1f3ff':0, '1f466-1f3fb':0, '1f466-1f3fc':0, '1f466-1f3fd':0, '1f466-1f3fe':0, '1f466-1f3ff':0, '1f467-1f3fb':0, '1f467-1f3fc':0, '1f467-1f3fd':0, '1f467-1f3fe':0, '1f467-1f3ff':0, '1f468-1f3fb-200d-1f33e':0, '1f468-1f3fc-200d-1f33e':0, '1f468-1f3fd-200d-1f33e':0, '1f468-1f3fe-200d-1f33e':0, '1f468-1f3ff-200d-1f33e':0, '1f468-1f3fb-200d-1f373':0, '1f468-1f3fc-200d-1f373':0, '1f468-1f3fd-200d-1f373':0, '1f468-1f3fe-200d-1f373':0, '1f468-1f3ff-200d-1f373':0, '1f468-1f3fb-200d-1f37c':0, '1f468-1f3fc-200d-1f37c':0, '1f468-1f3fd-200d-1f37c':0, '1f468-1f3fe-200d-1f37c':0, '1f468-1f3ff-200d-1f37c':0, '1f468-1f3fb-200d-1f393':0, '1f468-1f3fc-200d-1f393':0, '1f468-1f3fd-200d-1f393':0, '1f468-1f3fe-200d-1f393':0, '1f468-1f3ff-200d-1f393':0, '1f468-1f3fb-200d-1f3a4':0, '1f468-1f3fc-200d-1f3a4':0, '1f468-1f3fd-200d-1f3a4':0, '1f468-1f3fe-200d-1f3a4':0, '1f468-1f3ff-200d-1f3a4':0, '1f468-1f3fb-200d-1f3a8':0, '1f468-1f3fc-200d-1f3a8':0, '1f468-1f3fd-200d-1f3a8':0, '1f468-1f3fe-200d-1f3a8':0, '1f468-1f3ff-200d-1f3a8':0, '1f468-1f3fb-200d-1f3eb':0, '1f468-1f3fc-200d-1f3eb':0, '1f468-1f3fd-200d-1f3eb':0, '1f468-1f3fe-200d-1f3eb':0, '1f468-1f3ff-200d-1f3eb':0, '1f468-1f3fb-200d-1f3ed':0, '1f468-1f3fc-200d-1f3ed':0, '1f468-1f3fd-200d-1f3ed':0, '1f468-1f3fe-200d-1f3ed':0, '1f468-1f3ff-200d-1f3ed':0, '1f468-1f3fb-200d-1f4bb':0, '1f468-1f3fc-200d-1f4bb':0, '1f468-1f3fd-200d-1f4bb':0, '1f468-1f3fe-200d-1f4bb':0, '1f468-1f3ff-200d-1f4bb':0, '1f468-1f3fb-200d-1f4bc':0, '1f468-1f3fc-200d-1f4bc':0, '1f468-1f3fd-200d-1f4bc':0, '1f468-1f3fe-200d-1f4bc':0, '1f468-1f3ff-200d-1f4bc':0, '1f468-1f3fb-200d-1f527':0, '1f468-1f3fc-200d-1f527':0, '1f468-1f3fd-200d-1f527':0, '1f468-1f3fe-200d-1f527':0, '1f468-1f3ff-200d-1f527':0, '1f468-1f3fb-200d-1f52c':0, '1f468-1f3fc-200d-1f52c':0, '1f468-1f3fd-200d-1f52c':0, '1f468-1f3fe-200d-1f52c':0, '1f468-1f3ff-200d-1f52c':0, '1f468-1f3fb-200d-1f680':0, '1f468-1f3fc-200d-1f680':0, '1f468-1f3fd-200d-1f680':0, '1f468-1f3fe-200d-1f680':0, '1f468-1f3ff-200d-1f680':0, '1f468-1f3fb-200d-1f692':0, '1f468-1f3fc-200d-1f692':0, '1f468-1f3fd-200d-1f692':0, '1f468-1f3fe-200d-1f692':0, '1f468-1f3ff-200d-1f692':0, '1f468-1f3fb-200d-1f9af':0, '1f468-1f3fc-200d-1f9af':0, '1f468-1f3fd-200d-1f9af':0, '1f468-1f3fe-200d-1f9af':0, '1f468-1f3ff-200d-1f9af':0, '1f468-1f3fb-200d-1f9b0':0, '1f468-1f3fc-200d-1f9b0':0, '1f468-1f3fd-200d-1f9b0':0, '1f468-1f3fe-200d-1f9b0':0, '1f468-1f3ff-200d-1f9b0':0, '1f468-1f3fb-200d-1f9b1':0, '1f468-1f3fc-200d-1f9b1':0, '1f468-1f3fd-200d-1f9b1':0, '1f468-1f3fe-200d-1f9b1':0, '1f468-1f3ff-200d-1f9b1':0, '1f468-1f3fb-200d-1f9b2':0, '1f468-1f3fc-200d-1f9b2':0, '1f468-1f3fd-200d-1f9b2':0, '1f468-1f3fe-200d-1f9b2':0, '1f468-1f3ff-200d-1f9b2':0, '1f468-1f3fb-200d-1f9b3':0, '1f468-1f3fc-200d-1f9b3':0, '1f468-1f3fd-200d-1f9b3':0, '1f468-1f3fe-200d-1f9b3':0, '1f468-1f3ff-200d-1f9b3':0, '1f468-1f3fb-200d-1f9bc':0, '1f468-1f3fc-200d-1f9bc':0, '1f468-1f3fd-200d-1f9bc':0, '1f468-1f3fe-200d-1f9bc':0, '1f468-1f3ff-200d-1f9bc':0, '1f468-1f3fb-200d-1f9bd':0, '1f468-1f3fc-200d-1f9bd':0, '1f468-1f3fd-200d-1f9bd':0, '1f468-1f3fe-200d-1f9bd':0, '1f468-1f3ff-200d-1f9bd':0, '1f468-1f3fb-200d-2695':0, '1f468-1f3fc-200d-2695':0, '1f468-1f3fd-200d-2695':0, '1f468-1f3fe-200d-2695':0, '1f468-1f3ff-200d-2695':0, '1f468-1f3fb-200d-2696':0, '1f468-1f3fc-200d-2696':0, '1f468-1f3fd-200d-2696':0, '1f468-1f3fe-200d-2696':0, '1f468-1f3ff-200d-2696':0, '1f468-1f3fb-200d-2708':0, '1f468-1f3fc-200d-2708':0, '1f468-1f3fd-200d-2708':0, '1f468-1f3fe-200d-2708':0, '1f468-1f3ff-200d-2708':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fb':0, '1f468-1f3fc':0, '1f468-1f3fd':0, '1f468-1f3fe':0, '1f468-1f3ff':0, '1f469-1f3fb-200d-1f33e':0, '1f469-1f3fc-200d-1f33e':0, '1f469-1f3fd-200d-1f33e':0, '1f469-1f3fe-200d-1f33e':0, '1f469-1f3ff-200d-1f33e':0, '1f469-1f3fb-200d-1f373':0, '1f469-1f3fc-200d-1f373':0, '1f469-1f3fd-200d-1f373':0, '1f469-1f3fe-200d-1f373':0, '1f469-1f3ff-200d-1f373':0, '1f469-1f3fb-200d-1f37c':0, '1f469-1f3fc-200d-1f37c':0, '1f469-1f3fd-200d-1f37c':0, '1f469-1f3fe-200d-1f37c':0, '1f469-1f3ff-200d-1f37c':0, '1f469-1f3fb-200d-1f393':0, '1f469-1f3fc-200d-1f393':0, '1f469-1f3fd-200d-1f393':0, '1f469-1f3fe-200d-1f393':0, '1f469-1f3ff-200d-1f393':0, '1f469-1f3fb-200d-1f3a4':0, '1f469-1f3fc-200d-1f3a4':0, '1f469-1f3fd-200d-1f3a4':0, '1f469-1f3fe-200d-1f3a4':0, '1f469-1f3ff-200d-1f3a4':0, '1f469-1f3fb-200d-1f3a8':0, '1f469-1f3fc-200d-1f3a8':0, '1f469-1f3fd-200d-1f3a8':0, '1f469-1f3fe-200d-1f3a8':0, '1f469-1f3ff-200d-1f3a8':0, '1f469-1f3fb-200d-1f3eb':0, '1f469-1f3fc-200d-1f3eb':0, '1f469-1f3fd-200d-1f3eb':0, '1f469-1f3fe-200d-1f3eb':0, '1f469-1f3ff-200d-1f3eb':0, '1f469-1f3fb-200d-1f3ed':0, '1f469-1f3fc-200d-1f3ed':0, '1f469-1f3fd-200d-1f3ed':0, '1f469-1f3fe-200d-1f3ed':0, '1f469-1f3ff-200d-1f3ed':0, '1f469-1f3fb-200d-1f4bb':0, '1f469-1f3fc-200d-1f4bb':0, '1f469-1f3fd-200d-1f4bb':0, '1f469-1f3fe-200d-1f4bb':0, '1f469-1f3ff-200d-1f4bb':0, '1f469-1f3fb-200d-1f4bc':0, '1f469-1f3fc-200d-1f4bc':0, '1f469-1f3fd-200d-1f4bc':0, '1f469-1f3fe-200d-1f4bc':0, '1f469-1f3ff-200d-1f4bc':0, '1f469-1f3fb-200d-1f527':0, '1f469-1f3fc-200d-1f527':0, '1f469-1f3fd-200d-1f527':0, '1f469-1f3fe-200d-1f527':0, '1f469-1f3ff-200d-1f527':0, '1f469-1f3fb-200d-1f52c':0, '1f469-1f3fc-200d-1f52c':0, '1f469-1f3fd-200d-1f52c':0, '1f469-1f3fe-200d-1f52c':0, '1f469-1f3ff-200d-1f52c':0, '1f469-1f3fb-200d-1f680':0, '1f469-1f3fc-200d-1f680':0, '1f469-1f3fd-200d-1f680':0, '1f469-1f3fe-200d-1f680':0, '1f469-1f3ff-200d-1f680':0, '1f469-1f3fb-200d-1f692':0, '1f469-1f3fc-200d-1f692':0, '1f469-1f3fd-200d-1f692':0, '1f469-1f3fe-200d-1f692':0, '1f469-1f3ff-200d-1f692':0, '1f469-1f3fb-200d-1f9af':0, '1f469-1f3fc-200d-1f9af':0, '1f469-1f3fd-200d-1f9af':0, '1f469-1f3fe-200d-1f9af':0, '1f469-1f3ff-200d-1f9af':0, '1f469-1f3fb-200d-1f9b0':0, '1f469-1f3fc-200d-1f9b0':0, '1f469-1f3fd-200d-1f9b0':0, '1f469-1f3fe-200d-1f9b0':0, '1f469-1f3ff-200d-1f9b0':0, '1f469-1f3fb-200d-1f9b1':0, '1f469-1f3fc-200d-1f9b1':0, '1f469-1f3fd-200d-1f9b1':0, '1f469-1f3fe-200d-1f9b1':0, '1f469-1f3ff-200d-1f9b1':0, '1f469-1f3fb-200d-1f9b2':0, '1f469-1f3fc-200d-1f9b2':0, '1f469-1f3fd-200d-1f9b2':0, '1f469-1f3fe-200d-1f9b2':0, '1f469-1f3ff-200d-1f9b2':0, '1f469-1f3fb-200d-1f9b3':0, '1f469-1f3fc-200d-1f9b3':0, '1f469-1f3fd-200d-1f9b3':0, '1f469-1f3fe-200d-1f9b3':0, '1f469-1f3ff-200d-1f9b3':0, '1f469-1f3fb-200d-1f9bc':0, '1f469-1f3fc-200d-1f9bc':0, '1f469-1f3fd-200d-1f9bc':0, '1f469-1f3fe-200d-1f9bc':0, '1f469-1f3ff-200d-1f9bc':0, '1f469-1f3fb-200d-1f9bd':0, '1f469-1f3fc-200d-1f9bd':0, '1f469-1f3fd-200d-1f9bd':0, '1f469-1f3fe-200d-1f9bd':0, '1f469-1f3ff-200d-1f9bd':0, '1f469-1f3fb-200d-2695':0, '1f469-1f3fc-200d-2695':0, '1f469-1f3fd-200d-2695':0, '1f469-1f3fe-200d-2695':0, '1f469-1f3ff-200d-2695':0, '1f469-1f3fb-200d-2696':0, '1f469-1f3fc-200d-2696':0, '1f469-1f3fd-200d-2696':0, '1f469-1f3fe-200d-2696':0, '1f469-1f3ff-200d-2696':0, '1f469-1f3fb-200d-2708':0, '1f469-1f3fc-200d-2708':0, '1f469-1f3fd-200d-2708':0, '1f469-1f3fe-200d-2708':0, '1f469-1f3ff-200d-2708':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fb':0, '1f469-1f3fc':0, '1f469-1f3fd':0, '1f469-1f3fe':0, '1f469-1f3ff':0, '1f46b-1f3fb':0, '1f46b-1f3fc':0, '1f46b-1f3fd':0, '1f46b-1f3fe':0, '1f46b-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46c-1f3fb':0, '1f46c-1f3fc':0, '1f46c-1f3fd':0, '1f46c-1f3fe':0, '1f46c-1f3ff':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46d-1f3fb':0, '1f46d-1f3fc':0, '1f46d-1f3fd':0, '1f46d-1f3fe':0, '1f46d-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe':0, '1f46e-1f3fb-200d-2640':0, '1f46e-1f3fc-200d-2640':0, '1f46e-1f3fd-200d-2640':0, '1f46e-1f3fe-200d-2640':0, '1f46e-1f3ff-200d-2640':0, '1f46e-1f3fb-200d-2642':0, '1f46e-1f3fc-200d-2642':0, '1f46e-1f3fd-200d-2642':0, '1f46e-1f3fe-200d-2642':0, '1f46e-1f3ff-200d-2642':0, '1f46e-1f3fb':0, '1f46e-1f3fc':0, '1f46e-1f3fd':0, '1f46e-1f3fe':0, '1f46e-1f3ff':0, '1f470-1f3fb-200d-2640':0, '1f470-1f3fc-200d-2640':0, '1f470-1f3fd-200d-2640':0, '1f470-1f3fe-200d-2640':0, '1f470-1f3ff-200d-2640':0, '1f470-1f3fb-200d-2642':0, '1f470-1f3fc-200d-2642':0, '1f470-1f3fd-200d-2642':0, '1f470-1f3fe-200d-2642':0, '1f470-1f3ff-200d-2642':0, '1f470-1f3fb':0, '1f470-1f3fc':0, '1f470-1f3fd':0, '1f470-1f3fe':0, '1f470-1f3ff':0, '1f471-1f3fb-200d-2640':0, '1f471-1f3fc-200d-2640':0, '1f471-1f3fd-200d-2640':0, '1f471-1f3fe-200d-2640':0, '1f471-1f3ff-200d-2640':0, '1f471-1f3fb-200d-2642':0, '1f471-1f3fc-200d-2642':0, '1f471-1f3fd-200d-2642':0, '1f471-1f3fe-200d-2642':0, '1f471-1f3ff-200d-2642':0, '1f471-1f3fb':0, '1f471-1f3fc':0, '1f471-1f3fd':0, '1f471-1f3fe':0, '1f471-1f3ff':0, '1f472-1f3fb':0, '1f472-1f3fc':0, '1f472-1f3fd':0, '1f472-1f3fe':0, '1f472-1f3ff':0, '1f473-1f3fb-200d-2640':0, '1f473-1f3fc-200d-2640':0, '1f473-1f3fd-200d-2640':0, '1f473-1f3fe-200d-2640':0, '1f473-1f3ff-200d-2640':0, '1f473-1f3fb-200d-2642':0, '1f473-1f3fc-200d-2642':0, '1f473-1f3fd-200d-2642':0, '1f473-1f3fe-200d-2642':0, '1f473-1f3ff-200d-2642':0, '1f473-1f3fb':0, '1f473-1f3fc':0, '1f473-1f3fd':0, '1f473-1f3fe':0, '1f473-1f3ff':0, '1f474-1f3fb':0, '1f474-1f3fc':0, '1f474-1f3fd':0, '1f474-1f3fe':0, '1f474-1f3ff':0, '1f475-1f3fb':0, '1f475-1f3fc':0, '1f475-1f3fd':0, '1f475-1f3fe':0, '1f475-1f3ff':0, '1f476-1f3fb':0, '1f476-1f3fc':0, '1f476-1f3fd':0, '1f476-1f3fe':0, '1f476-1f3ff':0, '1f477-1f3fb-200d-2640':0, '1f477-1f3fc-200d-2640':0, '1f477-1f3fd-200d-2640':0, '1f477-1f3fe-200d-2640':0, '1f477-1f3ff-200d-2640':0, '1f477-1f3fb-200d-2642':0, '1f477-1f3fc-200d-2642':0, '1f477-1f3fd-200d-2642':0, '1f477-1f3fe-200d-2642':0, '1f477-1f3ff-200d-2642':0, '1f477-1f3fb':0, '1f477-1f3fc':0, '1f477-1f3fd':0, '1f477-1f3fe':0, '1f477-1f3ff':0, '1f478-1f3fb':0, '1f478-1f3fc':0, '1f478-1f3fd':0, '1f478-1f3fe':0, '1f478-1f3ff':0, '1f47c-1f3fb':0, '1f47c-1f3fc':0, '1f47c-1f3fd':0, '1f47c-1f3fe':0, '1f47c-1f3ff':0, '1f481-1f3fb-200d-2640':0, '1f481-1f3fc-200d-2640':0, '1f481-1f3fd-200d-2640':0, '1f481-1f3fe-200d-2640':0, '1f481-1f3ff-200d-2640':0, '1f481-1f3fb-200d-2642':0, '1f481-1f3fc-200d-2642':0, '1f481-1f3fd-200d-2642':0, '1f481-1f3fe-200d-2642':0, '1f481-1f3ff-200d-2642':0, '1f481-1f3fb':0, '1f481-1f3fc':0, '1f481-1f3fd':0, '1f481-1f3fe':0, '1f481-1f3ff':0, '1f482-1f3fb-200d-2640':0, '1f482-1f3fc-200d-2640':0, '1f482-1f3fd-200d-2640':0, '1f482-1f3fe-200d-2640':0, '1f482-1f3ff-200d-2640':0, '1f482-1f3fb-200d-2642':0, '1f482-1f3fc-200d-2642':0, '1f482-1f3fd-200d-2642':0, '1f482-1f3fe-200d-2642':0, '1f482-1f3ff-200d-2642':0, '1f482-1f3fb':0, '1f482-1f3fc':0, '1f482-1f3fd':0, '1f482-1f3fe':0, '1f482-1f3ff':0, '1f483-1f3fb':0, '1f483-1f3fc':0, '1f483-1f3fd':0, '1f483-1f3fe':0, '1f483-1f3ff':0, '1f485-1f3fb':0, '1f485-1f3fc':0, '1f485-1f3fd':0, '1f485-1f3fe':0, '1f485-1f3ff':0, '1f486-1f3fb-200d-2640':0, '1f486-1f3fc-200d-2640':0, '1f486-1f3fd-200d-2640':0, '1f486-1f3fe-200d-2640':0, '1f486-1f3ff-200d-2640':0, '1f486-1f3fb-200d-2642':0, '1f486-1f3fc-200d-2642':0, '1f486-1f3fd-200d-2642':0, '1f486-1f3fe-200d-2642':0, '1f486-1f3ff-200d-2642':0, '1f486-1f3fb':0, '1f486-1f3fc':0, '1f486-1f3fd':0, '1f486-1f3fe':0, '1f486-1f3ff':0, '1f487-1f3fb-200d-2640':0, '1f487-1f3fc-200d-2640':0, '1f487-1f3fd-200d-2640':0, '1f487-1f3fe-200d-2640':0, '1f487-1f3ff-200d-2640':0, '1f487-1f3fb-200d-2642':0, '1f487-1f3fc-200d-2642':0, '1f487-1f3fd-200d-2642':0, '1f487-1f3fe-200d-2642':0, '1f487-1f3ff-200d-2642':0, '1f487-1f3fb':0, '1f487-1f3fc':0, '1f487-1f3fd':0, '1f487-1f3fe':0, '1f487-1f3ff':0, '1f48f-1f3fb':0, '1f48f-1f3fc':0, '1f48f-1f3fd':0, '1f48f-1f3fe':0, '1f48f-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f491-1f3fb':0, '1f491-1f3fc':0, '1f491-1f3fd':0, '1f491-1f3fe':0, '1f491-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fe':0, '1f4aa-1f3fb':0, '1f4aa-1f3fc':0, '1f4aa-1f3fd':0, '1f4aa-1f3fe':0, '1f4aa-1f3ff':0, '1f574-1f3fb':0, '1f574-1f3fc':0, '1f574-1f3fd':0, '1f574-1f3fe':0, '1f574-1f3ff':0, '1f575-1f3fb-200d-2640':0, '1f575-1f3fc-200d-2640':0, '1f575-1f3fd-200d-2640':0, '1f575-1f3fe-200d-2640':0, '1f575-1f3ff-200d-2640':0, '1f575-1f3fb-200d-2642':0, '1f575-1f3fc-200d-2642':0, '1f575-1f3fd-200d-2642':0, '1f575-1f3fe-200d-2642':0, '1f575-1f3ff-200d-2642':0, '1f575-1f3fb':0, '1f575-1f3fc':0, '1f575-1f3fd':0, '1f575-1f3fe':0, '1f575-1f3ff':0, '1f57a-1f3fb':0, '1f57a-1f3fc':0, '1f57a-1f3fd':0, '1f57a-1f3fe':0, '1f57a-1f3ff':0, '1f590-1f3fb':0, '1f590-1f3fc':0, '1f590-1f3fd':0, '1f590-1f3fe':0, '1f590-1f3ff':0, '1f595-1f3fb':0, '1f595-1f3fc':0, '1f595-1f3fd':0, '1f595-1f3fe':0, '1f595-1f3ff':0, '1f596-1f3fb':0, '1f596-1f3fc':0, '1f596-1f3fd':0, '1f596-1f3fe':0, '1f596-1f3ff':0, '1f645-1f3fb-200d-2640':0, '1f645-1f3fc-200d-2640':0, '1f645-1f3fd-200d-2640':0, '1f645-1f3fe-200d-2640':0, '1f645-1f3ff-200d-2640':0, '1f645-1f3fb-200d-2642':0, '1f645-1f3fc-200d-2642':0, '1f645-1f3fd-200d-2642':0, '1f645-1f3fe-200d-2642':0, '1f645-1f3ff-200d-2642':0, '1f645-1f3fb':0, '1f645-1f3fc':0, '1f645-1f3fd':0, '1f645-1f3fe':0, '1f645-1f3ff':0, '1f646-1f3fb-200d-2640':0, '1f646-1f3fc-200d-2640':0, '1f646-1f3fd-200d-2640':0, '1f646-1f3fe-200d-2640':0, '1f646-1f3ff-200d-2640':0, '1f646-1f3fb-200d-2642':0, '1f646-1f3fc-200d-2642':0, '1f646-1f3fd-200d-2642':0, '1f646-1f3fe-200d-2642':0, '1f646-1f3ff-200d-2642':0, '1f646-1f3fb':0, '1f646-1f3fc':0, '1f646-1f3fd':0, '1f646-1f3fe':0, '1f646-1f3ff':0, '1f647-1f3fb-200d-2640':0, '1f647-1f3fc-200d-2640':0, '1f647-1f3fd-200d-2640':0, '1f647-1f3fe-200d-2640':0, '1f647-1f3ff-200d-2640':0, '1f647-1f3fb-200d-2642':0, '1f647-1f3fc-200d-2642':0, '1f647-1f3fd-200d-2642':0, '1f647-1f3fe-200d-2642':0, '1f647-1f3ff-200d-2642':0, '1f647-1f3fb':0, '1f647-1f3fc':0, '1f647-1f3fd':0, '1f647-1f3fe':0, '1f647-1f3ff':0, '1f64b-1f3fb-200d-2640':0, '1f64b-1f3fc-200d-2640':0, '1f64b-1f3fd-200d-2640':0, '1f64b-1f3fe-200d-2640':0, '1f64b-1f3ff-200d-2640':0, '1f64b-1f3fb-200d-2642':0, '1f64b-1f3fc-200d-2642':0, '1f64b-1f3fd-200d-2642':0, '1f64b-1f3fe-200d-2642':0, '1f64b-1f3ff-200d-2642':0, '1f64b-1f3fb':0, '1f64b-1f3fc':0, '1f64b-1f3fd':0, '1f64b-1f3fe':0, '1f64b-1f3ff':0, '1f64c-1f3fb':0, '1f64c-1f3fc':0, '1f64c-1f3fd':0, '1f64c-1f3fe':0, '1f64c-1f3ff':0, '1f64d-1f3fb-200d-2640':0, '1f64d-1f3fc-200d-2640':0, '1f64d-1f3fd-200d-2640':0, '1f64d-1f3fe-200d-2640':0, '1f64d-1f3ff-200d-2640':0, '1f64d-1f3fb-200d-2642':0, '1f64d-1f3fc-200d-2642':0, '1f64d-1f3fd-200d-2642':0, '1f64d-1f3fe-200d-2642':0, '1f64d-1f3ff-200d-2642':0, '1f64d-1f3fb':0, '1f64d-1f3fc':0, '1f64d-1f3fd':0, '1f64d-1f3fe':0, '1f64d-1f3ff':0, '1f64e-1f3fb-200d-2640':0, '1f64e-1f3fc-200d-2640':0, '1f64e-1f3fd-200d-2640':0, '1f64e-1f3fe-200d-2640':0, '1f64e-1f3ff-200d-2640':0, '1f64e-1f3fb-200d-2642':0, '1f64e-1f3fc-200d-2642':0, '1f64e-1f3fd-200d-2642':0, '1f64e-1f3fe-200d-2642':0, '1f64e-1f3ff-200d-2642':0, '1f64e-1f3fb':0, '1f64e-1f3fc':0, '1f64e-1f3fd':0, '1f64e-1f3fe':0, '1f64e-1f3ff':0, '1f64f-1f3fb':0, '1f64f-1f3fc':0, '1f64f-1f3fd':0, '1f64f-1f3fe':0, '1f64f-1f3ff':0, '1f6a3-1f3fb-200d-2640':0, '1f6a3-1f3fc-200d-2640':0, '1f6a3-1f3fd-200d-2640':0, '1f6a3-1f3fe-200d-2640':0, '1f6a3-1f3ff-200d-2640':0, '1f6a3-1f3fb-200d-2642':0, '1f6a3-1f3fc-200d-2642':0, '1f6a3-1f3fd-200d-2642':0, '1f6a3-1f3fe-200d-2642':0, '1f6a3-1f3ff-200d-2642':0, '1f6a3-1f3fb':0, '1f6a3-1f3fc':0, '1f6a3-1f3fd':0, '1f6a3-1f3fe':0, '1f6a3-1f3ff':0, '1f6b4-1f3fb-200d-2640':0, '1f6b4-1f3fc-200d-2640':0, '1f6b4-1f3fd-200d-2640':0, '1f6b4-1f3fe-200d-2640':0, '1f6b4-1f3ff-200d-2640':0, '1f6b4-1f3fb-200d-2642':0, '1f6b4-1f3fc-200d-2642':0, '1f6b4-1f3fd-200d-2642':0, '1f6b4-1f3fe-200d-2642':0, '1f6b4-1f3ff-200d-2642':0, '1f6b4-1f3fb':0, '1f6b4-1f3fc':0, '1f6b4-1f3fd':0, '1f6b4-1f3fe':0, '1f6b4-1f3ff':0, '1f6b5-1f3fb-200d-2640':0, '1f6b5-1f3fc-200d-2640':0, '1f6b5-1f3fd-200d-2640':0, '1f6b5-1f3fe-200d-2640':0, '1f6b5-1f3ff-200d-2640':0, '1f6b5-1f3fb-200d-2642':0, '1f6b5-1f3fc-200d-2642':0, '1f6b5-1f3fd-200d-2642':0, '1f6b5-1f3fe-200d-2642':0, '1f6b5-1f3ff-200d-2642':0, '1f6b5-1f3fb':0, '1f6b5-1f3fc':0, '1f6b5-1f3fd':0, '1f6b5-1f3fe':0, '1f6b5-1f3ff':0, '1f6b6-1f3fb-200d-2640':0, '1f6b6-1f3fc-200d-2640':0, '1f6b6-1f3fd-200d-2640':0, '1f6b6-1f3fe-200d-2640':0, '1f6b6-1f3ff-200d-2640':0, '1f6b6-1f3fb-200d-2642':0, '1f6b6-1f3fc-200d-2642':0, '1f6b6-1f3fd-200d-2642':0, '1f6b6-1f3fe-200d-2642':0, '1f6b6-1f3ff-200d-2642':0, '1f6b6-1f3fb':0, '1f6b6-1f3fc':0, '1f6b6-1f3fd':0, '1f6b6-1f3fe':0, '1f6b6-1f3ff':0, '1f6c0-1f3fb':0, '1f6c0-1f3fc':0, '1f6c0-1f3fd':0, '1f6c0-1f3fe':0, '1f6c0-1f3ff':0, '1f6cc-1f3fb':0, '1f6cc-1f3fc':0, '1f6cc-1f3fd':0, '1f6cc-1f3fe':0, '1f6cc-1f3ff':0, '1f90c-1f3fb':0, '1f90c-1f3fc':0, '1f90c-1f3fd':0, '1f90c-1f3fe':0, '1f90c-1f3ff':0, '1f90f-1f3fb':0, '1f90f-1f3fc':0, '1f90f-1f3fd':0, '1f90f-1f3fe':0, '1f90f-1f3ff':0, '1f918-1f3fb':0, '1f918-1f3fc':0, '1f918-1f3fd':0, '1f918-1f3fe':0, '1f918-1f3ff':0, '1f919-1f3fb':0, '1f919-1f3fc':0, '1f919-1f3fd':0, '1f919-1f3fe':0, '1f919-1f3ff':0, '1f91a-1f3fb':0, '1f91a-1f3fc':0, '1f91a-1f3fd':0, '1f91a-1f3fe':0, '1f91a-1f3ff':0, '1f91b-1f3fb':0, '1f91b-1f3fc':0, '1f91b-1f3fd':0, '1f91b-1f3fe':0, '1f91b-1f3ff':0, '1f91c-1f3fb':0, '1f91c-1f3fc':0, '1f91c-1f3fd':0, '1f91c-1f3fe':0, '1f91c-1f3ff':0, '1f91d-1f3fb':0, '1f91d-1f3fc':0, '1f91d-1f3fd':0, '1f91d-1f3fe':0, '1f91d-1f3ff':0, '1f91e-1f3fb':0, '1f91e-1f3fc':0, '1f91e-1f3fd':0, '1f91e-1f3fe':0, '1f91e-1f3ff':0, '1f91f-1f3fb':0, '1f91f-1f3fc':0, '1f91f-1f3fd':0, '1f91f-1f3fe':0, '1f91f-1f3ff':0, '1f926-1f3fb-200d-2640':0, '1f926-1f3fc-200d-2640':0, '1f926-1f3fd-200d-2640':0, '1f926-1f3fe-200d-2640':0, '1f926-1f3ff-200d-2640':0, '1f926-1f3fb-200d-2642':0, '1f926-1f3fc-200d-2642':0, '1f926-1f3fd-200d-2642':0, '1f926-1f3fe-200d-2642':0, '1f926-1f3ff-200d-2642':0, '1f926-1f3fb':0, '1f926-1f3fc':0, '1f926-1f3fd':0, '1f926-1f3fe':0, '1f926-1f3ff':0, '1f930-1f3fb':0, '1f930-1f3fc':0, '1f930-1f3fd':0, '1f930-1f3fe':0, '1f930-1f3ff':0, '1f931-1f3fb':0, '1f931-1f3fc':0, '1f931-1f3fd':0, '1f931-1f3fe':0, '1f931-1f3ff':0, '1f932-1f3fb':0, '1f932-1f3fc':0, '1f932-1f3fd':0, '1f932-1f3fe':0, '1f932-1f3ff':0, '1f933-1f3fb':0, '1f933-1f3fc':0, '1f933-1f3fd':0, '1f933-1f3fe':0, '1f933-1f3ff':0, '1f934-1f3fb':0, '1f934-1f3fc':0, '1f934-1f3fd':0, '1f934-1f3fe':0, '1f934-1f3ff':0, '1f935-1f3fb-200d-2640':0, '1f935-1f3fc-200d-2640':0, '1f935-1f3fd-200d-2640':0, '1f935-1f3fe-200d-2640':0, '1f935-1f3ff-200d-2640':0, '1f935-1f3fb-200d-2642':0, '1f935-1f3fc-200d-2642':0, '1f935-1f3fd-200d-2642':0, '1f935-1f3fe-200d-2642':0, '1f935-1f3ff-200d-2642':0, '1f935-1f3fb':0, '1f935-1f3fc':0, '1f935-1f3fd':0, '1f935-1f3fe':0, '1f935-1f3ff':0, '1f936-1f3fb':0, '1f936-1f3fc':0, '1f936-1f3fd':0, '1f936-1f3fe':0, '1f936-1f3ff':0, '1f937-1f3fb-200d-2640':0, '1f937-1f3fc-200d-2640':0, '1f937-1f3fd-200d-2640':0, '1f937-1f3fe-200d-2640':0, '1f937-1f3ff-200d-2640':0, '1f937-1f3fb-200d-2642':0, '1f937-1f3fc-200d-2642':0, '1f937-1f3fd-200d-2642':0, '1f937-1f3fe-200d-2642':0, '1f937-1f3ff-200d-2642':0, '1f937-1f3fb':0, '1f937-1f3fc':0, '1f937-1f3fd':0, '1f937-1f3fe':0, '1f937-1f3ff':0, '1f938-1f3fb-200d-2640':0, '1f938-1f3fc-200d-2640':0, '1f938-1f3fd-200d-2640':0, '1f938-1f3fe-200d-2640':0, '1f938-1f3ff-200d-2640':0, '1f938-1f3fb-200d-2642':0, '1f938-1f3fc-200d-2642':0, '1f938-1f3fd-200d-2642':0, '1f938-1f3fe-200d-2642':0, '1f938-1f3ff-200d-2642':0, '1f938-1f3fb':0, '1f938-1f3fc':0, '1f938-1f3fd':0, '1f938-1f3fe':0, '1f938-1f3ff':0, '1f939-1f3fb-200d-2640':0, '1f939-1f3fc-200d-2640':0, '1f939-1f3fd-200d-2640':0, '1f939-1f3fe-200d-2640':0, '1f939-1f3ff-200d-2640':0, '1f939-1f3fb-200d-2642':0, '1f939-1f3fc-200d-2642':0, '1f939-1f3fd-200d-2642':0, '1f939-1f3fe-200d-2642':0, '1f939-1f3ff-200d-2642':0, '1f939-1f3fb':0, '1f939-1f3fc':0, '1f939-1f3fd':0, '1f939-1f3fe':0, '1f939-1f3ff':0, '1f93d-1f3fb-200d-2640':0, '1f93d-1f3fc-200d-2640':0, '1f93d-1f3fd-200d-2640':0, '1f93d-1f3fe-200d-2640':0, '1f93d-1f3ff-200d-2640':0, '1f93d-1f3fb-200d-2642':0, '1f93d-1f3fc-200d-2642':0, '1f93d-1f3fd-200d-2642':0, '1f93d-1f3fe-200d-2642':0, '1f93d-1f3ff-200d-2642':0, '1f93d-1f3fb':0, '1f93d-1f3fc':0, '1f93d-1f3fd':0, '1f93d-1f3fe':0, '1f93d-1f3ff':0, '1f93e-1f3fb-200d-2640':0, '1f93e-1f3fc-200d-2640':0, '1f93e-1f3fd-200d-2640':0, '1f93e-1f3fe-200d-2640':0, '1f93e-1f3ff-200d-2640':0, '1f93e-1f3fb-200d-2642':0, '1f93e-1f3fc-200d-2642':0, '1f93e-1f3fd-200d-2642':0, '1f93e-1f3fe-200d-2642':0, '1f93e-1f3ff-200d-2642':0, '1f93e-1f3fb':0, '1f93e-1f3fc':0, '1f93e-1f3fd':0, '1f93e-1f3fe':0, '1f93e-1f3ff':0, '1f977-1f3fb':0, '1f977-1f3fc':0, '1f977-1f3fd':0, '1f977-1f3fe':0, '1f977-1f3ff':0, '1f9b5-1f3fb':0, '1f9b5-1f3fc':0, '1f9b5-1f3fd':0, '1f9b5-1f3fe':0, '1f9b5-1f3ff':0, '1f9b6-1f3fb':0, '1f9b6-1f3fc':0, '1f9b6-1f3fd':0, '1f9b6-1f3fe':0, '1f9b6-1f3ff':0, '1f9b8-1f3fb-200d-2640':0, '1f9b8-1f3fc-200d-2640':0, '1f9b8-1f3fd-200d-2640':0, '1f9b8-1f3fe-200d-2640':0, '1f9b8-1f3ff-200d-2640':0, '1f9b8-1f3fb-200d-2642':0, '1f9b8-1f3fc-200d-2642':0, '1f9b8-1f3fd-200d-2642':0, '1f9b8-1f3fe-200d-2642':0, '1f9b8-1f3ff-200d-2642':0, '1f9b8-1f3fb':0, '1f9b8-1f3fc':0, '1f9b8-1f3fd':0, '1f9b8-1f3fe':0, '1f9b8-1f3ff':0, '1f9b9-1f3fb-200d-2640':0, '1f9b9-1f3fc-200d-2640':0, '1f9b9-1f3fd-200d-2640':0, '1f9b9-1f3fe-200d-2640':0, '1f9b9-1f3ff-200d-2640':0, '1f9b9-1f3fb-200d-2642':0, '1f9b9-1f3fc-200d-2642':0, '1f9b9-1f3fd-200d-2642':0, '1f9b9-1f3fe-200d-2642':0, '1f9b9-1f3ff-200d-2642':0, '1f9b9-1f3fb':0, '1f9b9-1f3fc':0, '1f9b9-1f3fd':0, '1f9b9-1f3fe':0, '1f9b9-1f3ff':0, '1f9bb-1f3fb':0, '1f9bb-1f3fc':0, '1f9bb-1f3fd':0, '1f9bb-1f3fe':0, '1f9bb-1f3ff':0, '1f9cd-1f3fb-200d-2640':0, '1f9cd-1f3fc-200d-2640':0, '1f9cd-1f3fd-200d-2640':0, '1f9cd-1f3fe-200d-2640':0, '1f9cd-1f3ff-200d-2640':0, '1f9cd-1f3fb-200d-2642':0, '1f9cd-1f3fc-200d-2642':0, '1f9cd-1f3fd-200d-2642':0, '1f9cd-1f3fe-200d-2642':0, '1f9cd-1f3ff-200d-2642':0, '1f9cd-1f3fb':0, '1f9cd-1f3fc':0, '1f9cd-1f3fd':0, '1f9cd-1f3fe':0, '1f9cd-1f3ff':0, '1f9ce-1f3fb-200d-2640':0, '1f9ce-1f3fc-200d-2640':0, '1f9ce-1f3fd-200d-2640':0, '1f9ce-1f3fe-200d-2640':0, '1f9ce-1f3ff-200d-2640':0, '1f9ce-1f3fb-200d-2642':0, '1f9ce-1f3fc-200d-2642':0, '1f9ce-1f3fd-200d-2642':0, '1f9ce-1f3fe-200d-2642':0, '1f9ce-1f3ff-200d-2642':0, '1f9ce-1f3fb':0, '1f9ce-1f3fc':0, '1f9ce-1f3fd':0, '1f9ce-1f3fe':0, '1f9ce-1f3ff':0, '1f9cf-1f3fb-200d-2640':0, '1f9cf-1f3fc-200d-2640':0, '1f9cf-1f3fd-200d-2640':0, '1f9cf-1f3fe-200d-2640':0, '1f9cf-1f3ff-200d-2640':0, '1f9cf-1f3fb-200d-2642':0, '1f9cf-1f3fc-200d-2642':0, '1f9cf-1f3fd-200d-2642':0, '1f9cf-1f3fe-200d-2642':0, '1f9cf-1f3ff-200d-2642':0, '1f9cf-1f3fb':0, '1f9cf-1f3fc':0, '1f9cf-1f3fd':0, '1f9cf-1f3fe':0, '1f9cf-1f3ff':0, '1f9d1-1f3fb-200d-1f33e':0, '1f9d1-1f3fc-200d-1f33e':0, '1f9d1-1f3fd-200d-1f33e':0, '1f9d1-1f3fe-200d-1f33e':0, '1f9d1-1f3ff-200d-1f33e':0, '1f9d1-1f3fb-200d-1f373':0, '1f9d1-1f3fc-200d-1f373':0, '1f9d1-1f3fd-200d-1f373':0, '1f9d1-1f3fe-200d-1f373':0, '1f9d1-1f3ff-200d-1f373':0, '1f9d1-1f3fb-200d-1f37c':0, '1f9d1-1f3fc-200d-1f37c':0, '1f9d1-1f3fd-200d-1f37c':0, '1f9d1-1f3fe-200d-1f37c':0, '1f9d1-1f3ff-200d-1f37c':0, '1f9d1-1f3fb-200d-1f384':0, '1f9d1-1f3fc-200d-1f384':0, '1f9d1-1f3fd-200d-1f384':0, '1f9d1-1f3fe-200d-1f384':0, '1f9d1-1f3ff-200d-1f384':0, '1f9d1-1f3fb-200d-1f393':0, '1f9d1-1f3fc-200d-1f393':0, '1f9d1-1f3fd-200d-1f393':0, '1f9d1-1f3fe-200d-1f393':0, '1f9d1-1f3ff-200d-1f393':0, '1f9d1-1f3fb-200d-1f3a4':0, '1f9d1-1f3fc-200d-1f3a4':0, '1f9d1-1f3fd-200d-1f3a4':0, '1f9d1-1f3fe-200d-1f3a4':0, '1f9d1-1f3ff-200d-1f3a4':0, '1f9d1-1f3fb-200d-1f3a8':0, '1f9d1-1f3fc-200d-1f3a8':0, '1f9d1-1f3fd-200d-1f3a8':0, '1f9d1-1f3fe-200d-1f3a8':0, '1f9d1-1f3ff-200d-1f3a8':0, '1f9d1-1f3fb-200d-1f3eb':0, '1f9d1-1f3fc-200d-1f3eb':0, '1f9d1-1f3fd-200d-1f3eb':0, '1f9d1-1f3fe-200d-1f3eb':0, '1f9d1-1f3ff-200d-1f3eb':0, '1f9d1-1f3fb-200d-1f3ed':0, '1f9d1-1f3fc-200d-1f3ed':0, '1f9d1-1f3fd-200d-1f3ed':0, '1f9d1-1f3fe-200d-1f3ed':0, '1f9d1-1f3ff-200d-1f3ed':0, '1f9d1-1f3fb-200d-1f4bb':0, '1f9d1-1f3fc-200d-1f4bb':0, '1f9d1-1f3fd-200d-1f4bb':0, '1f9d1-1f3fe-200d-1f4bb':0, '1f9d1-1f3ff-200d-1f4bb':0, '1f9d1-1f3fb-200d-1f4bc':0, '1f9d1-1f3fc-200d-1f4bc':0, '1f9d1-1f3fd-200d-1f4bc':0, '1f9d1-1f3fe-200d-1f4bc':0, '1f9d1-1f3ff-200d-1f4bc':0, '1f9d1-1f3fb-200d-1f527':0, '1f9d1-1f3fc-200d-1f527':0, '1f9d1-1f3fd-200d-1f527':0, '1f9d1-1f3fe-200d-1f527':0, '1f9d1-1f3ff-200d-1f527':0, '1f9d1-1f3fb-200d-1f52c':0, '1f9d1-1f3fc-200d-1f52c':0, '1f9d1-1f3fd-200d-1f52c':0, '1f9d1-1f3fe-200d-1f52c':0, '1f9d1-1f3ff-200d-1f52c':0, '1f9d1-1f3fb-200d-1f680':0, '1f9d1-1f3fc-200d-1f680':0, '1f9d1-1f3fd-200d-1f680':0, '1f9d1-1f3fe-200d-1f680':0, '1f9d1-1f3ff-200d-1f680':0, '1f9d1-1f3fb-200d-1f692':0, '1f9d1-1f3fc-200d-1f692':0, '1f9d1-1f3fd-200d-1f692':0, '1f9d1-1f3fe-200d-1f692':0, '1f9d1-1f3ff-200d-1f692':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fb-200d-1f9af':0, '1f9d1-1f3fc-200d-1f9af':0, '1f9d1-1f3fd-200d-1f9af':0, '1f9d1-1f3fe-200d-1f9af':0, '1f9d1-1f3ff-200d-1f9af':0, '1f9d1-1f3fb-200d-1f9b0':0, '1f9d1-1f3fc-200d-1f9b0':0, '1f9d1-1f3fd-200d-1f9b0':0, '1f9d1-1f3fe-200d-1f9b0':0, '1f9d1-1f3ff-200d-1f9b0':0, '1f9d1-1f3fb-200d-1f9b1':0, '1f9d1-1f3fc-200d-1f9b1':0, '1f9d1-1f3fd-200d-1f9b1':0, '1f9d1-1f3fe-200d-1f9b1':0, '1f9d1-1f3ff-200d-1f9b1':0, '1f9d1-1f3fb-200d-1f9b2':0, '1f9d1-1f3fc-200d-1f9b2':0, '1f9d1-1f3fd-200d-1f9b2':0, '1f9d1-1f3fe-200d-1f9b2':0, '1f9d1-1f3ff-200d-1f9b2':0, '1f9d1-1f3fb-200d-1f9b3':0, '1f9d1-1f3fc-200d-1f9b3':0, '1f9d1-1f3fd-200d-1f9b3':0, '1f9d1-1f3fe-200d-1f9b3':0, '1f9d1-1f3ff-200d-1f9b3':0, '1f9d1-1f3fb-200d-1f9bc':0, '1f9d1-1f3fc-200d-1f9bc':0, '1f9d1-1f3fd-200d-1f9bc':0, '1f9d1-1f3fe-200d-1f9bc':0, '1f9d1-1f3ff-200d-1f9bc':0, '1f9d1-1f3fb-200d-1f9bd':0, '1f9d1-1f3fc-200d-1f9bd':0, '1f9d1-1f3fd-200d-1f9bd':0, '1f9d1-1f3fe-200d-1f9bd':0, '1f9d1-1f3ff-200d-1f9bd':0, '1f9d1-1f3fb-200d-2695':0, '1f9d1-1f3fc-200d-2695':0, '1f9d1-1f3fd-200d-2695':0, '1f9d1-1f3fe-200d-2695':0, '1f9d1-1f3ff-200d-2695':0, '1f9d1-1f3fb-200d-2696':0, '1f9d1-1f3fc-200d-2696':0, '1f9d1-1f3fd-200d-2696':0, '1f9d1-1f3fe-200d-2696':0, '1f9d1-1f3ff-200d-2696':0, '1f9d1-1f3fb-200d-2708':0, '1f9d1-1f3fc-200d-2708':0, '1f9d1-1f3fd-200d-2708':0, '1f9d1-1f3fe-200d-2708':0, '1f9d1-1f3ff-200d-2708':0, '1f9d1-1f3fb':0, '1f9d1-1f3fc':0, '1f9d1-1f3fd':0, '1f9d1-1f3fe':0, '1f9d1-1f3ff':0, '1f9d2-1f3fb':0, '1f9d2-1f3fc':0, '1f9d2-1f3fd':0, '1f9d2-1f3fe':0, '1f9d2-1f3ff':0, '1f9d3-1f3fb':0, '1f9d3-1f3fc':0, '1f9d3-1f3fd':0, '1f9d3-1f3fe':0, '1f9d3-1f3ff':0, '1f9d4-1f3fb-200d-2640':0, '1f9d4-1f3fc-200d-2640':0, '1f9d4-1f3fd-200d-2640':0, '1f9d4-1f3fe-200d-2640':0, '1f9d4-1f3ff-200d-2640':0, '1f9d4-1f3fb-200d-2642':0, '1f9d4-1f3fc-200d-2642':0, '1f9d4-1f3fd-200d-2642':0, '1f9d4-1f3fe-200d-2642':0, '1f9d4-1f3ff-200d-2642':0, '1f9d4-1f3fb':0, '1f9d4-1f3fc':0, '1f9d4-1f3fd':0, '1f9d4-1f3fe':0, '1f9d4-1f3ff':0, '1f9d5-1f3fb':0, '1f9d5-1f3fc':0, '1f9d5-1f3fd':0, '1f9d5-1f3fe':0, '1f9d5-1f3ff':0, '1f9d6-1f3fb-200d-2640':0, '1f9d6-1f3fc-200d-2640':0, '1f9d6-1f3fd-200d-2640':0, '1f9d6-1f3fe-200d-2640':0, '1f9d6-1f3ff-200d-2640':0, '1f9d6-1f3fb-200d-2642':0, '1f9d6-1f3fc-200d-2642':0, '1f9d6-1f3fd-200d-2642':0, '1f9d6-1f3fe-200d-2642':0, '1f9d6-1f3ff-200d-2642':0, '1f9d6-1f3fb':0, '1f9d6-1f3fc':0, '1f9d6-1f3fd':0, '1f9d6-1f3fe':0, '1f9d6-1f3ff':0, '1f9d7-1f3fb-200d-2640':0, '1f9d7-1f3fc-200d-2640':0, '1f9d7-1f3fd-200d-2640':0, '1f9d7-1f3fe-200d-2640':0, '1f9d7-1f3ff-200d-2640':0, '1f9d7-1f3fb-200d-2642':0, '1f9d7-1f3fc-200d-2642':0, '1f9d7-1f3fd-200d-2642':0, '1f9d7-1f3fe-200d-2642':0, '1f9d7-1f3ff-200d-2642':0, '1f9d7-1f3fb':0, '1f9d7-1f3fc':0, '1f9d7-1f3fd':0, '1f9d7-1f3fe':0, '1f9d7-1f3ff':0, '1f9d8-1f3fb-200d-2640':0, '1f9d8-1f3fc-200d-2640':0, '1f9d8-1f3fd-200d-2640':0, '1f9d8-1f3fe-200d-2640':0, '1f9d8-1f3ff-200d-2640':0, '1f9d8-1f3fb-200d-2642':0, '1f9d8-1f3fc-200d-2642':0, '1f9d8-1f3fd-200d-2642':0, '1f9d8-1f3fe-200d-2642':0, '1f9d8-1f3ff-200d-2642':0, '1f9d8-1f3fb':0, '1f9d8-1f3fc':0, '1f9d8-1f3fd':0, '1f9d8-1f3fe':0, '1f9d8-1f3ff':0, '1f9d9-1f3fb-200d-2640':0, '1f9d9-1f3fc-200d-2640':0, '1f9d9-1f3fd-200d-2640':0, '1f9d9-1f3fe-200d-2640':0, '1f9d9-1f3ff-200d-2640':0, '1f9d9-1f3fb-200d-2642':0, '1f9d9-1f3fc-200d-2642':0, '1f9d9-1f3fd-200d-2642':0, '1f9d9-1f3fe-200d-2642':0, '1f9d9-1f3ff-200d-2642':0, '1f9d9-1f3fb':0, '1f9d9-1f3fc':0, '1f9d9-1f3fd':0, '1f9d9-1f3fe':0, '1f9d9-1f3ff':0, '1f9da-1f3fb-200d-2640':0, '1f9da-1f3fc-200d-2640':0, '1f9da-1f3fd-200d-2640':0, '1f9da-1f3fe-200d-2640':0, '1f9da-1f3ff-200d-2640':0, '1f9da-1f3fb-200d-2642':0, '1f9da-1f3fc-200d-2642':0, '1f9da-1f3fd-200d-2642':0, '1f9da-1f3fe-200d-2642':0, '1f9da-1f3ff-200d-2642':0, '1f9da-1f3fb':0, '1f9da-1f3fc':0, '1f9da-1f3fd':0, '1f9da-1f3fe':0, '1f9da-1f3ff':0, '1f9db-1f3fb-200d-2640':0, '1f9db-1f3fc-200d-2640':0, '1f9db-1f3fd-200d-2640':0, '1f9db-1f3fe-200d-2640':0, '1f9db-1f3ff-200d-2640':0, '1f9db-1f3fb-200d-2642':0, '1f9db-1f3fc-200d-2642':0, '1f9db-1f3fd-200d-2642':0, '1f9db-1f3fe-200d-2642':0, '1f9db-1f3ff-200d-2642':0, '1f9db-1f3fb':0, '1f9db-1f3fc':0, '1f9db-1f3fd':0, '1f9db-1f3fe':0, '1f9db-1f3ff':0, '1f9dc-1f3fb-200d-2640':0, '1f9dc-1f3fc-200d-2640':0, '1f9dc-1f3fd-200d-2640':0, '1f9dc-1f3fe-200d-2640':0, '1f9dc-1f3ff-200d-2640':0, '1f9dc-1f3fb-200d-2642':0, '1f9dc-1f3fc-200d-2642':0, '1f9dc-1f3fd-200d-2642':0, '1f9dc-1f3fe-200d-2642':0, '1f9dc-1f3ff-200d-2642':0, '1f9dc-1f3fb':0, '1f9dc-1f3fc':0, '1f9dc-1f3fd':0, '1f9dc-1f3fe':0, '1f9dc-1f3ff':0, '1f9dd-1f3fb-200d-2640':0, '1f9dd-1f3fc-200d-2640':0, '1f9dd-1f3fd-200d-2640':0, '1f9dd-1f3fe-200d-2640':0, '1f9dd-1f3ff-200d-2640':0, '1f9dd-1f3fb-200d-2642':0, '1f9dd-1f3fc-200d-2642':0, '1f9dd-1f3fd-200d-2642':0, '1f9dd-1f3fe-200d-2642':0, '1f9dd-1f3ff-200d-2642':0, '1f9dd-1f3fb':0, '1f9dd-1f3fc':0, '1f9dd-1f3fd':0, '1f9dd-1f3fe':0, '1f9dd-1f3ff':0, '261d-1f3fb':0, '261d-1f3fc':0, '261d-1f3fd':0, '261d-1f3fe':0, '261d-1f3ff':0, '26f9-1f3fb-200d-2640':0, '26f9-1f3fc-200d-2640':0, '26f9-1f3fd-200d-2640':0, '26f9-1f3fe-200d-2640':0, '26f9-1f3ff-200d-2640':0, '26f9-1f3fb-200d-2642':0, '26f9-1f3fc-200d-2642':0, '26f9-1f3fd-200d-2642':0, '26f9-1f3fe-200d-2642':0, '26f9-1f3ff-200d-2642':0, '26f9-1f3fb':0, '26f9-1f3fc':0, '26f9-1f3fd':0, '26f9-1f3fe':0, '26f9-1f3ff':0, '270a-1f3fb':0, '270a-1f3fc':0, '270a-1f3fd':0, '270a-1f3fe':0, '270a-1f3ff':0, '270b-1f3fb':0, '270b-1f3fc':0, '270b-1f3fd':0, '270b-1f3fe':0, '270b-1f3ff':0, '270c-1f3fb':0, '270c-1f3fc':0, '270c-1f3fd':0, '270c-1f3fe':0, '270c-1f3ff':0, '270d-1f3fb':0, '270d-1f3fc':0, '270d-1f3fd':0, '270d-1f3fe':0, '270d-1f3ff':0}};\r\n\r\nconst Emoji: {[emoji: string]: number} = EmojiVersions[''];\r\nfor(const version in EmojiVersions) {\r\n  if(version) {\r\n    Object.assign(Emoji, EmojiVersions[version as EMOJI_VERSION]);\r\n  }\r\n}\r\n\r\nexport default Emoji;\r\n\r\n/* Emoji[\"00a9-fe0f\"] = 6362;\r\nEmoji[\"00ae-fe0f\"] = 6363;\r\nEmoji[\"2122-fe0f\"] = 6364; */\r\n","// https://github.com/twitter/twemoji-parser/blob/master/src/lib/regex.js\r\n\r\nexport function encodeEmoji(emojiText: string) {\r\n  const codepoints = toCodePoints(removeVS16s(emojiText)).join('-');\r\n  return codepoints;\r\n}\r\n\r\nconst vs16RegExp = /\\uFE0F/g;\r\n// avoid using a string literal like '\\u200D' here because minifiers expand it inline\r\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\r\n\r\nconst removeVS16s = (rawEmoji: string) => (rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji);\r\n\r\nexport function toCodePoints(unicodeSurrogates: string): Array<string> {\r\n  const points = [];\r\n  let char = 0;\r\n  let previous = 0;\r\n  let i = 0;\r\n  while(i < unicodeSurrogates.length) {\r\n    char = unicodeSurrogates.charCodeAt(i++);\r\n    if(previous) {\r\n      points.push((0x10000 + ((previous - 0xd800) << 10) + (char - 0xdc00)).toString(16));\r\n      previous = 0;\r\n    } else if(char > 0xd800 && char <= 0xdbff) {\r\n      previous = char;\r\n    } else {\r\n      points.push(char.toString(16));\r\n    }\r\n  }\r\n\r\n  if(points.length && points[0].length === 2) {\r\n    points[0] = '00' + points[0];\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\nexport function getEmojiToneIndex(input: string) {\r\n  const match = input.match(/[\\uDFFB-\\uDFFF]/);\r\n  return match ? 5 - (57343 - match[0].charCodeAt(0)) : 0;\r\n}\r\n\r\nconst VIRTUAL_COUNTRIES_EMOJIS: Map<string, string> = new Map([\r\n  ['FT', '🏴‍☠']\r\n]);\r\n\r\nexport function getCountryEmoji(iso2: string) {\r\n  return VIRTUAL_COUNTRIES_EMOJIS.get(iso2) ??\r\n    String.fromCharCode(55356, 56741 + iso2.charCodeAt(0), 55356, 56741 + iso2.charCodeAt(1));\r\n}\r\n\r\nexport function emojiFromCodePoints(codePoints: string) {\r\n  return codePoints.split('-').reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\r\n}\r\n","import Emoji from '../../config/emoji';\r\nimport {encodeEmoji} from '../../vendor/emoji';\r\n\r\nexport default function getEmojiUnified(emojiCode: string) {\r\n  const unified = encodeEmoji(emojiCode).replace(/-?fe0f/g, '');\r\n\r\n  /* if(unified === '1f441-200d-1f5e8') {\r\n    //unified = '1f441-fe0f-200d-1f5e8-fe0f';\r\n    unified = '1f441-fe0f-200d-1f5e8';\r\n  } */\r\n\r\n  if(!Emoji.hasOwnProperty(unified)\r\n  // && !emojiData.hasOwnProperty(unified.replace(/-?fe0f$/, ''))\r\n  ) {\r\n    // console.error('lol', unified);\r\n    return;\r\n  }\r\n\r\n  return unified;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {EMAIL_REG_EXP, FULL_REG_EXP} from '.';\r\nimport TLD from '../../config/tld';\r\nimport {MessageEntity} from '../../layer';\r\nimport checkBrackets from './checkBrackets';\r\nimport getEmojiUnified from './getEmojiUnified';\r\n\r\nexport default function parseEntities(text: string) {\r\n  let match: RegExpMatchArray;\r\n  let raw = text;\r\n  const entities: MessageEntity[] = [];\r\n  let matchIndex;\r\n  let rawOffset = 0;\r\n  // var start = tsNow()\r\n  FULL_REG_EXP.lastIndex = 0;\r\n  while(match = raw.match(FULL_REG_EXP)) {\r\n    matchIndex = rawOffset + match.index;\r\n\r\n    // console.log('parseEntities match:', match);\r\n\r\n    if(match[3]) { // mentions\r\n      entities.push({\r\n        _: 'messageEntityMention',\r\n        offset: matchIndex + match[1].length,\r\n        length: match[2].length + match[3].length\r\n      });\r\n    } else if(match[4]) {\r\n      if(EMAIL_REG_EXP.test(match[4])) { // email\r\n        entities.push({\r\n          _: 'messageEntityEmail',\r\n          offset: matchIndex,\r\n          length: match[4].length\r\n        });\r\n      } else {\r\n        let url: string;\r\n        let protocol = match[5];\r\n        const tld = match[6];\r\n        // let excluded = '';\r\n        if(tld) { // URL\r\n          if(!protocol && (tld.substr(0, 4) === 'xn--' || TLD.indexOf(tld.toLowerCase()) !== -1)) {\r\n            protocol = 'http://';\r\n          }\r\n\r\n          if(protocol) {\r\n            const balanced = checkBrackets(match[4]);\r\n            if(balanced.length !== match[4].length) {\r\n              // excluded = match[4].substring(balanced.length);\r\n              match[4] = balanced;\r\n            }\r\n\r\n            url = (match[5] ? '' : protocol) + match[4];\r\n          }\r\n        } else { // IP address\r\n          url = (match[5] ? '' : 'http://') + match[4];\r\n        }\r\n\r\n        if(url) {\r\n          entities.push({\r\n            _: 'messageEntityUrl',\r\n            offset: matchIndex,\r\n            length: match[4].length\r\n          });\r\n        }\r\n      }\r\n    } else if(match[7]) { // New line\r\n      entities.push({\r\n        _: 'messageEntityLinebreak',\r\n        offset: matchIndex,\r\n        length: 1\r\n      });\r\n    } else if(match[8]) { // Emoji\r\n      const unified = getEmojiUnified(match[8]);\r\n      if(unified) {\r\n        entities.push({\r\n          _: 'messageEntityEmoji',\r\n          offset: matchIndex,\r\n          length: match[8].length,\r\n          unicode: unified\r\n        });\r\n      }\r\n    } else if(match[11]) { // Hashtag\r\n      entities.push({\r\n        _: 'messageEntityHashtag',\r\n        offset: matchIndex + (match[10] ? match[10].length : 0),\r\n        length: match[11].length\r\n      });\r\n    } else if(match[13]) { // Bot command\r\n      entities.push({\r\n        _: 'messageEntityBotCommand',\r\n        offset: matchIndex + (match[11] ? match[11].length : 0) + (match[12] ? match[12].length : 0),\r\n        length: 1 + match[13].length + (match[14] ? 1 + match[14].length : 0),\r\n        unsafe: true\r\n      });\r\n    } else if(match[16]) { // Media timestamp\r\n      const timestamp = match[16];\r\n      const splitted: string[] = timestamp.split(':');\r\n      const splittedLength = splitted.length;\r\n      const hours = splittedLength === 3 ? +splitted[0] : 0;\r\n      const minutes = +splitted[splittedLength === 3 ? 1 : 0];\r\n      const seconds = +splitted[splittedLength - 1];\r\n      entities.push({\r\n        _: 'messageEntityTimestamp',\r\n        offset: matchIndex + (/\\D/.test(match[0][0]) ? 1 : 0),\r\n        length: timestamp.length,\r\n        raw: timestamp,\r\n        time: hours * 3600 + minutes * 60 + seconds\r\n      });\r\n    }\r\n\r\n    raw = raw.substr(match.index + match[0].length);\r\n    rawOffset += match.index + match[0].length;\r\n  }\r\n\r\n  // if (entities.length) {\r\n  //   console.log('parse entities', text, entities.slice())\r\n  // }\r\n  return entities;\r\n}\r\n","// just for the future\r\nexport default function buildURLHash(str: string) {\r\n  return '#' + encodeURIComponent(str);\r\n}\r\n","export default function encodeEntities(value: string) {\r\n  return value.replace(/&/g, '&amp;').replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, (value) => {\r\n    const hi = value.charCodeAt(0);\r\n    const low = value.charCodeAt(1);\r\n    return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\r\n  }).replace(/([^\\#-~| |!])/g, (value) => { // non-alphanumeric\r\n    return '&#' + value.charCodeAt(0) + ';';\r\n  }).replace(/</g, '&lt;').replace(/>/g, '&gt;');\r\n}\r\n","export default function spoiler(text: string): string {\r\n  const chars = '⠁⠂⠄⠈⠐⠠⡀⢀⠃⠅⠆⠉⠊⠌⠑⠒⠔⠘⠡⠢⠤⠨⠰⡁⡂⡄⡈⡐⡠⢁⢂⢄⢈⢐⢠⣀⠇⠋⠍⠎⠓⠕⠖⠙⠚⠜⠣⠥⠦⠩⠪⠬⠱⠲⠴⠸⡃⡅⡆⡉⡊⡌⡑⡒⡔⡘⡡⡢⡤⡨⡰⢃⢅⢆⢉⢊⢌⢑⢒⢔⢘⢡⢢⢤⢨⢰⣁⣂⣄⣈⣐⣠⠏⠗⠛⠝⠞⠧⠫⠭⠮⠳⠵⠶⠹⠺⠼⡇⡋⡍⡎⡓⡕⡖⡙⡚⡜⡣⡥⡦⡩⡪⡬⡱⡲⡴⡸⢇⢋⢍⢎⢓⢕⢖⢙⢚⢜⢣⢥⢦⢩⢪⢬⢱⢲⢴⢸⣃⣅⣆⣉⣊⣌⣑⣒⣔⣘⣡⣢⣤⣨⣰⠟⠯⠷⠻⠽⠾⡏⡗⡛⡝⡞⡧⡫⡭⡮⡳⡵⡶⡹⡺⡼⢏⢗⢛⢝⢞⢧⢫⢭⢮⢳⢵⢶⢹⢺⢼⣇⣋⣍⣎⣓⣕⣖⣙⣚⣜⣣⣥⣦⣩⣪⣬⣱⣲⣴⣸⠿⡟⡯⡷⡻⡽⡾⢟⢯⢷⢻⢽⢾⣏⣗⣛⣝⣞⣧⣫⣭⣮⣳⣵⣶⣹⣺⣼⡿⢿⣟⣯⣷⣻⣽⣾⣿';\r\n  const charsLength = chars.length;\r\n\r\n  const out: string[] = [];\r\n  for(let i = 0; i < text.length; ++i) {\r\n    out.push(chars[(Math.random() * 1000 | 0) % charsLength]);\r\n  }\r\n\r\n  return out.join('');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport spoiler from './spoiler';\r\n\r\nexport default function encodeSpoiler(text: string, entity: MessageEntity.messageEntitySpoiler) {\r\n  const before = text.slice(0, entity.offset);\r\n  const spoilerBefore = text.slice(entity.offset, entity.offset + entity.length);\r\n  const spoilerAfter = spoiler(spoilerBefore)/*  '▚'.repeat(entity.length) */;\r\n  const after = text.slice(entity.offset + entity.length);\r\n  text = before + spoilerAfter + after;\r\n  return {text, entityText: spoilerAfter};\r\n};\r\n","import IS_EMOJI_SUPPORTED from './emojiSupport';\r\n\r\nexport type EMOJI_VERSION = '' | '14';\r\n\r\nconst EMOJI_VERSIONS_SUPPORTED: {\r\n  [v in EMOJI_VERSION]: boolean\r\n} = {} as any;\r\n\r\n// Thanks to WebZ for the detect\r\nfunction isEmojiSupported(emoji: string) {\r\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\r\n  const inlineEl = document.createElement('span');\r\n  inlineEl.classList.add('emoji');\r\n  document.body.appendChild(inlineEl);\r\n\r\n  inlineEl.innerText = emoji; // Emoji from 14.0 version\r\n  const newEmojiWidth = inlineEl.offsetWidth;\r\n  inlineEl.innerText = '❤️'; // Emoji from 1.0 version\r\n  const legacyEmojiWidth = inlineEl.offsetWidth;\r\n\r\n  document.body.removeChild(inlineEl);\r\n\r\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\r\n}\r\n\r\nif(IS_EMOJI_SUPPORTED) {\r\n  EMOJI_VERSIONS_SUPPORTED[''] = true;\r\n\r\n  const a: [keyof typeof EMOJI_VERSIONS_SUPPORTED, string][] = [\r\n    ['14', '🫱🏻']\r\n  ];\r\n\r\n  a.forEach(([version, emoji]) => {\r\n    EMOJI_VERSIONS_SUPPORTED[version] = isEmojiSupported(emoji);\r\n  });\r\n}\r\n\r\nexport default EMOJI_VERSIONS_SUPPORTED;\r\n","export default function simulateEvent(elem: EventTarget, name: string) {\r\n  const event = new Event(name, {bubbles: true, cancelable: true});\r\n  elem.dispatchEvent(event);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport simulateEvent from './dispatchEvent';\r\n\r\nlet lastMouseDownElement: HTMLElement;\r\ndocument.addEventListener('mousedown', (e) => {\r\n  lastMouseDownElement = e.target as HTMLElement;\r\n  // if((lastMouseDownElement as any)?.cancelMouseDown) {\r\n  if(lastMouseDownElement?.closest('[cancel-mouse-down]')) {\r\n    e.preventDefault();\r\n  }\r\n});\r\n\r\nexport function hasMouseMovedSinceDown(e: Event) {\r\n  if(e.isTrusted && e.type === 'click' && e.target !== lastMouseDownElement) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport const CLICK_EVENT_NAME: 'mousedown' /* | 'touchend' */ | 'click' = (IS_TOUCH_SUPPORTED ? 'mousedown' : 'click') as any;\r\nexport type AttachClickOptions = AddEventListenerOptions & Partial<{listenerSetter: ListenerSetter, cancelMouseDown?: boolean, touchMouseDown: boolean, ignoreMove: boolean}>;\r\nexport function attachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options: AttachClickOptions = {}) {\r\n  const add = options.listenerSetter ? options.listenerSetter.add(elem) : elem.addEventListener.bind(elem);\r\n  const remove = options.listenerSetter ? options.listenerSetter.removeManual.bind(options.listenerSetter, elem) : elem.removeEventListener.bind(elem);\r\n\r\n  options.touchMouseDown = true;\r\n  /* if(options.touchMouseDown && CLICK_EVENT_NAME === 'touchend') {\r\n    add('mousedown', callback, options);\r\n  } else if(CLICK_EVENT_NAME === 'touchend') {\r\n    const o = {...options, once: true};\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      const onTouchMove = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        remove('touchend', onTouchEnd, o);\r\n      };\r\n\r\n      const onTouchEnd = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        callback(e);\r\n        if(options.once) {\r\n          remove('touchstart', onTouchStart);\r\n        }\r\n      };\r\n\r\n      add('touchend', onTouchEnd, o);\r\n      add('touchmove', onTouchMove, o);\r\n    };\r\n\r\n    add('touchstart', onTouchStart);\r\n  } else {\r\n    add(CLICK_EVENT_NAME, callback, options);\r\n  } */\r\n\r\n  if(options.cancelMouseDown) {\r\n    (elem as HTMLElement).setAttribute('cancel-mouse-down', '');\r\n    // (elem as any).cancelMouseDown = true;\r\n  }\r\n\r\n  if(CLICK_EVENT_NAME === 'click' && !options.ignoreMove) {\r\n    const cb = callback;\r\n    callback = (e) => {\r\n      if(hasMouseMovedSinceDown(e)) {\r\n        return;\r\n      }\r\n\r\n      cb(e);\r\n    };\r\n  }\r\n\r\n  add(CLICK_EVENT_NAME, callback, options);\r\n\r\n  // @ts-ignore\r\n  return () => remove(CLICK_EVENT_NAME, callback, options);\r\n}\r\n\r\n// export function detachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options?: AddEventListenerOptions) {\r\n//   // if(CLICK_EVENT_NAME === 'touchend') {\r\n//   //   elem.removeEventListener('touchstart', callback, options);\r\n//   // } else {\r\n//   elem.removeEventListener(CLICK_EVENT_NAME, callback as any, options);\r\n//   // }\r\n// }\r\n\r\nexport function simulateClickEvent(elem: HTMLElement) {\r\n  simulateEvent(elem, CLICK_EVENT_NAME);\r\n}\r\n","const BOM = '﻿';\r\n// const BOM = 'K';\r\nexport default BOM;\r\n","import wrapUrl from './wrapUrl';\r\n\r\nexport default function wrapTelegramUrlToAnchor(url1: string) {\r\n  const {url, onclick} = wrapUrl(url1);\r\n  const element = document.createElement('a');\r\n  (element as HTMLAnchorElement).href = url;\r\n  if(onclick) {\r\n    element.setAttribute('onclick', `${onclick}(this)`);\r\n  }\r\n\r\n  return element;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n/* export function isInDOM(element: Element, parentNode?: HTMLElement): boolean {\r\n  if(!element) {\r\n    return false;\r\n  }\r\n\r\n  parentNode = parentNode || document.body;\r\n  if(element === parentNode) {\r\n    return true;\r\n  }\r\n  return isInDOM(element.parentNode as HTMLElement, parentNode);\r\n} */\r\nexport default function isInDOM(element: Element): boolean {\r\n  return !!element?.isConnected;\r\n}\r\n","export default function forEachReverse<T>(array: Array<T>, callback: (value: T, index?: number, array?: Array<T>) => void) {\r\n  for(let length = array.length, i = length - 1; i >= 0; --i) {\r\n    callback(array[i], i, array);\r\n  }\r\n};\r\n","import noop from '../noop';\r\n\r\nexport default function safePlay(media: {play: () => any}) {\r\n  try {\r\n    const promise = media.play();\r\n    if(promise instanceof Promise) {\r\n      promise.catch(noop);\r\n    }\r\n  } catch(e) {\r\n    console.error(e);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {LiteModeKey} from '../helpers/liteMode';\r\nimport type RLottiePlayer from '../lib/rlottie/rlottiePlayer';\r\nimport rootScope from '../lib/rootScope';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport forEachReverse from '../helpers/array/forEachReverse';\r\nimport idleController from '../helpers/idleController';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport {Middleware} from '../helpers/middleware';\r\nimport safePlay from '../helpers/dom/safePlay';\r\n\r\nexport type AnimationItemGroup = '' | 'none' | 'chat' | 'lock' |\r\n  'STICKERS-POPUP' | 'emoticons-dropdown' | 'STICKERS-SEARCH' | 'GIFS-SEARCH' |\r\n  `CHAT-MENU-REACTIONS-${number}` | 'INLINE-HELPER' | 'GENERAL-SETTINGS' | 'STICKER-VIEWER' | 'EMOJI' |\r\n  'EMOJI-STATUS' | `chat-${number}` | 'PREMIUM-PROMO' | 'NEW-MEDIA' | 'BLUFF-SPOILER';\r\nexport interface AnimationItem {\r\n  el: HTMLElement,\r\n  group: AnimationItemGroup,\r\n  animation: AnimationItemWrapper,\r\n  liteModeKey?: LiteModeKey,\r\n  controlled?: boolean | Middleware,\r\n  type: AnimationItemType,\r\n  locked?: boolean\r\n};\r\n\r\nexport type AnimationItemType = 'lottie' | 'dots' | 'video' | 'emoji';\r\n\r\nexport interface AnimationItemWrapper {\r\n  remove: () => void;\r\n  paused: boolean;\r\n  pause: () => any;\r\n  play: () => any;\r\n  autoplay: boolean;\r\n  _autoplay?: boolean;\r\n  loop: boolean | number;\r\n  _loop?: boolean | number;\r\n  // onVisibilityChange?: (visible: boolean) => boolean;\r\n};\r\n\r\nexport class AnimationIntersector {\r\n  private observer: IntersectionObserver;\r\n  private visible: Set<AnimationItem>;\r\n\r\n  private overrideIdleGroups: Set<string>;\r\n  private byGroups: {[group in AnimationItemGroup]?: AnimationItem[]};\r\n  private byPlayer: Map<AnimationItem['animation'], AnimationItem>;\r\n  private lockedGroups: {[group in AnimationItemGroup]?: true};\r\n  private onlyOnePlayableGroup: AnimationItemGroup;\r\n\r\n  private intersectionLockedGroups: {[group in AnimationItemGroup]?: true};\r\n  private videosLocked: boolean;\r\n\r\n  constructor() {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      // if(rootScope.idle.isIDLE) return;\r\n\r\n      for(const entry of entries) {\r\n        const target = entry.target;\r\n\r\n        for(const group in this.byGroups) {\r\n          if(this.intersectionLockedGroups[group as AnimationItemGroup]) {\r\n            continue;\r\n          }\r\n\r\n          const animation = this.byGroups[group as AnimationItemGroup].find((p) => p.el === target);\r\n          if(!animation) {\r\n            continue;\r\n          }\r\n\r\n          if(entry.isIntersecting) {\r\n            this.visible.add(animation);\r\n            this.checkAnimation(animation, false);\r\n\r\n            /* if(animation instanceof HTMLVideoElement && animation.dataset.src) {\r\n              animation.src = animation.dataset.src;\r\n              animation.load();\r\n            } */\r\n          } else {\r\n            this.visible.delete(animation);\r\n            this.checkAnimation(animation, true);\r\n\r\n            const _animation = animation.animation;\r\n            if(animation.type === 'lottie'/*  && animation.cachingDelta === 2 */) {\r\n              // console.warn('will clear cache', player);\r\n              (_animation as RLottiePlayer).clearCache();\r\n            }/*  else if(animation instanceof HTMLVideoElement && animation.src) {\r\n              animation.dataset.src = animation.src;\r\n              animation.src = '';\r\n              animation.load();\r\n            } */\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.visible = new Set();\r\n\r\n    this.overrideIdleGroups = new Set();\r\n    this.byGroups = {};\r\n    this.byPlayer = new Map();\r\n    this.lockedGroups = {};\r\n    this.onlyOnePlayableGroup = '';\r\n\r\n    this.intersectionLockedGroups = {};\r\n    this.videosLocked = false;\r\n\r\n    idleController.addEventListener('change', (idle) => {\r\n      this.checkAnimations2(idle);\r\n    });\r\n  }\r\n\r\n  public toggleMediaPause(paused: boolean) {\r\n    if(paused) {\r\n      if(this.videosLocked) {\r\n        this.videosLocked = false;\r\n        this.checkAnimations2();\r\n      }\r\n    } else {\r\n      this.videosLocked = true;\r\n      this.checkAnimations2();\r\n    }\r\n  }\r\n\r\n  public setOverrideIdleGroup(group: string, override: boolean) {\r\n    if(override) this.overrideIdleGroups.add(group);\r\n    else this.overrideIdleGroups.delete(group);\r\n  }\r\n\r\n  public getAnimations(element: HTMLElement) {\r\n    const found: AnimationItem[] = [];\r\n    for(const group in this.byGroups) {\r\n      for(const player of this.byGroups[group as AnimationItemGroup]) {\r\n        if(player.el === element) {\r\n          found.push(player);\r\n        }\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  public removeAnimation(player: AnimationItem) {\r\n    const {el, animation} = player;\r\n    if(player.controlled !== true && player.type !== 'video') {\r\n      animation.remove();\r\n    }\r\n\r\n    const group = this.byGroups[player.group];\r\n    if(group) {\r\n      indexOfAndSplice(group, player);\r\n      if(!group.length) {\r\n        delete this.byGroups[player.group];\r\n      }\r\n    }\r\n\r\n    this.observer.unobserve(el);\r\n    this.visible.delete(player);\r\n    this.byPlayer.delete(animation);\r\n  }\r\n\r\n  public removeAnimationByPlayer(player: AnimationItemWrapper) {\r\n    const item = this.byPlayer.get(player);\r\n    if(item) {\r\n      this.removeAnimation(item);\r\n    }\r\n  }\r\n\r\n  public addAnimation(options: {\r\n    animation: AnimationItem['animation'],\r\n    group?: AnimationItemGroup,\r\n    observeElement: HTMLElement,\r\n    controlled?: AnimationItem['controlled'],\r\n    liteModeKey?: LiteModeKey\r\n    type: AnimationItemType,\r\n    locked?: boolean\r\n  }) {\r\n    const {animation, group = '', observeElement, controlled, liteModeKey, type, locked} = options;\r\n    if(group === 'none' || this.byPlayer.has(animation)) {\r\n      return;\r\n    }\r\n\r\n    const item: AnimationItem = {\r\n      el: observeElement,\r\n      animation: animation,\r\n      group,\r\n      controlled,\r\n      liteModeKey,\r\n      type,\r\n      locked\r\n    };\r\n\r\n    if(controlled && typeof(controlled) !== 'boolean') {\r\n      controlled.onClean(() => {\r\n        this.removeAnimationByPlayer(animation);\r\n      });\r\n    }\r\n\r\n    if(item.type === 'lottie') {\r\n      if(!rootScope.settings.stickers.loop && animation.loop) {\r\n        animation.loop = rootScope.settings.stickers.loop;\r\n      }\r\n    }\r\n\r\n    (this.byGroups[group as AnimationItemGroup] ??= []).push(item);\r\n    this.observer.observe(item.el);\r\n    this.byPlayer.set(animation, item);\r\n  }\r\n\r\n  public checkAnimations(\r\n    blurred?: boolean,\r\n    group?: AnimationItemGroup,\r\n    destroy?: boolean,\r\n    imitateIntersection?: boolean\r\n  ) {\r\n    // if(rootScope.idle.isIDLE) return;\r\n\r\n    if(group !== undefined && !this.byGroups[group]) {\r\n      // console.warn('no animation group:', group);\r\n      return;\r\n    }\r\n\r\n    const groups = group !== undefined /* && false */ ? [group] : Object.keys(this.byGroups) as AnimationItemGroup[];\r\n\r\n    for(const group of groups) {\r\n      if(imitateIntersection && this.intersectionLockedGroups[group]) {\r\n        continue;\r\n      }\r\n\r\n      const animations = this.byGroups[group];\r\n\r\n      forEachReverse(animations, (animation) => {\r\n        this.checkAnimation(animation, blurred, destroy);\r\n      });\r\n    }\r\n  }\r\n\r\n  public checkAnimations2(blurred?: boolean) {\r\n    this.checkAnimations(blurred, undefined, undefined, true);\r\n  }\r\n\r\n  public checkAnimation(player: AnimationItem, blurred?: boolean, destroy?: boolean) {\r\n    const {el, animation, group, locked} = player;\r\n    if(locked) {\r\n      return;\r\n    }\r\n\r\n    // return;\r\n    if(destroy || (!this.lockedGroups[group] && !isInDOM(el))) {\r\n      if(!player.controlled || destroy) {\r\n        this.removeAnimation(player);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(\r\n      blurred ||\r\n      (this.onlyOnePlayableGroup && this.onlyOnePlayableGroup !== group) ||\r\n      (player.type === 'video' && this.videosLocked)\r\n    ) {\r\n      if(!animation.paused) {\r\n        // console.warn('pause animation:', animation);\r\n        animation.pause();\r\n      }\r\n    } else if(\r\n      animation.paused &&\r\n      this.visible.has(player) &&\r\n      animation.autoplay &&\r\n      (!this.onlyOnePlayableGroup || this.onlyOnePlayableGroup === group) &&\r\n      (!idleController.isIdle || this.overrideIdleGroups.has(player.group))\r\n    ) {\r\n      // console.warn('play animation:', animation);\r\n      safePlay(animation);\r\n    }\r\n  }\r\n\r\n  public getOnlyOnePlayableGroup() {\r\n    return this.onlyOnePlayableGroup;\r\n  }\r\n\r\n  public setOnlyOnePlayableGroup(group: AnimationItemGroup = '') {\r\n    this.onlyOnePlayableGroup = group;\r\n  }\r\n\r\n  public lockGroup(group: AnimationItemGroup) {\r\n    this.lockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockGroup(group: AnimationItemGroup) {\r\n    delete this.lockedGroups[group];\r\n    this.checkAnimations(undefined, group);\r\n  }\r\n\r\n  public refreshGroup(group: AnimationItemGroup) {\r\n    const animations = this.byGroups[group];\r\n    if(!animations?.length) {\r\n      return;\r\n    }\r\n\r\n    animations.forEach((animation) => {\r\n      this.observer.unobserve(animation.el);\r\n    });\r\n\r\n    fastRaf(() => {\r\n      animations.forEach((animation) => {\r\n        this.observer.observe(animation.el);\r\n      });\r\n    });\r\n  }\r\n\r\n  public lockIntersectionGroup(group: AnimationItemGroup) {\r\n    this.intersectionLockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockIntersectionGroup(group: AnimationItemGroup) {\r\n    delete this.intersectionLockedGroups[group];\r\n    this.refreshGroup(group);\r\n  }\r\n\r\n  public toggleIntersectionGroup(group: AnimationItemGroup, lock: boolean) {\r\n    if(lock) this.lockIntersectionGroup(group);\r\n    else this.unlockIntersectionGroup(group);\r\n  }\r\n\r\n  public setAutoplay(play: boolean, liteModeKey: LiteModeKey) {\r\n    let changed = false;\r\n    this.byPlayer.forEach((animationItem, animation) => {\r\n      if(animationItem.liteModeKey === liteModeKey) {\r\n        changed = true;\r\n        animation.autoplay = play ? animation._autoplay : false;\r\n        animation.loop = play ? rootScope.settings.stickers.loop && animation._loop : false;\r\n      }\r\n    });\r\n\r\n    return changed;\r\n  }\r\n\r\n  public setLoop(loop: boolean) {\r\n    let changed = false;\r\n    this.byPlayer.forEach((animationItem, animation) => {\r\n      if(\r\n        animation._loop &&\r\n        animation.loop !== loop &&\r\n        (animationItem.type === 'lottie' || animationItem.type === 'video')\r\n      ) {\r\n        changed = true;\r\n        animation.loop = loop;\r\n\r\n        // if(animation._autoplay && animation.autoplay !== animation._autoplay) {\r\n        animation.autoplay = animation._autoplay;\r\n        // }\r\n      }\r\n    });\r\n\r\n    return changed;\r\n  }\r\n\r\n  public toggleItemLock(animationItem: AnimationItem, lock: boolean) {\r\n    // const wasLocked = animationItem.locked;\r\n    animationItem.locked = lock;\r\n\r\n    // if(!!wasLocked !== lock) {\r\n    //   this.checkAnimation(animationItem);\r\n    // }\r\n  }\r\n}\r\n\r\nconst animationIntersector = new AnimationIntersector();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.animationIntersector = animationIntersector);\r\nexport default animationIntersector;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\ntype TargetType = HTMLElement;\r\nexport type OnVisibilityChangeItem = {target: TargetType, visible: boolean, entry: IntersectionObserverEntry, index: number};\r\nexport type OnVisibilityChange = (item: OnVisibilityChangeItem) => void;\r\n\r\nexport default class VisibilityIntersector {\r\n  private observer: IntersectionObserver;\r\n  private items: Map<TargetType, boolean> = new Map();\r\n  private locked = false;\r\n\r\n  constructor(onVisibilityChange: OnVisibilityChange, options?: IntersectionObserverInit) {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      if(this.locked) {\r\n        return;\r\n      }\r\n\r\n      const changed: OnVisibilityChangeItem[] = [];\r\n\r\n      entries.forEach((entry, index) => {\r\n        const target = entry.target as TargetType;\r\n\r\n        if(this.items.get(target) === entry.isIntersecting) {\r\n          return;\r\n        } else {\r\n          this.items.set(target, entry.isIntersecting);\r\n        }\r\n\r\n        /* if(entry.isIntersecting) {\r\n          console.log('ooo', entry);\r\n        } */\r\n\r\n        /* if(this.locked) {\r\n          return;\r\n        } */\r\n\r\n        const change: typeof changed[0] = {target, visible: entry.isIntersecting, entry, index};\r\n\r\n        // ! order will be incorrect so can't use it\r\n        // changed[entry.isIntersecting ? 'unshift' : 'push'](change);\r\n        changed.push(change);\r\n\r\n        // onVisibilityChange(target, entry.isIntersecting);\r\n      });\r\n\r\n      changed.forEach((item) => {\r\n        onVisibilityChange(item);\r\n      });\r\n    }, options);\r\n  }\r\n\r\n  public getVisible() {\r\n    const items: TargetType[] = [];\r\n    this.items.forEach((value, key) => {\r\n      if(value) {\r\n        items.push(key);\r\n      }\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  public clearVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.items.set(target, false);\r\n    }\r\n  }\r\n\r\n  public isVisible(target: TargetType) {\r\n    return !!this.items.get(target);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.observer.disconnect();\r\n    this.items.clear();\r\n  }\r\n\r\n  public refresh() {\r\n    this.observer.disconnect();\r\n\r\n    // window.requestAnimationFrame(() => {\r\n    const targets = [...this.items.keys()];\r\n    for(const target of targets) {\r\n      // this.items.set(target, false);\r\n      this.observer.observe(target);\r\n    }\r\n    // });\r\n  }\r\n\r\n  public refreshVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.observer.unobserve(target);\r\n    }\r\n\r\n    for(const target of visible) {\r\n      this.observer.observe(target);\r\n    }\r\n  }\r\n\r\n  public observe(target: TargetType) {\r\n    this.items.set(target, false);\r\n    this.observer.observe(target);\r\n  }\r\n\r\n  public unobserve(target: TargetType) {\r\n    this.observer.unobserve(target);\r\n    this.items.delete(target);\r\n  }\r\n\r\n  public unlock() {\r\n    this.locked = false;\r\n  }\r\n\r\n  public unlockAndRefresh() {\r\n    this.unlock();\r\n    this.refresh();\r\n  }\r\n\r\n  public lock() {\r\n    this.locked = true;\r\n  }\r\n}\r\n","export default function findAndSpliceAll<T>(array: Array<T>, verify: (value: T, index: number, arr: typeof array) => boolean) {\r\n  const out: typeof array = [];\r\n  let idx = -1;\r\n  while((idx = array.findIndex(verify)) !== -1) {\r\n    out.push(array.splice(idx, 1)[0]);\r\n  }\r\n\r\n  return out;\r\n}\r\n","export default function findAndSplice<T>(array: Array<T>, verify: (value: T, index?: number, array?: Array<T>) => boolean) {\r\n  const index = array.findIndex(verify);\r\n  return index !== -1 ? array.splice(index, 1)[0] : undefined;\r\n};\r\n","// * Jolly Cobra's schedulers\r\n\r\nimport {AnyToVoidFunction} from '../../types';\r\n\r\nexport default function throttle<F extends AnyToVoidFunction>(\r\n  fn: F,\r\n  ms: number,\r\n  shouldRunFirst = true\r\n) {\r\n  let interval: number | null = null;\r\n  let isPending: boolean;\r\n  let args: Parameters<F>;\r\n\r\n  const clear = () => {\r\n    clearInterval(interval!);\r\n    interval = null;\r\n  };\r\n\r\n  const ret = (..._args: Parameters<F>) => {\r\n    isPending = true;\r\n    args = _args;\r\n\r\n    if(!interval) {\r\n      if(shouldRunFirst) {\r\n        isPending = false;\r\n        // @ts-ignore\r\n        fn(...args);\r\n      }\r\n\r\n      interval = setInterval(() => {\r\n        if(!isPending) {\r\n          clear();\r\n          return;\r\n        }\r\n\r\n        isPending = false;\r\n        // @ts-ignore\r\n        fn(...args);\r\n      }, ms) as any;\r\n    }\r\n  };\r\n\r\n  ret.clear = clear;\r\n\r\n  return ret;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport {Middleware} from '../helpers/middleware';\r\nimport throttle from '../helpers/schedulers/throttle';\r\nimport {logger, LogTypes} from '../lib/logger';\r\n\r\nconst PARALLEL_LIMIT = 8;\r\nconst IGNORE_ERRORS: Set<ErrorType> = new Set(['NO_ENTRY_FOUND', 'STORAGE_OFFLINE', 'MIDDLEWARE', 'NO_AUTO_DOWNLOAD']);\r\n\r\nexport type LazyLoadElementBase = {\r\n  load: () => Promise<any>,\r\n  middleware?: Middleware\r\n};\r\n\r\nexport default class LazyLoadQueueBase {\r\n  public queueId = 0;\r\n  protected queue: Array<LazyLoadElementBase> = [];\r\n  protected inProcess: Set<LazyLoadElementBase> = new Set();\r\n\r\n  protected lockPromise: Promise<void> = null;\r\n  protected unlockResolve: () => void = null;\r\n\r\n  protected log = logger('LL', LogTypes.Error);\r\n  protected processQueue: () => void;\r\n\r\n  constructor(protected parallelLimit = PARALLEL_LIMIT) {\r\n    this.processQueue = throttle(() => this._processQueue(), 8, false);\r\n  }\r\n\r\n  public clear() {\r\n    this.inProcess.clear(); // ацтеки забьются, будет плохо\r\n\r\n    this.queue.length = 0;\r\n    // unreachable code\r\n    /* for(let item of this.inProcess) {\r\n      this.lazyLoadMedia.push(item);\r\n    } */\r\n  }\r\n\r\n  public lock() {\r\n    if(this.lockPromise) return;\r\n\r\n    // const perf = performance.now();\r\n    this.lockPromise = new Promise((resolve, reject) => {\r\n      this.unlockResolve = resolve;\r\n    });\r\n\r\n    /* if(DEBUG) {\r\n      this.lockPromise.then(() => {\r\n        this.log('was locked for:', performance.now() - perf);\r\n      });\r\n    } */\r\n  }\r\n\r\n  public unlock() {\r\n    if(!this.unlockResolve) return;\r\n\r\n    this.unlockResolve();\r\n    this.unlockResolve = this.lockPromise = null;\r\n\r\n    this.processQueue();\r\n  }\r\n\r\n  protected async processItem(item: LazyLoadElementBase) {\r\n    if(this.lockPromise) {\r\n      return;\r\n    }\r\n\r\n    this.inProcess.add(item);\r\n\r\n    /* if(DEBUG) {\r\n      this.log('will load media', this.lockPromise, item);\r\n    } */\r\n\r\n    try {\r\n      // await new Promise((resolve) => setTimeout(resolve, 2e3));\r\n      // await new Promise((resolve, reject) => window.requestAnimationFrame(() => window.requestAnimationFrame(resolve)));\r\n      // await item.load(item.div);\r\n      await this.loadItem(item);\r\n    } catch(err) {\r\n      if(!IGNORE_ERRORS.has((err as ApiError)?.type)) {\r\n        this.log.error('loadMediaQueue error:', err/* , item */);\r\n      }\r\n    }\r\n\r\n    this.inProcess.delete(item);\r\n\r\n    /* if(DEBUG) {\r\n      this.log('loaded media', item);\r\n    } */\r\n\r\n    this.processQueue();\r\n  }\r\n\r\n  protected loadItem(item: LazyLoadElementBase) {\r\n    return item.load();\r\n  }\r\n\r\n  protected getItem() {\r\n    return this.queue.shift();\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElementBase) {\r\n    this.queue[method](el);\r\n    this.processQueue();\r\n  }\r\n\r\n  protected _processQueue(item?: LazyLoadElementBase) {\r\n    if(!this.queue.length || this.lockPromise || (this.parallelLimit > 0 && this.inProcess.size >= this.parallelLimit)) return;\r\n\r\n    // console.log('_processQueue start');\r\n    // let added = 0;\r\n    do {\r\n      if(item) {\r\n        indexOfAndSplice(this.queue, item);\r\n      } else {\r\n        item = this.getItem();\r\n      }\r\n\r\n      if(item) {\r\n        this.processItem(item);\r\n      } else {\r\n        break;\r\n      }\r\n\r\n      item = null;\r\n      // ++added;\r\n    } while(this.inProcess.size < this.parallelLimit && this.queue.length);\r\n    // console.log('_processQueue end, added', added, this.queue.length);\r\n  }\r\n\r\n  public push(el: LazyLoadElementBase) {\r\n    this.addElement('push', el);\r\n  }\r\n\r\n  public unshift(el: LazyLoadElementBase) {\r\n    this.addElement('unshift', el);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\r\nimport LazyLoadQueueBase, {LazyLoadElementBase} from './lazyLoadQueueBase';\r\nimport VisibilityIntersector from './visibilityIntersector';\r\n\r\nexport type LazyLoadElement = Omit<LazyLoadElementBase, 'load'> & {\r\n  load: (target?: HTMLElement) => Promise<any>,\r\n  div: HTMLElement\r\n  wasSeen?: boolean,\r\n  visible?: boolean\r\n};\r\n\r\nexport default class LazyLoadQueueIntersector extends LazyLoadQueueBase {\r\n  protected queue: Array<LazyLoadElement> = [];\r\n  protected inProcess: Set<LazyLoadElement> = new Set();\r\n\r\n  public intersector: VisibilityIntersector;\r\n  protected intersectorTimeout: number;\r\n\r\n  constructor(parallelLimit?: number) {\r\n    super(parallelLimit);\r\n  }\r\n\r\n  public lock() {\r\n    super.lock();\r\n    this.intersector.lock();\r\n  }\r\n\r\n  public unlock() {\r\n    super.unlock();\r\n    this.intersector.unlock();\r\n  }\r\n\r\n  public unlockAndRefresh() {\r\n    super.unlock();\r\n    this.intersector.unlockAndRefresh();\r\n  }\r\n\r\n  public clear() {\r\n    super.clear();\r\n    this.intersector.disconnect();\r\n  }\r\n\r\n  public refresh() {\r\n    this.intersector.refresh();\r\n  }\r\n\r\n  protected loadItem(item: LazyLoadElement) {\r\n    return item.load(item.div);\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\r\n    const item = this.queue.find((i) => i.div === el.div && i.load === el.load);\r\n    if(item) {\r\n      return false;\r\n    } else {\r\n      for(const item of this.inProcess) {\r\n        if(item.div === el.div && item.load === el.load) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.queue[method](el);\r\n    return true;\r\n  }\r\n\r\n  protected setProcessQueueTimeout() {\r\n    this.intersectorTimeout ??= window.setTimeout(() => {\r\n      this.intersectorTimeout = undefined;\r\n      this.processQueue();\r\n    }, 0);\r\n  }\r\n\r\n  public push(el: LazyLoadElement) {\r\n    super.push(el);\r\n  }\r\n\r\n  public unshift(el: LazyLoadElement) {\r\n    super.unshift(el);\r\n  }\r\n\r\n  public delete(el: Omit<LazyLoadElement, 'load'>) {\r\n    findAndSpliceAll(this.queue, (i) => i.div === el.div);\r\n    this.unobserve(el);\r\n  }\r\n\r\n  public observe(el: LazyLoadElement) {\r\n    this.intersector.observe(el.div);\r\n  }\r\n\r\n  public unobserve(el: Omit<LazyLoadElement, 'load'>) {\r\n    this.intersector.unobserve(el.div);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's useHeavyAnimationCheck.ts, patched\r\n\r\nimport {AnyToVoidFunction} from '../types';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport DEBUG from '../config/debug';\r\nimport pause from '../helpers/schedulers/pause';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\nconst eventListener = new EventListenerBase<{\r\n  start: () => void,\r\n  end: () => void\r\n}>();\r\nconst ANIMATION_START_EVENT = 'start';\r\nconst ANIMATION_END_EVENT = 'end';\r\n\r\nlet isAnimating = false;\r\nlet heavyAnimationPromise: CancellablePromise<void> = deferredPromise<void>();\r\nlet promisesInQueue = 0;\r\n\r\nheavyAnimationPromise.resolve();\r\n\r\nconst log = console.log.bind(console.log, '[HEAVY-ANIMATION]:');\r\n\r\nexport function dispatchHeavyAnimationEvent(promise: Promise<any>, timeout?: number) {\r\n  if(!isAnimating) {\r\n    heavyAnimationPromise = deferredPromise<void>();\r\n    eventListener.dispatchEvent(ANIMATION_START_EVENT);\r\n    isAnimating = true;\r\n    DEBUG && log('start');\r\n  }\r\n\r\n  ++promisesInQueue;\r\n  DEBUG && log('attach promise, length:', promisesInQueue, timeout);\r\n\r\n  const promises = [\r\n    timeout !== undefined ? pause(timeout) : undefined,\r\n    promise.finally(() => {})\r\n  ].filter(Boolean);\r\n\r\n  const perf = performance.now();\r\n  const _heavyAnimationPromise = heavyAnimationPromise;\r\n  Promise.race(promises).then(() => {\r\n    if(heavyAnimationPromise !== _heavyAnimationPromise || heavyAnimationPromise.isFulfilled) { // interrupted\r\n      return;\r\n    }\r\n\r\n    --promisesInQueue;\r\n    DEBUG && log('promise end, length:', promisesInQueue, performance.now() - perf);\r\n    if(promisesInQueue <= 0) {\r\n      onHeavyAnimationEnd();\r\n    }\r\n  });\r\n\r\n  return heavyAnimationPromise;\r\n}\r\n\r\n(window as any).dispatchHeavyAnimationEvent = dispatchHeavyAnimationEvent;\r\n\r\nfunction onHeavyAnimationEnd() {\r\n  if(heavyAnimationPromise.isFulfilled) {\r\n    return;\r\n  }\r\n\r\n  isAnimating = false;\r\n  promisesInQueue = 0;\r\n  eventListener.dispatchEvent(ANIMATION_END_EVENT);\r\n  heavyAnimationPromise.resolve();\r\n\r\n  DEBUG && log('end');\r\n}\r\n\r\nexport function interruptHeavyAnimation() {\r\n  onHeavyAnimationEnd();\r\n}\r\n\r\nexport function getHeavyAnimationPromise() {\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nexport default function(\r\n  handleAnimationStart: AnyToVoidFunction,\r\n  handleAnimationEnd: AnyToVoidFunction,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  // useEffect(() => {\r\n  if(isAnimating) {\r\n    handleAnimationStart();\r\n  }\r\n\r\n  const add = listenerSetter ? listenerSetter.add(eventListener) : eventListener.addEventListener.bind(eventListener);\r\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, eventListener) : eventListener.removeEventListener.bind(eventListener);\r\n  add(ANIMATION_START_EVENT, handleAnimationStart);\r\n  add(ANIMATION_END_EVENT, handleAnimationEnd);\r\n\r\n  return () => {\r\n    remove(ANIMATION_END_EVENT, handleAnimationEnd);\r\n    remove(ANIMATION_START_EVENT, handleAnimationStart);\r\n  };\r\n  // }, [handleAnimationEnd, handleAnimationStart]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport VisibilityIntersector, {OnVisibilityChangeItem} from './visibilityIntersector';\r\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\r\nimport findAndSplice from '../helpers/array/findAndSplice';\r\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\n\r\nexport default class LazyLoadQueue extends LazyLoadQueueIntersector {\r\n  constructor(parallelLimit?: number, ignoreHeavyAnimation?: boolean) {\r\n    super(parallelLimit);\r\n\r\n    this.intersector = new VisibilityIntersector(this.onVisibilityChange);\r\n\r\n    !ignoreHeavyAnimation && useHeavyAnimationCheck(() => {\r\n      this.lock();\r\n    }, () => {\r\n      this.unlockAndRefresh();\r\n    });\r\n  }\r\n\r\n  private onVisibilityChange = ({target, visible}: OnVisibilityChangeItem) => {\r\n    // if(DEBUG) {\r\n    //   this.log('isIntersecting', target, visible);\r\n    // }\r\n\r\n    // if visible - will move to the end of visible arary\r\n    findAndSpliceAll(this.queue, (i) => i.div === target).forEach((item) => {\r\n      if(visible) {\r\n        item.wasSeen = true;\r\n      }\r\n\r\n      item.visible = visible;\r\n      const index = this.queue.findIndex((item) => !item.visible);\r\n      this.queue.splice(Math.max(0, index), 0, item);\r\n    });\r\n\r\n    this.setProcessQueueTimeout();\r\n  };\r\n\r\n  protected getItem() {\r\n    return findAndSplice(this.queue, (item) => item.wasSeen);\r\n  }\r\n\r\n  public async processItem(item: LazyLoadElement) {\r\n    await super.processItem(item);\r\n    this.intersector.unobserve(item.div);\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\r\n    const inserted = super.addElement(method, el);\r\n\r\n    if(!inserted) return false;\r\n\r\n    this.observe(el);\r\n    /* if(el.wasSeen) {\r\n      this.processQueue(el);\r\n    } else  */\r\n    el.wasSeen ??= false;\r\n\r\n    return true;\r\n  }\r\n\r\n  public setAllSeen() {\r\n    this.queue.forEach((item) => {\r\n      item.wasSeen = true;\r\n    });\r\n\r\n    this.setProcessQueueTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n/**\r\n  * https://core.telegram.org/api/files#vector-thumbnails\r\n  */\r\nexport default function getPathFromBytes(bytes: Uint8Array) {\r\n  const lookup = 'AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,';\r\n\r\n  let path = 'M';\r\n  for(let i = 0, length = bytes.length; i < length; ++i) {\r\n    const num = bytes[i];\r\n\r\n    if(num >= (128 + 64)) {\r\n      path += lookup[num - 128 - 64];\r\n    } else {\r\n      if(num >= 128) {\r\n        path += ',';\r\n      } else if(num >= 64) {\r\n        path += '-';\r\n      }\r\n      path += '' + (num & 63);\r\n    }\r\n  }\r\n  path += 'z';\r\n\r\n  return path;\r\n}\r\n","let outCanvas: HTMLCanvasElement,\r\n  outContext: CanvasRenderingContext2D;\r\n\r\n// https://github.com/telegramdesktop/tdesktop/blob/543bfab24a76402992421063f1e6444f347d31fe/Telegram/SourceFiles/boxes/sticker_set_box.cpp#L75\r\nexport default function computeLockColor(canvas: HTMLCanvasElement) {\r\n  if(!outCanvas) {\r\n    outCanvas = document.createElement('canvas');\r\n    outContext = outCanvas.getContext('2d');\r\n  }\r\n\r\n  const context = canvas.getContext('2d');\r\n  const size = 20 * (canvas.dpr ?? 1);\r\n  const width = size;\r\n  const height = size;\r\n  const skipx = (canvas.width - width) / 2;\r\n  const margin = 0/*  * (canvas.dpr ?? 1) */;\r\n  const skipy = canvas.height - height - margin;\r\n  const imageData = context.getImageData(skipx, skipy, width, height).data;\r\n  let sr = 0, sg = 0, sb = 0, sa = 0;\r\n  for(let i = 0; i < imageData.length; i += 4) {\r\n    sr += imageData[i];\r\n    sg += imageData[i + 1];\r\n    sb += imageData[i + 2];\r\n    sa += imageData[i + 3];\r\n  }\r\n\r\n  outCanvas.width = outCanvas.height = size;\r\n  const color = new Uint8ClampedArray([sr * 255 / sa, sg * 255 / sa, sb * 255 / sa, 255]);\r\n  const rgba = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3]})`;\r\n  outContext.fillStyle = rgba;\r\n  outContext.fillRect(0, 0, size, size);\r\n  outContext.fillStyle = `rgba(112, 117, 121, 0.3)`;\r\n  outContext.fillRect(0, 0, size, size);\r\n  // document.querySelector('.popup-title').append(c);\r\n  return outCanvas.toDataURL('image/jpeg');\r\n}\r\n","import assumeType from '../../helpers/assumeType';\r\nimport {Document} from '../../layer';\r\nimport {logger} from '../logger';\r\n\r\nexport const QUALITY_FILE_MIME_TYPE = 'application/x-mpegurl';\r\n\r\nexport const ctx = self as any as ServiceWorkerGlobalScope;\r\nexport const log = logger('HLS');\r\nexport const swLog = logger('SW-HLS');\r\n\r\nexport function isDocumentHlsQualityFile(doc: Document | undefined) {\r\n  assumeType<Document.document | undefined>(doc);\r\n  return doc?.mime_type === QUALITY_FILE_MIME_TYPE;\r\n}\r\n","import type Hls from 'hls.js';\r\n\r\nexport const hlsInstancesByVideo = new WeakMap<HTMLVideoElement, Hls>();\r\n","import DEBUG from '../../config/debug';\r\nimport {Middleware} from '../../helpers/middleware';\r\n\r\nimport {log} from './common';\r\nimport {hlsInstancesByVideo} from './hlsInstancesByVideo';\r\n\r\ntype InitVideoHlsParameters = {\r\n  video: HTMLVideoElement;\r\n  src: string;\r\n  middleware: Middleware;\r\n};\r\n\r\nexport async function initVideoHls({video, src, middleware}: InitVideoHlsParameters) {\r\n  const {default: Hls} = await import('hls.js');\r\n\r\n  log('initing video hls', src);\r\n\r\n  const hls = new Hls({\r\n    debug: DEBUG,\r\n    startLevel: 0,\r\n    testBandwidth: false,\r\n    // autoStartLoad: false\r\n    backBufferLength: 30,\r\n    maxBufferLength: 60,\r\n    maxMaxBufferLength: 60,\r\n    maxFragLookUpTolerance: 0.001,\r\n    maxBufferHole: 1,\r\n    nudgeMaxRetry: 10000\r\n  });\r\n\r\n  hlsInstancesByVideo.set(video, hls);\r\n\r\n  hls.loadSource(src);\r\n  hls.attachMedia(video as HTMLMediaElement);\r\n\r\n  middleware?.onDestroy(() => {\r\n    log('destroying Hls instance for video', src);\r\n    hls.destroy();\r\n  });\r\n}\r\n","import {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport {getCurrentAccount} from '../../lib/accounts/getCurrentAccount';\r\nimport {initVideoHls} from '../../lib/hls/initVideoHls';\r\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\r\nimport {Middleware} from '../middleware';\r\n\r\nfunction updateStreamInUse(url: string, inUse: boolean) {\r\n  if(url.includes('stream/')) {\r\n    apiManagerProxy.serviceMessagePort.invokeVoid('toggleStreamInUse', {url, inUse, accountNumber: getCurrentAccount()});\r\n  }\r\n}\r\n\r\n// const createdVideos: Set<HTMLVideoElement> = new Set();\r\nexport default function createVideo({\r\n  pip,\r\n  middleware\r\n}: {\r\n  pip?: boolean,\r\n  middleware: Middleware\r\n}) {\r\n  const video = document.createElement('video');\r\n  if(!pip) video.disablePictureInPicture = true;\r\n  video.setAttribute('playsinline', 'true');\r\n  // createdVideos.add(video);\r\n\r\n  middleware?.onDestroy(async() => {\r\n    // createdVideos.delete(video);\r\n    await getHeavyAnimationPromise();\r\n    video.src = '';\r\n    video.load();\r\n  });\r\n\r\n  let originalSrc = video.src;\r\n  Object.defineProperty(video, 'src', {\r\n    get: () => {\r\n      return originalSrc;\r\n    },\r\n    set: (newValue) => {\r\n      updateStreamInUse(originalSrc, false);\r\n      updateStreamInUse(newValue, true);\r\n\r\n      originalSrc = newValue;\r\n\r\n      if(newValue.startsWith('hls/')) {\r\n        initVideoHls({video, src: newValue, middleware: middleware});\r\n      } else {\r\n        video.setAttribute('src', newValue);\r\n      }\r\n    }\r\n  });\r\n\r\n  return video;\r\n}\r\n\r\n// (window as any).createdVideos = createdVideos;\r\n","export const CRBUG_1250841_ERROR = 'DECODER_ERROR_NOT_SUPPORTED: Audio configuration specified 2 channels, but FFmpeg thinks the file contains 1 channels';\r\n\r\nexport default function isCrbug1250841Error(err: MediaError) {\r\n  return err.code ===  4 && err.message === CRBUG_1250841_ERROR;\r\n}\r\n","import {IS_APPLE_MOBILE} from '../environment/userAgent';\r\nimport rootScope from '../lib/rootScope';\r\nimport callbackify from './callbackify';\r\nimport isCrbug1250841Error from './fixChromiumMp4.constants';\r\n\r\nexport function shouldIgnoreVideoError(e: ErrorEvent) {\r\n  try {\r\n    const target = e.target as HTMLVideoElement;\r\n    const error = target.error;\r\n\r\n    if(!error || error.message.includes('URL safety check')) {\r\n      console.warn('will ignore video error', e);\r\n      return true;\r\n    }\r\n\r\n    const isChromeBug = isCrbug1250841Error(error);\r\n    if(isChromeBug && !(target as any).triedFixingChromeBug) {\r\n      let srcPromise: MaybePromise<string>;\r\n      const originalSrc = target.src;\r\n      if(originalSrc.includes('stream/')) {\r\n        srcPromise = originalSrc + '?_crbug1250841';\r\n      } else {\r\n        srcPromise = rootScope.managers.appDocsManager.fixChromiumMp4(originalSrc);\r\n      }\r\n\r\n      callbackify(srcPromise, (src) => {\r\n        (target as any).triedFixingChromeBug = true;\r\n        if(target.src === src) {\r\n          return;\r\n        }\r\n\r\n        target.src = src;\r\n        target.load();\r\n      });\r\n      return true;\r\n    } else if(isChromeBug) {\r\n      console.error('chrome video error', e);\r\n    }\r\n  } catch(err) {}\r\n\r\n  return false;\r\n}\r\n\r\nexport default function onMediaLoad(media: HTMLMediaElement, readyState = media.HAVE_METADATA, useCanplayOnIos?: boolean) {\r\n  return new Promise<void>((resolve, reject) => {\r\n    if(media.readyState >= readyState) {\r\n      resolve();\r\n      return;\r\n    }\r\n\r\n    const loadEventName = IS_APPLE_MOBILE && !useCanplayOnIos ? 'loadeddata' : 'canplay';\r\n    const errorEventName = 'error';\r\n    const onLoad = () => {\r\n      media.removeEventListener(errorEventName, onError);\r\n      resolve();\r\n    };\r\n    const onError = (e: ErrorEvent) => {\r\n      if(shouldIgnoreVideoError(e)) {\r\n        return;\r\n      }\r\n\r\n      media.removeEventListener(loadEventName, onLoad);\r\n      media.removeEventListener(errorEventName, onError);\r\n      reject(media.error);\r\n    };\r\n    media.addEventListener(loadEventName, onLoad, {once: true});\r\n    media.addEventListener(errorEventName, onError);\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport onMediaLoad from '../onMediaLoad';\r\n\r\n// import { getHeavyAnimationPromise } from \"../../hooks/useHeavyAnimationCheck\";\r\n\r\nexport const loadedURLs: {[url: string]: boolean} = {};\r\nconst set = (elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement, url: string) => {\r\n  if(elem instanceof HTMLImageElement || elem instanceof HTMLVideoElement) elem.src = url;\r\n  else if(elem instanceof SVGImageElement) elem.setAttributeNS(null, 'href', url);\r\n  else elem.style.backgroundImage = 'url(' + url + ')';\r\n};\r\n\r\n// проблема функции в том, что она не подходит для ссылок, пригодна только для blob'ов, потому что обычным ссылкам нужен 'load' каждый раз.\r\nexport default function renderImageFromUrl(\r\n  elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement,\r\n  url: string,\r\n  callback?: () => void,\r\n  useCache?: boolean,\r\n  processImageOnLoad?: (image: HTMLImageElement) => void\r\n): MaybePromise<void> {\r\n  if(processImageOnLoad) useCache = false;\r\n  useCache ??= processImageOnLoad === undefined;\r\n\r\n  if(!url) {\r\n    console.error('renderImageFromUrl: no url?', elem, url);\r\n    callback?.();\r\n    return;\r\n  }\r\n\r\n  const isVideo = elem instanceof HTMLVideoElement;\r\n  if(((loadedURLs[url]/*  && false */) && useCache) || isVideo) {\r\n    /* if(isVideo) {\r\n      const source = document.createElement('source');\r\n      source.src = url;\r\n      source.type = 'video/webm';\r\n      elem.append(source);\r\n    } else  */if(elem) {\r\n      set(elem, url);\r\n    }\r\n\r\n    if(callback) {\r\n      if(isVideo) {\r\n        return onMediaLoad(elem).then(callback);\r\n      } else {\r\n        callback?.();\r\n      }\r\n      // callback && getHeavyAnimationPromise().then(() => callback());\r\n    }\r\n  } else {\r\n    const isImage = elem instanceof HTMLImageElement;\r\n    const loader = isImage ? elem : new Image();\r\n    // const loader = new Image();\r\n    // let perf = performance.now();\r\n\r\n    const onLoad = () => {\r\n      if(!isImage && elem) {\r\n        set(elem, url);\r\n      }\r\n\r\n      loadedURLs[url] = true;\r\n      // console.log('onload:', url, performance.now(), loader.naturalWidth, loader.naturalHeight);\r\n      processImageOnLoad?.(loader);\r\n      // TODO: переделать прогрузки аватаров до начала анимации, иначе с этим ожиданием они неприятно появляются\r\n      // callback && getHeavyAnimationPromise().then(() => callback());\r\n      callback?.();\r\n\r\n      // if(loader.naturalWidth) {\r\n      //   const interval = setInterval(() => {\r\n      //     if(!loader.naturalWidth) {\r\n      //       const parents = getParents(loader);\r\n      //       console.warn('image no dimensions', loader.isConnected, parents, (parents[parents.length - 1] as HTMLElement).outerHTML, loader.src === url);\r\n      //     }\r\n      //   }, 1);\r\n\r\n      //   setTimeout(() => clearInterval(interval), 1e3);\r\n      // }\r\n    };\r\n\r\n    const onError = (err: DOMException) => {\r\n      if(!err.message.includes('cannot be decoded')) {\r\n        console.error('Render image from url failed:', err, url, loader, err.message, loader.naturalWidth);\r\n      }\r\n\r\n      callback?.();\r\n    };\r\n\r\n    loader.decoding = 'async';\r\n    loader.src = url;\r\n    return loader.decode().then(onLoad, onError);\r\n    // const timeout = setTimeout(() => {\r\n    //   console.error('not yet decoded', loader, url);\r\n    //   debugger;\r\n    // }, 1e3);\r\n    // decodePromise.finally(() => {\r\n    //   clearTimeout(timeout);\r\n    // });\r\n  }\r\n}\r\n\r\nexport function renderImageFromUrlPromise(\r\n  elem: Parameters<typeof renderImageFromUrl>[0],\r\n  url: string,\r\n  useCache?: boolean,\r\n  processImageOnLoad?: (image: HTMLImageElement) => void\r\n) {\r\n  return new Promise<void>((resolve) => {\r\n    renderImageFromUrl(elem, url, resolve, useCache, processImageOnLoad);\r\n  });\r\n}\r\n","export default function bytesFromHex(hexString: string) {\r\n  const len = hexString.length;\r\n  const bytes = new Uint8Array(Math.ceil(len / 2));\r\n  let start = 0;\r\n\r\n  if(len % 2) { // read 0x581 as 0x0581\r\n    bytes[start++] = parseInt(hexString.charAt(0), 16);\r\n  }\r\n\r\n  for(let i = start; i < len; i += 2) {\r\n    bytes[start++] = parseInt(hexString.substr(i, 2), 16);\r\n  }\r\n\r\n  return bytes;\r\n}\r\n","export default function bytesToDataURL(bytes: Uint8Array, mimeType: string = 'image/jpeg') {\r\n  return `data:${mimeType};base64,${btoa(String.fromCharCode(...bytes))}`;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_SAFARI} from '../../environment/userAgent';\r\nimport bytesFromHex from './bytesFromHex';\r\nimport bytesToDataURL from './bytesToDataURL';\r\nimport convertToUint8Array from './convertToUint8Array';\r\n\r\nconst JPEG_HEADER_HEX = 'ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00';\r\n\r\nconst JPEG_HEADER = bytesFromHex(JPEG_HEADER_HEX);\r\nconst JPEG_TAIL = bytesFromHex('ffd9');\r\n\r\nexport function getPreviewBytesFromURL(url: string) {\r\n  const needle = 'base64,';\r\n  const sliced = url.slice(url.indexOf(needle) + needle.length);\r\n  const jpegBytes = [...atob(sliced)].map((char) => char.charCodeAt(0));\r\n\r\n  return new Uint8Array(jpegBytes);\r\n  // console.log('getPreviewBytesFromURL', bytesToHex(jpegBytes));\r\n\r\n  // const n = JPEG_HEADER_HEX.slice(-10);\r\n  // const one = jpegBytes[164];\r\n  // const two = jpegBytes[166];\r\n\r\n  // const body = jpegBytes.slice(bytesToHex(jpegBytes).indexOf(n) / 2 + n.length / 2/* JPEG_HEADER.length */, jpegBytes.length - JPEG_TAIL.length);\r\n  // const original = new Uint8Array([\r\n  //   0xFF,\r\n  //   one,\r\n  //   two,\r\n  //   ...body\r\n  // ]);\r\n\r\n  // console.log(bytesToHex(body));\r\n\r\n  // return original;\r\n}\r\n\r\nexport default function getPreviewURLFromBytes(bytes: Uint8Array | number[], isSticker = false) {\r\n  let arr: Uint8Array;\r\n  if(!isSticker && bytes[0] === 0x1) {\r\n    arr = new Uint8Array(JPEG_HEADER.concat(Array.from(bytes.slice(3)), JPEG_TAIL));\r\n    arr[164] = bytes[1];\r\n    arr[166] = bytes[2];\r\n  } else {\r\n    arr = convertToUint8Array(bytes);\r\n  }\r\n\r\n  let mimeType: string;\r\n  if(isSticker) {\r\n    mimeType = IS_SAFARI ? 'image/png' : 'image/webp';\r\n  } else {\r\n    mimeType = 'image/jpeg';\r\n  }\r\n\r\n  const dataURL = bytesToDataURL(arr, mimeType);\r\n  return dataURL;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\r\nimport {PhotoSize} from '../layer';\r\n// import appDownloadManager from \"../lib/appManagers/appDownloadManager\";\r\nimport getPreviewURLFromBytes from './bytes/getPreviewURLFromBytes';\r\n\r\nexport default function getPreviewURLFromThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, isSticker = false) {\r\n  // const cacheContext = appDownloadManager.getCacheContext(photo, thumb.type);\r\n  // return cacheContext.url || (cacheContext.url = getPreviewURLFromBytes(thumb.bytes, isSticker));\r\n  return getPreviewURLFromBytes(thumb.bytes, isSticker);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf} from './schedulers';\r\nimport {ArgumentTypes} from '../types';\r\n\r\ntype HeavyQueue<T extends HeavyQueue<any>> = {\r\n  items: ArgumentTypes<T['process']>[],\r\n  process: (...args: any[]) => ReturnType<T['process']>,\r\n  context: any,\r\n  promise?: CancellablePromise<ReturnType<T['process']>[]>\r\n};\r\nconst heavyQueue: HeavyQueue<any>[] = [];\r\nlet processingQueue = false;\r\n\r\nexport default function addHeavyTask<T extends HeavyQueue<T>>(queue: T, method: 'push' | 'unshift' = 'push') {\r\n  if(!queue.items.length) {\r\n    return Promise.resolve([]) as typeof promise;\r\n  }\r\n\r\n  const promise = queue.promise = deferredPromise();\r\n  heavyQueue[method](queue);\r\n  processHeavyQueue();\r\n\r\n  return promise;\r\n}\r\n\r\nfunction processHeavyQueue() {\r\n  if(!processingQueue) {\r\n    const queue = heavyQueue.shift();\r\n    timedChunk(queue).finally(() => {\r\n      processingQueue = false;\r\n      if(heavyQueue.length) {\r\n        processHeavyQueue();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction timedChunk<T extends HeavyQueue<T>>(queue: HeavyQueue<T>) {\r\n  if(!queue.items.length) {\r\n    queue.promise.resolve([] as any);\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n  const todo = queue.items.slice();\r\n  const results: ReturnType<T['process']>[] = [];\r\n\r\n  return new Promise<typeof results>((resolve, reject) => {\r\n    const f = async() => {\r\n      const start = performance.now();\r\n\r\n      do {\r\n        await getHeavyAnimationPromise();\r\n        const possiblePromise = queue.process.apply(queue.context, todo.shift());\r\n        let realResult: typeof results[0];\r\n        // @ts-ignore\r\n        if(possiblePromise instanceof Promise) {\r\n          try {\r\n            realResult = await possiblePromise;\r\n          } catch(err) {\r\n            reject(err);\r\n            return;\r\n          }\r\n        } else {\r\n          realResult = possiblePromise;\r\n        }\r\n\r\n        results.push(realResult);\r\n      } while(todo.length > 0 && (performance.now() - start) < 6);\r\n\r\n      if(todo.length > 0) {\r\n        fastRaf(f);\r\n        // setTimeout(f, 25);\r\n      } else {\r\n        resolve(results);\r\n      }\r\n    };\r\n\r\n    fastRaf(f);\r\n    // setTimeout(f, 25);\r\n  }).then(queue.promise.resolve.bind(queue.promise), queue.promise.reject.bind(queue.promise));\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type fastBlur from '../vendor/fastBlur';\r\nimport addHeavyTask from './heavyQueue';\r\nimport IS_CANVAS_FILTER_SUPPORTED from '../environment/canvasFilterSupport';\r\n\r\nconst RADIUS = 2;\r\nconst ITERATIONS = 2;\r\n\r\nlet requireBlurPromise: Promise<any>;\r\nlet fastBlurFunc: typeof fastBlur;\r\nif(!IS_CANVAS_FILTER_SUPPORTED) {\r\n  requireBlurPromise = import('../vendor/fastBlur').then((m) => {\r\n    fastBlurFunc = m.default;\r\n  });\r\n} else {\r\n  requireBlurPromise = Promise.resolve();\r\n}\r\n\r\nfunction processBlurNext(\r\n  img: HTMLImageElement,\r\n  radius: number,\r\n  iterations: number,\r\n  canvas: HTMLCanvasElement = document.createElement('canvas')\r\n) {\r\n  canvas.width = img.width;\r\n  canvas.height = img.height;\r\n\r\n  const ctx = canvas.getContext('2d', {alpha: false});\r\n  if(IS_CANVAS_FILTER_SUPPORTED) {\r\n    ctx.filter = `blur(${radius}px)`;\r\n    ctx.drawImage(img, -radius * 2, -radius * 2, canvas.width + radius * 4, canvas.height + radius * 4);\r\n  } else {\r\n    ctx.drawImage(img, 0, 0);\r\n    fastBlurFunc(ctx, 0, 0, canvas.width, canvas.height, radius, iterations);\r\n  }\r\n\r\n  return canvas;\r\n}\r\n\r\ntype CacheValue = {canvas: HTMLCanvasElement, promise: Promise<void>};\r\nconst cache: Map<string, CacheValue> = new Map();\r\nconst CACHE_SIZE = 150;\r\n\r\nexport default function blur(dataUri: string, radius: number = RADIUS, iterations: number = ITERATIONS) {\r\n  if(!dataUri) {\r\n    throw 'no dataUri for blur: ' + dataUri;\r\n  }\r\n\r\n  if(cache.size > CACHE_SIZE) {\r\n    cache.clear();\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n  canvas.className = 'canvas-thumbnail';\r\n\r\n  let cached = cache.get(dataUri);\r\n  if(!cached) {\r\n    const promise: CacheValue['promise'] = new Promise((resolve) => {\r\n      // return resolve(dataUri);\r\n      requireBlurPromise.then(() => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // if(IS_CANVAS_FILTER_SUPPORTED) {\r\n          // resolve(processBlurNext(img, radius, iterations));\r\n          // } else {\r\n          const promise = addHeavyTask({\r\n            items: [[img, radius, iterations, canvas]],\r\n            context: null,\r\n            process: processBlurNext\r\n          }, 'unshift');\r\n\r\n          promise.then(() => {\r\n            resolve();\r\n          });\r\n          // }\r\n        };\r\n        img.src = dataUri;\r\n      });\r\n    });\r\n\r\n    cache.set(dataUri, cached = {\r\n      canvas,\r\n      promise\r\n    });\r\n  } else {\r\n    canvas.width = cached.canvas.width;\r\n    canvas.height = cached.canvas.height;\r\n    cached.promise.then(() => {\r\n      canvas.getContext('2d').drawImage(cached.canvas, 0, 0, canvas.width, canvas.height);\r\n    });\r\n  }\r\n\r\n  return {\r\n    ...cached,\r\n    canvas\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {PhotoSize} from '../layer';\r\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\r\nimport {renderImageFromUrlPromise} from './dom/renderImageFromUrl';\r\nimport getPreviewURLFromThumb from './getPreviewURLFromThumb';\r\nimport blur from './blur';\r\n\r\nexport default function getImageFromStrippedThumb(\r\n  photo: MyPhoto | MyDocument,\r\n  thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize,\r\n  useBlur: boolean | number,\r\n  url = getPreviewURLFromThumb(photo, thumb, false)\r\n) {\r\n  let element: HTMLImageElement | HTMLCanvasElement, loadPromise: Promise<void>;\r\n  if(!useBlur) {\r\n    element = new Image();\r\n    loadPromise = renderImageFromUrlPromise(element, url);\r\n  } else {\r\n    const result = blur(url, typeof(useBlur) === 'number' ? useBlur : undefined);\r\n    element = result.canvas;\r\n    loadPromise = result.promise;\r\n  }\r\n\r\n  element.classList.add('thumbnail');\r\n\r\n  return {image: element, loadPromise};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {makeMediaSize} from './mediaSize';\r\n\r\nexport default function calcImageInBox(imageW: number, imageH: number, boxW: number, boxH: number, noZoom = true) {\r\n  if(imageW < boxW && imageH < boxH && noZoom) {\r\n    return makeMediaSize(imageW, imageH);\r\n  }\r\n\r\n  let boxedImageW = boxW;\r\n  let boxedImageH = boxH;\r\n\r\n  if((imageW / imageH) > (boxW / boxH)) {\r\n    boxedImageH = (imageH * boxW / imageW) | 0;\r\n  } else {\r\n    boxedImageW = (imageW * boxH / imageH) | 0;\r\n    if(boxedImageW > boxW) {\r\n      boxedImageH = (boxedImageH * boxW / boxedImageW) | 0;\r\n      boxedImageW = boxW;\r\n    }\r\n  }\r\n\r\n  if(noZoom && boxedImageW >= imageW && boxedImageH >= imageH) {\r\n    boxedImageW = imageW;\r\n    boxedImageH = imageH;\r\n  }\r\n\r\n  return makeMediaSize(boxedImageW, boxedImageH);\r\n}\r\n\r\nMOUNT_CLASS_TO.calcImageInBox = calcImageInBox;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport calcImageInBox from './calcImageInBox';\r\n\r\nexport class MediaSize {\r\n  constructor(public width = 0, public height = width) {\r\n\r\n  }\r\n\r\n  public aspect(boxSize: MediaSize, fitted: boolean) {\r\n    return calcImageInBox(this.width, this.height, boxSize.width, boxSize.height, fitted);\r\n  }\r\n\r\n  public aspectFitted(boxSize: MediaSize) {\r\n    return this.aspect(boxSize, true);\r\n  }\r\n\r\n  public aspectCovered(boxSize: MediaSize) {\r\n    return this.aspect(boxSize, false);\r\n  }\r\n}\r\n\r\nexport function makeMediaSize(width?: number, height?: number): MediaSize {\r\n  return new MediaSize(width, height);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport {makeMediaSize, MediaSize} from './mediaSize';\r\n\r\ntype MediaTypeSizes = {\r\n  regular: MediaSize,\r\n  webpage: MediaSize,\r\n  album: MediaSize,\r\n  esgSticker: MediaSize,\r\n  animatedSticker: MediaSize,\r\n  staticSticker: MediaSize,\r\n  emojiSticker: MediaSize,\r\n  poll: MediaSize,\r\n  round: MediaSize,\r\n  documentName: MediaSize,\r\n  invoice: MediaSize,\r\n  extendedInvoice: MediaSize,\r\n  customEmoji: MediaSize,\r\n  esgCustomEmoji: MediaSize,\r\n  emojiStatus: MediaSize,\r\n  popupSticker: MediaSize\r\n};\r\n\r\nexport type MediaSizeType = keyof MediaTypeSizes;\r\n\r\nexport enum ScreenSize {\r\n  mobile,\r\n  medium,\r\n  large\r\n}\r\n\r\nconst MOBILE_SIZE = 600;\r\nconst FLOATING_LEFT_SIDEBAR_SIZE = 925;\r\nconst MEDIUM_SIZE = 1275;\r\nconst LARGE_SIZE = 1680;\r\n\r\nconst CUSTOM_EMOJI_SIZE = makeMediaSize(20, 20);\r\nconst ESG_CUSTOM_EMOJI_SIZE = makeMediaSize(36, 36);\r\nconst EMOJI_STATUS_SIZE = makeMediaSize(18, 18);\r\n\r\nclass MediaSizes extends EventListenerBase<{\r\n  changeScreen: (from: ScreenSize, to: ScreenSize) => void,\r\n  resize: () => void\r\n}> {\r\n  private screenSizes: {key: ScreenSize, value: number}[] = [\r\n    {key: ScreenSize.mobile, value: MOBILE_SIZE},\r\n    {key: ScreenSize.medium, value: MEDIUM_SIZE},\r\n    {key: ScreenSize.large, value: LARGE_SIZE}\r\n  ];\r\n\r\n  private sizes: {[k in 'desktop' | 'handhelds']: MediaTypeSizes} = {\r\n    handhelds: {\r\n      regular: makeMediaSize(340, 340),\r\n      webpage: makeMediaSize(340, 200),\r\n      album: makeMediaSize(340, 0),\r\n      esgSticker: makeMediaSize(68, 68),\r\n      animatedSticker: makeMediaSize(180, 180),\r\n      staticSticker: makeMediaSize(180, 180),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(240, 0),\r\n      round: makeMediaSize(240, 240),\r\n      documentName: makeMediaSize(200, 0),\r\n      invoice: makeMediaSize(340, 340),\r\n      extendedInvoice: makeMediaSize(340, 340),\r\n      customEmoji: CUSTOM_EMOJI_SIZE,\r\n      esgCustomEmoji: ESG_CUSTOM_EMOJI_SIZE,\r\n      emojiStatus: EMOJI_STATUS_SIZE,\r\n      popupSticker: makeMediaSize(68, 68)\r\n    },\r\n    desktop: {\r\n      regular: makeMediaSize(420, 400),\r\n      webpage: makeMediaSize(420, 380),\r\n      album: makeMediaSize(420, 0),\r\n      esgSticker: makeMediaSize(72, 72),\r\n      animatedSticker: makeMediaSize(200, 200),\r\n      staticSticker: makeMediaSize(200, 200),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(330, 0),\r\n      round: makeMediaSize(280, 280),\r\n      documentName: makeMediaSize(240, 0),\r\n      invoice: makeMediaSize(320, 320),\r\n      extendedInvoice: makeMediaSize(420, 400),\r\n      customEmoji: CUSTOM_EMOJI_SIZE,\r\n      esgCustomEmoji: ESG_CUSTOM_EMOJI_SIZE,\r\n      emojiStatus: EMOJI_STATUS_SIZE,\r\n      popupSticker: makeMediaSize(80, 80)\r\n    }\r\n  };\r\n\r\n  public isMobile = false;\r\n  public isFloatingLeftSidebar = false;\r\n  public isLessThanFloatingLeftSidebar = false;\r\n  public active: MediaTypeSizes;\r\n  public activeScreen: ScreenSize;\r\n  private rAF: number;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener('resize', () => {\r\n      if(this.rAF) window.cancelAnimationFrame(this.rAF);\r\n      this.rAF = window.requestAnimationFrame(() => {\r\n        this.handleResize();\r\n        this.rAF = 0;\r\n      });\r\n    });\r\n    this.handleResize();\r\n  }\r\n\r\n  private handleResize = () => {\r\n    const innerWidth = window.innerWidth;\r\n    // this.isMobile = innerWidth <= 720;\r\n\r\n    let activeScreen = this.screenSizes[0].key;\r\n    for(let i = this.screenSizes.length - 1; i >= 0; --i) {\r\n      if(this.screenSizes[i].value < innerWidth) {\r\n        activeScreen = (this.screenSizes[i + 1] || this.screenSizes[i]).key;\r\n        break;\r\n      }\r\n    }\r\n\r\n    const wasScreen = this.activeScreen;\r\n    this.activeScreen = activeScreen;\r\n    this.isMobile = this.activeScreen === ScreenSize.mobile;\r\n    this.isLessThanFloatingLeftSidebar = innerWidth <= FLOATING_LEFT_SIDEBAR_SIZE;\r\n    this.isFloatingLeftSidebar = this.activeScreen === ScreenSize.medium && this.isLessThanFloatingLeftSidebar;\r\n    this.active = this.isMobile ? this.sizes.handhelds : this.sizes.desktop;\r\n\r\n    // console.time('esg');\r\n    // const computedStyle = window.getComputedStyle(document.documentElement);\r\n    // this.active.esgSticker.width = parseFloat(computedStyle.getPropertyValue('--esg-sticker-size'));\r\n    // console.timeEnd('esg');\r\n\r\n    if(wasScreen !== activeScreen) {\r\n      // console.log('changeScreen', this.activeScreen, activeScreen);\r\n\r\n      if(wasScreen !== undefined) {\r\n        this.dispatchEvent('changeScreen', wasScreen, activeScreen);\r\n      }\r\n    }\r\n\r\n    if(wasScreen !== undefined) {\r\n      this.dispatchEvent('resize');\r\n    }\r\n\r\n    /* if(this.isMobile) {\r\n      for(let i in this.active) {\r\n        // @ts-ignore\r\n        let size = this.active[i];\r\n        size.width = innerWidth\r\n      }\r\n    } */\r\n  };\r\n}\r\n\r\nconst mediaSizes = new MediaSizes();\r\nMOUNT_CLASS_TO.mediaSizes = mediaSizes;\r\nexport default mediaSizes;\r\n","export default function clamp(v: number, min: number, max: number): number {\r\n  return Math.min(max, Math.max(min, v));\r\n}\r\n","const IS_IMAGE_BITMAP_SUPPORTED = typeof(ImageBitmap) !== 'undefined';\r\n\r\nexport default IS_IMAGE_BITMAP_SUPPORTED;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {RLottieColor} from '../lib/rlottie/rlottiePlayer';\r\n\r\nexport type FramesCacheMap = Map<number, Uint8ClampedArray>;\r\nexport type FramesCacheMapNew = Map<number, HTMLCanvasElement | ImageBitmap>;\r\nexport type FramesCacheMapURLs = Map<number, string>;\r\nexport type FramesCacheItem = {\r\n  frames: FramesCacheMap,\r\n  framesNew: FramesCacheMapNew,\r\n  framesURLs: FramesCacheMapURLs,\r\n  clearCache: () => void,\r\n  counter: number\r\n};\r\n\r\nexport class FramesCache {\r\n  private cache: Map<string, FramesCacheItem>;\r\n\r\n  constructor() {\r\n    this.cache = new Map();\r\n  }\r\n\r\n  public static createCache(): FramesCacheItem {\r\n    const cache: FramesCacheItem = {\r\n      frames: new Map(),\r\n      framesNew: new Map(),\r\n      framesURLs: new Map(),\r\n      clearCache: () => {\r\n        cache.framesNew.forEach((value) => {\r\n          (value as ImageBitmap).close?.();\r\n        });\r\n\r\n        cache.frames.clear();\r\n        cache.framesNew.clear();\r\n        cache.framesURLs.clear();\r\n      },\r\n      counter: 0\r\n    };\r\n\r\n    return cache;\r\n  }\r\n\r\n  public getCache(name: string) {\r\n    let cache = this.cache.get(name);\r\n    if(!cache) {\r\n      this.cache.set(name, cache = FramesCache.createCache());\r\n    } else {\r\n      // console.warn('[RLottieCache] cache will be reused', cache);\r\n    }\r\n\r\n    ++cache.counter;\r\n    return cache;\r\n  }\r\n\r\n  public releaseCache(name: string) {\r\n    const cache = this.cache.get(name);\r\n    if(cache && !--cache.counter) {\r\n      this.cache.delete(name);\r\n      // console.warn('[RLottieCache] released cache', cache);\r\n    }\r\n  }\r\n\r\n  public getCacheCounter(name: string) {\r\n    const cache = this.cache.get(name);\r\n    return cache?.counter;\r\n  }\r\n\r\n  public generateName(name: string, width: number, height: number, color: RLottieColor, toneIndex: number) {\r\n    return [\r\n      name,\r\n      width,\r\n      height,\r\n      // color ? rgbaToHexa(color) : ''\r\n      // color ? 'colored' : '',\r\n      toneIndex || ''\r\n    ].filter(Boolean).join('-');\r\n  }\r\n}\r\n\r\nconst framesCache = new FramesCache();\r\n\r\nexport default framesCache;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport rootScope from '../../lib/rootScope';\r\nimport mediaSizes from '../mediaSizes';\r\n\r\nexport type CustomProperty = string;\r\n\r\nexport class CustomProperties {\r\n  private cache: {[k in CustomProperty]?: [string, string]};\r\n  private computedStyle: CSSStyleDeclaration;\r\n  private nightComputedStyle: CSSStyleDeclaration;\r\n  private nightElement: HTMLElement;\r\n\r\n  constructor() {\r\n    this.cache = {};\r\n\r\n    this.nightElement = document.createElement('div');\r\n    this.nightElement.className = 'night';\r\n    this.nightElement.style.display = 'none';\r\n    document.body.append(this.nightElement);\r\n\r\n    rootScope.addEventListener('theme_changed', this.resetCache);\r\n    mediaSizes.addEventListener('resize', this.resetCache);\r\n  }\r\n\r\n  protected resetCache = () => {\r\n    this.computedStyle = undefined;\r\n    const cache = this.cache;\r\n    this.cache = {};\r\n\r\n    for(const i in cache) {\r\n      this.getProperty(i as CustomProperty);\r\n    }\r\n  };\r\n\r\n  public getProperty(name: CustomProperty, night?: boolean) {\r\n    const values = this.cache[name];\r\n    const index = night ? 1 : 0;\r\n    if(values?.[index]) {\r\n      return values[index];\r\n    }\r\n\r\n    this.computedStyle ??= window.getComputedStyle(document.documentElement);\r\n    this.nightComputedStyle ??= window.getComputedStyle(this.nightElement);\r\n\r\n    const value = (night ? this.nightComputedStyle : this.computedStyle).getPropertyValue('--' + name).trim();\r\n    return this.setPropertyCache(name, value, night);\r\n  }\r\n\r\n  public getPropertyAsColor(name: CustomProperty) {\r\n    const value = this.getProperty(name);\r\n    if(value[0] === '#') {\r\n      return value;\r\n    }\r\n\r\n    return `rgb(${value})`;\r\n  }\r\n\r\n  public getPropertyAsSize(name: CustomProperty) {\r\n    const value = this.getProperty(name);\r\n    let size: number;\r\n\r\n    if(value[value.length - 1] === '%') {\r\n\r\n    } else if(value.indexOf('rem')) {\r\n      size = +value.replace('rem', '') * 16;\r\n    } else {\r\n      size = +value.replace('px', '');\r\n    }\r\n\r\n    return size;\r\n  }\r\n\r\n  public setPropertyCache(name: CustomProperty, value: string, night?: boolean) {\r\n    return (this.cache[name] ??= [] as any)[night ? 1 : 0] = value;\r\n  }\r\n}\r\n\r\nconst customProperties = new CustomProperties();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.customProperties = customProperties);\r\nexport default customProperties;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AnimationItemGroup, AnimationItemWrapper} from '../../components/animationIntersector';\r\nimport type {Middleware} from '../../helpers/middleware';\r\nimport type {LiteModeKey} from '../../helpers/liteMode';\r\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\r\nimport IS_APPLE_MX from '../../environment/appleMx';\r\nimport {IS_ANDROID, IS_APPLE_MOBILE, IS_APPLE, IS_SAFARI} from '../../environment/userAgent';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport clamp from '../../helpers/number/clamp';\r\nimport QueryableWorker from './queryableWorker';\r\nimport IS_IMAGE_BITMAP_SUPPORTED from '../../environment/imageBitmapSupport';\r\nimport framesCache, {FramesCache, FramesCacheItem} from '../../helpers/framesCache';\r\nimport customProperties from '../../helpers/dom/customProperties';\r\n\r\nexport type RLottieOptions = {\r\n  container: HTMLElement | HTMLElement[],\r\n  middleware?: Middleware,\r\n  canvas?: HTMLCanvasElement,\r\n  autoplay?: boolean,\r\n  animationData: Blob,\r\n  loop?: RLottiePlayer['loop'],\r\n  width?: number,\r\n  height?: number,\r\n  group?: AnimationItemGroup,\r\n  noCache?: boolean,\r\n  needUpscale?: boolean,\r\n  skipRatio?: number,\r\n  initFrame?: number, // index\r\n  color?: RLottieColor,\r\n  textColor?: WrapSomethingOptions['textColor'],\r\n  name?: string,\r\n  skipFirstFrameRendering?: boolean,\r\n  toneIndex?: number,\r\n  sync?: boolean,\r\n  liteModeKey?: LiteModeKey\r\n};\r\n\r\nexport type RLottieColor = [number, number, number];\r\n\r\nexport function getLottiePixelRatio(width: number, height: number, needUpscale?: boolean) {\r\n  let pixelRatio = clamp(window.devicePixelRatio, 1, 2);\r\n  if(pixelRatio > 1 && !needUpscale) {\r\n    if(width > 90 && height > 90) {\r\n      if(!IS_APPLE && mediaSizes.isMobile) {\r\n        pixelRatio = 1;\r\n      }\r\n    } else if((width > 60 && height > 60) || IS_ANDROID) {\r\n      pixelRatio = Math.max(1.5, pixelRatio - 1.5);\r\n    }\r\n  }\r\n\r\n  return pixelRatio;\r\n}\r\n\r\nexport function applyColorOnContext(\r\n  context: CanvasRenderingContext2D,\r\n  color: RLottieColor | string,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number\r\n) {\r\n  context.globalCompositeOperation = 'source-atop';\r\n  context.fillStyle = typeof(color) === 'string' ? color : `rgb(${color[0]}, ${color[1]}, ${color[2]})`;\r\n  context.fillRect(x, y, width, height);\r\n  context.globalCompositeOperation = 'source-over';\r\n}\r\n\r\nexport default class RLottiePlayer extends EventListenerBase<{\r\n  enterFrame: (frameNo: number) => void,\r\n  ready: () => void,\r\n  firstFrame: () => void,\r\n  cached: () => void,\r\n  destroy: () => void\r\n}> implements AnimationItemWrapper {\r\n  public static CACHE = framesCache;\r\n  private static reqId = 0;\r\n\r\n  public reqId = 0;\r\n  public curFrame: number;\r\n  private frameCount: number;\r\n  private fps: number;\r\n  private skipDelta: number;\r\n  public name: string;\r\n  public cacheName: string;\r\n  private toneIndex: number;\r\n\r\n  private worker: QueryableWorker;\r\n\r\n  private width = 0;\r\n  private height = 0;\r\n\r\n  public el: HTMLElement[];\r\n  public canvas: HTMLCanvasElement[];\r\n  public contexts: CanvasRenderingContext2D[];\r\n\r\n  public paused = true;\r\n  // public paused = false;\r\n  public direction = 1;\r\n  private speed = 1;\r\n  public autoplay = true;\r\n  public _autoplay: boolean; // ! will be used to store original value for settings.stickers.loop\r\n  public loop: number | boolean = true;\r\n  public _loop: RLottiePlayer['loop']; // ! will be used to store original value for settings.stickers.loop\r\n  public group: AnimationItemGroup = '';\r\n  public liteModeKey: LiteModeKey;\r\n\r\n  private frInterval: number;\r\n  private frThen: number;\r\n  private rafId: number;\r\n\r\n  // private caching = false;\r\n  // private removed = false;\r\n\r\n  private cache: FramesCacheItem;\r\n  private imageData: ImageData;\r\n  public clamped: Uint8ClampedArray;\r\n  private cachingDelta = 0;\r\n\r\n  private initFrame: number;\r\n  private color: RLottieOptions['color'];\r\n  private textColor: RLottieOptions['textColor'];\r\n\r\n  public minFrame: number;\r\n  public maxFrame: number;\r\n\r\n  private playedTimes = 0;\r\n\r\n  private currentMethod: RLottiePlayer['mainLoopForwards'] | RLottiePlayer['mainLoopBackwards'];\r\n  private frameListener: (currentFrame: number) => void;\r\n  private skipFirstFrameRendering: boolean;\r\n  private playToFrameOnFrameCallback: (frameNo: number) => void;\r\n\r\n  public overrideRender: (frame: ImageData | HTMLCanvasElement | ImageBitmap) => void;\r\n  private renderedFirstFrame: boolean;\r\n\r\n  private raw: boolean;\r\n\r\n  constructor({el, worker, options}: {\r\n    el: RLottiePlayer['el'],\r\n    worker: QueryableWorker,\r\n    options: RLottieOptions\r\n  }) {\r\n    super(true);\r\n\r\n    this.reqId = ++RLottiePlayer['reqId'];\r\n    this.el = el;\r\n    this.worker = worker;\r\n\r\n    for(const i in options) {\r\n      if(this.hasOwnProperty(i)) {\r\n        // @ts-ignore\r\n        this[i] = options[i];\r\n      }\r\n    }\r\n\r\n    this._loop = this.loop;\r\n    this._autoplay = this.autoplay;\r\n\r\n    // ! :(\r\n    this.initFrame = options.initFrame;\r\n    this.color = options.color;\r\n    this.textColor = options.textColor;\r\n    this.name = options.name;\r\n    this.skipFirstFrameRendering = options.skipFirstFrameRendering;\r\n    this.toneIndex = options.toneIndex;\r\n    this.raw = false;\r\n    this.liteModeKey = options.liteModeKey;\r\n\r\n    if(this.name) {\r\n      this.cacheName = RLottiePlayer.CACHE.generateName(\r\n        this.name,\r\n        this.width,\r\n        this.height,\r\n        this.color,\r\n        this.toneIndex\r\n      );\r\n    }\r\n\r\n    // * Skip ratio (30fps)\r\n    let skipRatio: number;\r\n    if(options.skipRatio !== undefined) skipRatio = options.skipRatio;\r\n    else if((IS_ANDROID || IS_APPLE_MOBILE || (IS_APPLE && !IS_SAFARI && !IS_APPLE_MX)) && this.width < 100 && this.height < 100 && !options.needUpscale) {\r\n      skipRatio = 0.5;\r\n    }\r\n\r\n    this.skipDelta = skipRatio !== undefined ? 1 / skipRatio | 0 : 1;\r\n\r\n    // options.needUpscale = true;\r\n\r\n    // * Pixel ratio\r\n    const pixelRatio = getLottiePixelRatio(this.width, this.height, options.needUpscale);\r\n\r\n    this.width = Math.round(this.width * pixelRatio);\r\n    this.height = Math.round(this.height * pixelRatio);\r\n\r\n    // options.noCache = true;\r\n\r\n    // * Cache frames params\r\n    if(!options.noCache/*  && false */) {\r\n      // проверка на размер уже после скейлинга, сделано для попапа и сайдбара, где стикеры 80х80 и 68х68, туда нужно 75%\r\n      if(IS_APPLE && this.width > 100 && this.height > 100) {\r\n        this.cachingDelta = 2; // 2 // 50%\r\n      } else if(this.width < 100 && this.height < 100) {\r\n        this.cachingDelta = Infinity; // 100%\r\n      } else {\r\n        this.cachingDelta = 4; // 75%\r\n      }\r\n    }\r\n\r\n    // this.cachingDelta = Infinity;\r\n    // this.cachingDelta = 0;\r\n    // if(isApple) {\r\n    //   this.cachingDelta = 0; //2 // 50%\r\n    // }\r\n\r\n    if(!this.canvas) {\r\n      this.canvas = this.el.map(() => {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.classList.add('rlottie');\r\n        canvas.width = this.width;\r\n        canvas.height = this.height;\r\n        canvas.dpr = pixelRatio;\r\n        return canvas;\r\n      });\r\n    }\r\n\r\n    this.contexts = this.canvas.map((canvas) => canvas.getContext('2d'));\r\n\r\n    if(!IS_IMAGE_BITMAP_SUPPORTED || this.raw) {\r\n      this.imageData = new ImageData(this.width, this.height);\r\n\r\n      if(CAN_USE_TRANSFERABLES) {\r\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\r\n      }\r\n    }\r\n\r\n    if(this.name) {\r\n      this.cache = RLottiePlayer.CACHE.getCache(this.cacheName);\r\n    } else {\r\n      this.cache = FramesCache.createCache();\r\n    }\r\n  }\r\n\r\n  public setSize(width: number, height: number) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.canvas.forEach((canvas) => {\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n    });\r\n  }\r\n\r\n  public clearCache() {\r\n    if(this.cachingDelta === Infinity) {\r\n      return;\r\n    }\r\n\r\n    if(this.cacheName && this.cache.counter > 1) { // skip clearing because same sticker can be still visible\r\n      return;\r\n    }\r\n\r\n    this.cache.clearCache();\r\n  }\r\n\r\n  public sendQuery(args: any[], transfer?: Transferable[]) {\r\n    this.worker.sendQuery([args.shift(), this.reqId, ...args], transfer);\r\n  }\r\n\r\n  public loadFromData(data: RLottieOptions['animationData']) {\r\n    this.sendQuery([\r\n      'loadFromData',\r\n      data,\r\n      this.width,\r\n      this.height,\r\n      this.toneIndex,\r\n      this.raw\r\n      /* , this.canvas.transferControlToOffscreen() */\r\n    ]);\r\n  }\r\n\r\n  public play() {\r\n    if(!this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = false;\r\n    this.setMainLoop();\r\n  }\r\n\r\n  public pause(clearPendingRAF = true) {\r\n    if(this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = true;\r\n    if(clearPendingRAF) {\r\n      clearTimeout(this.rafId);\r\n      this.rafId = undefined;\r\n    }\r\n    // window.cancelAnimationFrame(this.rafId);\r\n  }\r\n\r\n  private resetCurrentFrame() {\r\n    return this.curFrame = this.initFrame ?? (this.direction === 1 ? this.minFrame : this.maxFrame);\r\n  }\r\n\r\n  public stop(renderFirstFrame = true) {\r\n    this.pause();\r\n\r\n    const curFrame = this.resetCurrentFrame();\r\n    if(renderFirstFrame) {\r\n      this.requestFrame(curFrame);\r\n      // this.sendQuery('renderFrame', this.curFrame);\r\n    }\r\n  }\r\n\r\n  public restart() {\r\n    this.stop(false);\r\n    this.play();\r\n  }\r\n\r\n  public playOrRestart() {\r\n    if(!this.paused) {\r\n      return;\r\n    }\r\n\r\n    if(this.curFrame === this.maxFrame) {\r\n      this.restart();\r\n    } else {\r\n      this.play();\r\n    }\r\n  }\r\n\r\n  public setSpeed(speed: number) {\r\n    if(this.speed === speed) {\r\n      return;\r\n    }\r\n\r\n    this.speed = speed;\r\n\r\n    if(!this.paused) {\r\n      this.setMainLoop();\r\n    }\r\n  }\r\n\r\n  public setDirection(direction: number) {\r\n    if(this.direction === direction) {\r\n      return;\r\n    }\r\n\r\n    this.direction = direction;\r\n\r\n    if(!this.paused) {\r\n      this.setMainLoop();\r\n    }\r\n  }\r\n\r\n  public remove() {\r\n    this.pause();\r\n    this.sendQuery(['destroy']);\r\n    if(this.cacheName) RLottiePlayer.CACHE.releaseCache(this.cacheName);\r\n    this.dispatchEvent('destroy');\r\n    this.cleanup();\r\n  }\r\n\r\n  public applyColor(context: CanvasRenderingContext2D) {\r\n    applyColorOnContext(\r\n      context,\r\n      // this.color || customProperties.getPropertyAsColor(typeof(this.textColor) === 'function' ? this.textColor() : this.textColor),\r\n      this.color || customProperties.getPropertyAsColor(this.textColor),\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    );\r\n  }\r\n\r\n  public applyColorForAllContexts() {\r\n    if(!this.color && !this.textColor) {\r\n      return;\r\n    }\r\n\r\n    this.contexts.forEach((context) => {\r\n      this.applyColor(context);\r\n    });\r\n  }\r\n\r\n  public renderFrame2(frame: Uint8ClampedArray | HTMLCanvasElement | ImageBitmap, frameNo: number) {\r\n    /* this.setListenerResult('enterFrame', frameNo);\r\n    return; */\r\n\r\n    try {\r\n      if(frame instanceof Uint8ClampedArray) {\r\n        this.imageData.data.set(frame);\r\n      }\r\n\r\n      // this.context.putImageData(new ImageData(frame, this.width, this.height), 0, 0);\r\n      this.contexts.forEach((context, idx) => {\r\n        let cachedSource: HTMLCanvasElement | ImageBitmap = this.cache.framesNew.get(frameNo);\r\n        if(!(frame instanceof Uint8ClampedArray)) {\r\n          cachedSource = frame;\r\n        } else if(idx > 0) {\r\n          cachedSource = this.canvas[0];\r\n        }\r\n\r\n        if(!cachedSource) {\r\n          const c = document.createElement('canvas');\r\n          c.width = context.canvas.width;\r\n          c.height = context.canvas.height;\r\n          c.getContext('2d').putImageData(this.imageData, 0, 0);\r\n          this.cache.framesNew.set(frameNo, c);\r\n          cachedSource = c;\r\n        }\r\n\r\n        if(this.overrideRender && this.renderedFirstFrame) {\r\n          this.overrideRender(cachedSource || this.imageData);\r\n        } else if(cachedSource) {\r\n          context.clearRect(0, 0, cachedSource.width, cachedSource.height);\r\n          context.drawImage(cachedSource, 0, 0);\r\n        } else {\r\n          context.putImageData(this.imageData, 0, 0);\r\n        }\r\n\r\n        if(this.color || this.textColor) {\r\n          this.applyColor(context);\r\n        }\r\n\r\n        if(!this.renderedFirstFrame) {\r\n          this.renderedFirstFrame = true;\r\n        }\r\n      });\r\n\r\n      this.dispatchEvent('enterFrame', frameNo);\r\n    } catch(err) {\r\n      console.error('RLottiePlayer renderFrame error:', err/* , frame */, this.width, this.height);\r\n      this.autoplay = false;\r\n      this.pause();\r\n    }\r\n  }\r\n\r\n  public renderFrame(frame: Parameters<RLottiePlayer['renderFrame2']>[0], frameNo: number) {\r\n    const canCacheFrame = this.cachingDelta && (frameNo % this.cachingDelta || !frameNo);\r\n    if(canCacheFrame) {\r\n      if(frame instanceof Uint8ClampedArray && !this.cache.frames.has(frameNo)) {\r\n        this.cache.frames.set(frameNo, new Uint8ClampedArray(frame));// frame;\r\n      } else if(IS_IMAGE_BITMAP_SUPPORTED && frame instanceof ImageBitmap && !this.cache.framesNew.has(frameNo)) {\r\n        this.cache.framesNew.set(frameNo, frame);\r\n      }\r\n    }\r\n\r\n    /* if(!this.listenerResults.hasOwnProperty('cached')) {\r\n      this.setListenerResult('enterFrame', frameNo);\r\n      if(frameNo === (this.frameCount - 1)) {\r\n        this.setListenerResult('cached');\r\n      }\r\n\r\n      return;\r\n    } */\r\n\r\n    if(this.frInterval) {\r\n      const now = Date.now(), delta = now - this.frThen;\r\n\r\n      if(delta < 0) {\r\n        const timeout = this.frInterval > -delta ? -delta % this.frInterval : this.frInterval;\r\n        if(this.rafId) clearTimeout(this.rafId);\r\n        this.rafId = window.setTimeout(() => {\r\n          this.renderFrame2(frame, frameNo);\r\n        }, timeout);\r\n        // await new Promise((resolve) => setTimeout(resolve, -delta % this.frInterval));\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.renderFrame2(frame, frameNo);\r\n  }\r\n\r\n  public requestFrame(frameNo: number) {\r\n    const frame = this.cache.frames.get(frameNo);\r\n    const frameNew = this.cache.framesNew.get(frameNo);\r\n    if(frameNew) {\r\n      this.renderFrame(frameNew, frameNo);\r\n    } else if(frame) {\r\n      this.renderFrame(frame, frameNo);\r\n    } else {\r\n      if(this.clamped && !this.clamped.length) { // fix detached\r\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\r\n      }\r\n\r\n      this.sendQuery(['renderFrame', frameNo], this.clamped ? [this.clamped.buffer] : undefined);\r\n    }\r\n  }\r\n\r\n  private onLap() {\r\n    ++this.playedTimes;\r\n    if(typeof(this.loop) === 'number' && this.playedTimes >= this.loop) {\r\n      this.loop =\r\n        this.autoplay =\r\n        this._loop =\r\n        this._autoplay =\r\n        false;\r\n    }\r\n\r\n    if(!this.loop) {\r\n      this.clearCache();\r\n      this.pause(false);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private mainLoopForwards() {\r\n    const {skipDelta, maxFrame} = this;\r\n    const frame = (this.curFrame + skipDelta) > maxFrame ? this.curFrame = (this.loop ? this.minFrame : this.maxFrame) : this.curFrame += skipDelta;\r\n    // console.log('mainLoopForwards', this.curFrame, skipDelta, frame);\r\n\r\n    this.requestFrame(frame);\r\n    if((frame + skipDelta) > maxFrame) {\r\n      return this.onLap();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private mainLoopBackwards() {\r\n    const {skipDelta, minFrame} = this;\r\n    const frame = (this.curFrame - skipDelta) < minFrame ? this.curFrame = (this.loop ? this.maxFrame : this.minFrame) : this.curFrame -= skipDelta;\r\n    // console.log('mainLoopBackwards', this.curFrame, skipDelta, frame);\r\n\r\n    this.requestFrame(frame);\r\n    if((frame - skipDelta) < minFrame) {\r\n      return this.onLap();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public setMainLoop() {\r\n    // window.cancelAnimationFrame(this.rafId);\r\n    clearTimeout(this.rafId);\r\n    this.rafId = undefined;\r\n\r\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\r\n    this.frThen = Date.now() - this.frInterval;\r\n\r\n    // console.trace('setMainLoop', this.frInterval, this.direction, this, JSON.stringify(this.listenerResults), this.listenerResults);\r\n\r\n    const method = (this.direction === 1 ? this.mainLoopForwards : this.mainLoopBackwards).bind(this);\r\n    this.currentMethod = method;\r\n    // this.frameListener && this.removeListener('enterFrame', this.frameListener);\r\n\r\n    // setTimeout(() => {\r\n    // this.addListener('enterFrame', this.frameListener);\r\n    // }, 0);\r\n\r\n    if(this.frameListener) {\r\n      const lastResult = this.listenerResults.enterFrame;\r\n      if(lastResult !== undefined) {\r\n        this.frameListener(this.curFrame);\r\n      }\r\n    }\r\n\r\n    // this.mainLoop(method);\r\n    // this.r(method);\r\n    // method();\r\n  }\r\n\r\n  public playPart(options: {\r\n    from: number,\r\n    to: number,\r\n    callback?: () => void\r\n  }) {\r\n    this.pause();\r\n\r\n    const {from, to, callback} = options;\r\n    this.curFrame = from - 1;\r\n\r\n    return this.playToFrame({\r\n      frame: to,\r\n      direction: to > from ? 1 : -1,\r\n      callback\r\n    });\r\n  }\r\n\r\n  public playToFrame(options: {\r\n    frame: number,\r\n    speed?: number,\r\n    direction?: number,\r\n    callback?: () => void\r\n  }) {\r\n    this.pause();\r\n\r\n    const {frame, speed, callback, direction} = options;\r\n    this.setDirection(direction === undefined ? this.curFrame > frame ? -1 : 1 : direction);\r\n    speed !== undefined && this.setSpeed(speed);\r\n\r\n    const bounds = [this.curFrame, frame];\r\n    if(this.direction === -1) bounds.reverse();\r\n\r\n    this.loop = false;\r\n    this.setMinMax(bounds[0], bounds[1]);\r\n\r\n    if(this.playToFrameOnFrameCallback) {\r\n      this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\r\n    }\r\n\r\n    if(callback) {\r\n      this.playToFrameOnFrameCallback = (frameNo: number) => {\r\n        if(frameNo === frame) {\r\n          this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\r\n          callback();\r\n        }\r\n      };\r\n\r\n      this.addEventListener('enterFrame', this.playToFrameOnFrameCallback);\r\n    }\r\n\r\n    this.play();\r\n  }\r\n\r\n  public setColor(color: RLottieColor | string, renderIfPaused: boolean) {\r\n    if(typeof(color) === 'string') {\r\n      this.textColor = color;\r\n    } else {\r\n      this.color = color;\r\n    }\r\n\r\n    if(renderIfPaused && this.paused) {\r\n      this.applyColorForAllContexts();\r\n      // this.renderFrame2(this.imageData?.data, this.curFrame);\r\n    }\r\n  }\r\n\r\n  private setMinMax(minFrame = 0, maxFrame = this.frameCount - 1) {\r\n    this.minFrame = minFrame;\r\n    this.maxFrame = maxFrame;\r\n  }\r\n\r\n  public async onLoad(frameCount: number, fps: number) {\r\n    this.frameCount = frameCount;\r\n    this.fps = fps;\r\n    this.setMinMax();\r\n    if(this.initFrame !== undefined) {\r\n      this.initFrame = clamp(this.initFrame, this.minFrame, this.maxFrame);\r\n    }\r\n\r\n    const curFrame = this.resetCurrentFrame();\r\n\r\n    // * Handle 30fps stickers if 30fps set\r\n    if(this.fps < 60 && this.skipDelta !== 1) {\r\n      const diff = 60 / fps;\r\n      this.skipDelta = this.skipDelta / diff | 0;\r\n    }\r\n\r\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\r\n    this.frThen = Date.now() - this.frInterval;\r\n    // this.sendQuery('renderFrame', 0);\r\n\r\n    // Кешировать сразу не получится, рендер стикера (тайгер) занимает 519мс,\r\n    // если рендерить 75% с получением каждого кадра из воркера, будет 475мс, т.е. при 100% было бы 593мс, потеря на передаче 84мс.\r\n\r\n    /* console.time('cache' + this.reqId);\r\n    for(let i = 0; i < frameCount; ++i) {\r\n      //if(this.removed) return;\r\n\r\n      if(i % 4) {\r\n        await new Promise((resolve) => {\r\n          delete this.listenerResults.enterFrame;\r\n          this.addListener('enterFrame', resolve, true);\r\n          this.requestFrame(i);\r\n        });\r\n      }\r\n    }\r\n\r\n    console.timeEnd('cache' + this.reqId); */\r\n    // console.log('cached');\r\n    /* this.el.innerHTML = '';\r\n    this.el.append(this.canvas);\r\n    return; */\r\n\r\n    !this.skipFirstFrameRendering && this.requestFrame(curFrame);\r\n    this.dispatchEvent('ready');\r\n    this.addEventListener('enterFrame', () => {\r\n      this.dispatchEvent('firstFrame');\r\n\r\n      if(!this.canvas[0].parentNode && this.el?.[0] && !this.overrideRender) {\r\n        this.el.forEach((container, idx) => container.append(this.canvas[idx]));\r\n      }\r\n\r\n      // console.log('enterFrame firstFrame');\r\n\r\n      // let lastTime = this.frThen;\r\n      this.frameListener = () => {\r\n        if(this.paused || !this.currentMethod) {\r\n          return;\r\n        }\r\n\r\n        const time = Date.now();\r\n        // console.log(`enterFrame handle${this.reqId}`, time, (time - lastTime), this.frInterval);\r\n        /* if(Math.round(time - lastTime + this.frInterval * 0.25) < Math.round(this.frInterval)) {\r\n          return;\r\n        } */\r\n\r\n        // lastTime = time;\r\n\r\n        this.frThen = time + this.frInterval;\r\n        const canContinue = this.currentMethod();\r\n        if(!canContinue && !this.loop && this.autoplay) {\r\n          this.autoplay = false;\r\n        }\r\n      };\r\n\r\n      this.addEventListener('enterFrame', this.frameListener);\r\n      // setInterval(this.frameListener, this.frInterval);\r\n\r\n      // ! fix autoplaying since there will be no animationIntersector for it\r\n      if(this.group === 'none' && this.autoplay) {\r\n        this.play();\r\n      }\r\n    }, {once: true});\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport {applyColorOnContext} from '../lib/rlottie/rlottiePlayer';\r\nimport rootScope from '../lib/rootScope';\r\nimport getStickerThumbKey from '../lib/storages/utils/thumbs/getStickerThumbKey';\r\nimport customProperties from './dom/customProperties';\r\n\r\nconst savingLottiePreview: {[docId: DocId]: {width: number, height: number}} = {};\r\n\r\nexport function isSavingLottiePreview(doc: MyDocument, toneIndex: number | string, width: number, height: number) {\r\n  const key = getStickerThumbKey(doc.id, toneIndex);\r\n  const saving = savingLottiePreview[key];\r\n  return saving && saving.width >= width && saving.height >= height;\r\n}\r\n\r\nlet sharedCanvas: HTMLCanvasElement, sharedContext: CanvasRenderingContext2D;\r\nconst createCanvas = () => {\r\n  rootScope.addEventListener('theme_changed', () => {\r\n    rootScope.managers.thumbsStorage.clearColoredStickerThumbs();\r\n\r\n    for(const key in savingLottiePreview) {\r\n      const [, toneIndex] = key.split('-');\r\n      if(toneIndex && isNaN(+toneIndex)) {\r\n        delete savingLottiePreview[key];\r\n      }\r\n    }\r\n  });\r\n\r\n  sharedCanvas = document.createElement('canvas');\r\n  sharedContext = sharedCanvas.getContext('2d');\r\n};\r\n\r\nexport async function saveLottiePreview(doc: MyDocument, canvas: HTMLCanvasElement, toneIndex: number | string) {\r\n  const key = getStickerThumbKey(doc.id, toneIndex);\r\n  const {width, height} = canvas;\r\n  if(isSavingLottiePreview(doc, toneIndex, width, height)) {\r\n    return;\r\n  }\r\n\r\n  const saving = savingLottiePreview[key] = {\r\n    width,\r\n    height\r\n  };\r\n\r\n  const thumb = await rootScope.managers.thumbsStorage.getStickerCachedThumb(doc.id, toneIndex);\r\n  if(savingLottiePreview[key] !== saving) {\r\n    return;\r\n  }\r\n\r\n  if(thumb && thumb.w >= width && thumb.h >= height) {\r\n    return;\r\n  }\r\n\r\n  if(typeof(toneIndex) === 'string') {\r\n    if(!sharedCanvas) {\r\n      createCanvas();\r\n    }\r\n\r\n    sharedCanvas.width = width;\r\n    sharedCanvas.height = height;\r\n    sharedContext.drawImage(canvas, 0, 0, width, height);\r\n    applyColorOnContext(sharedContext, customProperties.getProperty(toneIndex), 0, 0, width, height);\r\n    canvas = sharedCanvas;\r\n  }\r\n\r\n  const promise = new Promise<Blob>((resolve) => {\r\n    canvas.toBlob((blob) => resolve(blob));\r\n  });\r\n\r\n  const blob = await promise;\r\n  if(savingLottiePreview[key] !== saving) {\r\n    return;\r\n  }\r\n\r\n  if(!blob) {\r\n    console.error('trying to save sticker preview with no blob', arguments);\r\n    debugger;\r\n    return;\r\n  }\r\n\r\n  rootScope.managers.thumbsStorage.saveStickerPreview(doc.id, blob, width, height, toneIndex);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nclass SequentialDom {\r\n  private promises: Partial<{\r\n    read: CancellablePromise<void>,\r\n    write: CancellablePromise<void>\r\n  }> = {};\r\n  private raf = fastRaf.bind(null);\r\n  private scheduled = false;\r\n\r\n  private do(kind: keyof SequentialDom['promises'], callback?: VoidFunction) {\r\n    let promise = this.promises[kind];\r\n    if(!promise) {\r\n      this.scheduleFlush();\r\n      promise = this.promises[kind] = deferredPromise<void>();\r\n    }\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public measure(callback?: VoidFunction) {\r\n    return this.do('read', callback);\r\n  }\r\n\r\n  public mutate(callback?: VoidFunction) {\r\n    return this.do('write', callback);\r\n  }\r\n\r\n  /**\r\n   * Will fire instantly if element is not connected\r\n   * @param element\r\n   * @param callback\r\n   */\r\n  public mutateElement(element: HTMLElement, callback?: VoidFunction) {\r\n    const isConnected = isInDOM(element);\r\n    const promise = isConnected ? this.mutate() : Promise.resolve();\r\n\r\n    if(callback !== undefined) {\r\n      if(!isConnected) {\r\n        callback();\r\n      } else {\r\n        promise.then(() => callback());\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private scheduleFlush() {\r\n    if(!this.scheduled) {\r\n      this.scheduled = true;\r\n\r\n      this.raf(() => {\r\n        this.promises.read && this.promises.read.resolve();\r\n        this.promises.write && this.promises.write.resolve();\r\n\r\n        this.scheduled = false;\r\n        this.promises = {};\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst sequentialDom = new SequentialDom();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.sequentialDom = sequentialDom);\r\nexport default sequentialDom;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport tabId from '../config/tabId';\r\n\r\nlet uploadId = 0;\r\nexport default function getFileNameForUpload(file: File | Blob) {\r\n  let fileName: string;\r\n  const mimeType = file?.type;\r\n  if(mimeType) { // the same like apiFileName in appMessagesManager for upload!\r\n    const ext = `${tabId}_${uploadId++}.${mimeType.split('/')[1]}`;\r\n\r\n    if(['image/jpeg', 'image/png', 'image/bmp'].indexOf(mimeType) >= 0) {\r\n      fileName = 'photo' + ext;\r\n    } else if(mimeType.indexOf('audio/') === 0 || ['video/ogg'].indexOf(mimeType) >= 0) {\r\n      fileName = 'audio' + ext;\r\n    } else if(mimeType.indexOf('video/') === 0) {\r\n      fileName = 'video' + ext;\r\n    } else {\r\n      fileName = 'document' + ext;\r\n    }\r\n  } else {\r\n    fileName = `upload-${tabId}_${uploadId++}`;\r\n  }\r\n\r\n  return fileName;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Document, InputFileLocation} from '../../../../layer';\r\n\r\nexport default function getDocumentInputFileLocation(doc: Document.document, thumbSize?: string): InputFileLocation.inputDocumentFileLocation {\r\n  return {\r\n    _: 'inputDocumentFileLocation',\r\n    id: doc.id,\r\n    access_hash: doc.access_hash,\r\n    file_reference: doc.file_reference,\r\n    thumb_size: thumbSize\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {Document, PhotoSize, VideoSize} from '../../../../layer';\r\nimport type {DownloadOptions} from '../../../mtproto/apiFileManager';\r\nimport getDocumentInputFileLocation from './getDocumentInputFileLocation';\r\n\r\ntype GetDocumentDownloadOptions = {\r\n  thumb?: PhotoSize.photoSize | Extract<VideoSize, VideoSize.videoSize>;\r\n  queueId?: number;\r\n  onlyCache?: boolean;\r\n};\r\n\r\nexport default function getDocumentDownloadOptions(\r\n  doc: Document.document,\r\n  {thumb, queueId, onlyCache}: GetDocumentDownloadOptions = {}\r\n): DownloadOptions {\r\n  const inputFileLocation = getDocumentInputFileLocation(doc, thumb?.type);\r\n\r\n  let mimeType: MTMimeType;\r\n  if(thumb?._ === 'photoSize') {\r\n    mimeType = doc.sticker ? 'image/webp' : (doc.mime_type.startsWith('image/') ? doc.mime_type : 'image/jpeg');\r\n  } else {\r\n    mimeType = doc.mime_type || 'application/octet-stream';\r\n  }\r\n\r\n  return {\r\n    dcId: doc.dc_id,\r\n    location: inputFileLocation,\r\n    size: thumb ? thumb.size : doc.size,\r\n    mimeType,\r\n    fileName: doc.file_name,\r\n    queueId,\r\n    onlyCache\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {PhotoSize, InputFileLocation} from '../../../../layer';\r\nimport type {DownloadOptions} from '../../../mtproto/apiFileManager';\r\nimport type {MyDocument} from '../../appDocsManager';\r\nimport type {MyPhoto} from '../../appPhotosManager';\r\n\r\nexport default function getPhotoDownloadOptions(photo: MyPhoto | MyDocument, photoSize: PhotoSize, queueId?: number, onlyCache?: boolean): DownloadOptions {\r\n  const isDocument = photo._ === 'document';\r\n\r\n  if(!photoSize || photoSize._ === 'photoSizeEmpty') {\r\n    // console.error('no photoSize by photo:', photo);\r\n    throw new Error('photoSizeEmpty!');\r\n  }\r\n\r\n  // maybe it's a thumb\r\n  const isPhoto = !!((photoSize._ === 'photoSize' || photoSize._ === 'photoSizeProgressive') && photo.access_hash && photo.file_reference);\r\n  const location: InputFileLocation.inputPhotoFileLocation | InputFileLocation.inputDocumentFileLocation = {\r\n    _: isDocument ? 'inputDocumentFileLocation' : 'inputPhotoFileLocation',\r\n    id: photo.id,\r\n    access_hash: photo.access_hash,\r\n    file_reference: photo.file_reference,\r\n    thumb_size: photoSize.type\r\n  };\r\n\r\n  return {\r\n    dcId: photo.dc_id,\r\n    location,\r\n    size: isPhoto ? (photoSize as PhotoSize.photoSize).size : undefined,\r\n    mimeType: 'image/jpeg',\r\n    queueId,\r\n    onlyCache\r\n  };\r\n}\r\n","import {InputWebFileLocation} from '../../../../layer';\r\nimport {DownloadOptions} from '../../../mtproto/apiFileManager';\r\n\r\nexport default function getWebFileDownloadOptions(location: InputWebFileLocation): DownloadOptions {\r\n  const downloadOptions: DownloadOptions = {\r\n    dcId: 0,\r\n    location,\r\n    size: 0,\r\n    mimeType: 'image/jpeg'\r\n  };\r\n\r\n  // if(location._ === 'inputWebFileGeoPointLocation') {\r\n  //   downloadOptions.size = 512 * 1024;\r\n  //   downloadOptions.mimeType = 'image/jpeg';\r\n  // }\r\n\r\n  return downloadOptions;\r\n}\r\n","import {WebDocument} from '../../../../layer';\r\nimport {DownloadOptions} from '../../../mtproto/apiFileManager';\r\nimport getWebFileDownloadOptions from '../webFiles/getWebFileDownloadOptions';\r\n\r\nexport default function getWebDocumentDownloadOptions(webDocument: WebDocument): DownloadOptions {\r\n  const downloadOptions = getWebFileDownloadOptions({\r\n    _: 'inputWebFileLocation',\r\n    access_hash: (webDocument as WebDocument.webDocument).access_hash,\r\n    url: webDocument.url\r\n  });\r\n\r\n  downloadOptions.size = webDocument.size;\r\n  downloadOptions.mimeType = webDocument.mime_type;\r\n\r\n  return downloadOptions;\r\n}\r\n","import {WebDocument} from '../../../../layer';\r\n\r\nexport default function isWebDocument(webDocument: any): webDocument is WebDocument {\r\n  return !!(webDocument && (webDocument._ === 'webDocument' || webDocument._ === 'webDocumentNoProxy'));\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {getFileNameByLocation} from '../../../../helpers/fileName';\r\nimport {DownloadOptions} from '../../../mtproto/apiFileManager';\r\n\r\nexport default function getDownloadFileNameFromOptions(options: DownloadOptions) {\r\n  return getFileNameByLocation(options.location, options);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DownloadMediaOptions, DownloadOptions} from '../../../mtproto/apiFileManager';\r\nimport getDocumentDownloadOptions from '../docs/getDocumentDownloadOptions';\r\nimport getPhotoDownloadOptions from '../photos/getPhotoDownloadOptions';\r\nimport getWebDocumentDownloadOptions from '../webDocs/getWebDocumentDownloadOptions';\r\nimport isWebDocument from '../webDocs/isWebDocument';\r\nimport getWebFileDownloadOptions from '../webFiles/getWebFileDownloadOptions';\r\nimport isWebFileLocation from '../webFiles/isWebFileLocation';\r\nimport getDownloadFileNameFromOptions from './getDownloadFileNameFromOptions';\r\n\r\nexport default function getDownloadMediaDetails(options: DownloadMediaOptions) {\r\n  const {media, thumb, queueId, onlyCache} = options;\r\n\r\n  let downloadOptions: DownloadOptions;\r\n  if(media._ === 'document') downloadOptions = getDocumentDownloadOptions(media, {thumb: thumb as any, queueId, onlyCache});\r\n  else if(media._ === 'photo') downloadOptions = getPhotoDownloadOptions(media, thumb as any, queueId, onlyCache);\r\n  else if(isWebDocument(media)) downloadOptions = getWebDocumentDownloadOptions(media);\r\n  else if(isWebFileLocation(media)) downloadOptions = getWebFileDownloadOptions(media);\r\n\r\n  downloadOptions.downloadId = options.downloadId;\r\n\r\n  const fileName = getDownloadFileNameFromOptions(downloadOptions);\r\n  return {fileName, downloadOptions};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function createDownloadAnchor(url: string, fileName: string, onRemove?: () => void) {\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = fileName;\r\n  a.target = '_blank';\r\n\r\n  a.style.position = 'absolute';\r\n  a.style.top = '1px';\r\n  a.style.left = '1px';\r\n\r\n  document.body.append(a);\r\n\r\n  try {\r\n    const clickEvent = document.createEvent('MouseEvents');\r\n    clickEvent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\r\n    a.dispatchEvent(clickEvent);\r\n  } catch(e) {\r\n    console.error('Download click error', e);\r\n    try {\r\n      a.click();\r\n    } catch(e) {\r\n      window.open(url as string, '_blank');\r\n    }\r\n  }\r\n\r\n  setTimeout(() => {\r\n    a.remove();\r\n    onRemove && onRemove();\r\n  }, 100);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DownloadMediaOptions, DownloadOptions} from '../mtproto/apiFileManager';\r\nimport type {AppMessagesManager} from './appMessagesManager';\r\nimport type {MyDocument} from './appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {InputFile, Photo, PhotoSize} from '../../layer';\r\nimport getFileNameForUpload from '../../helpers/getFileNameForUpload';\r\nimport {AppManagers} from './managers';\r\nimport rootScope from '../rootScope';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport noop from '../../helpers/noop';\r\nimport getDownloadMediaDetails from './utils/download/getDownloadMediaDetails';\r\nimport getDownloadFileNameFromOptions from './utils/download/getDownloadFileNameFromOptions';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport makeError from '../../helpers/makeError';\r\nimport createDownloadAnchor from '../../helpers/dom/createDownloadAnchor';\r\nimport {getFileNameByLocation} from '../../helpers/fileName';\r\nimport getDocumentDownloadOptions from './utils/docs/getDocumentDownloadOptions';\r\nimport getPhotoDownloadOptions from './utils/photos/getPhotoDownloadOptions';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\n\r\nexport type ResponseMethodBlob = 'blob';\r\nexport type ResponseMethodJson = 'json';\r\nexport type ResponseMethod = ResponseMethodBlob | ResponseMethodJson;\r\n\r\n/* export type DownloadBlob = {promise: Promise<Blob>, controller: AbortController};\r\nexport type DownloadJson = {promise: Promise<any>, controller: AbortController}; */\r\nexport type DownloadBlob = CancellablePromise<Blob>;\r\nexport type DownloadUrl = CancellablePromise<string>;\r\nexport type DownloadJson = CancellablePromise<any>;\r\n// export type Download = DownloadBlob/*  | DownloadJson */;\r\nexport type Download = DownloadBlob | DownloadUrl/*  | DownloadJson */;\r\n\r\nexport type Progress = {done: number, fileName: string, total: number, offset: number};\r\nexport type ProgressCallback = (details: Progress) => void;\r\n\r\ntype DownloadType = 'url' | 'blob' | 'void' | 'disc';\r\n\r\nexport class AppDownloadManager {\r\n  private downloads: {[fileName: string]: {main: Download} & {[type in DownloadType]?: Download}} = {};\r\n  // private downloadsToDisc: {[fileName: string]: Download} = {};\r\n  private progress: {[fileName: string]: Progress} = {};\r\n  // private progressCallbacks: {[fileName: string]: Array<ProgressCallback>} = {};\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    rootScope.addEventListener('download_progress', (details) => {\r\n      // const callbacks = this.progressCallbacks[details.fileName];\r\n      // if(callbacks) {\r\n      //   callbacks.forEach((callback) => callback(details));\r\n      // }\r\n\r\n      const download = this.downloads[details.fileName];\r\n      if(download?.main?.notifyAll) {\r\n        this.progress[details.fileName] = details;\r\n        download.main.notifyAll(details);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getNewDeferred<T>(fileName: string, type?: DownloadType) {\r\n    const deferred = deferredPromise<T>();\r\n\r\n    let download = this.downloads[fileName];\r\n    if(!download) {\r\n      download = this.downloads[fileName] = {\r\n        main: deferred as any\r\n      };\r\n\r\n      deferred.cancel = () => {\r\n        const error = makeError('DOWNLOAD_CANCELED');\r\n\r\n        this.managers.apiFileManager.cancelDownload(fileName);\r\n\r\n        deferred.reject(error);\r\n        deferred.cancel = noop;\r\n      };\r\n\r\n      deferred.catch(() => {\r\n        this.clearDownload(fileName, type);\r\n      }).finally(() => {\r\n        delete this.progress[fileName];\r\n        // delete this.progressCallbacks[fileName];\r\n      });\r\n    } else {\r\n      const main = download.main;\r\n      (['cancel', 'addNotifyListener', 'notify', 'notifyAll'] as (keyof CancellablePromise<void>)[]).forEach((key) => {\r\n        if(!main[key]) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        deferred[key] = main[key].bind(main);\r\n      });\r\n    }\r\n\r\n    const haveToClear = type === 'disc';\r\n    if(haveToClear) {\r\n      deferred.catch(noop).finally(() => {\r\n        this.clearDownload(fileName, type);\r\n      });\r\n    }\r\n\r\n    return download[type] = deferred as any;\r\n  }\r\n\r\n  public getNewDeferredForUpload<T extends Promise<any>>(fileName: string, promise: T) {\r\n    const deferred: CancellablePromise<Awaited<T>> = this.getNewDeferred<InputFile>(fileName);\r\n    promise.then(deferred.resolve.bind(deferred), deferred.reject.bind(deferred));\r\n\r\n    deferred.finally(() => {\r\n      this.clearDownload(fileName);\r\n    });\r\n\r\n    return deferred;\r\n  }\r\n\r\n  private clearDownload(fileName: string, type?: DownloadType) {\r\n    const downloads = this.downloads[fileName];\r\n    if(!downloads) {\r\n      return;\r\n    }\r\n\r\n    delete downloads[type];\r\n\r\n    const length = Object.keys(downloads).length;\r\n    if(!length || (downloads.main && length === 1)) {\r\n      delete this.downloads[fileName];\r\n    }\r\n  }\r\n\r\n  public getUpload(fileName: string): ReturnType<AppMessagesManager['sendFile']>['promise'] {\r\n    let deferred: CancellablePromise<any> = this.getDownload(fileName);\r\n    if(deferred) {\r\n      return deferred;\r\n    }\r\n\r\n    deferred = this.getNewDeferred(fileName);\r\n    this.managers.appMessagesManager.getUploadPromise(fileName).then(deferred.resolve.bind(deferred), deferred.reject.bind(deferred));\r\n    return deferred;\r\n  }\r\n\r\n  /* public fakeDownload(fileName: string, value: Blob | string) {\r\n    const deferred = this.getNewDeferred<Blob>(fileName);\r\n    if(typeof(value) === 'string') {\r\n      fetch(value)\r\n      .then((response) => response.blob())\r\n      .then((blob) => deferred.resolve(blob));\r\n    } else {\r\n      deferred.resolve(value);\r\n    }\r\n\r\n    return deferred;\r\n  } */\r\n\r\n  private d(fileName: string, getPromise: () => Promise<any>, type?: DownloadType) {\r\n    let deferred = this.getDownload(fileName, type);\r\n    if(deferred) return deferred;\r\n\r\n    deferred = this.getNewDeferred<Blob>(fileName, type);\r\n    getPromise().then(deferred.resolve.bind(deferred), deferred.reject.bind(deferred));\r\n    return deferred;\r\n  }\r\n\r\n  public download(options: DownloadOptions): DownloadBlob {\r\n    const fileName = getDownloadFileNameFromOptions(options);\r\n    return this.d(fileName, () => this.managers.apiFileManager.download(options), 'blob') as any;\r\n  }\r\n\r\n  public downloadMedia(options: DownloadMediaOptions, type: DownloadType = 'blob', promiseBefore?: Promise<any>): DownloadBlob {\r\n    const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n\r\n    return this.d(fileName, () => {\r\n      let cb: any;\r\n      if(type === 'url') {\r\n        cb = this.managers.apiFileManager.downloadMediaURL;\r\n      } else if(type === 'void'/*  || type === 'disc' */) {\r\n        cb = this.managers.apiFileManager.downloadMediaVoid;\r\n      } else /* if(type === 'blob') */ {\r\n        cb = this.managers.apiFileManager.downloadMedia;\r\n      }\r\n\r\n      if(promiseBefore) {\r\n        return promiseBefore.then(() => {\r\n          return cb(options);\r\n        }, () => {\r\n          delete options.downloadId;\r\n          return cb(options);\r\n        });\r\n      }\r\n\r\n      return cb(options);\r\n    }, type) as any;\r\n  }\r\n\r\n  public downloadMediaURL(options: DownloadMediaOptions): DownloadUrl {\r\n    return this.downloadMedia(options, 'url') as any;\r\n  }\r\n\r\n  public downloadMediaVoid(options: DownloadMediaOptions): DownloadBlob {\r\n    return this.downloadMedia(options, 'void');\r\n  }\r\n\r\n  public upload(file: File | Blob, fileName?: string, promise?: Promise<any>) {\r\n    if(!fileName) {\r\n      fileName = getFileNameForUpload(file);\r\n    }\r\n\r\n    if(!promise) {\r\n      promise = this.managers.apiFileManager.upload({file, fileName});\r\n    }\r\n\r\n    const deferred = this.getNewDeferredForUpload(fileName, promise);\r\n    return deferred as any as CancellablePromise<InputFile>;\r\n  }\r\n\r\n  public getDownload(fileName: string, type?: DownloadType) {\r\n    const d = this.downloads[fileName];\r\n    return d && d[type];\r\n  }\r\n\r\n  // public addProgressCallback(fileName: string, callback: ProgressCallback) {\r\n  //   const progress = this.progress[fileName];\r\n  //   (this.progressCallbacks[fileName] ?? (this.progressCallbacks[fileName] = [])).push(callback);\r\n\r\n  //   if(progress) {\r\n  //     callback(progress);\r\n  //   }\r\n  // }\r\n\r\n  public downloadToDisc(options: DownloadMediaOptions, justAttach?: boolean) {\r\n    const media = options.media;\r\n    const isDocument = media._ === 'document';\r\n    if(!isDocument && !options.thumb) {\r\n      options.thumb = (media as Photo.photo).sizes.slice().pop() as PhotoSize.photoSize;\r\n    }\r\n\r\n    const USE_SW = !IS_MOBILE_SAFARI && !!apiManagerProxy.serviceMessagePort;\r\n    // const USE_SW = true;\r\n\r\n    const getOutFileName = () => {\r\n      const downloadOptions = isDocument ?\r\n        getDocumentDownloadOptions(media) :\r\n        getPhotoDownloadOptions(media as any, options.thumb as PhotoSize.photoSize);\r\n      return (options.media as MyDocument).file_name || getFileNameByLocation(downloadOptions.location);\r\n    };\r\n\r\n    // const {fileName: cacheFileName} = getDownloadMediaDetails(options);\r\n    // if(justAttach) {\r\n    //   const promise = this.downloadsToDisc[cacheFileName];\r\n    //   if(promise) {\r\n    //     return promise;\r\n    //   }\r\n    // }\r\n\r\n    // const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n    // if(downloadOptions.size && downloadOptions.size > MAX_FILE_SAVE_SIZE) {\r\n    let url: string, pingPromise: Promise<any>, iframe: HTMLIFrameElement;\r\n    if(USE_SW) {\r\n      const id = '' + (Math.random() * 0x7FFFFFFF | 0);\r\n      // const id = 'test';\r\n      url = `d/${id}`;\r\n      options.downloadId = id;\r\n\r\n      pingPromise = apiManagerProxy.pingServiceWorkerWithIframe();\r\n\r\n      if(!justAttach) {\r\n        const {iframe: _iframe, onSuccess, onError} = this.createDownloadIframe(url);\r\n        iframe = _iframe;\r\n\r\n        // * 1. make sure that SW is alive with a ping\r\n        // * 2. send download request and wait for a pong (downloadRequestReceived)\r\n        // * 3. if pong is missing (something with request and can't handle it with iframe events),\r\n        // *    fallback to regular download\r\n        pingPromise = pingPromise.then(() => {\r\n          const deferred = deferredPromise<void>();\r\n\r\n          const onFinish = (good: boolean) => {\r\n            clearTimeout(timeout);\r\n            apiManagerProxy.serviceMessagePort.removeEventListener('downloadRequestReceived', onDownloadRequestReceived);\r\n            if(good) deferred.resolve();\r\n            else deferred.reject();\r\n          };\r\n\r\n          const onDownloadRequestReceived = (downloadId: string) => {\r\n            if(downloadId === id) {\r\n              onFinish(true);\r\n            }\r\n          };\r\n\r\n          apiManagerProxy.serviceMessagePort.addEventListener('downloadRequestReceived', onDownloadRequestReceived);\r\n\r\n          const timeout = window.setTimeout(() => {\r\n            onFinish(false);\r\n          }, 1500);\r\n\r\n          onSuccess();\r\n\r\n          return deferred;\r\n        }, (err) => {\r\n          onError();\r\n          throw err;\r\n        });\r\n      }\r\n    }\r\n\r\n    const promise = this.downloadMedia(options, 'disc', pingPromise);\r\n    // this.downloadsToDisc[cacheFileName] = promise;\r\n\r\n    if(justAttach) {\r\n      return promise;\r\n    }\r\n\r\n    let element: HTMLElement, hadProgress = false;\r\n    const onProgress = () => {\r\n      if(hadProgress) {\r\n        return;\r\n      }\r\n\r\n      hadProgress = true;\r\n      element = iframe;\r\n\r\n      indexOfAndSplice(promise.listeners, onProgress);\r\n    };\r\n\r\n    promise.addNotifyListener(onProgress);\r\n    promise.then((blob) => {\r\n      if(!blob) {\r\n        return;\r\n      }\r\n\r\n      const url = URL.createObjectURL(blob);\r\n      createDownloadAnchor(url, getOutFileName(), () => {\r\n        URL.revokeObjectURL(url);\r\n      });\r\n    }).catch(noop).finally(() => {\r\n      if(!hadProgress) {\r\n        onProgress();\r\n      }\r\n\r\n      setTimeout(() => {\r\n        element?.remove();\r\n      }, 1000);\r\n\r\n      // if(this.downloadsToDisc[cacheFileName] === promise) {\r\n      //   delete this.downloadsToDisc[cacheFileName];\r\n      // }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  private createDownloadIframe(url: string) {\r\n    const iframe = document.createElement('iframe');\r\n    iframe.hidden = true;\r\n\r\n    return {\r\n      iframe,\r\n      onSuccess: () => {\r\n        // const removeListeners = () => {\r\n        //   iframe.removeEventListener('load', onLoad);\r\n        //   iframe.removeEventListener('error', onError);\r\n        //   console.error('event', window.event);\r\n        // };\r\n\r\n        // const onLoad = () => {\r\n        //   removeListeners();\r\n        // };\r\n\r\n        // const onError = () => {\r\n        //   removeListeners();\r\n        // };\r\n\r\n        // iframe.addEventListener('load', onLoad);\r\n        // iframe.addEventListener('error', onError);\r\n\r\n        iframe.src = url;\r\n        document.body.append(iframe);\r\n      },\r\n      onError: () => {\r\n        console.error('falling back to normal download');\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nconst appDownloadManager = new AppDownloadManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appDownloadManager = appDownloadManager);\r\nexport default appDownloadManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../appDocsManager';\r\nimport type {MyPhoto} from '../../appPhotosManager';\r\nimport type {PhotoSize, VideoSize, WebDocument} from '../../../../layer';\r\nimport calcImageInBox from '../../../../helpers/calcImageInBox';\r\nimport {THUMB_TYPE_FULL} from '../../../mtproto/mtproto_config';\r\n\r\nexport default function choosePhotoSize(\r\n  photo: MyPhoto | MyDocument | WebDocument,\r\n  boxWidth = 0,\r\n  boxHeight = 0,\r\n  useBytes = false,\r\n  pushDocumentSize = false\r\n) {\r\n  if(window.devicePixelRatio > 1) {\r\n    boxWidth *= 2;\r\n    boxHeight *= 2;\r\n  }\r\n\r\n  /*\r\n  s box 100x100\r\n  m box 320x320\r\n  x box 800x800\r\n  y box 1280x1280\r\n  w box 2560x2560\r\n  a crop  160x160\r\n  b crop  320x320\r\n  c crop  640x640\r\n  d crop  1280x1280 */\r\n\r\n  let sizes: PhotoSize[] = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs as PhotoSize[];\r\n  let bestPhotoSize: typeof sizes[0] = {_: 'photoSizeEmpty', type: THUMB_TYPE_FULL};\r\n  if(pushDocumentSize && sizes && photo._ !== 'photo') {\r\n    sizes = sizes.concat({\r\n      _: 'photoSize',\r\n      w: photo.w,\r\n      h: photo.h,\r\n      size: photo.size,\r\n      type: THUMB_TYPE_FULL\r\n    });\r\n  }\r\n\r\n  if(sizes?.length) {\r\n    for(let i = 0, length = sizes.length; i < length; ++i) {\r\n      const photoSize = sizes[i];\r\n      if(!('w' in photoSize) && !('h' in photoSize)) continue;\r\n\r\n      bestPhotoSize = photoSize;\r\n\r\n      const size = calcImageInBox(photoSize.w, photoSize.h, boxWidth, boxHeight);\r\n      if(size.width >= boxWidth || size.height >= boxHeight) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(useBytes && bestPhotoSize._ === 'photoSizeEmpty' && sizes[0]._ === 'photoStrippedSize') {\r\n      bestPhotoSize = sizes[0];\r\n    }\r\n  }\r\n\r\n  return bestPhotoSize;\r\n}\r\n","import {MyDocument} from '../../appDocsManager';\r\nimport {VideoSize} from '../../../../layer';\r\n\r\nexport default function getStickerEffectThumb(doc: MyDocument) {\r\n  return doc.video_thumbs?.[0] as Extract<VideoSize, VideoSize.videoSize>;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\n\r\nexport default class QueryableWorker extends EventListenerBase<{\r\n  ready: () => void,\r\n  frame: (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => void,\r\n  loaded: (reqId: number, frameCount: number, fps: number) => void,\r\n  error: (reqId: number, error: Error) => void,\r\n  workerError: (error: ErrorEvent) => void\r\n}> {\r\n  constructor(private worker: Worker) {\r\n    super();\r\n\r\n    this.worker.onerror = (error) => {\r\n      try {\r\n        this.dispatchEvent('workerError', error);\r\n        this.cleanup();\r\n        this.terminate();\r\n      } catch(err) {\r\n\r\n      }\r\n    };\r\n\r\n    this.worker.onmessage = (event) => {\r\n      this.dispatchEvent(event.data.queryMethodListener, ...event.data.queryMethodArguments);\r\n    };\r\n  }\r\n\r\n  public postMessage(message: any) {\r\n    this.worker.postMessage(message);\r\n  }\r\n\r\n  public terminate() {\r\n    this.worker.terminate();\r\n  }\r\n\r\n  public sendQuery(args: any[], transfer?: Transferable[]) {\r\n    this.worker.postMessage({\r\n      queryMethod: args.shift(),\r\n      queryMethodArguments: args\r\n    }, CAN_USE_TRANSFERABLES ? transfer: undefined);\r\n  }\r\n}\r\n","const IS_WEB_ASSEMBLY_SUPPORTED = typeof(WebAssembly) !== 'undefined';\r\n\r\nexport default IS_WEB_ASSEMBLY_SUPPORTED;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport animationIntersector from '../../components/animationIntersector';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport {logger, LogTypes} from '../logger';\r\nimport RLottiePlayer, {RLottieOptions} from './rlottiePlayer';\r\nimport QueryableWorker from './queryableWorker';\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport IS_WEB_ASSEMBLY_SUPPORTED from '../../environment/webAssemblySupport';\r\nimport makeError from '../../helpers/makeError';\r\nimport App from '../../config/app';\r\nimport rootScope from '../rootScope';\r\nimport toArray from '../../helpers/array/toArray';\r\n\r\nexport type LottieAssetName =\r\n  | 'EmptyFolder'\r\n  | 'Folders_1'\r\n  | 'Folders_2'\r\n  | 'TwoFactorSetupMonkeyClose'\r\n  | 'TwoFactorSetupMonkeyCloseAndPeek'\r\n  | 'TwoFactorSetupMonkeyCloseAndPeekToIdle'\r\n  | 'TwoFactorSetupMonkeyIdle'\r\n  | 'TwoFactorSetupMonkeyPeek'\r\n  | 'TwoFactorSetupMonkeyTracking'\r\n  | 'voice_outlined2'\r\n  | 'voip_filled'\r\n  | 'voice_mini'\r\n  | 'jolly_roger'\r\n  | 'Gift3'\r\n  | 'Gift6'\r\n  | 'Gift12'\r\n  | 'Folders_Shared'\r\n  | 'UtyanSearch'\r\n  | 'UtyanDiscussion'\r\n  | 'UtyanLinks'\r\n  | 'UtyanStories'\r\n  | 'ReactionGeneric'\r\n  | 'StatsEmoji'\r\n  | 'Congratulations'\r\n  | 'large_lastseen'\r\n  | 'large_readtime'\r\n  | 'StarReaction'\r\n  | 'StarReactionAppear'\r\n  | 'StarReactionSelect'\r\n  | 'StarReactionEffect1'\r\n  | 'StarReactionEffect2'\r\n  | 'StarReactionEffect3'\r\n  | 'UtyanPasscode'\r\n;\r\n\r\nexport class LottieLoader {\r\n  private loadPromise: Promise<void> = !IS_WEB_ASSEMBLY_SUPPORTED ? Promise.reject(makeError('NO_WASM')) : undefined;\r\n  private loaded = false;\r\n\r\n  private workersLimit = App.threads;\r\n  private players: {[reqId: number]: RLottiePlayer} = {};\r\n  private playersByCacheName: {[cacheName: string]: Set<RLottiePlayer>} = {};\r\n\r\n  private workers: QueryableWorker[] = [];\r\n  private curWorkerNum = 0;\r\n\r\n  private log = logger('LOTTIE', LogTypes.Error);\r\n\r\n  constructor() {\r\n    rootScope.addEventListener('theme_changed', () => {\r\n      for(const reqId in this.players) {\r\n        this.players[reqId].applyColorForAllContexts();\r\n      }\r\n    });\r\n  }\r\n\r\n  public getAnimation(element: HTMLElement) {\r\n    for(const i in this.players) {\r\n      if(this.players[i].el.includes(element)) {\r\n        return this.players[i];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public loadLottieWorkers() {\r\n    if(this.loadPromise) {\r\n      return this.loadPromise;\r\n    }\r\n\r\n    return this.loadPromise = new Promise((resolve, reject) => {\r\n      let remain = this.workersLimit;\r\n      for(let i = 0; i < this.workersLimit; ++i) {\r\n        const worker = new Worker(new URL('./rlottie.worker.ts', import.meta.url), {type: 'module'});\r\n        const queryableWorker = this.workers[i] = new QueryableWorker(worker);\r\n\r\n        queryableWorker.addEventListener('ready', () => {\r\n          this.log('worker #' + i + ' ready');\r\n\r\n          queryableWorker.addEventListener('frame', this.onFrame);\r\n          queryableWorker.addEventListener('loaded', this.onPlayerLoaded);\r\n          queryableWorker.addEventListener('error', this.onPlayerError);\r\n\r\n          --remain;\r\n          if(!remain) {\r\n            this.log('workers ready');\r\n            resolve();\r\n            this.loaded = true;\r\n          }\r\n        }, {once: true});\r\n\r\n        queryableWorker.addEventListener('workerError', (error) => {\r\n          reject('rlottie load error: ' + error.message);\r\n          this.loaded = false;\r\n        }, {once: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  public makeAssetUrl(name: LottieAssetName) {\r\n    return 'assets/tgs/' + name + '.json';\r\n  }\r\n\r\n  public loadAnimationAsAsset(params: Omit<RLottieOptions, 'animationData' | 'name'>, name: LottieAssetName) {\r\n    // (params as RLottieOptions).name = name;\r\n    return this.loadAnimationFromURL(params, this.makeAssetUrl(name));\r\n  }\r\n\r\n  public loadAnimationDataFromURL(url: string, method: 'json'): Promise<any>;\r\n  public loadAnimationDataFromURL(url: string, method?: 'blob'): Promise<Blob>;\r\n  public loadAnimationDataFromURL(url: string, method: 'json' | 'blob' = 'blob'): Promise<Blob | any> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    this.loadLottieWorkers();\r\n\r\n    return fetch(url)\r\n    .then((res) => {\r\n      if(!res.headers || res.headers.get('content-type') === 'application/octet-stream') {\r\n        return res.arrayBuffer()\r\n        .then((data) => apiManagerProxy.invokeCrypto('gzipUncompress', data))\r\n        .then((arr) => blobConstruct(arr as Uint8Array, ''));\r\n      } else {\r\n        return res[method]();\r\n      }\r\n    });\r\n    /* .then((str) => {\r\n      return new Promise<string>((resolve) => setTimeout(() => resolve(str), 2e3));\r\n    }) */\r\n  }\r\n\r\n  public loadAnimationFromURLManually(name: LottieAssetName) {\r\n    const url = this.makeAssetUrl(name);\r\n    return this.loadAnimationDataFromURL(url).then((blob) => {\r\n      return (params: Omit<RLottieOptions, 'animationData'>) => this.loadAnimationFromURLNext(blob, params, url);\r\n    });\r\n  }\r\n\r\n  public loadAnimationFromURL(params: Omit<RLottieOptions, 'animationData'>, url: string) {\r\n    return this.loadAnimationDataFromURL(url).then((blob) => {\r\n      return this.loadAnimationFromURLNext(blob, params, url);\r\n    });\r\n  }\r\n\r\n  public loadAnimationFromURLNext(blob: Blob, params: Omit<RLottieOptions, 'animationData'>, url: string) {\r\n    const newParams = Object.assign(params, {animationData: blob, needUpscale: true});\r\n    newParams.name ||= url;\r\n    return this.loadAnimationWorker(newParams);\r\n  }\r\n\r\n  public waitForFirstFrame(player: RLottiePlayer) {\r\n    return Promise.race([\r\n      /* new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', () => {\r\n          setTimeout(() => resolve(), 1500);\r\n        }, true);\r\n      }) */\r\n      new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', resolve, {once: true});\r\n      }),\r\n      pause(2500)\r\n    ]).then(() => player);\r\n  }\r\n\r\n  public async loadAnimationWorker(params: RLottieOptions): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      await this.loadLottieWorkers();\r\n    }\r\n\r\n    const {middleware, group = ''} = params;\r\n    if(middleware && !middleware()) {\r\n      throw makeError('MIDDLEWARE');\r\n    }\r\n\r\n    if(params.sync) {\r\n      const cacheName = RLottiePlayer.CACHE.generateName(params.name, params.width, params.height, params.color, params.toneIndex);\r\n      const players = this.playersByCacheName[cacheName];\r\n      if(players?.size) {\r\n        return Promise.resolve(players.entries().next().value[0]);\r\n      }\r\n    }\r\n\r\n    const containers = toArray(params.container);\r\n    if(!params.width || !params.height) {\r\n      params.width = parseInt(containers[0].style.width);\r\n      params.height = parseInt(containers[0].style.height);\r\n    }\r\n\r\n    if(!params.width || !params.height) {\r\n      throw new Error('No size for sticker!');\r\n    }\r\n\r\n    params.group = group;\r\n\r\n    const player = this.initPlayer(containers, params);\r\n\r\n    animationIntersector.addAnimation({\r\n      animation: player,\r\n      group,\r\n      observeElement: player.el[0],\r\n      controlled: middleware,\r\n      liteModeKey: params.liteModeKey,\r\n      type: 'lottie'\r\n    });\r\n\r\n    if(!params.sync) {\r\n      // * have to use onClean here, SuperStickerRenderer relies on it\r\n      middleware?.onClean(() => {\r\n        player.remove();\r\n      });\r\n    }\r\n\r\n    return player;\r\n  }\r\n\r\n  private onPlayerLoaded = (reqId: number, frameCount: number, fps: number) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onPlayerLoaded on destroyed player:', reqId, frameCount);\r\n      return;\r\n    }\r\n\r\n    this.log.debug('onPlayerLoaded');\r\n    player.onLoad(frameCount, fps);\r\n  };\r\n\r\n  private onFrame = (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onFrame on destroyed player:', reqId, frameNo);\r\n      return;\r\n    }\r\n\r\n    if(player.clamped !== undefined && frame instanceof Uint8ClampedArray) {\r\n      player.clamped = frame;\r\n    }\r\n\r\n    player.renderFrame(frame, frameNo);\r\n  };\r\n\r\n  private onPlayerError = (reqId: number, error: Error) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      return;\r\n    }\r\n\r\n    // ! will need refactoring later, this is not the best way to remove the animation\r\n    const animations = animationIntersector.getAnimations(player.el[0]);\r\n    animations.forEach((animation) => {\r\n      animationIntersector.removeAnimation(animation);\r\n    });\r\n  };\r\n\r\n  public onDestroy(reqId: number) {\r\n    delete this.players[reqId];\r\n  }\r\n\r\n  public destroyWorkers() {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.workers.forEach((worker, idx) => {\r\n      worker.terminate();\r\n      this.log('worker #' + idx + ' terminated');\r\n    });\r\n\r\n    this.log('workers destroyed');\r\n    this.workers.length = 0;\r\n    this.curWorkerNum = 0;\r\n    this.loaded = false;\r\n    this.loadPromise = undefined;\r\n  }\r\n\r\n  private initPlayer(el: RLottiePlayer['el'], options: RLottieOptions) {\r\n    const player = new RLottiePlayer({\r\n      el,\r\n      worker: this.workers[this.curWorkerNum++],\r\n      options\r\n    });\r\n\r\n    const {reqId, cacheName} = player;\r\n    this.players[reqId] = player;\r\n\r\n    const playersByCacheName = cacheName ? this.playersByCacheName[cacheName] ??= new Set() : undefined;\r\n    if(cacheName) {\r\n      playersByCacheName.add(player);\r\n    }\r\n\r\n    if(this.curWorkerNum >= this.workers.length) {\r\n      this.curWorkerNum = 0;\r\n    }\r\n\r\n    player.addEventListener('destroy', () => {\r\n      this.onDestroy(reqId);\r\n      if(playersByCacheName.delete(player) && !playersByCacheName.size) {\r\n        delete this.playersByCacheName[cacheName];\r\n      }\r\n    });\r\n\r\n    player.loadFromData(options.animationData);\r\n\r\n    return player;\r\n  }\r\n}\r\n\r\nconst lottieLoader = new LottieLoader();\r\nMOUNT_CLASS_TO.lottieLoader = lottieLoader;\r\nexport default lottieLoader;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport indexOfAndSplice from './array/indexOfAndSplice';\r\nimport makeError from './makeError';\r\n\r\nexport type Middleware = {\r\n  (): boolean;\r\n  create(): MiddlewareHelper;\r\n  onClean: (callback: VoidFunction) => void;\r\n  onDestroy: (callback: VoidFunction) => void;\r\n};\r\n\r\nconst createDetails = (): {\r\n  cleaned?: boolean,\r\n  inner: MiddlewareHelper[],\r\n  onCleanCallbacks: VoidFunction[],\r\n  middleware?: Middleware\r\n} => ({\r\n  cleaned: false,\r\n  inner: [],\r\n  onCleanCallbacks: []\r\n});\r\n\r\nconst MIDDLEWARE_ERROR = makeError('MIDDLEWARE');\r\n\r\n// * onClean == cancel promises, etc\r\n// * onDestroy == destructor\r\nexport class MiddlewareHelper {\r\n  private details = createDetails();\r\n  private onDestroyCallbacks: VoidFunction[] = [];\r\n  private parent: MiddlewareHelper;\r\n  private destroyed: boolean;\r\n\r\n  public clean() {\r\n    const details = this.details;\r\n    details.cleaned = true;\r\n    details.inner.splice(0, details.inner.length).forEach((helper) => helper.destroy());\r\n    details.onCleanCallbacks.splice(0, details.onCleanCallbacks.length).forEach((callback) => callback());\r\n    details.middleware = undefined;\r\n    this.details = createDetails();\r\n  }\r\n\r\n  public destroy() {\r\n    this.destroyed = true;\r\n    this.clean();\r\n    this.onDestroyCallbacks.splice(0, this.onDestroyCallbacks.length).forEach((callback) => callback());\r\n\r\n    if(this.parent) {\r\n      indexOfAndSplice(this.parent.details.inner, this);\r\n      this.parent = undefined;\r\n    }\r\n  }\r\n\r\n  private createMiddlewareForDetails(details: ReturnType<typeof createDetails>, additionalCallback?: () => boolean) {\r\n    const middleware: Middleware = () => {\r\n      return !details.cleaned && (!additionalCallback || additionalCallback());\r\n    };\r\n\r\n    middleware.create = () => {\r\n      if(!middleware()) throw MIDDLEWARE_ERROR;\r\n      const helper = getMiddleware();\r\n      helper.parent = this;\r\n      details.inner.push(helper);\r\n      return helper;\r\n    };\r\n\r\n    middleware.onClean = (callback) => {\r\n      if(!middleware()) return callback();\r\n      details.onCleanCallbacks.push(callback);\r\n    };\r\n\r\n    middleware.onDestroy = this.onDestroy;\r\n\r\n    return middleware;\r\n  }\r\n\r\n  public get(additionalCallback?: () => boolean) {\r\n    const details = this.details;\r\n    if(details.cleaned) {\r\n      return this.createMiddlewareForDetails(details);\r\n    }\r\n\r\n    if(additionalCallback) {\r\n      return this.createMiddlewareForDetails(details, additionalCallback);\r\n    }\r\n\r\n    return details.middleware ??= this.createMiddlewareForDetails(details);\r\n  }\r\n\r\n  public onDestroy = (callback: VoidFunction) => {\r\n    if(this.destroyed) return callback();\r\n    this.onDestroyCallbacks.push(callback);\r\n  };\r\n}\r\n\r\n// * will change .cleaned and new instance will be created\r\nexport function getMiddleware() {\r\n  return new MiddlewareHelper();\r\n}\r\n","// * Jolly Cobra's schedulers\r\n\r\nimport {AnyToVoidFunction} from '../../types';\r\nimport {fastRaf} from '../schedulers';\r\nimport throttleWith from './throttleWith';\r\n\r\nexport default function throttleWithRaf<F extends AnyToVoidFunction>(fn: F) {\r\n  return throttleWith(fastRaf, fn);\r\n}\r\n","import {createSignal, Setter} from 'solid-js';\r\n\r\n/**\r\n * do not use getter in JSX\r\n */\r\nexport default function createUnifiedSignal<T = any>(...args: Partial<Parameters<typeof createSignal<T>>>) {\r\n  const [getter, setter] = createSignal<T>(...args);\r\n  return <A extends Parameters<Setter<T>>>(...args: Partial<A>) => {\r\n    // @ts-ignore\r\n    if(args.length === 0) {\r\n      return getter();\r\n    }\r\n\r\n    // @ts-ignore\r\n    return setter(...args);\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_WORKER} from './context';\r\nimport createUnifiedSignal from './solid/createUnifiedSignal';\r\n\r\nexport class WindowSize {\r\n  private _width: ReturnType<typeof createUnifiedSignal<number>>;\r\n  private _height: ReturnType<typeof createUnifiedSignal<number>>;\r\n  // private rAF: number;\r\n  private viewport: VisualViewport | Window;\r\n\r\n  constructor() {\r\n    if(IS_WORKER) {\r\n      return;\r\n    }\r\n\r\n    this._width = createUnifiedSignal();\r\n    this._height = createUnifiedSignal();\r\n\r\n    this.viewport = /* 'visualViewport' in window ? window.visualViewport :  */window;\r\n    const set = () => {\r\n      this.setDimensions();\r\n\r\n      // if(this.width === undefined) {\r\n      //   this.setDimensions();\r\n      //   return;\r\n      // }\r\n\r\n      // if(this.rAF) window.cancelAnimationFrame(this.rAF);\r\n      // this.rAF = window.requestAnimationFrame(() => {\r\n      //   this.rAF = 0;\r\n\r\n      //   batch(() => {\r\n      //     this.setDimensions();\r\n      //   });\r\n      // });\r\n    };\r\n    this.viewport.addEventListener('resize', set);\r\n    set();\r\n  }\r\n\r\n  private setDimensions() {\r\n    const w = this.viewport;\r\n    this._width((w as VisualViewport).width || (w as Window).innerWidth);\r\n    this._height((w as VisualViewport).height || (w as Window).innerHeight);\r\n  }\r\n\r\n  public get width() {\r\n    return this._width();\r\n  }\r\n\r\n  public get height() {\r\n    return this._height();\r\n  }\r\n}\r\n\r\nconst windowSize = new WindowSize();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.windowSize = windowSize);\r\nexport default windowSize;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport isInDOM from '../../helpers/dom/isInDOM';\r\nimport makeError from '../../helpers/makeError';\r\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\r\nimport throttleWithRaf from '../../helpers/schedulers/throttleWithRaf';\r\nimport windowSize from '../../helpers/windowSize';\r\nimport {PhotoSize, VideoSize} from '../../layer';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport Scrollable from '../scrollable';\r\nimport wrapSticker from './sticker';\r\n\r\nexport const emojiAnimationContainer = document.createElement('div');\r\nemojiAnimationContainer.classList.add('emoji-animation-container');\r\n\r\nconst NO_UNMOUNT = false;\r\n\r\nexport default function wrapStickerAnimation({\r\n  size,\r\n  stickerSize,\r\n  doc,\r\n  middleware,\r\n  target,\r\n  side,\r\n  skipRatio,\r\n  play,\r\n  managers,\r\n  fullThumb,\r\n  withRandomOffset,\r\n  relativeEffect,\r\n  loopEffect,\r\n  onUnmount,\r\n  scrollable,\r\n  textColor,\r\n  addOffsetX: _addOffsetX = 0,\r\n  addOffsetY: _addOffsetY = 0\r\n}: {\r\n  size: number,\r\n  stickerSize?: number,\r\n  doc: MyDocument,\r\n  middleware?: Middleware,\r\n  target: HTMLElement,\r\n  side: 'left' | 'center' | 'right',\r\n  skipRatio?: number,\r\n  play: boolean,\r\n  managers?: AppManagers,\r\n  fullThumb?: PhotoSize | Extract<VideoSize, VideoSize.videoSize>,\r\n  withRandomOffset?: boolean,\r\n  relativeEffect?: boolean,\r\n  loopEffect?: boolean,\r\n  onUnmount?: () => void,\r\n  scrollable?: Scrollable,\r\n  textColor?: string,\r\n  addOffsetX?: number,\r\n  addOffsetY?: number\r\n}) {\r\n  const animationDiv = document.createElement('div');\r\n  animationDiv.classList.add('emoji-animation');\r\n\r\n  // const size = 280;\r\n  animationDiv.style.width = size + 'px';\r\n  animationDiv.style.height = size + 'px';\r\n\r\n  let animation: RLottiePlayer;\r\n  const unmountAnimation = () => {\r\n    if(NO_UNMOUNT) {\r\n      return;\r\n    }\r\n\r\n    middlewareHelper.destroy();\r\n    const a = animation;\r\n    animation = undefined;\r\n    a?.remove();\r\n    animationDiv.remove();\r\n    onScroll && scrollable.container.removeEventListener('scroll', onScroll);\r\n    if(a) {\r\n      onUnmount?.();\r\n    }\r\n  };\r\n\r\n  const middlewareHelper = middleware?.create() ?? getMiddleware();\r\n  middleware = middlewareHelper.get();\r\n\r\n  const stickerPromise = wrapSticker({\r\n    div: animationDiv,\r\n    doc,\r\n    middleware,\r\n    withThumb: false,\r\n    needFadeIn: false,\r\n    loop: !!loopEffect,\r\n    width: stickerSize || size,\r\n    height: stickerSize || size,\r\n    play,\r\n    group: 'none',\r\n    skipRatio,\r\n    managers,\r\n    fullThumb,\r\n    isEffect: true,\r\n    textColor\r\n  }).then(({render}) => render).then((_animation) => {\r\n    assumeType<RLottiePlayer>(_animation);\r\n    if(!middleware()) {\r\n      _animation.remove();\r\n      throw makeError('MIDDLEWARE');\r\n    }\r\n\r\n    animation = _animation;\r\n    animation.addEventListener('enterFrame', (frameNo) => {\r\n      if((!loopEffect && frameNo === animation.maxFrame) || !isInDOM(target)) {\r\n        unmountAnimation();\r\n      }\r\n    });\r\n\r\n    animation.addEventListener('destroy', unmountAnimation);\r\n\r\n    if(IS_VIBRATE_SUPPORTED) {\r\n      animation.addEventListener('firstFrame', () => {\r\n        navigator.vibrate(100);\r\n      }, {once: true});\r\n    }\r\n\r\n    animation.addEventListener('firstFrame', () => {\r\n      setPosition();\r\n    }, {once: true});\r\n\r\n    return animation;\r\n  });\r\n\r\n  const generateRandomSigned = (max: number) => {\r\n    const r = Math.random() * max * 2;\r\n    return r > max ? -r % max : r;\r\n  };\r\n\r\n  const randomOffsetX = withRandomOffset ? generateRandomSigned(16) : 0;\r\n  const randomOffsetY = withRandomOffset ? generateRandomSigned(4) : 0;\r\n  const setPosition = () => {\r\n    if(!isInDOM(target)) {\r\n      unmountAnimation();\r\n      return;\r\n    }\r\n\r\n    const rect = target.getBoundingClientRect();\r\n\r\n    const factor = rect.width / 200;\r\n    const stableOffsetX = side === 'center' ? 0 : 16 * (side === 'right' ? 1 : -1) * factor;\r\n    // const stableOffsetY = side === 'center' ? 0 : -50 * factor;\r\n    const stableOffsetY = side === 'center' ? 0 : 0 * factor;\r\n\r\n    const rectX = side === 'right' ? rect.right : rect.left;\r\n    const rectY = rect.top;\r\n\r\n    const addOffsetX = (side === 'center' ? (rect.width - size) / 2 : (side === 'right' ? -size : 0)) + stableOffsetX + randomOffsetX + _addOffsetX * (side === 'right' ? 1 : -1);\r\n    const addOffsetY = (side === 'center' || true ? (rect.height - size) / 2 : 0) + stableOffsetY + randomOffsetY + _addOffsetY;\r\n    const x = rectX + addOffsetX;\r\n    const y = rectY + addOffsetY;\r\n\r\n    if(y <= -size || y >= windowSize.height) {\r\n      unmountAnimation();\r\n      return;\r\n    }\r\n\r\n    if(relativeEffect) {\r\n      if(side !== 'center') animationDiv.style[side] = Math.abs(stableOffsetX) * -1 + 'px';\r\n      else animationDiv.style.left = addOffsetX + 'px';\r\n      animationDiv.style.top = addOffsetY + 'px';\r\n    } else {\r\n      animationDiv.style.top = y + 'px';\r\n      animationDiv.style.left = x + 'px';\r\n    }\r\n  };\r\n\r\n  let onScroll: () => void;\r\n  if(scrollable) {\r\n    onScroll = throttleWithRaf(setPosition);\r\n    scrollable.container.addEventListener('scroll', onScroll);\r\n  }\r\n\r\n  // setPosition();\r\n\r\n  if(relativeEffect) {\r\n    animationDiv.classList.add('is-relative');\r\n    target.parentElement.append(animationDiv);\r\n  } else {\r\n    emojiAnimationContainer.append(animationDiv);\r\n  }\r\n\r\n  return {animationDiv, stickerPromise};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport type LiteModeKey = 'all' | 'gif' | 'video' |\r\n  'emoji' | 'emoji_panel' | 'emoji_messages' |\r\n  'effects' | 'effects_reactions' | 'effects_premiumstickers' | 'effects_emoji' |\r\n  'stickers' | 'stickers_panel' | 'stickers_chat' |\r\n  'chat' | 'chat_background' | 'chat_spoilers' | 'animations';\r\n\r\nexport class LiteMode {\r\n  public isEnabled() {\r\n    return !!(rootScope.settings && rootScope.settings.liteMode.all);\r\n  }\r\n\r\n  public isAvailable(key: LiteModeKey) {\r\n    return !!(rootScope.settings && !rootScope.settings.liteMode.all && !rootScope.settings.liteMode[key]);\r\n  }\r\n}\r\n\r\nconst liteMode = new LiteMode();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.liteMode = liteMode);\r\nexport default liteMode;\r\n","const Icons = {\r\n  check: 'e900',\r\n  checks: 'e901',\r\n  activesessions: 'e902',\r\n  add: 'e903',\r\n  add_reaction: 'e904',\r\n  addboost: 'e905',\r\n  addmember_filled: 'e906',\r\n  adduser: 'e907',\r\n  admin: 'e908',\r\n  ads: 'e909',\r\n  align_center: 'e90a',\r\n  align_left: 'e90b',\r\n  align_right: 'e90c',\r\n  animals: 'e90d',\r\n  animations: 'e90e',\r\n  app_expand: 'e90f',\r\n  app_shrink: 'e910',\r\n  archive: 'e911',\r\n  arrow_down: 'e912',\r\n  arrow_next: 'e913',\r\n  arrow_prev: 'e914',\r\n  arrowcircle: 'e915',\r\n  arrowhead: 'e916',\r\n  attach: 'e917',\r\n  audio_repeat: 'e918',\r\n  audio_repeat_single: 'e919',\r\n  author_hidden: 'e91a',\r\n  avatarnext: 'e91b',\r\n  avatarprevious: 'e91c',\r\n  aversion: 'e91d',\r\n  back: 'e91e',\r\n  binfilled: 'e91f',\r\n  bold: 'e920',\r\n  bomb: 'e921',\r\n  boost: 'e922',\r\n  boostcircle: 'e923',\r\n  bot_filled: 'e924',\r\n  botcom: 'e925',\r\n  bots: 'e926',\r\n  brightness: 'e927',\r\n  brush: 'e928',\r\n  bubblereply: 'e929',\r\n  bug: 'e92a',\r\n  calendar: 'e92b',\r\n  calendarfilter: 'e92c',\r\n  camera: 'e92d',\r\n  cameraadd: 'e92e',\r\n  captiondown: 'e92f',\r\n  captionup: 'e930',\r\n  car: 'e931',\r\n  card: 'e932',\r\n  card_outline: 'e933',\r\n  cash_circle: 'e934',\r\n  channel: 'e935',\r\n  channel_filled: 'e936',\r\n  channelviews: 'e937',\r\n  chatspinned: 'e938',\r\n  chatsplaceholder: 'e939',\r\n  check1: 'e93a',\r\n  checkbox: 'e93b',\r\n  checkboxblock: 'e93c',\r\n  checkboxempty: 'e93d',\r\n  checkboxon: 'e93e',\r\n  checkretract: 'e93f',\r\n  checkround: 'e940',\r\n  checkround_filled: 'e941',\r\n  clock: 'e942',\r\n  close: 'e943',\r\n  clouddownload: 'e944',\r\n  collapse: 'e945',\r\n  colorize: 'e946',\r\n  comments: 'e947',\r\n  commentssticker: 'e948',\r\n  contrast: 'e949',\r\n  copy: 'e94a',\r\n  crop: 'e94b',\r\n  cross: 'e94c',\r\n  crossgif: 'e94d',\r\n  crossround: 'e94e',\r\n  crossstar: 'e94f',\r\n  darkmode: 'e950',\r\n  data: 'e951',\r\n  delete: 'e952',\r\n  delete_filled: 'e953',\r\n  deletedaccount: 'e954',\r\n  deleteleft: 'e955',\r\n  deleteuser: 'e956',\r\n  devices: 'e957',\r\n  document: 'e958',\r\n  down: 'e959',\r\n  download: 'e95a',\r\n  dragfiles: 'e95b',\r\n  dragmedia: 'e95c',\r\n  eats: 'e95d',\r\n  edit: 'e95e',\r\n  email: 'e95f',\r\n  endcall_filled: 'e960',\r\n  enhance: 'e961',\r\n  enter: 'e962',\r\n  equalizer: 'e963',\r\n  expand: 'e964',\r\n  eye: 'e965',\r\n  eye1: 'e966',\r\n  eye2: 'e967',\r\n  eyecross_outline: 'e968',\r\n  factcheck: 'e969',\r\n  fade: 'e96a',\r\n  fast_forward: 'e96b',\r\n  fast_rewind: 'e96c',\r\n  favourites: 'e96d',\r\n  flag: 'e96e',\r\n  flip: 'e96f',\r\n  flip_image_horizontal: 'e970',\r\n  folder: 'e971',\r\n  fontframe: 'e972',\r\n  fontframe_bg: 'e973',\r\n  fontframe_outline: 'e974',\r\n  fontsize: 'e975',\r\n  forward: 'e976',\r\n  forward_filled: 'e977',\r\n  free_transform: 'e978',\r\n  fullscreen: 'e979',\r\n  gc_microphone: 'e97a',\r\n  gc_microphoneoff: 'e97b',\r\n  geometric_digit_0: 'e97c',\r\n  geometric_digit_1: 'e97d',\r\n  geometric_digit_2: 'e97e',\r\n  geometric_digit_3: 'e97f',\r\n  geometric_digit_4: 'e980',\r\n  geometric_digit_5: 'e981',\r\n  geometric_digit_6: 'e982',\r\n  geometric_digit_7: 'e983',\r\n  geometric_digit_8: 'e984',\r\n  geometric_digit_9: 'e985',\r\n  geometric_dot: 'e986',\r\n  geometric_letter_x: 'e987',\r\n  gifs: 'e988',\r\n  gift: 'e989',\r\n  gift_premium: 'e98a',\r\n  grain: 'e98b',\r\n  group: 'e98c',\r\n  group_filled: 'e98d',\r\n  groupmedia: 'e98e',\r\n  groupmediaoff: 'e98f',\r\n  hand: 'e990',\r\n  help: 'e991',\r\n  hide: 'e992',\r\n  highlights: 'e993',\r\n  image: 'e994',\r\n  image_original: 'e995',\r\n  info: 'e996',\r\n  info2: 'e997',\r\n  italic: 'e998',\r\n  key: 'e999',\r\n  keyboard: 'e99a',\r\n  lamp: 'e99b',\r\n  language: 'e99c',\r\n  largepause: 'e99d',\r\n  largeplay: 'e99e',\r\n  left: 'e99f',\r\n  limit_chat: 'e9a0',\r\n  limit_chats: 'e9a1',\r\n  limit_file: 'e9a2',\r\n  limit_folders: 'e9a3',\r\n  limit_link: 'e9a4',\r\n  limit_pin: 'e9a5',\r\n  link: 'e9a6',\r\n  link_paid: 'e9a7',\r\n  list: 'e9a8',\r\n  listscreenshare: 'e9a9',\r\n  livelocation: 'e9aa',\r\n  location: 'e9ab',\r\n  lock: 'e9ac',\r\n  lockoff: 'e9ad',\r\n  loginlogodesktop: 'e9ae',\r\n  loginlogomobile: 'e9af',\r\n  logout: 'e9b0',\r\n  mac_command_key: 'e9b1',\r\n  mediaspeed_empty: 'e9b2',\r\n  mediaspoiler: 'e9b3',\r\n  mediaspoileroff: 'e9b4',\r\n  mention: 'e9b5',\r\n  menu: 'e9b6',\r\n  message: 'e9b7',\r\n  message_jump: 'e9b8',\r\n  message_quote: 'e9b9',\r\n  messageunread: 'e9ba',\r\n  microphone: 'e9bb',\r\n  microphone_crossed: 'e9bc',\r\n  microphone_crossed_filled: 'e9bd',\r\n  microphone_filled: 'e9be',\r\n  minus: 'e9bf',\r\n  monospace: 'e9c0',\r\n  more: 'e9c1',\r\n  multistories: 'e9c2',\r\n  mute: 'e9c3',\r\n  muted: 'e9c4',\r\n  mynotes: 'e9c5',\r\n  newchannel: 'e9c6',\r\n  newchannel_filled: 'e9c7',\r\n  newchat_filled: 'e9c8',\r\n  newgroup: 'e9c9',\r\n  newgroup_filled: 'e9ca',\r\n  newprivate: 'e9cb',\r\n  newprivate_filled: 'e9cc',\r\n  newtab: 'e9cd',\r\n  next: 'e9ce',\r\n  nochannel: 'e9cf',\r\n  noncontacts: 'e9d0',\r\n  nosound: 'e9d1',\r\n  online: 'e9d2',\r\n  passwordoff: 'e9d3',\r\n  pause: 'e9d4',\r\n  permissions: 'e9d5',\r\n  person: 'e9d6',\r\n  phone: 'e9d7',\r\n  phone_filled: 'e9d8',\r\n  pin: 'e9d9',\r\n  pin2: 'e9da',\r\n  pinlist: 'e9db',\r\n  pinned_filled: 'e9dc',\r\n  pinnedchat: 'e9dd',\r\n  pip: 'e9de',\r\n  play: 'e9df',\r\n  playback_05: 'e9e0',\r\n  playback_15: 'e9e1',\r\n  playback_1x: 'e9e2',\r\n  playback_2x: 'e9e3',\r\n  plus: 'e9e4',\r\n  plusround: 'e9e5',\r\n  poll: 'e9e6',\r\n  premium_addone: 'e9e7',\r\n  premium_avatars: 'e9e8',\r\n  premium_badge: 'e9e9',\r\n  premium_colors: 'e9ea',\r\n  premium_double: 'e9eb',\r\n  premium_emoji: 'e9ec',\r\n  premium_filesize: 'e9ed',\r\n  premium_lastseen: 'e9ee',\r\n  premium_limits: 'e9ef',\r\n  premium_lock: 'e9f0',\r\n  premium_management: 'e9f1',\r\n  premium_noads: 'e9f2',\r\n  premium_privacy: 'e9f3',\r\n  premium_reactions: 'e9f4',\r\n  premium_restrict: 'e9f5',\r\n  premium_speed: 'e9f6',\r\n  premium_status: 'e9f7',\r\n  premium_stickers: 'e9f8',\r\n  premium_tags: 'e9f9',\r\n  premium_transcription: 'e9fa',\r\n  premium_translate: 'e9fb',\r\n  premium_unlock: 'e9fc',\r\n  premium_wallpaper: 'e9fd',\r\n  previous: 'e9fe',\r\n  promote: 'e9ff',\r\n  quote: 'ea00',\r\n  quote_outline: 'ea01',\r\n  radiooff: 'ea02',\r\n  radioon: 'ea03',\r\n  reactions: 'ea04',\r\n  reactions_filled: 'ea05',\r\n  readchats: 'ea06',\r\n  recent: 'ea07',\r\n  redo: 'ea08',\r\n  replace: 'ea09',\r\n  reply: 'ea0a',\r\n  reply_filled: 'ea0b',\r\n  restrict: 'ea0c',\r\n  revenue: 'ea0d',\r\n  rightpanel: 'ea0e',\r\n  rotate: 'ea0f',\r\n  rotate_left: 'ea10',\r\n  rotate_right: 'ea11',\r\n  round_chats_filled: 'ea12',\r\n  saturation: 'ea13',\r\n  saved: 'ea14',\r\n  savedmessages: 'ea15',\r\n  schedule: 'ea16',\r\n  scheduled: 'ea17',\r\n  search: 'ea18',\r\n  select: 'ea19',\r\n  send: 'ea1a',\r\n  send2: 'ea1b',\r\n  sending: 'ea1c',\r\n  sendingerror: 'ea1d',\r\n  settings: 'ea1e',\r\n  settings_clipped_corner: 'ea1f',\r\n  settings_filled: 'ea20',\r\n  shadows: 'ea21',\r\n  sharescreen_filled: 'ea22',\r\n  sharpen: 'ea23',\r\n  shipping: 'ea24',\r\n  shuffle: 'ea25',\r\n  smallscreen: 'ea26',\r\n  smile: 'ea27',\r\n  speaker: 'ea28',\r\n  speakerfilled: 'ea29',\r\n  speakeroff: 'ea2a',\r\n  speakerofffilled: 'ea2b',\r\n  spoiler: 'ea2c',\r\n  sport: 'ea2d',\r\n  star: 'ea2e',\r\n  star_filled: 'ea2f',\r\n  statistics: 'ea30',\r\n  stickers: 'ea31',\r\n  stickers_face: 'ea32',\r\n  stop: 'ea33',\r\n  stories: 'ea34',\r\n  storyreply: 'ea35',\r\n  storyrepost: 'ea36',\r\n  strikethrough: 'ea37',\r\n  tag: 'ea38',\r\n  tag_add: 'ea39',\r\n  tag_crossed: 'ea3a',\r\n  tag_filter: 'ea3b',\r\n  tag_name: 'ea3c',\r\n  text: 'ea3d',\r\n  textedit: 'ea3e',\r\n  timer: 'ea3f',\r\n  tip: 'ea40',\r\n  tools: 'ea41',\r\n  topics: 'ea42',\r\n  transcribe: 'ea43',\r\n  unarchive: 'ea44',\r\n  unclaimed: 'ea45',\r\n  underline: 'ea46',\r\n  undo: 'ea47',\r\n  unmute: 'ea48',\r\n  unpin: 'ea49',\r\n  unread: 'ea4a',\r\n  up: 'ea4b',\r\n  user: 'ea4c',\r\n  username: 'ea4d',\r\n  videocamera: 'ea4e',\r\n  videocamera_crossed_filled: 'ea4f',\r\n  videocamera_filled: 'ea50',\r\n  videochat: 'ea51',\r\n  vignette: 'ea52',\r\n  volume_down: 'ea53',\r\n  volume_mute: 'ea54',\r\n  volume_off: 'ea55',\r\n  volume_up: 'ea56',\r\n  warmth: 'ea57',\r\n  webview: 'ea58',\r\n  win_key: 'ea59',\r\n  zoomin: 'ea5a',\r\n  zoomout: 'ea5b'\r\n};\r\n\r\nexport default Icons;\r\n","const IconsReverse = new Set<Icon>([\r\n  'avatarnext',\r\n  'avatarprevious',\r\n  'arrow_next',\r\n  'channel',\r\n  'chatspinned',\r\n  'fast_forward',\r\n  'fast_rewind',\r\n  'forward',\r\n  'forward_filled',\r\n  'group',\r\n  'group_filled',\r\n  'left',\r\n  'listscreenshare',\r\n  'logout',\r\n  'muted',\r\n  'newchannel_filled',\r\n  'newchannel',\r\n  'newgroup',\r\n  'newgroup_filled',\r\n  'next',\r\n  'nosound',\r\n  'previous',\r\n  'send',\r\n  'send2',\r\n  'reply',\r\n  'reply_filled',\r\n  'sharescreen_filled',\r\n  'transcribe',\r\n  'storyreply',\r\n  'premium_noads',\r\n  'topics',\r\n  'pinlist',\r\n  'deleteleft'\r\n]);\r\n\r\nexport default IconsReverse;\r\n","import {TGICO_CLASS} from '../helpers/tgico';\r\nimport Icons from '../icons';\r\nimport IconsReverse from '../iconsReverse';\r\nimport I18n from '../lib/langPack';\r\n\r\nexport function getIconContent(icon: Icon) {\r\n  return String.fromCharCode(parseInt(Icons[icon], 16));\r\n}\r\n\r\nexport default function Icon(icon: Icon, ...classes: string[]) {\r\n  const span = document.createElement('span');\r\n  if(I18n.isRTL && IconsReverse.has(icon)) {\r\n    classes.push('icon-reflect');\r\n  }\r\n\r\n  span.classList.add(TGICO_CLASS/* ...tgico(icon) */, ...classes);\r\n  span.textContent = getIconContent(icon);\r\n  return span;\r\n}\r\n","export default function setCurrentTime(media: HTMLMediaElement, currentTime: number) {\r\n  media.isSeeking = true;\r\n  media.currentTime = currentTime;\r\n}\r\n","import {IS_CHROMIUM} from '../../environment/userAgent';\r\nimport deferredPromise from '../cancellablePromise';\r\nimport noop from '../noop';\r\nimport deepEqual from '../object/deepEqual';\r\nimport onMediaLoad from '../onMediaLoad';\r\nimport safePlay from './safePlay';\r\nimport setCurrentTime from './setCurrentTime';\r\n\r\nconst USE_FIX = IS_CHROMIUM;\r\n\r\nexport const SHOULD_HANDLE_VIDEO_LEAK = USE_FIX;\r\n\r\nexport async function onVideoLeak(video: HTMLVideoElement) {\r\n  // console.error('video is stuck', video.src, video, video.paused, videoPlaybackQuality);\r\n  const firstElementChild = video.firstElementChild as HTMLSourceElement;\r\n  if(!firstElementChild) {\r\n    video.src = '';\r\n    video.load();\r\n    throw new Error('leak');\r\n  }\r\n\r\n  const paused = video.paused;\r\n  firstElementChild.remove();\r\n  video.load();\r\n\r\n  if(!video.childElementCount && !video.src) {\r\n    throw new Error('leak');\r\n  }\r\n\r\n  if(!paused) safePlay(video);\r\n  else setCurrentTime(video, 0.0001);\r\n\r\n  return handleVideoLeak(video, onMediaLoad(video));\r\n}\r\n\r\nexport async function testVideoLeak(\r\n  video: HTMLVideoElement,\r\n  isLeak = !video.getVideoPlaybackQuality().totalVideoFrames\r\n) {\r\n  if(!isLeak) {\r\n    return;\r\n  }\r\n\r\n  return onVideoLeak(video);\r\n}\r\n\r\n// * fix new memory leak of chrome\r\nexport default async function handleVideoLeak(\r\n  video: HTMLVideoElement,\r\n  loadPromise?: Promise<any>\r\n) {\r\n  if(!USE_FIX) {\r\n    return loadPromise;\r\n  }\r\n\r\n  const bindPromise = (promise: Promise<any>) => {\r\n    promise.then(\r\n      deferred.resolve.bind(deferred),\r\n      deferred.reject.bind(deferred)\r\n    );\r\n  };\r\n\r\n  const onTimeUpdate = () => bindPromise(testVideoLeak(video));\r\n\r\n  const deferred = deferredPromise<void>();\r\n  try {\r\n    await loadPromise;\r\n  } catch(err) {\r\n    onTimeUpdate();\r\n    return;\r\n  }\r\n\r\n  if(\r\n    video.getVideoPlaybackQuality().totalVideoFrames ||\r\n    video.readyState > video.HAVE_METADATA // * video can lose metadata on timeupdate if has no next chunk\r\n  ) {\r\n    deferred.resolve();\r\n    return;\r\n  }\r\n\r\n  video.addEventListener('timeupdate', onTimeUpdate, {once: true});\r\n  return deferred;\r\n}\r\n\r\nconst eventsOrder = [\r\n  // 'timeupdate',\r\n  'seeked',\r\n  'canplay',\r\n  'canplaythrough',\r\n  'seeking'\r\n  // 'play'\r\n];\r\nconst eventsOrderLength = eventsOrder.length;\r\n\r\nconst sawEvents = new WeakMap<HTMLElement, {events: Set<string>}>();\r\nexport const leakVideoFallbacks = new WeakMap<HTMLElement, () => void>();\r\n\r\nfunction onVideoLeakListener(e: Event) {\r\n  const {type, target} = e;\r\n  if(\r\n    !(target instanceof HTMLVideoElement) ||\r\n    target.readyState > target.HAVE_METADATA ||\r\n    target.isSeeking ||\r\n    target.ignoreLeak\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  // const needLog = target.parentElement.dataset.docId === '';\r\n  // if(needLog) {\r\n  //   console.log('video event', event/* , target */, target.currentTime, target.duration);\r\n  // }\r\n\r\n  let cache = sawEvents.get(target);\r\n  if(!cache) {\r\n    sawEvents.set(target, cache = {events: new Set()});\r\n  }\r\n\r\n  if(cache.events.has(type)) {\r\n    return;\r\n  }\r\n\r\n  cache.events.add(type);\r\n\r\n  if(cache.events.size === eventsOrderLength/*  && event == eventsOrder[eventsOrderLength - 1] */) {\r\n    const events = Array.from(cache.events);\r\n    const index = eventsOrder.indexOf(events[0]);\r\n    const normalized = eventsOrder.slice(index).concat(eventsOrder.slice(0, index));\r\n    if(!deepEqual(events, normalized)) {\r\n      return;\r\n    }\r\n\r\n    // console.log('bad video', target.currentTime, target.duration);\r\n\r\n    const fallbackCallback = leakVideoFallbacks.get(target);\r\n    if(fallbackCallback) {\r\n      fallbackCallback();\r\n      leakVideoFallbacks.delete(target);\r\n    } else {\r\n      onVideoLeak(target).catch(noop);\r\n    }\r\n  }\r\n\r\n  // const lastEvent = sawEvents.get(target);\r\n  // if(!lastEvent) {\r\n  //   if(eventsOrder[0] === event) {\r\n  //     sawEvents.set(target, event);\r\n  //   }\r\n  // } else if(lastEvent !== event) {\r\n  //   const lastEventIndex = eventsOrder.indexOf(lastEvent);\r\n  //   const shouldBeEvent = eventsOrder[lastEventIndex + 1];\r\n  //   if(shouldBeEvent === event) { // save event for next check\r\n  //     sawEvents.set(target, event);\r\n  //   } else if(!shouldBeEvent) { // saw all events\r\n  //     onVideoLeak(target).catch(noop);\r\n  //   } else { // wrong event\r\n  //     sawEvents.delete(target);\r\n  //   }\r\n  // }\r\n}\r\n\r\nfunction attachVideoLeakListener(element: HTMLElement | Document, event: string) {\r\n  element.addEventListener(event, onVideoLeakListener, true);\r\n  return () => element.removeEventListener(event, onVideoLeakListener, true);\r\n}\r\n\r\nexport function attachVideoLeakListeners(element: HTMLElement | Document) {\r\n  if(!USE_FIX) {\r\n    return;\r\n  }\r\n\r\n  const callbacks = eventsOrder.map((event) => {\r\n    return attachVideoLeakListener(element, event);\r\n  });\r\n\r\n  return () => {\r\n    callbacks.forEach((callback) => callback());\r\n  };\r\n}\r\n\r\nattachVideoLeakListeners(document);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport type {ThumbCache} from '../../lib/storages/thumbs';\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport IS_WEBP_SUPPORTED from '../../environment/webpSupport';\r\nimport getPathFromBytes from '../../helpers/bytes/getPathFromBytes';\r\nimport deferredPromise from '../../helpers/cancellablePromise';\r\nimport computeLockColor from '../../helpers/computeLockColor';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport createVideo from '../../helpers/dom/createVideo';\r\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\r\nimport getImageFromStrippedThumb from '../../helpers/getImageFromStrippedThumb';\r\nimport getPreviewURLFromThumb from '../../helpers/getPreviewURLFromThumb';\r\nimport makeError from '../../helpers/makeError';\r\nimport {makeMediaSize} from '../../helpers/mediaSize';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {Middleware} from '../../helpers/middleware';\r\nimport {isSavingLottiePreview, saveLottiePreview} from '../../helpers/saveLottiePreview';\r\nimport sequentialDom from '../../helpers/sequentialDom';\r\nimport {DocumentAttribute, PhotoSize, VideoSize} from '../../layer';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport rootScope from '../../lib/rootScope';\r\nimport webpWorkerController from '../../lib/webp/webpWorkerController';\r\nimport {Awaited} from '../../types';\r\nimport {getEmojiToneIndex} from '../../vendor/emoji';\r\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport wrapStickerAnimation from './stickerAnimation';\r\nimport framesCache from '../../helpers/framesCache';\r\nimport liteMode, {LiteModeKey} from '../../helpers/liteMode';\r\nimport Scrollable from '../scrollable';\r\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\r\nimport Icon from '../icon';\r\nimport {SHOULD_HANDLE_VIDEO_LEAK, attachVideoLeakListeners, leakVideoFallbacks, onVideoLeak} from '../../helpers/dom/handleVideoLeak';\r\nimport noop from '../../helpers/noop';\r\nimport {IS_WEBM_SUPPORTED} from '../../environment/videoSupport';\r\nimport toArray from '../../helpers/array/toArray';\r\n\r\n// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L40\r\nexport const STICKER_EFFECT_MULTIPLIER = 1 + 0.245 * 2;\r\nconst EMOJI_EFFECT_MULTIPLIER = 3;\r\nconst UNMOUNT_THUMBS = true;\r\n\r\nconst locksUrls: {[docId: string]: string} = {};\r\n\r\nexport const videosCache: {[key: string]: Promise<any>} = {};\r\n\r\nconst onAnimationEnd = (element: HTMLElement, onAnimationEnd: () => void, timeout: number) => {\r\n  const onEnd = () => {\r\n    element.removeEventListener('animationend', onEnd);\r\n    onAnimationEnd();\r\n    clearTimeout(_timeout);\r\n  };\r\n  element.addEventListener('animationend', onEnd);\r\n  const _timeout = setTimeout(onEnd, timeout);\r\n};\r\n\r\nconst isEmptyContainer = (container: HTMLElement) => {\r\n  const childElementCount = container.childElementCount;\r\n  if(!childElementCount) return true;\r\n  const child = container.firstElementChild as HTMLElement;\r\n  return child.classList.contains('premium-sticker-lock') && childElementCount === 1;\r\n};\r\n\r\nconst getThumbFromContainer = (container: HTMLElement) => {\r\n  let element = container.firstElementChild as HTMLElement;\r\n  if(element && element.classList.contains('premium-sticker-lock')) {\r\n    element = element.nextElementSibling as HTMLElement;\r\n  }\r\n\r\n  return element;\r\n};\r\n\r\nexport default async function wrapSticker({doc, div, middleware, loadStickerMiddleware, lazyLoadQueue, exportLoad, group, play, onlyThumb, emoji, width, height, withThumb, loop, loadPromises, needFadeIn, needUpscale, skipRatio, static: asStatic, managers = rootScope.managers, fullThumb, isOut, noPremium, withLock, relativeEffect, loopEffect, isCustomEmoji, syncedVideo, liteModeKey, isEffect, textColor, scrollable, showPremiumInfo, useCache}: {\r\n  doc: MyDocument,\r\n  div: HTMLElement | HTMLElement[],\r\n  middleware?: Middleware,\r\n  loadStickerMiddleware?: Middleware,\r\n  lazyLoadQueue?: LazyLoadQueue,\r\n  exportLoad?: number,\r\n  group?: AnimationItemGroup,\r\n  play?: boolean,\r\n  onlyThumb?: boolean,\r\n  emoji?: string,\r\n  width?: number,\r\n  height?: number,\r\n  withThumb?: boolean,\r\n  loop?: RLottiePlayer['loop'],\r\n  loadPromises?: Promise<any>[],\r\n  needFadeIn?: boolean,\r\n  needUpscale?: boolean,\r\n  skipRatio?: number,\r\n  static?: boolean,\r\n  managers?: AppManagers,\r\n  fullThumb?: PhotoSize | Extract<VideoSize, VideoSize.videoSize>,\r\n  isOut?: boolean,\r\n  noPremium?: boolean,\r\n  withLock?: boolean,\r\n  relativeEffect?: boolean,\r\n  loopEffect?: boolean,\r\n  isCustomEmoji?: boolean,\r\n  syncedVideo?: boolean,\r\n  liteModeKey?: LiteModeKey | false,\r\n  isEffect?: boolean,\r\n  textColor?: WrapSomethingOptions['textColor'],\r\n  scrollable?: Scrollable\r\n  showPremiumInfo?: () => void,\r\n  useCache?: boolean\r\n}) {\r\n  const options = arguments[0];\r\n  div = toArray(div);\r\n\r\n  liteModeKey ??= 'stickers_panel';\r\n\r\n  if(isCustomEmoji) {\r\n    emoji = doc.stickerEmojiRaw;\r\n  }\r\n\r\n  const stickerType = doc.sticker;\r\n  if(stickerType === 1 || (stickerType === 3 && !IS_WEBM_SUPPORTED)) {\r\n    asStatic = true;\r\n  }\r\n\r\n  if(!width && !height) {\r\n    const sizes = mediaSizes.active;\r\n    const boxSize = emoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\r\n    const size = makeMediaSize(doc.w, doc.h).aspectFitted(boxSize);\r\n    width = size.width;\r\n    height = size.height;\r\n  }\r\n\r\n  if(stickerType === 2) {\r\n    // LottieLoader.loadLottie();\r\n    lottieLoader.loadLottieWorkers();\r\n  }\r\n\r\n  loop = !!(!emoji || isCustomEmoji) && loop;\r\n\r\n  div.forEach((div) => {\r\n    div.dataset.docId = '' + doc.id;\r\n    if(emoji) {\r\n      div.dataset.stickerEmoji = emoji;\r\n    }\r\n\r\n    // div.dataset.stickerPlay = '' + +(play || false);\r\n    // div.dataset.stickerLoop = '' + +(loop || false);\r\n\r\n    div.classList.add('media-sticker-wrapper');\r\n  });\r\n\r\n  if(play && liteModeKey && !liteMode.isAvailable(liteModeKey) && !isCustomEmoji && !isEffect) {\r\n    play = false;\r\n    loop = false;\r\n  }\r\n\r\n  /* if(stickerType === 3) {\r\n    const videoRes = wrapVideo({\r\n      doc,\r\n      boxWidth: width,\r\n      boxHeight: height,\r\n      container: div,\r\n      group,\r\n      lazyLoadQueue,\r\n      middleware,\r\n      withoutPreloader: true,\r\n      loadPromises,\r\n      noPlayButton: true,\r\n      noInfo: true\r\n    });\r\n\r\n    if(videoRes.thumb) {\r\n      if(videoRes.thumb.images.thumb) {\r\n        videoRes.thumb.images.thumb.classList.add('media-sticker', 'thumbnail');\r\n      }\r\n\r\n      if(videoRes.thumb.images.full) {\r\n        videoRes.thumb.images.full.classList.add('media-sticker');\r\n      }\r\n    }\r\n\r\n    return videoRes.loadPromise;\r\n  } */\r\n\r\n  // console.log('wrap sticker', doc, div, onlyThumb);\r\n\r\n  let cacheContext: ThumbCache;\r\n  const getCacheContext = (type: string = cacheContext?.type) => {\r\n    return cacheContext = apiManagerProxy.getCacheContext(doc, type);\r\n  };\r\n\r\n  const isAnimated = !asStatic && (stickerType === 2 || stickerType === 3);\r\n\r\n  const effectThumb = getStickerEffectThumb(doc);\r\n  if(isOut !== undefined && effectThumb && !isOut) {\r\n    div.forEach((div) => div.classList.add('reflect-x'));\r\n  }\r\n\r\n  const willHaveLock = effectThumb && withLock;\r\n  if(willHaveLock) {\r\n    const lockUrl = locksUrls[doc.id];\r\n    div.forEach((div) => {\r\n      div.classList.add('is-premium-sticker');\r\n      div.append(Icon('premium_lock', 'premium-sticker-lock'));\r\n      lockUrl && div.style.setProperty('--lock-url', `url(${lockUrl})`);\r\n    });\r\n  }\r\n\r\n  if(asStatic && stickerType !== 1) {\r\n    const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\r\n    getCacheContext(thumb.type);\r\n  } else {\r\n    getCacheContext(fullThumb?.type);\r\n  }\r\n\r\n  const customEmojiAttribute = doc.attributes.find((attribute) => attribute._ === 'documentAttributeCustomEmoji') as DocumentAttribute.documentAttributeCustomEmoji;\r\n  if(!customEmojiAttribute || !customEmojiAttribute.pFlags.text_color) {\r\n    textColor = undefined;\r\n  } else if(!textColor) {\r\n    textColor = 'primary-text-color';\r\n  }\r\n\r\n  const toneIndex = emoji && !isCustomEmoji ? getEmojiToneIndex(emoji) : -1;\r\n  const lottieCachedThumbToneIndex = toneIndex === -1 ? textColor ?? toneIndex : toneIndex;\r\n  const downloaded = cacheContext.downloaded && !needFadeIn;\r\n\r\n  const isThumbNeededForType = isAnimated;\r\n  const lottieCachedThumb = stickerType === 2 || stickerType === 3 ? apiManagerProxy.getStickerCachedThumb(doc.id, lottieCachedThumbToneIndex) : undefined;\r\n\r\n  const ret = {\r\n    render: undefined as typeof loadPromise,\r\n    load: undefined as typeof load,\r\n    width,\r\n    height,\r\n    downloaded\r\n  };\r\n  let loadThumbPromise = deferredPromise<void>();\r\n  let haveThumbCached = false;\r\n  if((\r\n    doc.thumbs?.length ||\r\n      lottieCachedThumb\r\n  ) &&\r\n    isEmptyContainer(div[0]) && (\r\n    !downloaded ||\r\n      isThumbNeededForType ||\r\n      onlyThumb\r\n  ) && withThumb !== false/*  && doc.thumbs[0]._ !== 'photoSizeEmpty' */\r\n  ) {\r\n    let thumb = lottieCachedThumb || doc.thumbs[0];\r\n\r\n    // console.log('wrap sticker', thumb, div);\r\n\r\n    const afterRender = (div: HTMLElement, thumbImage: HTMLElement) => {\r\n      if(isEmptyContainer(div)) {\r\n        sequentialDom.mutateElement(div, () => {\r\n          if(isEmptyContainer(div)) {\r\n            thumbImage.classList.add('media-sticker', 'thumbnail');\r\n            div.append(thumbImage);\r\n          }\r\n\r\n          loadThumbPromise.resolve();\r\n        });\r\n      } else {\r\n        loadThumbPromise.resolve();\r\n      }\r\n    };\r\n\r\n    if('url' in thumb) {\r\n      haveThumbCached = true;\r\n      div.forEach((div) => {\r\n        const thumbImage = new Image();\r\n        renderImageFromUrl(thumbImage, (thumb as any).url, () => afterRender(div, thumbImage));\r\n      });\r\n    } else if('bytes' in thumb) {\r\n      if(thumb._ === 'photoPathSize') {\r\n        if(!thumb.bytes.length) {\r\n          thumb = doc.thumbs.find((t) => (t as PhotoSize.photoStrippedSize).bytes?.length) || thumb;\r\n        }\r\n\r\n        const d = getPathFromBytes((thumb as PhotoSize.photoStrippedSize).bytes);\r\n        const ns = 'http://www.w3.org/2000/svg';\r\n        const svg = document.createElementNS(ns, 'svg');\r\n        svg.classList.add('rlottie-vector', 'media-sticker', 'thumbnail');\r\n        svg.setAttributeNS(null, 'viewBox', `0 0 ${doc.w || 512} ${doc.h || 512}`);\r\n\r\n        // const defs = document.createElementNS(ns, 'defs');\r\n        // const linearGradient = document.createElementNS(ns, 'linearGradient');\r\n        // linearGradient.setAttributeNS(null, 'id', 'g');\r\n        // linearGradient.setAttributeNS(null, 'x1', '-300%');\r\n        // linearGradient.setAttributeNS(null, 'x2', '-200%');\r\n        // linearGradient.setAttributeNS(null, 'y1', '0');\r\n        // linearGradient.setAttributeNS(null, 'y2', '0');\r\n        // const stops = [\r\n        //   ['-10%', '.1'],\r\n        //   ['30%', '.07'],\r\n        //   ['70%', '.07'],\r\n        //   ['110%', '.1']\r\n        // ].map(([offset, stopOpacity]) => {\r\n        //   const stop = document.createElementNS(ns, 'stop');\r\n        //   stop.setAttributeNS(null, 'offset', offset);\r\n        //   stop.setAttributeNS(null, 'stop-opacity', stopOpacity);\r\n        //   return stop;\r\n        // });\r\n        // const animates = [\r\n        //   ['-300%', '1200%'],\r\n        //   ['-200%', '1300%']\r\n        // ].map(([from, to], idx) => {\r\n        //   const animate = document.createElementNS(ns, 'animate');\r\n        //   animate.setAttributeNS(null, 'attributeName', 'x' + (idx + 1));\r\n        //   animate.setAttributeNS(null, 'from', from);\r\n        //   animate.setAttributeNS(null, 'to', to);\r\n        //   animate.setAttributeNS(null, 'dur', '3s');\r\n        //   animate.setAttributeNS(null, 'repeatCount', 'indefinite');\r\n        //   return animate;\r\n        // });\r\n        // linearGradient.append(...stops, ...animates);\r\n        // defs.append(linearGradient);\r\n        // svg.append(defs);\r\n\r\n        const path = document.createElementNS(ns, 'path');\r\n        path.setAttributeNS(null, 'd', d);\r\n        // if(liteMode.isAvailable('animations') && !isCustomEmoji) path.setAttributeNS(null, 'fill', 'url(#g)');\r\n        svg.append(path);\r\n        div.forEach((div, idx) => div.append(idx > 0 ? svg.cloneNode(true) : svg));\r\n        haveThumbCached = true;\r\n        loadThumbPromise.resolve();\r\n      } else if(toneIndex <= 0) {\r\n        const r = () => {\r\n          (div as HTMLElement[]).forEach((div) => {\r\n            const thumbImage = new Image();\r\n            const url = getPreviewURLFromThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\r\n            renderImageFromUrl(thumbImage, url, () => afterRender(div, thumbImage), useCache);\r\n          });\r\n        };\r\n\r\n        if((IS_WEBP_SUPPORTED || doc.pFlags.stickerThumbConverted || cacheContext.url)/*  && false */) {\r\n          haveThumbCached = true;\r\n          r();\r\n        } else {\r\n          haveThumbCached = true;\r\n          webpWorkerController.convert('main-' + doc.id, thumb.bytes).then((bytes) => {\r\n            managers.appDocsManager.saveWebPConvertedStrippedThumb(doc.id, bytes);\r\n            (thumb as PhotoSize.photoStrippedSize).bytes = bytes;\r\n            doc.pFlags.stickerThumbConverted = true;\r\n\r\n            if((middleware && !middleware()) || !isEmptyContainer((div as HTMLElement[])[0])) {\r\n              loadThumbPromise.resolve();\r\n              return;\r\n            }\r\n\r\n            r();\r\n          }).catch(() => loadThumbPromise.resolve());\r\n        }\r\n      }\r\n    } else if(((stickerType === 2 && toneIndex <= 0) || stickerType === 3) && (withThumb || onlyThumb)) {\r\n      const load = async() => {\r\n        if(!isEmptyContainer((div as HTMLElement[])[0]) || (middleware && !middleware())) {\r\n          loadThumbPromise.resolve();\r\n          return;\r\n        }\r\n\r\n        const r = (div: HTMLElement, thumbImage: HTMLElement, url: string) => {\r\n          if(!isEmptyContainer(div) || (middleware && !middleware())) {\r\n            loadThumbPromise.resolve();\r\n            return;\r\n          }\r\n\r\n          if(!url) afterRender(div, thumbImage);\r\n          else renderImageFromUrl(thumbImage, url, () => afterRender(div, thumbImage), useCache);\r\n        };\r\n\r\n        getCacheContext();\r\n        (div as HTMLElement[]).forEach((div) => {\r\n          if(cacheContext.url) {\r\n            r(div, new Image(), cacheContext.url);\r\n          } else if('bytes' in thumb) {\r\n            const res = getImageFromStrippedThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\r\n            res.loadPromise.then(() => r(div, res.image, ''));\r\n\r\n            // return managers.appDocsManager.getThumbURL(doc, thumb as PhotoSize.photoStrippedSize).promise.then(r);\r\n          } else {\r\n            appDownloadManager.downloadMediaURL({\r\n              media: doc,\r\n              thumb: thumb as PhotoSize\r\n            }).then(async(url) => {\r\n              return r(div, new Image(), url);\r\n            });\r\n          }\r\n        });\r\n      };\r\n\r\n      if(lazyLoadQueue && onlyThumb) {\r\n        lazyLoadQueue.push({div: div[0], load});\r\n        loadThumbPromise.resolve();\r\n        return ret;\r\n      } else {\r\n        load();\r\n\r\n        if((thumb as any).url) {\r\n          haveThumbCached = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if(loadPromises && haveThumbCached) {\r\n    loadPromises.push(loadThumbPromise);\r\n  }\r\n\r\n  if(onlyThumb/*  || true */) { // for sticker panel\r\n    return ret;\r\n  }\r\n\r\n  const middlewareError = makeError('MIDDLEWARE');\r\n  const load = async() => {\r\n    if(middleware && !middleware()) {\r\n      throw middlewareError;\r\n    }\r\n\r\n    if(stickerType === 2 && !asStatic) {\r\n      const blob = await appDownloadManager.downloadMedia({media: doc, queueId: lazyLoadQueue?.queueId, thumb: fullThumb});\r\n      if(middleware && !middleware()) {\r\n        throw middlewareError;\r\n      }\r\n\r\n      const animation = await lottieLoader.loadAnimationWorker({\r\n        container: (div as HTMLElement[])[0],\r\n        loop,\r\n        autoplay: play,\r\n        animationData: blob,\r\n        width,\r\n        height,\r\n        name: 'doc' + doc.id,\r\n        needUpscale,\r\n        skipRatio,\r\n        toneIndex,\r\n        sync: isCustomEmoji,\r\n        middleware: loadStickerMiddleware ?? middleware,\r\n        group,\r\n        liteModeKey: liteModeKey || undefined,\r\n        textColor: !isCustomEmoji ? textColor : undefined\r\n      });\r\n\r\n      // const deferred = deferredPromise<void>();\r\n\r\n      const setLockColor = willHaveLock ? () => {\r\n        const lockUrl = locksUrls[doc.id] ??= computeLockColor(animation.canvas[0]);\r\n        (div as HTMLElement[]).forEach((div) => div.style.setProperty('--lock-url', `url(${lockUrl})`));\r\n      } : undefined;\r\n\r\n      const onFirstFrame = (container: HTMLElement, canvas: HTMLCanvasElement) => {\r\n        let element = getThumbFromContainer(container);\r\n        element = element !== canvas && element as HTMLElement;\r\n        if(needFadeIn !== false) {\r\n          needFadeIn = (needFadeIn || !element || element.tagName === 'svg') && liteMode.isAvailable('animations');\r\n        }\r\n\r\n        const cb = () => {\r\n          if(\r\n            element &&\r\n            element !== canvas &&\r\n            element.tagName !== 'DIV'\r\n          ) {\r\n            element.remove();\r\n          }\r\n        };\r\n\r\n        if(!needFadeIn) {\r\n          if(element) {\r\n            sequentialDom.mutate(cb);\r\n          }\r\n        } else {\r\n          sequentialDom.mutate(() => {\r\n            canvas && canvas.classList.add('fade-in');\r\n            if(element) {\r\n              element.classList.add('fade-out');\r\n            }\r\n\r\n            onAnimationEnd(canvas || element, () => {\r\n              sequentialDom.mutate(() => {\r\n                canvas && canvas.classList.remove('fade-in');\r\n                cb();\r\n              });\r\n            }, 400);\r\n          });\r\n        }\r\n      };\r\n\r\n      animation.addEventListener('firstFrame', () => {\r\n        const canvas = animation.canvas[0];\r\n        if(withThumb !== false || isCustomEmoji) {\r\n          saveLottiePreview(doc, canvas, lottieCachedThumbToneIndex);\r\n        }\r\n\r\n        if(willHaveLock) {\r\n          setLockColor();\r\n        }\r\n\r\n        if(!isCustomEmoji) {\r\n          (div as HTMLElement[]).forEach((container, idx) => {\r\n            onFirstFrame(container, animation.canvas[idx]);\r\n          });\r\n        }\r\n      }, {once: true});\r\n\r\n      if(emoji) {\r\n        managers.appStickersManager.preloadAnimatedEmojiStickerAnimation(emoji);\r\n      }\r\n\r\n      return animation;\r\n\r\n      // return deferred;\r\n      // await new Promise((resolve) => setTimeout(resolve, 5e3));\r\n    } else if(asStatic || stickerType === 3) {\r\n      const isSingleVideo = isAnimated && syncedVideo;\r\n      const cacheName = isSingleVideo ? framesCache.generateName('' + doc.id, 0, 0, undefined, undefined) : undefined;\r\n\r\n      const cachePromise = videosCache[cacheName];\r\n      if(cachePromise) {\r\n        return cachePromise as typeof promise;\r\n      }\r\n\r\n      const d = isSingleVideo ? (div as HTMLElement[]).slice(0, 1) : div as HTMLElement[];\r\n      const media: HTMLElement[] = d.map(() => {\r\n        let media: HTMLElement;\r\n        if(asStatic) {\r\n          media = new Image();\r\n        } else {\r\n          const video = media = createVideo({middleware});\r\n          video.muted = true;\r\n          if(play) video.autoplay = true;\r\n          if(loop) video.loop = true;\r\n          video._autoplay = play || false;\r\n          video._loop = loop || false;\r\n\r\n          if(loop && typeof(loop) === 'number') {\r\n            let previousTime = 0, playedTimes = 0;\r\n            function onTimeupdate(this: HTMLVideoElement) {\r\n              if(previousTime > this.currentTime && ++playedTimes === loop as number) {\r\n                this.autoplay = false;\r\n                this.loop = false;\r\n                this.pause();\r\n                video.removeEventListener('timeupdate', onTimeupdate);\r\n              }\r\n\r\n              (this as any).timeUpdatedTimes = ((this as any).timeUpdatedTimes || 0) + 1;\r\n\r\n              previousTime = this.currentTime;\r\n            }\r\n\r\n            video.addEventListener('timeupdate', onTimeupdate);\r\n            middleware.onClean(() => {\r\n              video.removeEventListener('timeupdate', onTimeupdate);\r\n            });\r\n          }\r\n        }\r\n\r\n        media.classList.add('media-sticker');\r\n        return media;\r\n      });\r\n\r\n      const thumbImage = (div as HTMLElement[]).map((div, idx) => {\r\n        const thumb = getThumbFromContainer(div);\r\n        return (thumb as HTMLElement) !== media[idx] && thumb;\r\n      }) as HTMLElement[];\r\n      if(needFadeIn !== false) {\r\n        needFadeIn = (needFadeIn || !downloaded || (asStatic ? thumbImage[0] : (!thumbImage[0] || thumbImage[0].tagName === 'svg'))) && liteMode.isAvailable('animations');\r\n      }\r\n\r\n      if(needFadeIn) {\r\n        media.forEach((media) => media.classList.add('fade-in'));\r\n      }\r\n\r\n      const promise = new Promise<HTMLVideoElement[] | HTMLImageElement[]>(async(resolve, reject) => {\r\n        const r = async() => {\r\n          if(middleware && !middleware()) {\r\n            reject(middlewareError);\r\n            return;\r\n          }\r\n\r\n          const mediaLength = media.length;\r\n          const loaded: HTMLElement[] = [];\r\n          const onLoad = (div: HTMLElement, media: HTMLElement, thumbImage: HTMLElement) => {\r\n            sequentialDom.mutateElement(div, () => {\r\n              if(middleware && !middleware()) {\r\n                reject(middlewareError);\r\n                return;\r\n              }\r\n\r\n              if(!media) {\r\n                if(!isSingleVideo || !isAnimated) {\r\n                  UNMOUNT_THUMBS && thumbImage?.remove();\r\n                }\r\n\r\n                return;\r\n              }\r\n\r\n              const isVideo = media instanceof HTMLVideoElement;\r\n              if(isVideo/*  && media.isConnected */) {\r\n                // * video sticker can have arbitrary dimensions\r\n                const {videoWidth, videoHeight} = media;\r\n                const ratio = videoWidth / videoHeight;\r\n\r\n                let w = width * window.devicePixelRatio;\r\n                let h = height * window.devicePixelRatio;\r\n                if(ratio < 1) {\r\n                  w = h * ratio;\r\n                } else {\r\n                  h = w / ratio;\r\n                }\r\n\r\n                if(!isSavingLottiePreview(doc, toneIndex, w, h)) {\r\n                  // const perf = performance.now();\r\n                  const canvas = document.createElement('canvas');\r\n                  canvas.width = w;\r\n                  canvas.height = h;\r\n                  const ctx = canvas.getContext('2d');\r\n                  ctx.drawImage(media, 0, 0, canvas.width, canvas.height);\r\n                  saveLottiePreview(doc, canvas, toneIndex);\r\n                  // console.log('perf', performance.now() - perf);\r\n                }\r\n              }\r\n\r\n              if(isSingleVideo) {\r\n                resolve(media as any);\r\n                return;\r\n              }\r\n\r\n              if(isVideo && SHOULD_HANDLE_VIDEO_LEAK) {\r\n                leakVideoFallbacks.set(media, () => {\r\n                  const reset = () => {\r\n                    onVideoLeak(media).catch(noop);\r\n                  };\r\n\r\n                  if(!thumbImage || !(thumbImage instanceof HTMLImageElement)) {\r\n                    const d = document.createElement('div');\r\n                    wrapSticker({\r\n                      ...options,\r\n                      div: d,\r\n                      static: true,\r\n                      exportLoad: undefined,\r\n                      needFadeIn: false,\r\n                      lazyLoadQueue: undefined\r\n                      // onlyThumb: true\r\n                    }).then(({render}) => {\r\n                      return render;\r\n                    }).finally(() => {\r\n                      sequentialDom.mutateElement(media, () => {\r\n                        if(middleware()) div.append(...Array.from(d.children));\r\n                        media.remove();\r\n                        reset();\r\n                      });\r\n                    });\r\n                  } else {\r\n                    media.replaceWith(thumbImage);\r\n                    reset();\r\n                  }\r\n                });\r\n\r\n                if(media.duration < 1 ||\r\n                  media.getVideoPlaybackQuality().totalVideoFrames < 10) {\r\n                  const detach = attachVideoLeakListeners(media);\r\n                  middleware.onClean(detach);\r\n                }\r\n              }\r\n\r\n              div.append(media);\r\n\r\n              if(needFadeIn) {\r\n                thumbImage && thumbImage.classList.add('fade-out');\r\n                onAnimationEnd(media, () => {\r\n                  media.classList.remove('fade-in');\r\n                  UNMOUNT_THUMBS && thumbImage?.remove();\r\n                }, 400);\r\n              } else {\r\n                UNMOUNT_THUMBS && thumbImage?.remove();\r\n              }\r\n\r\n              if(isAnimated) {\r\n                animationIntersector.addAnimation({\r\n                  animation: media as HTMLVideoElement,\r\n                  observeElement: div,\r\n                  group,\r\n                  controlled: middleware,\r\n                  liteModeKey: liteModeKey || undefined,\r\n                  type: 'video'\r\n                });\r\n              }\r\n\r\n              if(loaded.push(media) === mediaLength) {\r\n                resolve(loaded as any);\r\n              }\r\n            });\r\n          };\r\n\r\n          getCacheContext();\r\n          let lastPromise: Promise<any>;\r\n          (div as HTMLElement[]).forEach((div, idx) => {\r\n            const _media = media[idx];\r\n            const cb = () => onLoad(div, _media, thumbImage[idx]);\r\n            if(_media) lastPromise = renderImageFromUrlPromise(_media, cacheContext.url, useCache);\r\n            lastPromise.then(cb);\r\n          });\r\n        };\r\n\r\n        getCacheContext();\r\n        if(cacheContext.url) r();\r\n        else {\r\n          let promise: Promise<any>;\r\n          if(stickerType !== 1 && asStatic) {\r\n            const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\r\n            // promise = managers.appDocsManager.getThumbURL(doc, thumb).promise\r\n            promise = appDownloadManager.downloadMediaURL({media: doc, thumb, queueId: lazyLoadQueue?.queueId});\r\n          } else {\r\n            promise = appDownloadManager.downloadMediaURL({media: doc, queueId: lazyLoadQueue?.queueId});\r\n          }\r\n\r\n          promise.then(r, reject);\r\n        }\r\n      });\r\n\r\n      if(cacheName) {\r\n        videosCache[cacheName] = promise as any;\r\n        loadStickerMiddleware && promise.finally(() => {\r\n          if(!loadStickerMiddleware()) {\r\n            delete videosCache[cacheName];\r\n          }\r\n        });\r\n      }\r\n\r\n      return promise;\r\n    }\r\n  };\r\n\r\n  if(exportLoad && ((exportLoad === 1 && (!downloaded || isAnimated)) || exportLoad === 2)) {\r\n    ret.load = load;\r\n    return ret;\r\n  }\r\n\r\n  const loadPromise: Promise<Awaited<ReturnType<typeof load>> | void> = lazyLoadQueue && (!downloaded || isAnimated) ?\r\n    (lazyLoadQueue.push({div: div[0], load}), Promise.resolve()) :\r\n    load();\r\n\r\n  if(downloaded && (asStatic/*  || stickerType === 3 */)) {\r\n    loadThumbPromise = loadPromise as any;\r\n    loadPromises?.push(loadThumbPromise);\r\n  }\r\n\r\n  if(stickerType === 2 && effectThumb && isOut !== undefined && !noPremium) {\r\n    attachStickerEffectHandler({\r\n      container: div[0],\r\n      doc,\r\n      managers,\r\n      middleware,\r\n      isOut,\r\n      width,\r\n      loadPromise,\r\n      relativeEffect,\r\n      loopEffect,\r\n      scrollable,\r\n      showPremiumInfo\r\n    });\r\n  }\r\n\r\n  ret.render = loadPromise as any;\r\n  return ret;\r\n}\r\n\r\nexport async function fireStickerEffect({e, container, doc, managers, middleware, isOut, width, loadPromise, relativeEffect, loopEffect, scrollable, showPremiumInfo}: {\r\n  e: MouseEvent,\r\n  container: HTMLElement,\r\n  doc: MyDocument,\r\n  managers: AppManagers,\r\n  middleware: Middleware,\r\n  isOut: boolean,\r\n  width: number,\r\n  loadPromise: Promise<any>,\r\n  relativeEffect?: boolean,\r\n  loopEffect?: boolean,\r\n  scrollable?: Scrollable,\r\n  showPremiumInfo?: () => void\r\n}) {\r\n  const isAvailable = liteMode.isAvailable('effects_premiumstickers') || relativeEffect;\r\n  cancelEvent(e);\r\n  if(!e.isTrusted && !isAvailable) {\r\n    return;\r\n  }\r\n\r\n  if(container.dataset.playing || !isAvailable) {\r\n    showPremiumInfo?.();\r\n    return;\r\n  }\r\n\r\n  container.dataset.playing = '1';\r\n\r\n  await loadPromise;\r\n  const {animationDiv, stickerPromise} = wrapStickerAnimation({\r\n    doc,\r\n    middleware,\r\n    side: isOut ? 'right' : 'left',\r\n    size: width * STICKER_EFFECT_MULTIPLIER,\r\n    target: container,\r\n    play: true,\r\n    fullThumb: getStickerEffectThumb(doc),\r\n    relativeEffect,\r\n    loopEffect,\r\n    scrollable\r\n  });\r\n\r\n  if(isOut !== undefined && !isOut/*  && !relativeEffect */) {\r\n    animationDiv.classList.add('reflect-x');\r\n  }\r\n\r\n  stickerPromise.then((player) => {\r\n    player.addEventListener('destroy', () => {\r\n      delete container.dataset.playing;\r\n    });\r\n  });\r\n}\r\n\r\nfunction attachStickerEffectHandler(options: Omit<Parameters<typeof fireStickerEffect>[0], 'e'>) {\r\n  options.managers.appStickersManager.preloadSticker(options.doc.id, true);\r\n\r\n  const detach = attachClickEvent(options.container, (e) => {\r\n    fireStickerEffect({...options, e});\r\n  });\r\n\r\n  options.middleware.onDestroy(detach);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport windowSize from '../windowSize';\r\n\r\nexport default function getVisibleRect(\r\n  element: HTMLElement,\r\n  overflowElement: HTMLElement,\r\n  lookForSticky?: boolean,\r\n  rect: DOMRectMinified = element.getBoundingClientRect(),\r\n  overflowRect: DOMRectMinified = overflowElement.getBoundingClientRect()\r\n) {\r\n  let {top: overflowTop, right: overflowRight, bottom: overflowBottom, left: overflowLeft} = overflowRect;\r\n\r\n  // * respect sticky headers\r\n  if(lookForSticky) {\r\n    const sticky = overflowElement.querySelector('.sticky');\r\n    if(sticky) {\r\n      const stickyRect = sticky.getBoundingClientRect();\r\n      overflowTop = stickyRect.bottom;\r\n    }\r\n  }\r\n\r\n  if(rect.top >= overflowBottom ||\r\n    rect.bottom <= overflowTop ||\r\n    rect.right <= overflowLeft ||\r\n    rect.left >= overflowRight) {\r\n    return null;\r\n  }\r\n\r\n  const overflow = {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n    vertical: 0 as 0 | 1 | 2,\r\n    horizontal: 0 as 0 | 1 | 2\r\n  };\r\n\r\n  const windowWidth = windowSize.width;\r\n  const windowHeight = windowSize.height;\r\n\r\n  return {\r\n    rect: {\r\n      top: rect.top < overflowTop && overflowTop !== 0 ? (overflow.top = true, ++overflow.vertical, overflowTop) : rect.top,\r\n      right: rect.right > overflowRight && overflowRight !== windowWidth ? (overflow.right = true, ++overflow.horizontal, overflowRight) : rect.right,\r\n      bottom: rect.bottom > overflowBottom && overflowBottom !== windowHeight ? (overflow.bottom = true, ++overflow.vertical, overflowBottom) : rect.bottom,\r\n      left: rect.left < overflowLeft && overflowLeft !== 0 ? (overflow.left = true, ++overflow.horizontal, overflowLeft) : rect.left\r\n    },\r\n    overflow\r\n  };\r\n}\r\n\r\n(window as any).getVisibleRect = getVisibleRect;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getVisibleRect from './getVisibleRect';\r\n\r\nexport type ViewportSlicePart = {element: HTMLElement, rect: DOMRect, visibleRect: ReturnType<typeof getVisibleRect>}[];\r\n\r\nexport default function getViewportSlice({\r\n  overflowElement,\r\n  overflowRect,\r\n  selector,\r\n  extraSize,\r\n  extraMinLength,\r\n  elements\r\n}: {\r\n  overflowElement: HTMLElement,\r\n  overflowRect?: DOMRectMinified,\r\n  extraSize?: number,\r\n  extraMinLength?: number,\r\n  selector?: string,\r\n  elements?: HTMLElement[]\r\n}) {\r\n  // const perf = performance.now();\r\n  overflowRect ??= overflowElement.getBoundingClientRect();\r\n  elements ??= Array.from(overflowElement.querySelectorAll<HTMLElement>(selector));\r\n\r\n  if(extraSize) {\r\n    overflowRect = {\r\n      top: overflowRect.top - extraSize,\r\n      right: overflowRect.right + extraSize,\r\n      bottom: overflowRect.bottom + extraSize,\r\n      left: overflowRect.left - extraSize\r\n    };\r\n  }\r\n\r\n  const invisibleTop: ViewportSlicePart = [],\r\n    visible: typeof invisibleTop = [],\r\n    invisibleBottom: typeof invisibleTop = [];\r\n  let foundVisible = false;\r\n  for(const element of elements) {\r\n    const rect = element.getBoundingClientRect();\r\n    const visibleRect = getVisibleRect(element, overflowElement, false, rect, overflowRect);\r\n\r\n    const isVisible = !!visibleRect;\r\n    let array: typeof invisibleTop;\r\n    if(isVisible) {\r\n      foundVisible = true;\r\n      array = visible;\r\n    } else if(foundVisible) {\r\n      array = invisibleBottom;\r\n    } else {\r\n      array = invisibleTop;\r\n    }\r\n\r\n    array.push({\r\n      element,\r\n      rect,\r\n      visibleRect\r\n    });\r\n  }\r\n\r\n  if(extraMinLength) {\r\n    visible.unshift(...invisibleTop.splice(Math.max(0, invisibleTop.length - extraMinLength), extraMinLength));\r\n    visible.push(...invisibleBottom.splice(0, extraMinLength));\r\n  }\r\n\r\n  // if(extraSize && visible.length) {\r\n  //   const maxTop = visible[0].rect.top;\r\n  //   const minTop = maxTop - extraSize;\r\n  //   const minBottom = visible[visible.length - 1].rect.bottom;\r\n  //   const maxBottom = minBottom + extraSize;\r\n\r\n  //   for(let length = invisibleTop.length, i = length - 1; i >= 0; --i) {\r\n  //     const element = invisibleTop[i];\r\n  //     if(element.rect.top >= minTop) {\r\n  //       invisibleTop.splice(i, 1);\r\n  //       visible.unshift(element);\r\n  //     }\r\n  //   }\r\n\r\n  //   for(let i = 0, length = invisibleBottom.length; i < length; ++i) {\r\n  //     const element = invisibleBottom[i];\r\n  //     if(element.rect.bottom <= maxBottom) {\r\n  //       invisibleBottom.splice(i--, 1);\r\n  //       --length;\r\n  //       visible.push(element);\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // console.log('getViewportSlice time:', performance.now() - perf);\r\n\r\n  return {invisibleTop, visible, invisibleBottom};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function replaceContent(elem: HTMLElement, node: string | Node) {\r\n  if(typeof(node) === 'string') {\r\n    elem.textContent = node;\r\n    return;\r\n  }\r\n\r\n  // * children.length doesn't count text nodes\r\n  const firstChild = elem.firstChild;\r\n  if(firstChild) {\r\n    if(elem.lastChild === firstChild) {\r\n      firstChild.replaceWith(node);\r\n    } else {\r\n      elem.textContent = '';\r\n      elem.append(node);\r\n    }\r\n  } else {\r\n    elem.append(node);\r\n  }\r\n}\r\n","const resizeObserverMap: WeakMap<Element, (entry: ResizeObserverEntry) => void> = new WeakMap();\r\nconst resizeObserver = new ResizeObserver((entries) => {\r\n  for(const entry of entries) {\r\n    const callback = resizeObserverMap.get(entry.target);\r\n    callback(entry);\r\n  }\r\n});\r\n\r\nexport function observeResize(element: Element, callback: (entry: ResizeObserverEntry) => void) {\r\n  resizeObserverMap.set(element, callback);\r\n  resizeObserver.observe(element);\r\n\r\n  return () => {\r\n    unobserveResize(element);\r\n  };\r\n}\r\n\r\nexport function unobserveResize(element: Element) {\r\n  resizeObserverMap.delete(element);\r\n  resizeObserver.unobserve(element);\r\n}\r\n","export const PAID_REACTION_EMOJI_DOCID = '__PAID_REACTION_EMOJI__';\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../appManagers/appDocsManager';\r\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\r\nimport LazyLoadQueue from '../../components/lazyLoadQueue';\r\nimport wrapSticker, {videosCache} from '../../components/wrappers/sticker';\r\nimport customProperties, {CustomProperty} from '../../helpers/dom/customProperties';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport framesCache from '../../helpers/framesCache';\r\nimport {MediaSize} from '../../helpers/mediaSize';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {Middleware, MiddlewareHelper, getMiddleware} from '../../helpers/middleware';\r\nimport noop from '../../helpers/noop';\r\nimport {DocumentAttribute} from '../../layer';\r\nimport wrapRichText from '../richTextProcessor/wrapRichText';\r\nimport RLottiePlayer, {applyColorOnContext, getLottiePixelRatio} from '../rlottie/rlottiePlayer';\r\nimport rootScope from '../rootScope';\r\nimport CustomEmojiElement, {CustomEmojiElements} from './element';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport {IS_WEBM_SUPPORTED} from '../../environment/videoSupport';\r\nimport {observeResize, unobserveResize} from '../../components/resizeObserver';\r\nimport {PAID_REACTION_EMOJI_DOCID} from './constants';\r\nimport lottieLoader from '../rlottie/lottieLoader';\r\n\r\nconst globalLazyLoadQueue = new LazyLoadQueue();\r\n\r\nexport class CustomEmojiRendererElement extends HTMLElement {\r\n  public static globalLazyLoadQueue: LazyLoadQueue = globalLazyLoadQueue;\r\n\r\n  public canvas: HTMLCanvasElement;\r\n  public context: CanvasRenderingContext2D;\r\n\r\n  public playersSynced: Map<CustomEmojiElements, RLottiePlayer | HTMLVideoElement>;\r\n  public textColored: Set<CustomEmojiElements>;\r\n  public clearedElements: WeakSet<CustomEmojiElements>;\r\n  public customEmojis: Parameters<typeof wrapRichText>[1]['customEmojis'];\r\n  public lastPausedVideo: HTMLVideoElement;\r\n\r\n  public lastRect: {width: number, height: number};\r\n  public isDimensionsSet: boolean;\r\n\r\n  public animationGroup: AnimationItemGroup;\r\n  public size: MediaSize;\r\n\r\n  public isSelectable: boolean;\r\n  public isCanvasClean: boolean;\r\n\r\n  public ignoreSettingDimensions: boolean;\r\n\r\n  public forceRenderAfterSize: boolean;\r\n\r\n  public middlewareHelper: MiddlewareHelper;\r\n\r\n  public auto: boolean;\r\n  public textColor: CustomProperty;\r\n\r\n  public observeResizeElement: HTMLElement | false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.classList.add('custom-emoji-renderer');\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.classList.add('custom-emoji-canvas');\r\n    this.context = this.canvas.getContext('2d');\r\n    this.append(this.canvas);\r\n\r\n    this.playersSynced = new Map();\r\n    this.textColored = new Set();\r\n    this.clearedElements = new WeakSet();\r\n    this.customEmojis = new Map();\r\n\r\n    this.animationGroup = 'EMOJI';\r\n    this.isCanvasClean = false;\r\n  }\r\n\r\n  private onResizeEntry = (entry: ResizeObserverEntry) => {\r\n    this.setDimensionsFromRect(entry.contentRect);\r\n  };\r\n\r\n  public connectedCallback() {\r\n    if(emojiRenderers.has(this)) {\r\n      return;\r\n    }\r\n\r\n    // this.setDimensions();\r\n    // animationIntersector.addAnimation(this, this.animationGroup);\r\n    const observeElement = this.observeResizeElement ?? this.canvas;\r\n    if(observeElement) {\r\n      observeResize(observeElement, this.onResizeEntry);\r\n    }\r\n    emojiRenderers.add(this);\r\n\r\n    this.connectedCallback = undefined;\r\n  }\r\n\r\n  public disconnectedCallback() {\r\n    if(this.isConnected || !this.auto) {\r\n      return;\r\n    }\r\n\r\n    this.destroy?.();\r\n\r\n    this.disconnectedCallback = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    // if(this.isConnected) {\r\n    //   return;\r\n    // }\r\n\r\n    const observeElement = this.observeResizeElement ?? this.canvas;\r\n    if(observeElement) {\r\n      unobserveResize(observeElement);\r\n    }\r\n\r\n    this.customEmojis.forEach((elements) => {\r\n      elements.forEach((element) => {\r\n        element.clear();\r\n      });\r\n    });\r\n\r\n    emojiRenderers.delete(this);\r\n    this.playersSynced.clear();\r\n    this.middlewareHelper?.clean();\r\n    this.customEmojis.clear();\r\n    this.textColored.clear();\r\n\r\n    this.destroy =\r\n      this.lastPausedVideo =\r\n      undefined;\r\n  }\r\n\r\n  public getOffsets(offsetsMap: Map<CustomEmojiElements, {top: number, left: number, width: number}[]> = new Map()) {\r\n    if(!this.playersSynced.size) {\r\n      return offsetsMap;\r\n    }\r\n\r\n    const overflowElement = findUpClassName(this, 'scrollable') || this.offsetParent as HTMLElement;\r\n    if(!overflowElement) {\r\n      return offsetsMap;\r\n    }\r\n\r\n    const overflowRect = overflowElement.getBoundingClientRect();\r\n    const rect = this.getBoundingClientRect();\r\n\r\n    for(const elements of this.playersSynced.keys()) {\r\n      const elementsArr = Array.from(elements);\r\n      const placeholders = this.isSelectable ? elementsArr.map((element) => element.placeholder) : elementsArr;\r\n      const {visible} = getViewportSlice({\r\n        overflowElement,\r\n        overflowRect,\r\n        elements: placeholders,\r\n        extraSize: this.size.height * 2.5 // let's add some margin\r\n      });\r\n\r\n      const offsets = visible.map(({rect: elementRect}) => {\r\n        const top = elementRect.top - rect.top;\r\n        const left = elementRect.left - rect.left;\r\n        return {top, left, width: elementRect.width};\r\n      });\r\n\r\n      if(offsets.length) {\r\n        offsetsMap.set(elements, offsets);\r\n      }\r\n    }\r\n\r\n    // const rect = this.getBoundingClientRect();\r\n    // const visibleRect = getVisibleRect(this, overflowElement, undefined, rect);\r\n    // const minTop = visibleRect ? visibleRect.rect.top - this.size.height : 0;\r\n    // const maxTop = Infinity;\r\n    // for(const elements of this.playersSynced.keys()) {\r\n    //   const offsets = elements.map((element) => {\r\n    //     const elementRect = element.getBoundingClientRect();\r\n    //     const top = elementRect.top - rect.top;\r\n    //     const left = elementRect.left - rect.left;\r\n    //     return top >= minTop && (top + elementRect.height) <= maxTop ? {top, left} : undefined;\r\n    //   }).filter(Boolean);\r\n\r\n    //   if(offsets.length) {\r\n    //     offsetsMap.set(elements, offsets);\r\n    //   }\r\n    // }\r\n\r\n    return offsetsMap;\r\n  }\r\n\r\n  public clearCanvas() {\r\n    if(this.isCanvasClean) {\r\n      return;\r\n    }\r\n\r\n    const {context, canvas} = this;\r\n    context.clearRect(0, 0, canvas.width, canvas.height);\r\n    this.isCanvasClean = true;\r\n  }\r\n\r\n  public render(offsetsMap: ReturnType<CustomEmojiRendererElement['getOffsets']>) {\r\n    const {context, canvas, isDimensionsSet} = this;\r\n    if(!isDimensionsSet) {\r\n      this.setDimensionsFromRect(undefined, false);\r\n    }\r\n\r\n    this.isCanvasClean = false;\r\n\r\n    const {width, height, dpr} = canvas;\r\n    for(const [elements, offsets] of offsetsMap) {\r\n      const player = this.playersSynced.get(elements);\r\n      const frame = syncedPlayersFrames.get(player) || (player instanceof HTMLVideoElement ? player : undefined);\r\n      if(!frame) {\r\n        continue;\r\n      }\r\n\r\n      const isImageData = frame instanceof ImageData;\r\n      let frameWidth: number, frameHeight: number;\r\n      if(player instanceof HTMLVideoElement) {\r\n        frameWidth = this.size.width * dpr;\r\n        frameHeight = this.size.height * dpr;\r\n      } else {\r\n        frameWidth = frame.width;\r\n        frameHeight = frame.height;\r\n      }\r\n\r\n      // ! check performance of scaling\r\n      const elementWidth = Math.round(offsets[0].width * dpr);\r\n      if(elementWidth !== frameWidth) {\r\n        // if(this.size.width === 36) {\r\n        //   console.warn('different width', elementWidth, frameWidth, this);\r\n        // }\r\n\r\n        frameWidth = elementWidth;\r\n        frameHeight = elementWidth;\r\n      }\r\n\r\n      const maxTop = height - frameHeight;\r\n      const maxLeft = width - frameWidth;\r\n      const color = this.textColored.has(elements) ? customProperties.getProperty(this.textColor) : undefined;\r\n\r\n      if(!this.clearedElements.has(elements) && !this.isSelectable) {\r\n        if(this.isSelectable/*  && false */) {\r\n          elements.forEach((element) => {\r\n            element.lastChildWas ??= element.lastChild;\r\n            replaceContent(element, element.firstChild);\r\n          });\r\n        } else {\r\n          elements.forEach((element) => {\r\n            element.replaceChildren();\r\n          });\r\n        }\r\n\r\n        this.clearedElements.add(elements);\r\n      }\r\n\r\n      offsets.forEach(({top, left}) => {\r\n        top = Math.round(top * dpr), left = Math.round(left * dpr);\r\n        if(left < 0 ||/* top > maxTop ||  */left > maxLeft) {\r\n          return;\r\n        }\r\n\r\n        if(isImageData) {\r\n          context.putImageData(frame, left, top);\r\n        } else {\r\n          // context.clearRect(left, top, width, height);\r\n          context.drawImage(frame, left, top, frameWidth, frameHeight);\r\n        }\r\n\r\n        if(color) {\r\n          applyColorOnContext(context, color, left, top, frameWidth, frameHeight);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public checkForAnyFrame() {\r\n    for(const player of this.playersSynced.values()) {\r\n      if(syncedPlayersFrames.has(player) || player instanceof HTMLVideoElement) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public remove() {\r\n    super.remove();\r\n    // this.canvas.remove();\r\n  }\r\n\r\n  // public setDimensions() {\r\n  //   const {canvas} = this;\r\n  //   sequentialDom.mutateElement(canvas, () => {\r\n  //     const rect = canvas.getBoundingClientRect();\r\n  //     this.setDimensionsFromRect(rect);\r\n  //   });\r\n  // }\r\n\r\n  public setDimensionsFromRect(rect: {width: number, height: number} = this.lastRect, forceRenderAfter = true) {\r\n    const {canvas} = this;\r\n    const {dpr} = canvas;\r\n\r\n    if(this.lastRect !== rect) {\r\n      this.lastRect = rect;\r\n    }\r\n\r\n    if(!rect || !dpr || this.ignoreSettingDimensions) {\r\n      return;\r\n    }\r\n\r\n    const {width, height} = rect;\r\n    // if(this.isSelectable) {\r\n    //   height = this.parentElement.scrollHeight || height;\r\n\r\n    //   this.style.width = width + 'px';\r\n    //   this.style.height = height + 'px';\r\n    // }\r\n\r\n    const newWidth = Math.floor(Math.round(width * dpr));\r\n    const newHeight = Math.floor(Math.round(height * dpr));\r\n    if(canvas.width === newWidth && canvas.height === newHeight) {\r\n      return;\r\n    }\r\n\r\n    canvas.width = newWidth;\r\n    canvas.height = newHeight;\r\n    this.isDimensionsSet = true;\r\n    this.isCanvasClean = true;\r\n\r\n    if(this.observeResizeElement || this.observeResizeElement === false) {\r\n      this.canvas.style.setProperty('width', width + 'px', 'important');\r\n      this.canvas.style.setProperty('height', height + 'px', 'important');\r\n    }\r\n\r\n    if(this.forceRenderAfterSize || (this.isSelectable && forceRenderAfter)) {\r\n      this.forceRenderAfterSize = undefined;\r\n      this.forceRender();\r\n    }\r\n  }\r\n\r\n  public forceRender() {\r\n    if(!this.isDimensionsSet) {\r\n      return;\r\n    }\r\n\r\n    if(!renderEmojis(new Set([this]))) {\r\n      this.clearCanvas();\r\n    }\r\n  }\r\n\r\n  private onElementCleanup = (element: CustomEmojiElement, syncedPlayer: SyncedPlayer, middleware: Middleware) => {\r\n    element.clear(); // * it is correct\r\n\r\n    syncedPlayer.middlewares.delete(middleware);\r\n\r\n    // * still has some elements\r\n    if(syncedPlayer.middlewares.size) {\r\n      return;\r\n    }\r\n\r\n    if(syncedPlayer.player) {\r\n      const frame = syncedPlayersFrames.get(syncedPlayer.player);\r\n      if(frame) {\r\n        (frame as ImageBitmap).close?.();\r\n        syncedPlayersFrames.delete(syncedPlayer.player);\r\n      }\r\n\r\n      syncedPlayersFrames.delete(syncedPlayer.player);\r\n      if(syncedPlayer.player instanceof RLottiePlayer) {\r\n        syncedPlayer.player.overrideRender = noop;\r\n        syncedPlayer.player.remove();\r\n      } else if(syncedPlayer.player instanceof HTMLVideoElement) {\r\n        const cacheName = framesCache.generateName('' + element.docId, 0, 0, undefined, undefined);\r\n        delete videosCache[cacheName];\r\n      }\r\n\r\n      syncedPlayer.player = undefined;\r\n    }\r\n\r\n    if(\r\n      syncedPlayers.get(syncedPlayer.key) === syncedPlayer &&\r\n      syncedPlayers.delete(syncedPlayer.key) &&\r\n      !syncedPlayers.size\r\n    ) {\r\n      clearRenderInterval();\r\n    }\r\n  };\r\n\r\n  private async wrapPaidReactionEmoji(element: CustomEmojiElement): ReturnType<typeof wrapSticker> {\r\n    const size = this.size;\r\n    const player = await lottieLoader.loadAnimationAsAsset({\r\n      container: element,\r\n      width: size.width,\r\n      height: size.height,\r\n      loop: true,\r\n      autoplay: CUSTOM_EMOJI_INSTANT_PLAY,\r\n      sync: true\r\n    }, 'StarReaction')\r\n\r\n    return {\r\n      width: size.width,\r\n      height: size.height,\r\n      downloaded: true,\r\n      load: () => Promise.resolve(player),\r\n      render: undefined as any\r\n    }\r\n  }\r\n\r\n  private wrap({\r\n    doc,\r\n    isPaidReactionEmoji,\r\n    addCustomEmojis,\r\n    usingOwnQueue,\r\n    lazyLoadQueue,\r\n    onlyThumb,\r\n    withThumb,\r\n    loadPromises\r\n  }: {\r\n    doc: MyDocument,\r\n    isPaidReactionEmoji?: boolean,\r\n    addCustomEmojis: Parameters<typeof wrapRichText>[1]['customEmojis'],\r\n    usingOwnQueue?: boolean,\r\n    lazyLoadQueue?: LazyLoadQueue | false,\r\n    onlyThumb?: boolean,\r\n    withThumb?: boolean,\r\n    loadPromises?: Promise<any>[]\r\n  }) {\r\n    const renderer = this;\r\n    const size = this.size;\r\n    const managers = rootScope.managers;\r\n    const middleware = this.middlewareHelper.get();\r\n\r\n    const docId = doc.id;\r\n    const newElements = addCustomEmojis.get(docId);\r\n    const customEmojis = renderer.customEmojis.get(docId);\r\n    const newElementsArray = Array.from(newElements);\r\n    const isLottie = doc.sticker === 2;\r\n    const isStatic = newElementsArray[0].static || (doc.mime_type === 'video/webm' && !IS_WEBM_SUPPORTED);\r\n    const willHaveSyncedPlayer = (isLottie || (doc.sticker === 3 && this.isSelectable)) && !onlyThumb && !isStatic;\r\n\r\n    const attribute = doc.attributes.find((attribute) => attribute._ === 'documentAttributeCustomEmoji') as DocumentAttribute.documentAttributeCustomEmoji;\r\n    if(attribute && attribute.pFlags.text_color) {\r\n      renderer.textColored.add(customEmojis);\r\n    }\r\n\r\n    const loadStickerMiddleware = willHaveSyncedPlayer ? middleware.create().get(() => {\r\n      return !!syncedPlayer.middlewares.size;\r\n    }) : undefined;\r\n\r\n    const _loadPromises: Promise<any>[] = [];\r\n    const promise = isPaidReactionEmoji ? this.wrapPaidReactionEmoji(newElementsArray[0]) : wrapSticker({\r\n      div: newElementsArray,\r\n      doc,\r\n      width: size.width,\r\n      height: size.height,\r\n      loop: true,\r\n      play: CUSTOM_EMOJI_INSTANT_PLAY,\r\n      managers,\r\n      isCustomEmoji: true,\r\n      group: 'none',\r\n      loadPromises: _loadPromises,\r\n      middleware,\r\n      exportLoad: usingOwnQueue || lazyLoadQueue === false ? 2 : 1, // 2 - export load always, 1 - do not export load if cached static\r\n      needFadeIn: false,\r\n      loadStickerMiddleware,\r\n      static: isStatic,\r\n      onlyThumb,\r\n      withThumb: withThumb ?? (renderer.clearedElements.has(customEmojis) ? false : undefined),\r\n      syncedVideo: this.isSelectable,\r\n      textColor: renderer.textColor\r\n    });\r\n\r\n    if(loadPromises) {\r\n      promise.then(() => loadPromises.push(..._loadPromises));\r\n    }\r\n\r\n    const addition: {\r\n      onRender?: (_p: Awaited<Awaited<typeof promise>['render']>) => Promise<void>,\r\n      elements: typeof newElements\r\n    } = {\r\n      elements: newElements\r\n    };\r\n\r\n    const readyPromise = newElementsArray[0].readyPromise;\r\n    if(readyPromise) {\r\n      promise.then(({render}) => {\r\n        if(!render) {\r\n          readyPromise.resolve();\r\n          return;\r\n        }\r\n\r\n        render.then(\r\n          () => readyPromise.resolve(),\r\n          readyPromise.reject.bind(readyPromise)\r\n        );\r\n      });\r\n    }\r\n\r\n    if(doc.sticker === 1 || onlyThumb || isStatic) {\r\n      if(this.isSelectable) {\r\n        addition.onRender = () => Promise.all(_loadPromises).then(() => {\r\n          if(!middleware()) return;\r\n          newElementsArray.forEach((element) => {\r\n            const {placeholder} = element;\r\n            placeholder.src = (element.firstElementChild as HTMLImageElement).src;\r\n          });\r\n        });\r\n      }\r\n\r\n      return promise.then((res) => ({...res, ...addition}));\r\n    }\r\n\r\n    addition.onRender = (_p) => Promise.all(_loadPromises).then(() => {\r\n      if(!middleware() || !doc.animated) {\r\n        return;\r\n      }\r\n\r\n      const players = Array.isArray(_p) ? _p as HTMLVideoElement[] : [_p as RLottiePlayer];\r\n      const player = Array.isArray(players) ? players[0] : players;\r\n      assumeType<RLottiePlayer | HTMLVideoElement>(player);\r\n      newElementsArray.forEach((element, idx) => {\r\n        const player = players[idx] || players[0];\r\n        element.player = player;\r\n\r\n        if(syncedPlayer) {\r\n          element.syncedPlayer = syncedPlayer;\r\n          if(element.paused) {\r\n            element.syncedPlayer.pausedElements.add(element);\r\n          } else if(player.paused) {\r\n            player.play();\r\n          }\r\n        }\r\n\r\n        if(element.isConnected || middleware()) {\r\n          animationIntersector.addAnimation({\r\n            animation: element,\r\n            group: element.renderer.animationGroup,\r\n            observeElement: element.placeholder ?? element,\r\n            controlled: true,\r\n            type: 'emoji'\r\n          });\r\n        }\r\n      });\r\n\r\n      if(player instanceof RLottiePlayer || (player instanceof HTMLVideoElement && this.isSelectable)) {\r\n        syncedPlayer.player = player;\r\n        renderer.playersSynced.set(customEmojis, player);\r\n      }\r\n\r\n      if(player instanceof RLottiePlayer) {\r\n        player.group = renderer.animationGroup;\r\n\r\n        player.overrideRender ??= (frame) => {\r\n          syncedPlayersFrames.set(player, frame);\r\n          // frames.set(containers, frame);\r\n        };\r\n      } else if(player instanceof HTMLVideoElement) {\r\n        // player.play();\r\n\r\n        // const cache = framesCache.getCache(key);\r\n        // let {width, height} = renderer.size;\r\n        // width *= dpr;\r\n        // height *= dpr;\r\n\r\n        // const onFrame = (frame: ImageBitmap | HTMLCanvasElement) => {\r\n        //   topFrames.set(player, frame);\r\n        //   player.requestVideoFrameCallback(callback);\r\n        // };\r\n\r\n        // let frameNo = -1, lastTime = 0;\r\n        // const callback: VideoFrameRequestCallback = (now, metadata) => {\r\n        //   const time = player.currentTime;\r\n        //   if(lastTime > time) {\r\n        //     frameNo = -1;\r\n        //   }\r\n\r\n        //   const _frameNo = ++frameNo;\r\n        //   lastTime = time;\r\n        //   // const frameNo = Math.floor(player.currentTime * 1000 / CUSTOM_EMOJI_FRAME_INTERVAL);\r\n        //   // const frameNo = metadata.presentedFrames;\r\n        //   const imageBitmap = cache.framesNew.get(_frameNo);\r\n\r\n        //   if(imageBitmap) {\r\n        //     onFrame(imageBitmap);\r\n        //   } else if(IS_IMAGE_BITMAP_SUPPORTED) {\r\n        //     createImageBitmap(player, {resizeWidth: width, resizeHeight: height}).then((imageBitmap) => {\r\n        //       cache.framesNew.set(_frameNo, imageBitmap);\r\n        //       if(frameNo === _frameNo) onFrame(imageBitmap);\r\n        //     });\r\n        //   } else {\r\n        //     const canvas = document.createElement('canvas');\r\n        //     const context = canvas.getContext('2d');\r\n        //     canvas.width = width;\r\n        //     canvas.height = height;\r\n        //     context.drawImage(player, 0, 0);\r\n        //     cache.framesNew.set(_frameNo, canvas);\r\n        //     onFrame(canvas);\r\n        //   }\r\n        // };\r\n\r\n        // // player.requestVideoFrameCallback(callback);\r\n        // // setInterval(callback, CUSTOM_EMOJI_FRAME_INTERVAL);\r\n      }\r\n\r\n      if(willHaveSyncedPlayer) {\r\n        const dpr = getLottiePixelRatio(this.size.width, this.size.height);\r\n        renderer.canvas.dpr = dpr;\r\n        setRenderInterval();\r\n      }\r\n    });\r\n\r\n    let syncedPlayer: SyncedPlayer;\r\n    const key = [docId, size.width, size.height].join('-');\r\n    if(willHaveSyncedPlayer) {\r\n      syncedPlayer = syncedPlayers.get(key);\r\n      if(!syncedPlayer) {\r\n        syncedPlayer = {\r\n          player: undefined,\r\n          middlewares: new Set(),\r\n          pausedElements: new Set(),\r\n          key\r\n        };\r\n\r\n        syncedPlayers.set(key, syncedPlayer);\r\n      }\r\n\r\n      for(const element of newElements) {\r\n        const middleware = element.middlewareHelper.get();\r\n        syncedPlayer.middlewares.add(middleware);\r\n        middleware.onClean(this.onElementCleanup.bind(this, element, syncedPlayer, middleware));\r\n      }\r\n    }\r\n\r\n    return promise.then((res) => ({...res, ...addition}));\r\n  }\r\n\r\n  public add({\r\n    addCustomEmojis,\r\n    lazyLoadQueue,\r\n    onlyThumb,\r\n    withThumb\r\n  }: {\r\n    addCustomEmojis: Parameters<typeof wrapRichText>[1]['customEmojis'],\r\n    lazyLoadQueue?: LazyLoadQueue | false,\r\n    onlyThumb?: boolean,\r\n    withThumb?: boolean\r\n  }) {\r\n    const renderer = this;\r\n    const middleware = this.middlewareHelper.get();\r\n\r\n    addCustomEmojis.forEach((addElements, docId) => { // prevent adding old elements\r\n      let elements = this.customEmojis.get(docId);\r\n      if(!elements) this.customEmojis.set(docId, elements = new Set());\r\n      else this.clearedElements.delete(elements);\r\n\r\n      for(const el of addElements) {\r\n        if(elements.has(el)) {\r\n          addElements.delete(el);\r\n        } else {\r\n          el.clean = false;\r\n          el.renderer = renderer;\r\n          el.elements = elements;\r\n          el.middlewareHelper = middleware.create();\r\n          elements.add(el);\r\n\r\n          if(el.lastChildWas && !el.lastChildWas.parentNode) {\r\n            el.append(el.lastChildWas);\r\n          }\r\n        }\r\n      }\r\n\r\n      if(!addElements.size) {\r\n        addCustomEmojis.delete(docId);\r\n      }\r\n    });\r\n\r\n    if(!addCustomEmojis.size) {\r\n      return;\r\n    }\r\n\r\n    const usingOwnQueue = !!(!lazyLoadQueue && lazyLoadQueue !== false && globalLazyLoadQueue);\r\n    const docIds = Array.from(addCustomEmojis.keys());\r\n    const managers = rootScope.managers;\r\n\r\n    const loadPromise = managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then((docs) => {\r\n      if(!middleware()) return;\r\n\r\n      const wrapOptions: Omit<Parameters<CustomEmojiRendererElement['wrap']>[0], 'doc'> = {\r\n        addCustomEmojis,\r\n        usingOwnQueue,\r\n        lazyLoadQueue,\r\n        onlyThumb,\r\n        withThumb\r\n      };\r\n\r\n      const loadPromises: Promise<any>[] = [];\r\n\r\n      const missing: DocId[] = [];\r\n      const cachedPromises = docs.map((doc, idx) => {\r\n        if(!doc) {\r\n          const docId = docIds[idx];\r\n          if(docId === PAID_REACTION_EMOJI_DOCID) {\r\n            return this.wrap({\r\n              ...wrapOptions,\r\n              doc: {\r\n                _: 'document',\r\n                id: docId,\r\n                attributes: []\r\n              } as MyDocument,\r\n              isPaidReactionEmoji: true,\r\n              loadPromises\r\n            });\r\n          }\r\n          missing.push(docId);\r\n          return;\r\n        }\r\n\r\n        return this.wrap({...wrapOptions, doc, loadPromises});\r\n      }).filter(Boolean);\r\n\r\n      const uncachedPromisesPromise = !missing.length ?\r\n        Promise.resolve([] as typeof cachedPromises) :\r\n        managers.appEmojiManager.getCustomEmojiDocuments(missing).then((docs) => {\r\n          if(!middleware()) return [];\r\n          return docs.filter(Boolean).map((doc) => this.wrap({...wrapOptions, doc}));\r\n        });\r\n\r\n      const loadFromPromises = async(_promises: typeof cachedPromises) => {\r\n        const arr = await Promise.all(_promises);\r\n        const promises = arr.map(({load, onRender, elements}) => {\r\n          if(!load) {\r\n            return;\r\n          }\r\n\r\n          const l = () => load().then(onRender);\r\n\r\n          if(!usingOwnQueue) {\r\n            return l();\r\n          }\r\n\r\n          elements.forEach((element) => {\r\n            globalLazyLoadQueue.push({\r\n              div: element,\r\n              load: () => {\r\n                elements.forEach((element) => {\r\n                  globalLazyLoadQueue.delete({div: element});\r\n                });\r\n\r\n                return l();\r\n              }\r\n            });\r\n          });\r\n        });\r\n\r\n        return Promise.all(promises.filter(Boolean));\r\n      };\r\n\r\n      const load = () => {\r\n        if(!middleware()) return;\r\n        const cached = loadFromPromises(cachedPromises);\r\n        const uncached = uncachedPromisesPromise.then((promises) => loadFromPromises(promises));\r\n        return Promise.all([cached, uncached]);\r\n      };\r\n\r\n      if(lazyLoadQueue) {\r\n        lazyLoadQueue.push({\r\n          div: renderer.canvas,\r\n          load\r\n        });\r\n      } else {\r\n        load();\r\n      }\r\n\r\n      return Promise.all(cachedPromises).then(() => Promise.all(loadPromises)).then(() => {});\r\n    });\r\n\r\n    // recordPromise(loadPromise, 'render emojis: ' + docIds.length);\r\n\r\n    return loadPromise;\r\n  }\r\n\r\n  public setTextColor(textColor: string) {\r\n    this.textColor = textColor;\r\n  }\r\n\r\n  public static create(options: CustomEmojiRendererElementOptions) {\r\n    const renderer = new CustomEmojiRendererElement();\r\n    renderer.animationGroup = options.animationGroup;\r\n    renderer.size = options.customEmojiSize || mediaSizes.active.customEmoji;\r\n    renderer.isSelectable = options.isSelectable;\r\n    renderer.textColor = options.textColor;\r\n    // renderer.textColor = typeof(options.textColor) === 'function' ? options.textColor() : options.textColor;\r\n    renderer.observeResizeElement = options.observeResizeElement;\r\n    if(options.wrappingDraft) {\r\n      renderer.contentEditable = 'false';\r\n      renderer.style.height = 'inherit';\r\n    }\r\n    // const middleware = () => !!renderer.disconnectedCallback && (!options.middleware || options.middleware());\r\n    const middleware = options.middleware;\r\n    if(middleware) {\r\n      renderer.middlewareHelper = middleware.create();\r\n      renderer.middlewareHelper.get().onDestroy(() => {\r\n        renderer.destroy?.();\r\n      });\r\n    } else {\r\n      // console.error('no middleware', this, options);\r\n      renderer.auto = true;\r\n      renderer.middlewareHelper = getMiddleware();\r\n    }\r\n\r\n    return renderer;\r\n  }\r\n}\r\n\r\nexport type CustomEmojiRenderer = CustomEmojiRendererElement;\r\nexport type SyncedPlayer = {\r\n  player: RLottiePlayer | HTMLVideoElement,\r\n  middlewares: Set<Middleware>,\r\n  pausedElements: Set<CustomEmojiElement>,\r\n  key: string\r\n};\r\nexport type CustomEmojiFrame = Parameters<RLottiePlayer['overrideRender']>[0] | HTMLVideoElement;\r\n\r\nexport type CustomEmojiRendererElementOptions = Partial<{\r\n  loadPromises: Promise<any>[],\r\n  customEmojiRenderer: CustomEmojiRendererElement,\r\n\r\n  isSelectable: boolean,\r\n  wrappingDraft: boolean,\r\n\r\n  observeResizeElement?: HTMLElement | false\r\n}> & WrapSomethingOptions;\r\n\r\nconst CUSTOM_EMOJI_INSTANT_PLAY = true; // do not wait for animationIntersector\r\nlet emojiRenderInterval: number;\r\nconst emojiRenderers: Set<CustomEmojiRenderer> = new Set();\r\nconst syncedPlayers: Map<string, SyncedPlayer> = new Map();\r\nconst syncedPlayersFrames: Map<RLottiePlayer | HTMLVideoElement, CustomEmojiFrame> = new Map();\r\nexport const renderEmojis = (renderers = emojiRenderers) => {\r\n  const r = Array.from(renderers);\r\n  const t = r.filter((r) => r.isConnected && r.checkForAnyFrame() && !r.ignoreSettingDimensions);\r\n  if(!t.length) {\r\n    return false;\r\n  }\r\n\r\n  const o = t.map((renderer) => {\r\n    const paused = [...renderer.playersSynced.values()].reduce((acc, v) => acc + +!!v.paused, 0);\r\n    if(renderer.playersSynced.size === paused) {\r\n      return;\r\n    }\r\n\r\n    const offsets = renderer.getOffsets();\r\n    if(offsets.size) {\r\n      return [renderer, offsets] as const;\r\n    }\r\n  }).filter(Boolean);\r\n\r\n  for(const [renderer] of o) {\r\n    renderer.clearCanvas();\r\n  }\r\n\r\n  for(const [renderer, offsets] of o) {\r\n    renderer.render(offsets);\r\n  }\r\n\r\n  return true;\r\n};\r\nconst CUSTOM_EMOJI_FPS = 60;\r\nconst CUSTOM_EMOJI_FRAME_INTERVAL = 1000 / CUSTOM_EMOJI_FPS;\r\nconst setRenderInterval = () => {\r\n  if(emojiRenderInterval) {\r\n    return;\r\n  }\r\n\r\n  emojiRenderInterval = window.setInterval(renderEmojis, CUSTOM_EMOJI_FRAME_INTERVAL);\r\n  renderEmojis();\r\n};\r\nconst clearRenderInterval = () => {\r\n  if(!emojiRenderInterval) {\r\n    return;\r\n  }\r\n\r\n  clearInterval(emojiRenderInterval);\r\n  emojiRenderInterval = undefined;\r\n};\r\n\r\n(window as any).syncedPlayers = syncedPlayers;\r\n(window as any).emojiRenderers = emojiRenderers;\r\n\r\ncustomElements.define('custom-emoji-renderer-element', CustomEmojiRendererElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport animationIntersector from '../../components/animationIntersector';\r\nimport safePlay from '../../helpers/dom/safePlay';\r\nimport {MiddlewareHelper} from '../../helpers/middleware';\r\nimport {createCustomFiller} from '../richTextProcessor/wrapRichText';\r\nimport RLottiePlayer from '../rlottie/rlottiePlayer';\r\nimport {CustomEmojiRendererElement, SyncedPlayer} from './renderer';\r\n\r\nexport type CustomEmojiElements = Set<CustomEmojiElement>;\r\n\r\nexport default class CustomEmojiElement extends HTMLElement {\r\n  public elements: CustomEmojiElements;\r\n  public renderer: CustomEmojiRendererElement;\r\n  public player: RLottiePlayer | HTMLVideoElement;\r\n  public paused: boolean;\r\n  public syncedPlayer: SyncedPlayer;\r\n  public clean: boolean;\r\n  public lastChildWas: Node;\r\n  // public docId: DocId;\r\n  public placeholder: HTMLImageElement;\r\n  public middlewareHelper: MiddlewareHelper;\r\n  public static: boolean;\r\n  public readyPromise: CancellablePromise<void>;\r\n\r\n  constructor() {\r\n    super();\r\n    this.paused = true;\r\n    this.classList.add('custom-emoji');\r\n  }\r\n\r\n  public get docId() {\r\n    return this.dataset.docId;\r\n  }\r\n\r\n  public set docId(docId: DocId) {\r\n    this.dataset.docId = '' + docId;\r\n  }\r\n\r\n  public static create(docId?: DocId) {\r\n    const element = new CustomEmojiElement();\r\n    if(docId) element.docId = docId;\r\n    return element;\r\n  }\r\n\r\n  public get isConnected() {\r\n    return this.placeholder?.isConnected ?? super.isConnected;\r\n  }\r\n\r\n  public connectedCallback() {\r\n    // if(this.isConnected) {\r\n    //   return;\r\n    // }\r\n\r\n    if(this.player) {\r\n      animationIntersector.addAnimation({\r\n        animation: this,\r\n        group: this.renderer.animationGroup,\r\n        observeElement: this.placeholder ?? this,\r\n        controlled: true,\r\n        type: 'emoji'\r\n      });\r\n    }\r\n\r\n    // this.connectedCallback = undefined;\r\n  }\r\n\r\n  public disconnectedCallback() {\r\n    if(this.isConnected || !this.renderer?.isSelectable) { // prepend on sibling can invoke disconnectedCallback\r\n      return;\r\n    }\r\n\r\n    this.clear();\r\n  }\r\n\r\n  public destroy() {\r\n    this.clear();\r\n  }\r\n\r\n  public clear(replaceChildren = true) {\r\n    if(this.clean) {\r\n      return;\r\n    }\r\n\r\n    // if(this.docId === '5399836826758290421') {\r\n    //   console.log('clear', this, this.isConnected);\r\n    // }\r\n\r\n    this.clean = true;\r\n    this.pause();\r\n\r\n    const {syncedPlayer} = this;\r\n    if(syncedPlayer) {\r\n      syncedPlayer.pausedElements.delete(this);\r\n    }\r\n\r\n    this.middlewareHelper?.clean();\r\n    this.readyPromise?.reject();\r\n\r\n    if(this.renderer) {\r\n      const elements = this.renderer.customEmojis.get(this.docId);\r\n      if(elements?.delete(this) && !elements.size) {\r\n        this.renderer.customEmojis.delete(this.docId);\r\n        this.renderer.textColored.delete(elements);\r\n        this.renderer.playersSynced.delete(elements);\r\n      }\r\n\r\n      if(replaceChildren) {\r\n        if(this.renderer.isSelectable) {\r\n          this.replaceChildren(createCustomFiller(true));\r\n        } else {\r\n          // otherwise https://bugs.chromium.org/p/chromium/issues/detail?id=1144736#c27 will happen\r\n          this.replaceChildren();\r\n        }\r\n      }\r\n    }\r\n\r\n    if(this.player) {\r\n      animationIntersector.removeAnimationByPlayer(this);\r\n    }\r\n\r\n    CustomEmojiRendererElement.globalLazyLoadQueue?.delete({div: this});\r\n\r\n    /* this.disconnectedCallback =  */this.elements =\r\n      this.renderer =\r\n      this.player =\r\n      this.syncedPlayer =\r\n      undefined;\r\n  }\r\n\r\n  public pause() {\r\n    if(this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = true;\r\n\r\n    if(this.player instanceof HTMLVideoElement && !this.syncedPlayer) {\r\n      this.renderer.lastPausedVideo = this.player;\r\n      this.player.pause();\r\n    }\r\n\r\n    if(this.syncedPlayer && !this.syncedPlayer.pausedElements.has(this)) {\r\n      this.syncedPlayer.pausedElements.add(this);\r\n\r\n      if(this.syncedPlayer.player && this.syncedPlayer.pausedElements.size === this.syncedPlayer.middlewares.size) {\r\n        this.syncedPlayer.player.pause();\r\n      }\r\n    }\r\n  }\r\n\r\n  public play() {\r\n    if(!this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = false;\r\n\r\n    if(this.player instanceof HTMLVideoElement) {\r\n      this.player.currentTime = this.renderer.lastPausedVideo?.currentTime ?? this.player.currentTime;\r\n      safePlay(this.player);\r\n    }\r\n\r\n    if(this.syncedPlayer && this.syncedPlayer.pausedElements.has(this)) {\r\n      this.syncedPlayer.pausedElements.delete(this);\r\n\r\n      if(this.syncedPlayer.pausedElements.size !== this.syncedPlayer.middlewares.size) {\r\n        this.player.play();\r\n      }\r\n    }\r\n  }\r\n\r\n  public remove() {\r\n    super.remove();\r\n    this.clear();\r\n    // this.elements = this.renderer = this.player = undefined;\r\n  }\r\n\r\n  public get autoplay() {\r\n    return true;\r\n  }\r\n\r\n  public get loop() {\r\n    return true;\r\n  }\r\n}\r\n\r\ncustomElements.define('custom-emoji-element', CustomEmojiElement);\r\n","import callbackify from './helpers/callbackify';\r\n\r\nexport const CodeLanguageMap: {[key: string]: string[]} = {\r\n  'Markup': [\r\n    'markup',\r\n    'html',\r\n    'xml',\r\n    'svg',\r\n    'mathml',\r\n    'ssml',\r\n    'atom',\r\n    'rss'\r\n  ],\r\n  'CSS': [\r\n    'css'\r\n  ],\r\n  'C-like': [\r\n    'clike'\r\n  ],\r\n  'Regex': [\r\n    'regex'\r\n  ],\r\n  'JavaScript': [\r\n    'javascript',\r\n    'js'\r\n  ],\r\n  'ABAP': [\r\n    'abap'\r\n  ],\r\n  'ABNF': [\r\n    'abnf'\r\n  ],\r\n  'ActionScript': [\r\n    'actionscript'\r\n  ],\r\n  'Ada': [\r\n    'ada'\r\n  ],\r\n  'Agda': [\r\n    'agda'\r\n  ],\r\n  'AL': [\r\n    'al'\r\n  ],\r\n  'ANTLR4': [\r\n    'antlr4',\r\n    'g4'\r\n  ],\r\n  'Apache Configuration': [\r\n    'apacheconf'\r\n  ],\r\n  'SQL': [\r\n    'sql'\r\n  ],\r\n  'Apex': [\r\n    'apex'\r\n  ],\r\n  'APL': [\r\n    'apl'\r\n  ],\r\n  'AppleScript': [\r\n    'applescript'\r\n  ],\r\n  'AQL': [\r\n    'aql'\r\n  ],\r\n  'C': [\r\n    'c'\r\n  ],\r\n  'C++': [\r\n    'cpp'\r\n  ],\r\n  'Arduino': [\r\n    'arduino',\r\n    'ino'\r\n  ],\r\n  'ARFF': [\r\n    'arff'\r\n  ],\r\n  'ARM Assembly': [\r\n    'armasm',\r\n    'arm-asm'\r\n  ],\r\n  'Bash': [\r\n    'bash',\r\n    'sh',\r\n    'shell'\r\n  ],\r\n  'YAML': [\r\n    'yaml',\r\n    'yml'\r\n  ],\r\n  'Markdown': [\r\n    'markdown',\r\n    'md'\r\n  ],\r\n  'Arturo': [\r\n    'arturo',\r\n    'art'\r\n  ],\r\n  'AsciiDoc': [\r\n    'asciidoc',\r\n    'adoc'\r\n  ],\r\n  'C#': [\r\n    'csharp',\r\n    'cs',\r\n    'dotnet'\r\n  ],\r\n  'ASP.NET (C#)': [\r\n    'aspnet'\r\n  ],\r\n  '6502 Assembly': [\r\n    'asm6502'\r\n  ],\r\n  'Atmel AVR Assembly': [\r\n    'asmatmel'\r\n  ],\r\n  'AutoHotkey': [\r\n    'autohotkey'\r\n  ],\r\n  'AutoIt': [\r\n    'autoit'\r\n  ],\r\n  'AviSynth': [\r\n    'avisynth',\r\n    'avs'\r\n  ],\r\n  'Avro IDL': [\r\n    'avro-idl',\r\n    'avdl'\r\n  ],\r\n  'AWK': [\r\n    'awk',\r\n    'gawk'\r\n  ],\r\n  'BASIC': [\r\n    'basic'\r\n  ],\r\n  'Batch': [\r\n    'batch'\r\n  ],\r\n  'BBcode': [\r\n    'bbcode',\r\n    'shortcode'\r\n  ],\r\n  'BBj': [\r\n    'bbj'\r\n  ],\r\n  'Bicep': [\r\n    'bicep'\r\n  ],\r\n  'Birb': [\r\n    'birb'\r\n  ],\r\n  'Bison': [\r\n    'bison'\r\n  ],\r\n  'BNF': [\r\n    'bnf',\r\n    'rbnf'\r\n  ],\r\n  'BQN': [\r\n    'bqn'\r\n  ],\r\n  'Brainfuck': [\r\n    'brainfuck'\r\n  ],\r\n  'BrightScript': [\r\n    'brightscript'\r\n  ],\r\n  'Bro': [\r\n    'bro'\r\n  ],\r\n  'CFScript': [\r\n    'cfscript',\r\n    'cfc'\r\n  ],\r\n  'ChaiScript': [\r\n    'chaiscript'\r\n  ],\r\n  'CIL': [\r\n    'cil'\r\n  ],\r\n  'Cilk/C': [\r\n    'cilkc',\r\n    'cilk-c'\r\n  ],\r\n  'Cilk/C++': [\r\n    'cilkcpp',\r\n    'cilk-cpp',\r\n    'cilk'\r\n  ],\r\n  'Clojure': [\r\n    'clojure'\r\n  ],\r\n  'CMake': [\r\n    'cmake'\r\n  ],\r\n  'COBOL': [\r\n    'cobol'\r\n  ],\r\n  'CoffeeScript': [\r\n    'coffeescript',\r\n    'coffee'\r\n  ],\r\n  'Concurnas': [\r\n    'concurnas',\r\n    'conc'\r\n  ],\r\n  'Content-Security-Policy': [\r\n    'csp'\r\n  ],\r\n  'Cooklang': [\r\n    'cooklang'\r\n  ],\r\n  'Ruby': [\r\n    'ruby',\r\n    'rb'\r\n  ],\r\n  'Crystal': [\r\n    'crystal'\r\n  ],\r\n  'CSV': [\r\n    'csv'\r\n  ],\r\n  'CUE': [\r\n    'cue'\r\n  ],\r\n  'Cypher': [\r\n    'cypher'\r\n  ],\r\n  'D': [\r\n    'd'\r\n  ],\r\n  'Dart': [\r\n    'dart'\r\n  ],\r\n  'DataWeave': [\r\n    'dataweave'\r\n  ],\r\n  'DAX': [\r\n    'dax'\r\n  ],\r\n  'Dhall': [\r\n    'dhall'\r\n  ],\r\n  'Diff': [\r\n    'diff'\r\n  ],\r\n  'Markup templating': [\r\n    'markup-templating'\r\n  ],\r\n  'Django/Jinja2': [\r\n    'django',\r\n    'jinja2'\r\n  ],\r\n  'DNS zone file': [\r\n    'dns-zone-file',\r\n    'dns-zone'\r\n  ],\r\n  'Docker': [\r\n    'docker',\r\n    'dockerfile'\r\n  ],\r\n  'DOT (Graphviz)': [\r\n    'dot',\r\n    'gv'\r\n  ],\r\n  'EBNF': [\r\n    'ebnf'\r\n  ],\r\n  'EditorConfig': [\r\n    'editorconfig'\r\n  ],\r\n  'Eiffel': [\r\n    'eiffel'\r\n  ],\r\n  'EJS': [\r\n    'ejs',\r\n    'eta'\r\n  ],\r\n  'Elixir': [\r\n    'elixir'\r\n  ],\r\n  'Elm': [\r\n    'elm'\r\n  ],\r\n  'Lua': [\r\n    'lua'\r\n  ],\r\n  'Embedded Lua templating': [\r\n    'etlua'\r\n  ],\r\n  'ERB': [\r\n    'erb'\r\n  ],\r\n  'Erlang': [\r\n    'erlang'\r\n  ],\r\n  'Excel Formula': [\r\n    'excel-formula',\r\n    'xlsx',\r\n    'xls'\r\n  ],\r\n  'F#': [\r\n    'fsharp'\r\n  ],\r\n  'Factor': [\r\n    'factor'\r\n  ],\r\n  'False': [\r\n    'false'\r\n  ],\r\n  'Firestore security rules': [\r\n    'firestore-security-rules'\r\n  ],\r\n  'Flow': [\r\n    'flow'\r\n  ],\r\n  'Fortran': [\r\n    'fortran'\r\n  ],\r\n  'FreeMarker Template Language': [\r\n    'ftl'\r\n  ],\r\n  'GameMaker Language': [\r\n    'gml',\r\n    'gamemakerlanguage'\r\n  ],\r\n  'GAP (CAS)': [\r\n    'gap'\r\n  ],\r\n  'G-code': [\r\n    'gcode'\r\n  ],\r\n  'GDScript': [\r\n    'gdscript'\r\n  ],\r\n  'GEDCOM': [\r\n    'gedcom'\r\n  ],\r\n  'gettext': [\r\n    'gettext',\r\n    'po'\r\n  ],\r\n  'Git': [\r\n    'git'\r\n  ],\r\n  'GLSL': [\r\n    'glsl'\r\n  ],\r\n  'GN': [\r\n    'gn',\r\n    'gni'\r\n  ],\r\n  'GNU Linker Script': [\r\n    'linker-script',\r\n    'ld'\r\n  ],\r\n  'Go': [\r\n    'go'\r\n  ],\r\n  'Go module': [\r\n    'go-module',\r\n    'go-mod'\r\n  ],\r\n  'Gradle': [\r\n    'gradle'\r\n  ],\r\n  'GraphQL': [\r\n    'graphql'\r\n  ],\r\n  'Groovy': [\r\n    'groovy'\r\n  ],\r\n  'Less': [\r\n    'less'\r\n  ],\r\n  'Sass (SCSS)': [\r\n    'scss'\r\n  ],\r\n  'Textile': [\r\n    'textile'\r\n  ],\r\n  'Haml': [\r\n    'haml'\r\n  ],\r\n  'Handlebars': [\r\n    'handlebars',\r\n    'hbs',\r\n    'mustache'\r\n  ],\r\n  'Haskell': [\r\n    'haskell',\r\n    'hs'\r\n  ],\r\n  'Haxe': [\r\n    'haxe'\r\n  ],\r\n  'HCL': [\r\n    'hcl'\r\n  ],\r\n  'HLSL': [\r\n    'hlsl'\r\n  ],\r\n  'Hoon': [\r\n    'hoon'\r\n  ],\r\n  'HTTP Public-Key-Pins': [\r\n    'hpkp'\r\n  ],\r\n  'HTTP Strict-Transport-Security': [\r\n    'hsts'\r\n  ],\r\n  'JSON': [\r\n    'json',\r\n    'webmanifest'\r\n  ],\r\n  'URI': [\r\n    'uri',\r\n    'url'\r\n  ],\r\n  'HTTP': [\r\n    'http'\r\n  ],\r\n  'IchigoJam': [\r\n    'ichigojam'\r\n  ],\r\n  'Icon': [\r\n    'icon'\r\n  ],\r\n  'ICU Message Format': [\r\n    'icu-message-format'\r\n  ],\r\n  'Idris': [\r\n    'idris',\r\n    'idr'\r\n  ],\r\n  '.ignore': [\r\n    'ignore',\r\n    'gitignore',\r\n    'hgignore',\r\n    'npmignore'\r\n  ],\r\n  'Inform 7': [\r\n    'inform7'\r\n  ],\r\n  'Ini': [\r\n    'ini'\r\n  ],\r\n  'Io': [\r\n    'io'\r\n  ],\r\n  'J': [\r\n    'j'\r\n  ],\r\n  'Java': [\r\n    'java'\r\n  ],\r\n  'Scala': [\r\n    'scala'\r\n  ],\r\n  'PHP': [\r\n    'php'\r\n  ],\r\n  'JavaDoc-like': [\r\n    'javadoclike'\r\n  ],\r\n  'JavaDoc': [\r\n    'javadoc'\r\n  ],\r\n  'Java stack trace': [\r\n    'javastacktrace'\r\n  ],\r\n  'Jolie': [\r\n    'jolie'\r\n  ],\r\n  'JQ': [\r\n    'jq'\r\n  ],\r\n  'TypeScript': [\r\n    'typescript',\r\n    'ts'\r\n  ],\r\n  'JSDoc': [\r\n    'jsdoc'\r\n  ],\r\n  'N4JS': [\r\n    'n4js',\r\n    'n4jsd'\r\n  ],\r\n  'JSON5': [\r\n    'json5'\r\n  ],\r\n  'JSONP': [\r\n    'jsonp'\r\n  ],\r\n  'JS stack trace': [\r\n    'jsstacktrace'\r\n  ],\r\n  'Julia': [\r\n    'julia'\r\n  ],\r\n  'Keepalived Configure': [\r\n    'keepalived'\r\n  ],\r\n  'Keyman': [\r\n    'keyman'\r\n  ],\r\n  'Kotlin': [\r\n    'kotlin',\r\n    'kt',\r\n    'kts'\r\n  ],\r\n  'Kusto': [\r\n    'kusto'\r\n  ],\r\n  'LaTeX': [\r\n    'latex',\r\n    'tex',\r\n    'context'\r\n  ],\r\n  'Latte': [\r\n    'latte'\r\n  ],\r\n  'Scheme': [\r\n    'scheme'\r\n  ],\r\n  'LilyPond': [\r\n    'lilypond',\r\n    'ly'\r\n  ],\r\n  'Liquid': [\r\n    'liquid'\r\n  ],\r\n  'Lisp': [\r\n    'lisp',\r\n    'emacs',\r\n    'elisp',\r\n    'emacs-lisp'\r\n  ],\r\n  'LiveScript': [\r\n    'livescript'\r\n  ],\r\n  'LLVM IR': [\r\n    'llvm'\r\n  ],\r\n  'Log file': [\r\n    'log'\r\n  ],\r\n  'LOLCODE': [\r\n    'lolcode'\r\n  ],\r\n  'Magma (CAS)': [\r\n    'magma'\r\n  ],\r\n  'Makefile': [\r\n    'makefile'\r\n  ],\r\n  'Mata': [\r\n    'mata'\r\n  ],\r\n  'MATLAB': [\r\n    'matlab'\r\n  ],\r\n  'MAXScript': [\r\n    'maxscript'\r\n  ],\r\n  'MEL': [\r\n    'mel'\r\n  ],\r\n  'Mermaid': [\r\n    'mermaid'\r\n  ],\r\n  'METAFONT': [\r\n    'metafont'\r\n  ],\r\n  'Mizar': [\r\n    'mizar'\r\n  ],\r\n  'MongoDB': [\r\n    'mongodb'\r\n  ],\r\n  'Monkey': [\r\n    'monkey'\r\n  ],\r\n  'MoonScript': [\r\n    'moonscript',\r\n    'moon'\r\n  ],\r\n  'N1QL': [\r\n    'n1ql'\r\n  ],\r\n  'Nand To Tetris HDL': [\r\n    'nand2tetris-hdl'\r\n  ],\r\n  'Naninovel Script': [\r\n    'naniscript',\r\n    'nani'\r\n  ],\r\n  'NASM': [\r\n    'nasm'\r\n  ],\r\n  'NEON': [\r\n    'neon'\r\n  ],\r\n  'Nevod': [\r\n    'nevod'\r\n  ],\r\n  'nginx': [\r\n    'nginx'\r\n  ],\r\n  'Nim': [\r\n    'nim'\r\n  ],\r\n  'Nix': [\r\n    'nix'\r\n  ],\r\n  'NSIS': [\r\n    'nsis'\r\n  ],\r\n  'Objective-C': [\r\n    'objectivec',\r\n    'objc'\r\n  ],\r\n  'OCaml': [\r\n    'ocaml'\r\n  ],\r\n  'Odin': [\r\n    'odin'\r\n  ],\r\n  'OpenCL': [\r\n    'opencl'\r\n  ],\r\n  'OpenQasm': [\r\n    'openqasm',\r\n    'qasm'\r\n  ],\r\n  'Oz': [\r\n    'oz'\r\n  ],\r\n  'PARI/GP': [\r\n    'parigp'\r\n  ],\r\n  'Parser': [\r\n    'parser'\r\n  ],\r\n  'Pascal': [\r\n    'pascal',\r\n    'objectpascal'\r\n  ],\r\n  'Pascaligo': [\r\n    'pascaligo'\r\n  ],\r\n  'PATROL Scripting Language': [\r\n    'psl'\r\n  ],\r\n  'PC-Axis': [\r\n    'pcaxis',\r\n    'px'\r\n  ],\r\n  'PeopleCode': [\r\n    'peoplecode',\r\n    'pcode'\r\n  ],\r\n  'Perl': [\r\n    'perl'\r\n  ],\r\n  'PHPDoc': [\r\n    'phpdoc'\r\n  ],\r\n  'PlantUML': [\r\n    'plant-uml',\r\n    'plantuml'\r\n  ],\r\n  'PL/SQL': [\r\n    'plsql'\r\n  ],\r\n  'PowerQuery': [\r\n    'powerquery',\r\n    'pq',\r\n    'mscript'\r\n  ],\r\n  'PowerShell': [\r\n    'powershell'\r\n  ],\r\n  'Processing': [\r\n    'processing'\r\n  ],\r\n  'Prolog': [\r\n    'prolog'\r\n  ],\r\n  'PromQL': [\r\n    'promql'\r\n  ],\r\n  '.properties': [\r\n    'properties'\r\n  ],\r\n  'Protocol Buffers': [\r\n    'protobuf'\r\n  ],\r\n  'Stylus': [\r\n    'stylus'\r\n  ],\r\n  'Twig': [\r\n    'twig'\r\n  ],\r\n  'Pug': [\r\n    'pug'\r\n  ],\r\n  'Puppet': [\r\n    'puppet'\r\n  ],\r\n  'PureBasic': [\r\n    'purebasic',\r\n    'pbfasm'\r\n  ],\r\n  'Python': [\r\n    'python',\r\n    'py'\r\n  ],\r\n  'Q#': [\r\n    'qsharp',\r\n    'qs'\r\n  ],\r\n  'Q (kdb+ database)': [\r\n    'q'\r\n  ],\r\n  'QML': [\r\n    'qml'\r\n  ],\r\n  'Qore': [\r\n    'qore'\r\n  ],\r\n  'R': [\r\n    'r'\r\n  ],\r\n  'Racket': [\r\n    'racket',\r\n    'rkt'\r\n  ],\r\n  'Razor C#': [\r\n    'cshtml',\r\n    'razor'\r\n  ],\r\n  'React JSX': [\r\n    'jsx'\r\n  ],\r\n  'React TSX': [\r\n    'tsx'\r\n  ],\r\n  'Reason': [\r\n    'reason'\r\n  ],\r\n  'Rego': [\r\n    'rego'\r\n  ],\r\n  'Ren\\'py': [\r\n    'renpy',\r\n    'rpy'\r\n  ],\r\n  'ReScript': [\r\n    'rescript',\r\n    'res'\r\n  ],\r\n  'reST (reStructuredText)': [\r\n    'rest'\r\n  ],\r\n  'Rip': [\r\n    'rip'\r\n  ],\r\n  'Roboconf': [\r\n    'roboconf'\r\n  ],\r\n  'Robot Framework': [\r\n    'robotframework',\r\n    'robot'\r\n  ],\r\n  'Rust': [\r\n    'rust'\r\n  ],\r\n  'SAS': [\r\n    'sas'\r\n  ],\r\n  'Sass (Sass)': [\r\n    'sass'\r\n  ],\r\n  'Shell session': [\r\n    'shell-session',\r\n    'sh-session',\r\n    'shellsession'\r\n  ],\r\n  'Smali': [\r\n    'smali'\r\n  ],\r\n  'Smalltalk': [\r\n    'smalltalk'\r\n  ],\r\n  'Smarty': [\r\n    'smarty'\r\n  ],\r\n  'SML': [\r\n    'sml',\r\n    'smlnj'\r\n  ],\r\n  'Solidity (Ethereum)': [\r\n    'solidity',\r\n    'sol'\r\n  ],\r\n  'Solution file': [\r\n    'solution-file',\r\n    'sln'\r\n  ],\r\n  'Soy (Closure Template)': [\r\n    'soy'\r\n  ],\r\n  'Splunk SPL': [\r\n    'splunk-spl'\r\n  ],\r\n  'SQF: Status Quo Function (Arma 3)': [\r\n    'sqf'\r\n  ],\r\n  'Squirrel': [\r\n    'squirrel'\r\n  ],\r\n  'Stan': [\r\n    'stan'\r\n  ],\r\n  'Stata Ado': [\r\n    'stata'\r\n  ],\r\n  'Structured Text (IEC 61131-3)': [\r\n    'iecst'\r\n  ],\r\n  'SuperCollider': [\r\n    'supercollider',\r\n    'sclang'\r\n  ],\r\n  'Swift': [\r\n    'swift'\r\n  ],\r\n  'Systemd configuration file': [\r\n    'systemd'\r\n  ],\r\n  'T4 templating': [\r\n    't4-templating'\r\n  ],\r\n  'T4 Text Templates (C#)': [\r\n    't4-cs',\r\n    't4'\r\n  ],\r\n  'VB.Net': [\r\n    'vbnet'\r\n  ],\r\n  'T4 Text Templates (VB)': [\r\n    't4-vb'\r\n  ],\r\n  'TAP': [\r\n    'tap'\r\n  ],\r\n  'Tcl': [\r\n    'tcl'\r\n  ],\r\n  'Template Toolkit 2': [\r\n    'tt2'\r\n  ],\r\n  'TOML': [\r\n    'toml'\r\n  ],\r\n  'Tremor': [\r\n    'tremor',\r\n    'trickle',\r\n    'troy'\r\n  ],\r\n  'TypoScript': [\r\n    'typoscript',\r\n    'tsconfig'\r\n  ],\r\n  'UnrealScript': [\r\n    'unrealscript',\r\n    'uscript',\r\n    'uc'\r\n  ],\r\n  'UO Razor Script': [\r\n    'uorazor'\r\n  ],\r\n  'V': [\r\n    'v'\r\n  ],\r\n  'Vala': [\r\n    'vala'\r\n  ],\r\n  'Velocity': [\r\n    'velocity'\r\n  ],\r\n  'Verilog': [\r\n    'verilog'\r\n  ],\r\n  'VHDL': [\r\n    'vhdl'\r\n  ],\r\n  'vim': [\r\n    'vim'\r\n  ],\r\n  'Visual Basic': [\r\n    'visual-basic',\r\n    'vb',\r\n    'vba'\r\n  ],\r\n  'WarpScript': [\r\n    'warpscript'\r\n  ],\r\n  'WebAssembly': [\r\n    'wasm'\r\n  ],\r\n  'Web IDL': [\r\n    'web-idl',\r\n    'webidl'\r\n  ],\r\n  'WGSL': [\r\n    'wgsl'\r\n  ],\r\n  'Wiki markup': [\r\n    'wiki'\r\n  ],\r\n  'Wolfram language': [\r\n    'wolfram',\r\n    'mathematica',\r\n    'nb',\r\n    'wl'\r\n  ],\r\n  'Wren': [\r\n    'wren'\r\n  ],\r\n  'Xeora': [\r\n    'xeora',\r\n    'xeoracube'\r\n  ],\r\n  'Xojo (REALbasic)': [\r\n    'xojo'\r\n  ],\r\n  'XQuery': [\r\n    'xquery'\r\n  ],\r\n  'YANG': [\r\n    'yang'\r\n  ],\r\n  'Zig': [\r\n    'zig'\r\n  ]\r\n};\r\n\r\nexport const CodeLanguageAliases: {[key: string]: string} = {};\r\n\r\nfor(const language in CodeLanguageMap) {\r\n  const aliases = CodeLanguageMap[language];\r\n  aliases.unshift(language.toLowerCase());\r\n  for(let i = 0, l = aliases.length; i < l; ++i) {\r\n    CodeLanguageAliases[aliases[i]] = language;\r\n  }\r\n}\r\n\r\nfunction importPrismLanguage(language: string) {\r\n  const lowerCase = language.toLowerCase();\r\n  const aliases = CodeLanguageMap[CodeLanguageAliases[lowerCase]] || [];\r\n  for(const alias of aliases) {\r\n    if(prism.languages[alias]) {\r\n      return {language: alias, prism};\r\n    }\r\n  }\r\n\r\n  console.error('No prism language ' + lowerCase);\r\n}\r\n\r\nlet prism: any;\r\nexport function importPrism(language: string) {\r\n  if(prism) {\r\n    return callbackify(prism, () => importPrismLanguage(language));\r\n  }\r\n\r\n  const hadBefore = !!window.Prism;\r\n  if(!hadBefore) {\r\n    window.Prism = window.Prism || {} as any;\r\n    window.Prism.manual = true;\r\n  }\r\n\r\n  return prism = import('./vendor/prism').then((module) => {\r\n    const Prism = module.default;\r\n    if(!hadBefore) {\r\n      Prism.hooks.add('wrap', (env) => {\r\n        env.classes.forEach((className, i, arr) => {\r\n          arr[i] = 'prism-' + className;\r\n        });\r\n      });\r\n    }\r\n\r\n    prism = Prism;\r\n    return importPrismLanguage(language);\r\n  });\r\n}\r\n\r\nexport function highlightCode(code: string, _language: string) {\r\n  return callbackify(importPrism(_language), (imported) => {\r\n    if(!imported) {\r\n      console.error(`Language \"${_language}\" is not supported`, code);\r\n      return;\r\n    }\r\n\r\n    const {prism, language} = imported;\r\n    const html: string = prism.highlight(code, prism.languages[language], language);\r\n    return html;\r\n  });\r\n}\r\n\r\n// console.log(Object.keys(LanguageMap).map((key) => LanguageMap[key][0]));\r\n","export default function findIndexFrom<T>(\r\n  arr: T[],\r\n  predicate: (item: T, idx: number, arr: T[]) => boolean,\r\n  i: number = 0\r\n): number {\r\n  for(let length = arr.length; i < length; ++i) {\r\n    if(predicate(arr[i], i, arr)) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n","export default function createElementFromMarkup<T = Element>(markup: string) {\r\n  const div = document.createElement('div');\r\n  div.innerHTML = markup.trim();\r\n  return div.firstElementChild as T;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's animation.ts\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\n\r\ninterface AnimationInstance {\r\n  isCancelled: boolean;\r\n  deferred: CancellablePromise<void>\r\n}\r\n\r\ntype AnimationInstanceKey = any;\r\nconst instances: Map<AnimationInstanceKey, AnimationInstance> = new Map();\r\n\r\nexport function createAnimationInstance(key: AnimationInstanceKey) {\r\n  cancelAnimationByKey(key);\r\n\r\n  const instance: AnimationInstance = {\r\n    isCancelled: false,\r\n    deferred: deferredPromise<void>()\r\n  };\r\n\r\n  instances.set(key, instance);\r\n  instance.deferred.then(() => {\r\n    if(getAnimationInstance(key) === instance) {\r\n      instances.delete(key);\r\n    }\r\n  });\r\n\r\n  return instance;\r\n}\r\n\r\nexport function getAnimationInstance(key: AnimationInstanceKey) {\r\n  return instances.get(key);\r\n}\r\n\r\nexport function cancelAnimationByKey(key: AnimationInstanceKey) {\r\n  const instance = getAnimationInstance(key);\r\n  if(instance) {\r\n    instance.isCancelled = true;\r\n    instance.deferred.resolve();\r\n  }\r\n}\r\n\r\nexport function animateSingle(tick: Function, key: AnimationInstanceKey, instance?: AnimationInstance) {\r\n  if(!instance) {\r\n    instance = createAnimationInstance(key);\r\n  }\r\n\r\n  fastRaf(() => {\r\n    if(instance.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    if(tick()) {\r\n      animateSingle(tick, key, instance);\r\n    } else {\r\n      instance.deferred.resolve();\r\n    }\r\n  });\r\n\r\n  return instance.deferred;\r\n}\r\n\r\nexport function animate(tick: Function) {\r\n  fastRaf(() => {\r\n    if(tick()) {\r\n      animate(tick);\r\n    }\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Awaited} from '../types';\r\n\r\nexport default function callbackifyAll<T extends readonly unknown[] | [], R extends any>(\r\n  values: T,\r\n  callback: (result: { -readonly [P in keyof T]: Awaited<T[P]> }) => R\r\n): Promise<Awaited<R>> | R {\r\n  if(values.some((value) => value instanceof Promise)) {\r\n    return Promise.all(values).then(callback as any);\r\n  } else {\r\n    return callback(values as any);\r\n  }\r\n}\r\n","export default function getUnsafeRandomInt(min: number, max: number) {\r\n  min = Math.ceil(min);\r\n  max = Math.floor(max);\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n","import {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {logger} from '../lib/logger';\r\n\r\nimport animationIntersector from './animationIntersector';\r\n\r\nexport default class BluffSpoilerController {\r\n  private static log = logger('bluff-spoiler');\r\n\r\n  private static style: HTMLStyleElement;\r\n  private static lastDrawTime: number = 0;\r\n  private static DRAW_INTERVAL = 4 * (1000 / 60); // Once in 4 frames (considering 60fps) to avoid performance issues\r\n\r\n  private static reconnectIntervalId: number;\r\n  private static allWeakRefs: WeakRef<HTMLElement>[] = [];\r\n  private static reconnectCallbacks = new WeakMap<HTMLElement, (el: HTMLElement) => void>();\r\n  private static RECONNECT_INTERVAL = 250;\r\n\r\n  public static instancesCount = 0;\r\n\r\n  private static getStyleSheet() {\r\n    if(this.style) return this.style;\r\n\r\n    this.log('Creating style element');\r\n\r\n    this.style = document.createElement('style');\r\n    document.head.appendChild(this.style);\r\n\r\n    return this.style;\r\n  }\r\n\r\n  public static draw(canvas: HTMLCanvasElement) {\r\n    if(this.lastDrawTime + this.DRAW_INTERVAL > performance.now()) return;\r\n    this.lastDrawTime = performance.now();\r\n\r\n    const style = this.getStyleSheet();\r\n    const imageURL = canvas.toDataURL();\r\n\r\n    style.textContent = `\r\n      .bluff-spoiler {\r\n        mask-image: url(${imageURL});\r\n        opacity: 1;\r\n      }\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Observe if the element is reconnected to the DOM, in case there is still a reference to it\r\n   */\r\n  public static observeReconnection(element: HTMLElement, onReconnect: (el: HTMLElement) => void) {\r\n    const weakRef = new WeakRef(element);\r\n    if(!this.allWeakRefs.find((ref) => ref.deref() === element)) this.allWeakRefs.push(weakRef);\r\n\r\n    this.reconnectCallbacks.set(element, onReconnect);\r\n\r\n    this.initReconnectionInterval();\r\n  }\r\n\r\n  private static initReconnectionInterval() {\r\n    if(this.reconnectIntervalId) return;\r\n\r\n    this.log('Initializing reconnection interval');\r\n\r\n    this.reconnectIntervalId = window.setInterval(() => {\r\n      // animationIntersector.checkAnimations(undefined, 'BLUFF-SPOILER');\r\n\r\n      this.allWeakRefs = this.allWeakRefs.filter((weakRef) => {\r\n        const el = weakRef.deref();\r\n        if(!el) return false;\r\n\r\n        const animations = animationIntersector.getAnimations(el);\r\n        const reconnectCallback = this.reconnectCallbacks.get(el);\r\n        if(!animations?.length && el.isConnected) {\r\n          reconnectCallback(el);\r\n          this.log('Reconnected element');\r\n        }\r\n\r\n        return true;\r\n      });\r\n      if(!this.allWeakRefs.length) {\r\n        window.clearInterval(this.reconnectIntervalId);\r\n        this.reconnectIntervalId = undefined;\r\n\r\n        this.log('Removing reconnection interval');\r\n      }\r\n    }, this.RECONNECT_INTERVAL);\r\n  }\r\n\r\n  public static destroy() {\r\n    this.style?.remove();\r\n    this.style = undefined;\r\n\r\n    this.log('Destroying style element');\r\n  }\r\n}\r\n\r\nMOUNT_CLASS_TO['BluffSpoilerController'] = BluffSpoilerController;\r\n","/**\r\n * https://github.com/gre/bezier-easing\r\n * BezierEasing - use bezier curve for transition easing function\r\n * by Gaëtan Renaudeau 2014 - 2015 – MIT License\r\n */\r\n\r\n// These values are established by empiricism with tests (tradeoff: performance VS precision)\r\nvar NEWTON_ITERATIONS = 4;\r\nvar NEWTON_MIN_SLOPE = 0.001;\r\nvar SUBDIVISION_PRECISION = 0.0000001;\r\nvar SUBDIVISION_MAX_ITERATIONS = 10;\r\n\r\nvar kSplineTableSize = 11;\r\nvar kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\r\n\r\nvar float32ArraySupported = typeof Float32Array === 'function';\r\n\r\nexport interface EasingFunction { (input: number): number }\r\n\r\nfunction A(aA1: number, aA2: number) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }\r\nfunction B(aA1: number, aA2: number) { return 3.0 * aA2 - 6.0 * aA1; }\r\nfunction C(aA1: number)      { return 3.0 * aA1; }\r\n\r\n// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\r\nfunction calcBezier(aT: number, aA1: number, aA2: number) { return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT; }\r\n\r\n// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\r\nfunction getSlope(aT: number, aA1: number, aA2: number) { return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1); }\r\n\r\nfunction binarySubdivide(aX: number, aA: number, aB: number, mX1: number, mX2: number) {\r\n  var currentX, currentT, i = 0;\r\n  do {\r\n    currentT = aA + (aB - aA) / 2.0;\r\n    currentX = calcBezier(currentT, mX1, mX2) - aX;\r\n    if(currentX > 0.0) {\r\n      aB = currentT;\r\n    } else {\r\n      aA = currentT;\r\n    }\r\n  } while(Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);\r\n  return currentT;\r\n}\r\n\r\nfunction newtonRaphsonIterate(aX: number, aGuessT: number, mX1: number, mX2: number) {\r\n  for(var i = 0; i < NEWTON_ITERATIONS; ++i) {\r\n    var currentSlope = getSlope(aGuessT, mX1, mX2);\r\n    if(currentSlope === 0.0) {\r\n      return aGuessT;\r\n    }\r\n    var currentX = calcBezier(aGuessT, mX1, mX2) - aX;\r\n    aGuessT -= currentX / currentSlope;\r\n  }\r\n  return aGuessT;\r\n}\r\n\r\nfunction LinearEasing(x: number) {\r\n  return x;\r\n}\r\n\r\nexport default function BezierEasing(mX1: number, mY1: number, mX2: number, mY2: number): EasingFunction {\r\n  if(!(0 <= mX1 && mX1 <= 1 && 0 <= mX2 && mX2 <= 1)) {\r\n    throw new Error('bezier x values must be in [0, 1] range');\r\n  }\r\n\r\n  if(mX1 === mY1 && mX2 === mY2) {\r\n    return LinearEasing;\r\n  }\r\n\r\n  // Precompute samples table\r\n  var sampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);\r\n  for(var i = 0; i < kSplineTableSize; ++i) {\r\n    sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\r\n  }\r\n\r\n  function getTForX(aX: number) {\r\n    var intervalStart = 0.0;\r\n    var currentSample = 1;\r\n    var lastSample = kSplineTableSize - 1;\r\n\r\n    for(; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {\r\n      intervalStart += kSampleStepSize;\r\n    }\r\n    --currentSample;\r\n\r\n    // Interpolate to provide an initial guess for t\r\n    var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);\r\n    var guessForT = intervalStart + dist * kSampleStepSize;\r\n\r\n    var initialSlope = getSlope(guessForT, mX1, mX2);\r\n    if(initialSlope >= NEWTON_MIN_SLOPE) {\r\n      return newtonRaphsonIterate(aX, guessForT, mX1, mX2);\r\n    } else if(initialSlope === 0.0) {\r\n      return guessForT;\r\n    } else {\r\n      return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);\r\n    }\r\n  }\r\n\r\n  return function BezierEasing(x: number) {\r\n    // Because JavaScript number are imprecise, we should guarantee the extremes are right.\r\n    if(x === 0 || x === 1) {\r\n      return x;\r\n    }\r\n    return calcBezier(getTForX(x), mY1, mY2);\r\n  };\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {WallPaper} from '../layer';\r\nimport clamp from './number/clamp';\r\n\r\nexport type ColorHsla = {\r\n  h: number,\r\n  s: number,\r\n  l: number,\r\n  a: number\r\n};\r\n\r\nexport type ColorRgba = [number, number, number, number];\r\nexport type ColorRgb = [number, number, number];\r\n\r\n/**\r\n * https://stackoverflow.com/a/54070620/6758968\r\n * r, g, b in [0, 255]\r\n * @returns h in [0,360) and s, v in [0,1]\r\n */\r\nexport function rgbToHsv(r: number, g: number, b: number): [number, number, number] {\r\n  r /= 255, g /= 255, b /= 255;\r\n  const v = Math.max(r, g, b),\r\n    c = v - Math.min(r, g, b);\r\n  const h = c && ((v === r) ? (g - b ) / c : ((v == g) ? 2 + (b - r) / c : 4 + (r - g) / c));\r\n  return [60 * (h < 0 ? h + 6 : h), v && c / v, v];\r\n}\r\n\r\n/**\r\n * https://stackoverflow.com/a/54024653/6758968\r\n * @param h [0, 360]\r\n * @param s [0, 1]\r\n * @param v [0, 1]\r\n * @returns r, g, b in [0, 255]\r\n */\r\nexport function hsvToRgb(h: number, s: number, v: number): ColorRgb {\r\n  const f = (n: number, k: number = (n + h / 60) % 6) => Math.round((v - v * s * Math.max(Math.min(k, 4 - k, 1), 0)) * 255);\r\n  return [f(5), f(3), f(1)];\r\n}\r\n\r\n/**\r\n * @returns h [0, 360], s [0, 100], l [0, 100], a [0, 1]\r\n */\r\nexport function rgbaToHsla(r: number, g: number, b: number, a: number = 1): ColorHsla {\r\n  r /= 255, g /= 255, b /= 255;\r\n  const max = Math.max(r, g, b),\r\n    min = Math.min(r, g, b);\r\n  let h: number, s: number;\r\n  const l = (max + min) / 2;\r\n\r\n  if(max === min) {\r\n    h = s = 0; // achromatic\r\n  } else {\r\n    const d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n    switch(max) {\r\n      case r:\r\n        h = (g - b) / d + (g < b ? 6 : 0);\r\n        break;\r\n      case g:\r\n        h = (b - r) / d + 2;\r\n        break;\r\n      case b:\r\n        h = (r - g) / d + 4;\r\n        break;\r\n    }\r\n    h /= 6;\r\n  }\r\n\r\n  return {\r\n    h: h * 360,\r\n    s: s * 100,\r\n    l: l * 100,\r\n    a\r\n  };\r\n}\r\n\r\nexport function hslaToString(hsla: ColorHsla) {\r\n  return `hsla(${hsla.h}, ${hsla.s}%, ${hsla.l}%, ${hsla.a})`;\r\n}\r\n\r\n// * https://stackoverflow.com/a/9493060/6758968\r\n/**\r\n * Converts an HSL color value to RGB. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n *\r\n * @param   {number}  h       The hue [0, 360]\r\n * @param   {number}  s       The saturation [0, 1]\r\n * @param   {number}  l       The lightness [0, 1]\r\n * @return  {Array}           The RGB representation [0, 255]\r\n */\r\nexport function hslaToRgba(h: number, s: number, l: number, a: number): ColorRgba {\r\n  h /= 360, s /= 100, l /= 100;\r\n  let r: number, g: number, b: number;\r\n\r\n  if(s === 0) {\r\n    r = g = b = l; // achromatic\r\n  } else {\r\n    const hue2rgb = function hue2rgb(p: number, q: number, t: number) {\r\n      if(t < 0) t += 1;\r\n      if(t > 1) t -= 1;\r\n      if(t < 1/6) return p + (q - p) * 6 * t;\r\n      if(t < 1/2) return q;\r\n      if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n      return p;\r\n    }\r\n\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n    r = hue2rgb(p, q, h + 1/3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1/3);\r\n  }\r\n\r\n  return [r, g, b, a].map((v) => Math.round(v * 255)) as ColorRgba;\r\n}\r\n\r\nexport function hslaStringToRgba(hsla: string) {\r\n  const splitted = hsla.slice(5, -1).split(', ');\r\n  const alpha = +splitted.pop();\r\n  const arr = splitted.map((val) => {\r\n    if(val.endsWith('%')) {\r\n      return +val.slice(0, -1);\r\n    }\r\n\r\n    return +val;\r\n  });\r\n\r\n  return hslaToRgba(arr[0], arr[1], arr[2], alpha);\r\n}\r\n\r\nexport function hexaToRgba(hexa: string) {\r\n  const arr: ColorRgba = [] as any;\r\n  const offset = hexa[0] === '#' ? 1 : 0;\r\n  if(hexa.length === (5 + offset)) {\r\n    hexa = (offset ? '#' : '') + '0' + hexa.slice(offset);\r\n  }\r\n\r\n  if(hexa.length === (3 + offset)) {\r\n    for(let i = offset; i < hexa.length; ++i) {\r\n      arr.push(parseInt(hexa[i] + hexa[i], 16));\r\n    }\r\n  } else if(hexa.length === (4 + offset)) {\r\n    for(let i = offset; i < (hexa.length - 1); ++i) {\r\n      arr.push(parseInt(hexa[i] + hexa[i], 16));\r\n    }\r\n\r\n    arr.push(parseInt(hexa[hexa.length - 1], 16));\r\n  } else {\r\n    for(let i = offset; i < hexa.length; i += 2) {\r\n      arr.push(parseInt(hexa.slice(i, i + 2), 16));\r\n    }\r\n  }\r\n\r\n  return arr;\r\n}\r\n\r\nexport function hexToRgb(hex: string) {\r\n  return hexaToRgba(hex.slice(0, 7)) as any as ColorRgb;\r\n}\r\n\r\nexport function hexaToHsla(hexa: string) {\r\n  const rgba = hexaToRgba(hexa);\r\n  return rgbaToHsla(rgba[0], rgba[1], rgba[2], rgba[3]);\r\n}\r\n\r\nexport function rgbaToHexa(rgba: ColorRgba | ColorRgb) {\r\n  return '#' + rgba.map((v) => ('0' + v.toString(16)).slice(-2)).join('');\r\n}\r\n\r\nexport function hslaStringToHexa(hsla: string) {\r\n  return rgbaToHexa(hslaStringToRgba(hsla));\r\n}\r\n\r\nexport function hslaStringToHex(hsla: string) {\r\n  return hslaStringToHexa(hsla).slice(0, -2);\r\n}\r\n\r\n/**\r\n * @param weight [0, 1]\r\n */\r\nexport function mixColors(color1: ColorRgb, color2: ColorRgb, weight: number) {\r\n  const out = new Array<number>(3) as ColorRgb;\r\n  for(let i = 0; i < 3; ++i) {\r\n    const v1 = color1[i], v2 = color2[i];\r\n    out[i] = Math.floor(v2 + (v1 - v2) * weight);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport function computePerceivedBrightness(color: ColorRgb) {\r\n  return (color[0] * 0.2126 + color[1] * 0.7152 + color[2] * 0.0722) / 255;\r\n}\r\n\r\nexport function getAverageColor(color1: ColorRgb, color2: ColorRgb): ColorRgb {\r\n  return color1.map((v, i) => Math.round((v + color2[i]) / 2)) as ColorRgb;\r\n}\r\n\r\nexport function getAccentColor(baseHsv: number[], baseColor: ColorRgb, elementColor: ColorRgb): ColorRgb {\r\n  const hsvTemp3 = rgbToHsv(...baseColor);\r\n  const hsvTemp4 = rgbToHsv(...elementColor);\r\n\r\n  const dist = Math.min(1.5 * hsvTemp3[1] / baseHsv[1], 1);\r\n\r\n  hsvTemp3[0] = Math.min(360, hsvTemp4[0] - hsvTemp3[0] + baseHsv[0]);\r\n  hsvTemp3[1] = Math.min(1, hsvTemp4[1] * baseHsv[1] / hsvTemp3[1]);\r\n  hsvTemp3[2] = Math.min(1, (hsvTemp4[2] / hsvTemp3[2] + dist - 1) * baseHsv[2] / dist);\r\n  if(hsvTemp3[2] < 0.3) {\r\n    return elementColor;\r\n  }\r\n  return hsvToRgb(...hsvTemp3);\r\n}\r\n\r\nexport function changeColorAccent(baseHsv: number[], accentHsv: number[], color: ColorRgb, isDarkTheme: boolean) {\r\n  const colorHsv = rgbToHsv(...color);\r\n\r\n  const diffH = Math.min(Math.abs(colorHsv[0] - baseHsv[0]), Math.abs(colorHsv[0] - baseHsv[0] - 360));\r\n  if(diffH > 30) {\r\n    return color;\r\n  }\r\n\r\n  const dist = baseHsv[1] ? Math.min(1.5 * colorHsv[1] / baseHsv[1], 1) : 0;\r\n\r\n  colorHsv[0] = Math.min(360, colorHsv[0] + accentHsv[0] - baseHsv[0]);\r\n  colorHsv[1] = baseHsv[1] ? Math.min(1, colorHsv[1] * accentHsv[1] / baseHsv[1]) : 0;\r\n  colorHsv[2] = baseHsv[2] ? Math.min(1, colorHsv[2] * (1 - dist + dist * accentHsv[2] / baseHsv[2])) : 0;\r\n\r\n  let newColor = hsvToRgb(...colorHsv);\r\n\r\n  const origBrightness = computePerceivedBrightness(color);\r\n  const newBrightness = computePerceivedBrightness(newColor);\r\n\r\n  // We need to keep colors lighter in dark themes and darker in light themes\r\n  const needRevertBrightness = isDarkTheme ? origBrightness > newBrightness : origBrightness < newBrightness;\r\n\r\n  if(needRevertBrightness) {\r\n    const amountOfNew = 0.6;\r\n    const fallbackAmount = (1 - amountOfNew) * origBrightness / newBrightness + amountOfNew;\r\n    newColor = changeBrightness(newColor, fallbackAmount);\r\n  }\r\n\r\n  return newColor;\r\n}\r\n\r\nexport function changeBrightness(color: ColorRgb, amount: number) {\r\n  return color.map((v) => clamp(Math.round(v * amount), 0, 255)) as ColorRgb;\r\n}\r\n\r\nexport function getHexColorFromTelegramColor(color: number) {\r\n  const hex = (color < 0 ? 0xFFFFFF + color : color).toString(16);\r\n  return '#' + (hex.length >= 6 ? hex : '0'.repeat(6 - hex.length) + hex);\r\n}\r\n\r\nexport function getRgbColorFromTelegramColor(color: number) {\r\n  return hexToRgb(getHexColorFromTelegramColor(color));\r\n}\r\n\r\nexport function getColorsFromWallPaper(wallPaper: WallPaper) {\r\n  return wallPaper.settings ? [\r\n    wallPaper.settings.background_color,\r\n    wallPaper.settings.second_background_color,\r\n    wallPaper.settings.third_background_color,\r\n    wallPaper.settings.fourth_background_color\r\n  ].filter(Boolean).map(getHexColorFromTelegramColor).join(',') : '';\r\n}\r\n\r\nexport function rgbaToRgb(rgba: ColorRgba, bg: ColorRgb): ColorRgb {\r\n  const a = rgba[3];\r\n  return rgba.slice(0, 3).map((color, idx) => {\r\n    return clamp(Math.round((a * (color / 255) + (a * (bg[idx] / 255))) * 255), 0, 255);\r\n  }) as ColorRgb;\r\n}\r\n\r\nexport function calculateLuminance(rgb: ColorRgb) {\r\n  const [r, g, b] = rgb;\r\n  const luminance = (0.2126 * r / 255 + 0.7152 * g / 255 + 0.0722 * b / 255);\r\n  return luminance;\r\n}\r\n\r\nexport function getTextColor(luminance: number): ColorRgb {\r\n  return luminance > 0.5 ? [0, 0, 0] : [255, 255, 255];\r\n}\r\n\r\nexport function calculateOpacity(luminance: number, targetContrast: number) {\r\n  const targetTextLuminance = luminance > 0.5 ? 0 : 1;\r\n  const adaptiveOpacity = (luminance - targetTextLuminance + targetContrast) / targetContrast;\r\n  const opacity = +Math.max(0.5, Math.min(0.64, adaptiveOpacity)).toFixed(2);\r\n\r\n  return opacity;\r\n}\r\n","import {getOwner, runWithOwner} from 'solid-js';\r\n\r\nimport BezierEasing from '../../vendor/bezierEasing';\r\nimport {logger} from '../../lib/logger';\r\nimport {hexaToHsla} from '../../helpers/color';\r\n\r\nimport {FontInfo, FontKey} from './types';\r\n\r\nexport const delay = (timeout: number) => new Promise((resolve) => setTimeout(resolve, timeout));\r\n\r\nexport const log = logger('Media editor');\r\n\r\nexport function withCurrentOwner<Args extends Array<unknown>, Result>(fn: (...args: Args) => Result) {\r\n  const owner = getOwner();\r\n  return (...args: Args) => {\r\n    return runWithOwner(owner, () => fn(...args));\r\n  };\r\n}\r\n\r\nexport function distance(p1: [number, number], p2: [number, number]) {\r\n  return Math.hypot(p1[0] - p2[0], p1[1] - p2[1]);\r\n}\r\n\r\nexport function snapToViewport(ratio: number, vw: number, vh: number) {\r\n  if(vw / ratio > vh) vw = vh * ratio;\r\n  else vh = vw / ratio;\r\n\r\n  return [vw, vh] as [number, number];\r\n}\r\n\r\nexport function getSnappedViewportsScale(ratio: number, vw1: number, vh1: number, vw2: number, vh2: number) {\r\n  [vw1, vh1] = snapToViewport(ratio, vw1, vh1);\r\n  [vw2, vh2] = snapToViewport(ratio, vw2, vh2);\r\n\r\n  return Math.max(vw1 / vw2, vh1 / vh2);\r\n}\r\n\r\nexport function getContrastColor(color: string) {\r\n  return hexaToHsla(color).l < 80 ? '#ffffff' : '#000000';\r\n}\r\n\r\nexport function lerp(min: number, max: number, progress: number) {\r\n  return min + (max - min) * progress;\r\n}\r\n\r\nexport function lerpArray(min: number[], max: number[], progress: number) {\r\n  return min.map((start, index) => start + (max[index] - start) * progress);\r\n}\r\n\r\n\r\ntype AnimateValueOptions = {\r\n  easing?: (progress: number) => number;\r\n  onEnd?: () => void;\r\n};\r\n\r\nconst defaultEasing = BezierEasing(0.42, 0.0, 0.58, 1.0)\r\nexport const simpleEasing = BezierEasing(0.25, 0.1, 0.25, 1);\r\n\r\nexport function animateValue<T extends number | number[]>(\r\n  start: T,\r\n  end: T,\r\n  duration: number,\r\n  callback: (value: T) => void,\r\n  {easing = defaultEasing, onEnd = () => {}}: AnimateValueOptions = {}\r\n) {\r\n  let startTime: number;\r\n  let canceled = false;\r\n\r\n  function animateFrame(currentTime: number) {\r\n    if(canceled) return;\r\n    if(!startTime) startTime = currentTime;\r\n\r\n    const elapsed = currentTime - startTime;\r\n    const progress = Math.min(elapsed / duration, 1);\r\n    const easedProgress = easing(progress);\r\n\r\n    if(start instanceof Array && end instanceof Array) {\r\n      const currentValues = start.map((startVal, index) => lerp(startVal, end[index], easedProgress));\r\n      callback(currentValues as T);\r\n    } else {\r\n      callback(lerp(start as number, end as number, easedProgress) as T);\r\n    }\r\n\r\n    if(progress < 1) {\r\n      requestAnimationFrame(animateFrame);\r\n    } else {\r\n      onEnd();\r\n    }\r\n  }\r\n\r\n  requestAnimationFrame(animateFrame);\r\n\r\n  return () => {\r\n    canceled = true;\r\n  };\r\n}\r\n\r\nexport const fontInfoMap: Record<FontKey, FontInfo> = {\r\n  roboto: {\r\n    fontFamily: '\\'Roboto\\'',\r\n    fontWeight: 500,\r\n    baseline: 0.75\r\n  },\r\n  suez: {\r\n    fontFamily: '\\'Suez One\\'',\r\n    fontWeight: 400,\r\n    baseline: 0.75\r\n  },\r\n  bubbles: {\r\n    fontFamily: '\\'Rubik Bubbles\\'',\r\n    fontWeight: 400,\r\n    baseline: 0.75\r\n  },\r\n  playwrite: {\r\n    fontFamily: '\\'Playwrite BE VLG\\'',\r\n    fontWeight: 400,\r\n    baseline: 0.85\r\n  },\r\n  chewy: {\r\n    fontFamily: '\\'Chewy\\'',\r\n    fontWeight: 400,\r\n    baseline: 0.75\r\n  },\r\n  courier: {\r\n    fontFamily: '\\'Courier Prime\\'',\r\n    fontWeight: 700,\r\n    baseline: 0.65\r\n  },\r\n  fugaz: {\r\n    fontFamily: '\\'Fugaz One\\'',\r\n    fontWeight: 400,\r\n    baseline: 0.75\r\n  },\r\n  sedan: {\r\n    fontFamily: '\\'Sedan\\'',\r\n    fontWeight: 400,\r\n    baseline: 0.75\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * thanks https://github.com/dkaraush/particles for webgl version\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_MOBILE} from '../environment/userAgent';\r\nimport {animate} from '../helpers/animation';\r\nimport callbackify from '../helpers/callbackify';\r\nimport callbackifyAll from '../helpers/callbackifyAll';\r\nimport deferredPromise from '../helpers/cancellablePromise';\r\nimport {Middleware} from '../helpers/middleware';\r\nimport clamp from '../helpers/number/clamp';\r\nimport getUnsafeRandomInt from '../helpers/number/getUnsafeRandomInt';\r\nimport {applyColorOnContext} from '../lib/rlottie/rlottiePlayer';\r\nimport animationIntersector, {AnimationItemGroup, AnimationItemWrapper} from './animationIntersector';\r\nimport BluffSpoilerController from './bluffSpoilerController';\r\nimport {animateValue, simpleEasing} from './mediaEditor/utils';\r\n\r\nexport class AnimationItemNested implements AnimationItemWrapper {\r\n  public autoplay = true;\r\n  public loop = true;\r\n  public paused = true;\r\n\r\n  constructor(private options: {\r\n    onPlay: () => void,\r\n    onPause: () => void,\r\n    onDestroy?: () => void\r\n  }) {}\r\n\r\n  public remove() {\r\n    this.pause();\r\n    this.options.onDestroy?.();\r\n  }\r\n\r\n  public play() {\r\n    if(!this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = false;\r\n    this.options.onPlay();\r\n  }\r\n\r\n  public pause() {\r\n    if(this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = true;\r\n    this.options.onPause();\r\n  }\r\n}\r\n\r\nfunction getDefaultParticlesCount(width: number, height: number) {\r\n  return clamp(width * height / (500 * 500) * 1000 * (IS_MOBILE ? 5 : 10), 500, 10000);\r\n}\r\n\r\n// type DotRendererDot = {\r\n//   x: number,\r\n//   y: number,\r\n//   opacity: number,\r\n//   radius: number\r\n//   mOpacity: number,\r\n//   adding: boolean,\r\n//   counter: number,\r\n//   path: Path2D\r\n// };\r\nexport default class DotRenderer implements AnimationItemWrapper {\r\n  private static shaderTexts: {[url: string]: string | Promise<string>} = {};\r\n  private static createdIndex = -1;\r\n\r\n  private static imageSpoilerInstance: DotRenderer;\r\n  private static textSpoilerInstance: DotRenderer;\r\n\r\n  private static createdImageSpoilers = new WeakMap<HTMLCanvasElement, ReturnType<(typeof DotRenderer)['create']>>();\r\n\r\n  private drawCallbacks: Map<HTMLElement, () => void> = new Map();\r\n  private targetCanvasesCount = 0;\r\n\r\n  public canvas: HTMLCanvasElement;\r\n  private context: WebGL2RenderingContext;\r\n  // private dots: DotRendererDot[];\r\n\r\n  private reset = true;\r\n  private buffer: WebGLBuffer[];\r\n  private bufferParticlesCount: number;\r\n  private program: WebGLProgram;\r\n  private timeHandle: WebGLUniformLocation;\r\n  private deltaTimeHandle: WebGLUniformLocation;\r\n  private sizeHandle: WebGLUniformLocation;\r\n  private resetHandle: WebGLUniformLocation;\r\n  private radiusHandle: WebGLUniformLocation;\r\n  private seedHandle: WebGLUniformLocation;\r\n  private noiseScaleHandle: WebGLUniformLocation;\r\n  private noiseSpeedHandle: WebGLUniformLocation;\r\n  private dampingMultHandle: WebGLUniformLocation;\r\n  private velocityMultHandle: WebGLUniformLocation;\r\n  private forceMultHandle: WebGLUniformLocation;\r\n  private longevityHandle: WebGLUniformLocation;\r\n  private maxVelocityHandle: WebGLUniformLocation;\r\n  private noiseMovementHandle: WebGLUniformLocation;\r\n  private colorHandle: WebGLUniformLocation;\r\n  private lastDrawTime: number;\r\n  private time: number;\r\n  private bufferIndex: number;\r\n  private inited: boolean;\r\n\r\n  private config: {\r\n    particlesCount: number,\r\n    radius: number,\r\n    seed: number,\r\n    noiseScale: number,\r\n    noiseSpeed: number,\r\n    forceMult: number,\r\n    velocityMult: number,\r\n    dampingMult: number,\r\n    maxVelocity: number,\r\n    longevity: number,\r\n    noiseMovement: number,\r\n    timeScale: number,\r\n    color: number\r\n  };\r\n\r\n  public paused: boolean;\r\n  public autoplay: boolean;\r\n  public tempId: number;\r\n\r\n  private dpr: number;\r\n  private width: number;\r\n  private height: number;\r\n  private multiply: number;\r\n\r\n  public loop: boolean = true;\r\n  private initPromise: MaybePromise<boolean>;\r\n\r\n  constructor() {\r\n    const canvas = this.canvas = document.createElement('canvas');\r\n    this.dpr = window.devicePixelRatio;\r\n    canvas.classList.add('canvas-thumbnail', 'canvas-dots');\r\n\r\n    this.paused = true;\r\n    this.autoplay = true;\r\n    this.tempId = 0;\r\n    this.time = 0;\r\n    this.bufferIndex = 0;\r\n    // this.context = canvas.getContext('2d');\r\n    this.context = canvas.getContext('webgl2'/* , {preserveDrawingBuffer: true} */);\r\n  }\r\n\r\n  private resize(width: number, height: number, multiply?: number, config: Partial<DotRenderer['config']> = {}) {\r\n    this.width = width;\r\n    this.height = height;\r\n    this.multiply = multiply;\r\n    this.canvas.width = width * this.dpr;\r\n    this.canvas.height = height * this.dpr;\r\n    this.config = {\r\n      particlesCount: getDefaultParticlesCount(width, height),\r\n      radius: this.dpr * 1.6,\r\n      seed: Math.random() * 10,\r\n      noiseScale: 6,\r\n      noiseSpeed: .6,\r\n      forceMult: .6,\r\n      velocityMult: 1.,\r\n      dampingMult: .9999,\r\n      maxVelocity: 6.,\r\n      longevity: 1.4,\r\n      noiseMovement: 4,\r\n      timeScale: .65,\r\n      color: 0xffffff,\r\n      ...config\r\n    };\r\n\r\n    if(this.inited) {\r\n      this.draw();\r\n    }\r\n  }\r\n\r\n  private genBuffer() {\r\n    if(this.buffer) {\r\n      this.context.deleteBuffer(this.buffer[0]);\r\n      this.context.deleteBuffer(this.buffer[1]);\r\n    }\r\n\r\n    this.buffer = [];\r\n    for(let i = 0; i < 2; ++i) {\r\n      this.buffer[i] = this.context.createBuffer();\r\n      this.context.bindBuffer(this.context.ARRAY_BUFFER, this.buffer[i]);\r\n      this.context.bufferData(this.context.ARRAY_BUFFER, (this.bufferParticlesCount = Math.ceil(this.config.particlesCount)) * 6 * 4, this.context.DYNAMIC_DRAW);\r\n    }\r\n  }\r\n\r\n  private compileShader(type: number, path: string) {\r\n    const shader = this.context.createShader(type);\r\n    const shaderTextResult = DotRenderer.shaderTexts[path] ??=\r\n      fetch(path)\r\n      .then((response) => response.text())\r\n      .then((text) => DotRenderer.shaderTexts[path] = text + '\\n//' + Math.random());\r\n    return callbackify(shaderTextResult, (shaderText) => {\r\n      this.context.shaderSource(shader, shaderText);\r\n      this.context.compileShader(shader);\r\n      if(!this.context.getShaderParameter(shader, this.context.COMPILE_STATUS)) {\r\n        throw 'compile shader error:\\n' + this.context.getShaderInfoLog(shader);\r\n      }\r\n      return shader;\r\n    });\r\n  }\r\n\r\n  private compileShaders() {\r\n    return callbackifyAll([\r\n      this.compileShader(this.context.VERTEX_SHADER, 'assets/img/spoiler_vertex.glsl'),\r\n      this.compileShader(this.context.FRAGMENT_SHADER, 'assets/img/spoiler_fragment.glsl')\r\n    ], (result) => result);\r\n  }\r\n\r\n  // private prepare() {\r\n  //   let count = Math.round(this.width * this.height / (35 * (IS_MOBILE ? 2 : 1)));\r\n  //   count *= this.multiply || 1;\r\n  //   count = Math.min(!liteMode.isAvailable('chat_spoilers') ? 400 : IS_MOBILE ? 1000 : 2200, count);\r\n  //   count = Math.round(count);\r\n  //   const dots: DotRendererDot[] = this.dots = new Array(count);\r\n\r\n  //   for(let i = 0; i < count; ++i) {\r\n  //     dots[i] = this.generateDot();\r\n  //   }\r\n  // }\r\n\r\n  // private generateDot(adding?: boolean): DotRendererDot {\r\n  //   const x = Math.floor(Math.random() * this.canvas.width);\r\n  //   const y = Math.floor(Math.random() * this.canvas.height);\r\n  //   const opacity = adding ? 0 : Math.random();\r\n  //   const radius = (Math.random() >= .8 ? 1 : 0.5) * this.dpr;\r\n  //   const path = new Path2D();\r\n  //   path.arc(x, y, radius, 0, 2 * Math.PI, false);\r\n  //   return {\r\n  //     x,\r\n  //     y,\r\n  //     opacity,\r\n  //     radius,\r\n  //     mOpacity: opacity,\r\n  //     adding: adding ?? Math.random() >= .5,\r\n  //     counter: 0,\r\n  //     path\r\n  //   };\r\n  // }\r\n\r\n  // private draw() {\r\n  //   const {context, canvas, dots} = this;\r\n  //   context.clearRect(0, 0, canvas.width, canvas.height);\r\n  //   context.fillStyle = '#fff';\r\n\r\n  //   const add = 0.02;\r\n  //   for(let i = 0, length = dots.length; i < length; ++i) {\r\n  //     const dot = dots[i];\r\n  //     const addOpacity = dot.adding ? add : -add;\r\n\r\n  //     dot.mOpacity += addOpacity;\r\n  //     // if(dot.mOpacity <= 0) dot.mOpacity = dot.opacity;\r\n\r\n  //     // const easedOpacity = easing(dot.mOpacity);\r\n  //     const easedOpacity = clamp(dot.mOpacity, 0, 1);\r\n  //     context.globalAlpha = easedOpacity;\r\n  //     context.fill(dot.path);\r\n\r\n  //     if(dot.mOpacity <= 0) {\r\n  //       dot.adding = true;\r\n\r\n  //       if(++dot.counter >= 1) {\r\n  //         dots[i] = this.generateDot(dot.adding);\r\n  //       }\r\n  //     } else if(dot.mOpacity >= 1) {\r\n  //       dot.adding = false;\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  private draw() {\r\n    if(!this.inited) {\r\n      return;\r\n    }\r\n\r\n    const gl = this.context;\r\n    const config = this.config;\r\n    const now = Date.now();\r\n    const dt = Math.min((now - this.lastDrawTime) / 1_000, 1) * config.timeScale;\r\n    this.lastDrawTime = now;\r\n\r\n    this.time += dt;\r\n\r\n    if(this.bufferParticlesCount < config.particlesCount) {\r\n      this.genBuffer();\r\n      this.reset = true;\r\n    }\r\n\r\n    gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    gl.useProgram(this.program);\r\n    gl.uniform1f(this.resetHandle, this.reset ? 1 : 0);\r\n    if(this.reset) {\r\n      this.time = 0;\r\n      this.reset = false;\r\n    }\r\n    gl.uniform1f(this.timeHandle, this.time);\r\n    gl.uniform1f(this.deltaTimeHandle, dt);\r\n    gl.uniform2f(this.sizeHandle, this.canvas.width, this.canvas.height);\r\n    gl.uniform1f(this.seedHandle, config.seed);\r\n    gl.uniform1f(this.radiusHandle, config.radius);\r\n    gl.uniform1f(this.noiseScaleHandle, config.noiseScale);\r\n    gl.uniform1f(this.noiseSpeedHandle, config.noiseSpeed);\r\n    gl.uniform1f(this.dampingMultHandle, config.dampingMult);\r\n    gl.uniform1f(this.velocityMultHandle, config.velocityMult);\r\n    gl.uniform1f(this.forceMultHandle, config.forceMult);\r\n    gl.uniform1f(this.longevityHandle, config.longevity);\r\n    gl.uniform1f(this.maxVelocityHandle, config.maxVelocity);\r\n    gl.uniform1f(this.noiseMovementHandle, config.noiseMovement);\r\n    gl.uniform3f(this.colorHandle,\r\n      ((config.color >> 16) & 0xff) / 0xff,\r\n      ((config.color >> 8) & 0xff) / 0xff,\r\n      (config.color & 0xff) / 0xff\r\n    );\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer[this.bufferIndex]);\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 24, 0);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, 24, 8);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.vertexAttribPointer(2, 1, gl.FLOAT, false, 24, 16);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.vertexAttribPointer(3, 1, gl.FLOAT, false, 24, 20);\r\n    gl.enableVertexAttribArray(3);\r\n    gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this.buffer[1 - this.bufferIndex]);\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 24, 0);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(1, 2, gl.FLOAT, false, 24, 8);\r\n    gl.enableVertexAttribArray(1);\r\n    gl.vertexAttribPointer(2, 1, gl.FLOAT, false, 24, 16);\r\n    gl.enableVertexAttribArray(2);\r\n    gl.vertexAttribPointer(3, 1, gl.FLOAT, false, 24, 20);\r\n    gl.enableVertexAttribArray(3);\r\n    gl.beginTransformFeedback(gl.POINTS);\r\n    gl.drawArrays(gl.POINTS, 0, config.particlesCount);\r\n    gl.endTransformFeedback();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, null);\r\n\r\n    this.bufferIndex = 1 - this.bufferIndex;\r\n\r\n    this.drawCallbacks.forEach((draw) => draw());\r\n  }\r\n\r\n  public remove() {\r\n    this.pause();\r\n    this.destroy();\r\n  }\r\n\r\n  public pause() {\r\n    if(this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = true;\r\n    ++this.tempId;\r\n  }\r\n\r\n  // public renderFirstFrame() {\r\n  //   if(!this.dots) {\r\n  //     this.prepare();\r\n  //   }\r\n\r\n  //   this.draw();\r\n  // }\r\n\r\n  public play() {\r\n    if(!this.paused) {\r\n      return;\r\n    }\r\n\r\n    this.paused = false;\r\n    const tempId = ++this.tempId;\r\n    this.lastDrawTime = Date.now();\r\n\r\n    // if(!this.dots) {\r\n    //   this.prepare();\r\n    // }\r\n\r\n    animate(() => {\r\n      if(this.tempId !== tempId || this.paused) {\r\n        return false;\r\n      }\r\n\r\n      this.draw();\r\n      return true;\r\n    });\r\n  }\r\n\r\n  private _init(vertexShader: WebGLShader, fragmentShader: WebGLShader) {\r\n    this.genBuffer();\r\n\r\n    const gl = this.context;\r\n\r\n    const program = this.program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.transformFeedbackVaryings(program, ['outPosition', 'outVelocity', 'outTime', 'outDuration'], gl.INTERLEAVED_ATTRIBS);\r\n    gl.linkProgram(program);\r\n    if(!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n      throw 'program link error:\\n' + gl.getProgramInfoLog(program);\r\n    }\r\n    gl.deleteShader(vertexShader);\r\n    gl.deleteShader(fragmentShader);\r\n\r\n    this.timeHandle = gl.getUniformLocation(program, 'time');\r\n    this.deltaTimeHandle = gl.getUniformLocation(program, 'deltaTime');\r\n    this.sizeHandle = gl.getUniformLocation(program, 'size');\r\n    this.resetHandle = gl.getUniformLocation(program, 'reset');\r\n    this.radiusHandle = gl.getUniformLocation(program, 'r');\r\n    this.seedHandle = gl.getUniformLocation(program, 'seed');\r\n    this.noiseScaleHandle = gl.getUniformLocation(program, 'noiseScale');\r\n    this.noiseSpeedHandle = gl.getUniformLocation(program, 'noiseSpeed');\r\n    this.dampingMultHandle = gl.getUniformLocation(program, 'dampingMult');\r\n    this.velocityMultHandle = gl.getUniformLocation(program, 'velocityMult');\r\n    this.forceMultHandle = gl.getUniformLocation(program, 'forceMult');\r\n    this.longevityHandle = gl.getUniformLocation(program, 'longevity');\r\n    this.maxVelocityHandle = gl.getUniformLocation(program, 'maxVelocity');\r\n    this.noiseMovementHandle = gl.getUniformLocation(program, 'noiseMovement');\r\n    this.colorHandle = gl.getUniformLocation(program, 'color');\r\n\r\n    gl.clearColor(0, 0, 0, 0);\r\n    gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    this.inited = true;\r\n    this.lastDrawTime = Date.now();\r\n  }\r\n\r\n  private init() {\r\n    return this.initPromise ??= callbackify(this.compileShaders(), (shaders) => {\r\n      this._init(...shaders);\r\n      this.draw();\r\n      return true;\r\n    });\r\n  }\r\n\r\n  private destroy() {\r\n    if(this.buffer) {\r\n      this.context.deleteBuffer(this.buffer[0]);\r\n      this.context.deleteBuffer(this.buffer[1]);\r\n    }\r\n\r\n    this.buffer = null;\r\n    this.context.deleteProgram(this.program);\r\n    this.program = null;\r\n  }\r\n\r\n  public static create({\r\n    width,\r\n    height,\r\n    middleware,\r\n    animationGroup,\r\n    multiply,\r\n    config\r\n  }: {\r\n    width?: number,\r\n    height?: number,\r\n    middleware: Middleware,\r\n    animationGroup: AnimationItemGroup,\r\n    multiply?: number,\r\n    config?: Partial<DotRenderer['config']>\r\n  }) {\r\n    const index = ++this.createdIndex;\r\n    let {imageSpoilerInstance: instance} = this;\r\n    if(!instance) {\r\n      instance = this.imageSpoilerInstance = new DotRenderer();\r\n      instance.resize(480, 480);\r\n      (window as any).dotRenderer = instance;\r\n    }\r\n    // dotRenderer.renderFirstFrame();\r\n\r\n    const canvas = document.createElement('canvas');\r\n    canvas.classList.add('canvas-thumbnail', 'canvas-dots');\r\n    const dpr = window.devicePixelRatio;\r\n    if(width) {\r\n      canvas.width = width * dpr;\r\n      canvas.height = height * dpr;\r\n    }\r\n    const context = canvas.getContext('2d');\r\n\r\n    const rotate = (index % 4) === 1;\r\n    const flipX = (index % 4) === 2;\r\n    const flipY = (index % 4) === 3;\r\n\r\n    const transforms: string[] = [\r\n      rotate && 'rotate(180deg)',\r\n      flipX && 'scaleX(-1)',\r\n      flipY && 'scaleY(-1)'\r\n    ].filter(Boolean);\r\n    if(transforms.length) {\r\n      canvas.style.transform = transforms.join(' ');\r\n    }\r\n\r\n    let revealAnimation: {\r\n      underlyingCanvasClickCoords: {x: number, y: number},\r\n      transformedCoords: {x: number, y: number},\r\n      progress: number,\r\n      maxDist: number,\r\n      maxDistUnderlyingCanvas: number,\r\n      underLyingCtx: CanvasRenderingContext2D\r\n    };\r\n\r\n    const x = getUnsafeRandomInt(0, instance.canvas.width - canvas.width);\r\n    const y = getUnsafeRandomInt(0, instance.canvas.height - canvas.height);\r\n\r\n    function drawClippingCircle(ctx: CanvasRenderingContext2D, progress: number, coords: {x: number, y: number}, maxDist: number) {\r\n      ctx.save();\r\n      ctx.globalCompositeOperation = 'destination-out';\r\n      ctx.fillStyle = 'white';\r\n      ctx.shadowBlur = maxDist / 3.5 * instance.dpr * progress;\r\n      ctx.shadowColor = 'white';\r\n      ctx.beginPath();\r\n      ctx.arc(coords.x, coords.y, maxDist * progress, 0, 2 * Math.PI);\r\n      ctx.fill();\r\n      ctx.globalCompositeOperation = 'source-over';\r\n      ctx.restore();\r\n    }\r\n\r\n    const draw = () => {\r\n      const {width, height} = canvas;\r\n      const isRevealed = revealAnimation?.progress >= 1;\r\n\r\n      if(isRevealed) return;\r\n\r\n      context.clearRect(0, 0, width, height);\r\n\r\n      if(!revealAnimation) {\r\n        context.drawImage(instance.canvas, x, y, width, height, 0, 0, width, height);\r\n      } else {\r\n        const {\r\n          progress,\r\n          transformedCoords,\r\n          underLyingCtx,\r\n          maxDist,\r\n          maxDistUnderlyingCanvas,\r\n          underlyingCanvasClickCoords\r\n        } = revealAnimation;\r\n\r\n        // Zoom (push) the particles\r\n        const scaledProgress = progress ** 2 /* * Math.sqrt(progress) */ * 0.5;\r\n        context.drawImage(instance.canvas,\r\n          x + transformedCoords.x * scaledProgress, y + transformedCoords.y * scaledProgress, width * (1 - scaledProgress), height * (1 - scaledProgress),\r\n          0, 0, width, height\r\n        );\r\n\r\n        // Draw a clipping circle growing from where the user clicked\r\n        drawClippingCircle(context, progress, transformedCoords, maxDist);\r\n        drawClippingCircle(underLyingCtx, progress, underlyingCanvasClickCoords, maxDistUnderlyingCanvas);\r\n      }\r\n\r\n      if(config?.color) {\r\n        applyColorOnContext(context, '#' + config.color.toString(16), 0, 0, width, height);\r\n      }\r\n    };\r\n\r\n    ++instance.targetCanvasesCount;\r\n    const animation = new AnimationItemNested({\r\n      onPlay: () => {\r\n        instance.drawCallbacks.set(canvas, draw);\r\n        instance.play();\r\n      },\r\n      onPause: () => {\r\n        instance.drawCallbacks.delete(canvas);\r\n        if(!instance.drawCallbacks.size) {\r\n          instance.pause();\r\n        }\r\n      },\r\n      onDestroy: () => {\r\n        if(!--instance.targetCanvasesCount) {\r\n          instance.remove();\r\n          this.imageSpoilerInstance = undefined;\r\n        }\r\n      }\r\n    });\r\n\r\n    animationIntersector.addAnimation({\r\n      animation,\r\n      group: animationGroup,\r\n      observeElement: canvas,\r\n      controlled: middleware,\r\n      type: 'dots'\r\n    });\r\n\r\n    function revealWithAnimation(event: Event, underLyingCanvas: HTMLCanvasElement) {\r\n      if(!('clientX' in event && 'clientY' in event)) return false;\r\n      const bcr = canvas.getBoundingClientRect();\r\n\r\n      const rectX = event.clientX as number - bcr.left;\r\n      const rectY = event.clientY as number - bcr.top;\r\n      let transX = rectX, transY = rectY;\r\n\r\n      if(Number(rotate) + Number(flipX) === 1) {\r\n        transX = bcr.width - rectX;\r\n      }\r\n      if(Number(rotate) + Number(flipY) === 1) {\r\n        transY = bcr.height - rectY;\r\n      }\r\n\r\n      const distToMargin = Math.max(\r\n        Math.hypot(rectX, rectY),\r\n        Math.hypot(bcr.width - rectX, rectY),\r\n        Math.hypot(rectX, bcr.height - rectY),\r\n        Math.hypot(bcr.width - rectX, bcr.height - rectY),\r\n      );\r\n      const maxDist = distToMargin * instance.dpr + 50;\r\n\r\n      revealAnimation = {\r\n        underlyingCanvasClickCoords: {\r\n          x: rectX * underLyingCanvas.width / bcr.width,\r\n          y: rectY * underLyingCanvas.height / bcr.height\r\n        },\r\n        transformedCoords: {\r\n          x: transX * instance.dpr,\r\n          y: transY * instance.dpr\r\n        },\r\n        maxDist,\r\n        maxDistUnderlyingCanvas: maxDist / canvas.width * underLyingCanvas.width,\r\n        underLyingCtx: underLyingCanvas.getContext('2d'),\r\n        progress: 0\r\n      };\r\n\r\n      const deferred = deferredPromise<void>();\r\n\r\n      animateValue(0, 1, 800 + (400/* px/ms */ - distToMargin),\r\n        (v) => void (revealAnimation.progress = v),\r\n        {\r\n          onEnd: () => void deferred.resolve(),\r\n          easing: simpleEasing\r\n        }\r\n      );\r\n\r\n      return deferred;\r\n    }\r\n\r\n    const result = {\r\n      canvas,\r\n      readyResult: width && (/* dotRenderer.resize(width, height, multiply, config),  */instance.init()),\r\n      revealWithAnimation\r\n    };\r\n\r\n    this.createdImageSpoilers.set(canvas, result);\r\n\r\n    return result;\r\n  }\r\n\r\n  public static getImageSpoilerByElement(element: HTMLElement) {\r\n    return this.createdImageSpoilers.get(element as HTMLCanvasElement);\r\n  }\r\n\r\n  private static getTextSpoilerInstance() {\r\n    if(this.textSpoilerInstance) return this.textSpoilerInstance;\r\n\r\n    const instanceCanvasWidth = 240;\r\n    const instanceCanvasHeight = 120;\r\n    // const instanceCanvasWidth = 100;\r\n    // const instanceCanvasHeight = 40;\r\n\r\n    const instance = this.textSpoilerInstance = new DotRenderer();\r\n\r\n    /**\r\n     * Bigger DPR will make a visible separation between drawn chunks (when text spoilers are huge)\r\n     * Do not make this bigger, unless there is a way to mirror the dot on the other side when it is close to some margin\r\n     */\r\n    instance.dpr = Math.min(2, window.devicePixelRatio);\r\n    instance.resize(instanceCanvasWidth, instanceCanvasHeight, undefined, {\r\n      particlesCount: 4 * getDefaultParticlesCount(instanceCanvasWidth, instanceCanvasHeight),\r\n      noiseSpeed: 5,\r\n      maxVelocity: 10,\r\n      timeScale: 1.2,\r\n      radius: 1.8 * instance.dpr,\r\n      forceMult: .2,\r\n      velocityMult: .4,\r\n      dampingMult: 2.2,\r\n      longevity: 5.0\r\n    });\r\n\r\n    MOUNT_CLASS_TO.textSpoilerRenderer = instance;\r\n\r\n    return instance;\r\n  }\r\n\r\n  public static attachTextSpoilerTarget({\r\n    middleware,\r\n    animationGroup,\r\n    canvas,\r\n    draw\r\n  }: {\r\n    canvas: HTMLCanvasElement,\r\n    draw: () => void,\r\n    middleware: Middleware,\r\n    animationGroup: AnimationItemGroup,\r\n  }) {\r\n    const instance = this.getTextSpoilerInstance();\r\n\r\n    ++instance.targetCanvasesCount;\r\n\r\n    const animation = new AnimationItemNested({\r\n      onPlay: () => {\r\n        instance.drawCallbacks.set(canvas, draw);\r\n        instance.play();\r\n      },\r\n      onPause: () => {\r\n        instance.drawCallbacks.delete(canvas);\r\n        if(!instance.drawCallbacks.size) {\r\n          instance.pause();\r\n        }\r\n      },\r\n      onDestroy: () => {\r\n        if(!--instance.targetCanvasesCount) {\r\n          instance.remove();\r\n          this.textSpoilerInstance = undefined;\r\n        }\r\n      }\r\n    });\r\n\r\n    animationIntersector.addAnimation({\r\n      animation,\r\n      group: animationGroup,\r\n      observeElement: canvas,\r\n      controlled: middleware,\r\n      type: 'dots'\r\n    });\r\n\r\n    return {\r\n      animation,\r\n      sourceCanvas: instance.canvas,\r\n      dpr: instance.dpr,\r\n      readyResult: instance.init()\r\n    };\r\n  }\r\n\r\n  public static attachBluffTextSpoilerTarget(element: HTMLElement) {\r\n    const instance = this.getTextSpoilerInstance();\r\n\r\n    BluffSpoilerController.observeReconnection(element, (el) => this.attachBluffTextSpoilerTarget(el));\r\n\r\n    ++instance.targetCanvasesCount;\r\n    ++BluffSpoilerController.instancesCount;\r\n\r\n    const animation = new AnimationItemNested({\r\n      onPlay: () => {\r\n        instance.drawCallbacks.set(element, () => BluffSpoilerController.draw(instance.canvas));\r\n        instance.play();\r\n      },\r\n      onPause: () => {\r\n        instance.drawCallbacks.delete(element);\r\n        if(!instance.drawCallbacks.size) {\r\n          instance.pause();\r\n        }\r\n      },\r\n      onDestroy: () => {\r\n        if(!--instance.targetCanvasesCount) {\r\n          instance.remove();\r\n          this.textSpoilerInstance = undefined;\r\n        }\r\n        if(!--BluffSpoilerController.instancesCount) {\r\n          BluffSpoilerController.destroy();\r\n        }\r\n      }\r\n    });\r\n\r\n    animationIntersector.addAnimation({\r\n      animation,\r\n      group: 'BLUFF-SPOILER',\r\n      // controlled: true, // should not be controlled! elements might reappear in the DOM after being removed\r\n      observeElement: element,\r\n      type: 'dots'\r\n    });\r\n\r\n    instance.init();\r\n  }\r\n}\r\n","const utf16 = {\r\n  // The utf16-class is necessary to convert from javascripts internal character representation to unicode and back.\r\n  decode: (input) => {\r\n    const output = [];\r\n    let i = 0;\r\n    const len = input.length;\r\n    let value;\r\n    let extra;\r\n\r\n    while (i < len) {\r\n      value = input.charCodeAt(i++);\r\n      if ((value & 0xf800) === 0xd800) {\r\n        extra = input.charCodeAt(i++);\r\n        if ((value & 0xfc00) !== 0xd800 || (extra & 0xfc00) !== 0xdc00) {\r\n          throw new RangeError('UTF-16(decode): Illegal UTF-16 sequence');\r\n        }\r\n        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\r\n      }\r\n      output.push(value);\r\n    }\r\n    return output;\r\n  },\r\n  encode: (input) => {\r\n    const output = [];\r\n    let i = 0;\r\n    const len = input.length;\r\n    let value;\r\n\r\n    while (i < len) {\r\n      value = input[i++];\r\n      if ((value & 0xf800) === 0xd800) {\r\n        throw new RangeError('UTF-16(encode): Illegal UTF-16 value');\r\n      }\r\n      if (value > 0xffff) {\r\n        value -= 0x10000;\r\n        output.push(String.fromCharCode(((value >>> 10) & 0x3ff) | 0xd800));\r\n        value = 0xdc00 | (value & 0x3ff);\r\n      }\r\n      output.push(String.fromCharCode(value));\r\n    }\r\n    return output.join('');\r\n  },\r\n};\r\n\r\n// Default parameters\r\nconst initial_n = 0x80;\r\nconst initial_bias = 72;\r\nconst delimiter = '\\x2D';\r\nconst base = 36;\r\nconst damp = 700;\r\nconst tmin = 1;\r\nconst tmax = 26;\r\nconst skew = 38;\r\nconst maxint = 0x7fffffff;\r\n\r\n// decode_digit(cp) returns the numeric value of a basic code\r\n// point (for use in representing integers) in the range 0 to\r\n// base-1, or base if cp is does not represent a value.\r\n\r\nfunction decode_digit(cp) {\r\n  return cp - 48 < 10 ? cp - 22 : cp - 65 < 26 ? cp - 65 : cp - 97 < 26 ? cp - 97 : base;\r\n}\r\n\r\n// ** Bias adaptation function **\r\nfunction adapt(delta, numpoints, firsttime) {\r\n  let k;\r\n  delta = firsttime ? Math.floor(delta / damp) : delta >> 1;\r\n  delta += Math.floor(delta / numpoints);\r\n\r\n  for (k = 0; delta > ((base - tmin) * tmax) >> 1; k += base) {\r\n    delta = Math.floor(delta / (base - tmin));\r\n  }\r\n  return Math.floor(k + ((base - tmin + 1) * delta) / (delta + skew));\r\n}\r\n\r\n// Main decode\r\nfunction decode(input, preserveCase) {\r\n  // Dont use utf16\r\n  const output = [];\r\n  const case_flags = [];\r\n  const input_length = input.length;\r\n\r\n  let n; let out; let i; let bias; let basic; let j; let ic; let oldi; let w; let k; let digit; let t; let len;\r\n\r\n  // Initialize the state:\r\n\r\n  n = initial_n;\r\n  i = 0;\r\n  bias = initial_bias;\r\n\r\n  // Handle the basic code points: Let basic be the number of input code\r\n  // points before the last delimiter, or 0 if there is none, then\r\n  // copy the first basic code points to the output.\r\n\r\n  basic = input.lastIndexOf(delimiter);\r\n  if (basic < 0) basic = 0;\r\n\r\n  for (j = 0; j < basic; ++j) {\r\n    if (preserveCase) case_flags[output.length] = input.charCodeAt(j) - 65 < 26;\r\n    if (input.charCodeAt(j) >= 0x80) {\r\n      throw new RangeError('Illegal input >= 0x80');\r\n    }\r\n    output.push(input.charCodeAt(j));\r\n  }\r\n\r\n  // Main decoding loop: Start just after the last delimiter if any\r\n  // basic code points were copied; start at the beginning otherwise.\r\n\r\n  for (ic = basic > 0 ? basic + 1 : 0; ic < input_length;) {\r\n    // ic is the index of the next character to be consumed,\r\n\r\n    // Decode a generalized variable-length integer into delta,\r\n    // which gets added to i. The overflow checking is easier\r\n    // if we increase i as we go, then subtract off its starting\r\n    // value at the end to obtain delta.\r\n    for (oldi = i, w = 1, k = base; ; k += base) {\r\n      if (ic >= input_length) {\r\n        throw RangeError('punycode_bad_input(1)');\r\n      }\r\n      digit = decode_digit(input.charCodeAt(ic++));\r\n\r\n      if (digit >= base) {\r\n        throw RangeError('punycode_bad_input(2)');\r\n      }\r\n      if (digit > Math.floor((maxint - i) / w)) {\r\n        throw RangeError('punycode_overflow(1)');\r\n      }\r\n      i += digit * w;\r\n      t = k <= bias ? tmin : k >= bias + tmax ? tmax : k - bias;\r\n      if (digit < t) {\r\n        break;\r\n      }\r\n      if (w > Math.floor(maxint / (base - t))) {\r\n        throw RangeError('punycode_overflow(2)');\r\n      }\r\n      w *= base - t;\r\n    }\r\n\r\n    out = output.length + 1;\r\n    bias = adapt(i - oldi, out, oldi === 0);\r\n\r\n    // i was supposed to wrap around from out to 0,\r\n    // incrementing n each time, so we'll fix that now:\r\n    if (Math.floor(i / out) > maxint - n) {\r\n      throw RangeError('punycode_overflow(3)');\r\n    }\r\n    n += Math.floor(i / out);\r\n    i %= out;\r\n\r\n    // Insert n at position i of the output:\r\n    // Case of last character determines uppercase flag:\r\n    if (preserveCase) {\r\n      case_flags.splice(i, 0, input.charCodeAt(ic - 1) - 65 < 26);\r\n    }\r\n\r\n    output.splice(i, 0, n);\r\n    i++;\r\n  }\r\n  if (preserveCase) {\r\n    for (i = 0, len = output.length; i < len; i++) {\r\n      if (case_flags[i]) {\r\n        output[i] = String.fromCharCode(output[i])\r\n          .toUpperCase()\r\n          .charCodeAt(0);\r\n      }\r\n    }\r\n  }\r\n  return utf16.encode(output);\r\n}\r\n\r\nfunction toUnicode(domain) {\r\n  const domain_array = domain.split('.');\r\n  const out = [];\r\n  for (let i = 0; i < domain_array.length; ++i) {\r\n    const s = domain_array[i];\r\n    out.push(s.match(/^xn--/) ? decode(s.slice(4)) : s);\r\n  }\r\n  return out.join('.');\r\n}\r\n\r\nexport default toUnicode;\r\n","import convertPunycode from '../../vendor/convertPunycode';\r\n\r\n// * https://github.com/Ajaxy/telegram-tt/blob/6b52024107b7b534fc25dfaddd91868f653d0092/src/util/browser/url.ts#L43\r\nexport default function isMixedScriptUrl(url: string): boolean {\r\n  let domain;\r\n  try {\r\n    domain = convertPunycode(new URL(url).hostname);\r\n  } catch(e) {\r\n    return true; // If URL is invalid, treat it as mixed script\r\n  }\r\n\r\n  let hasLatin = false;\r\n  let hasNonLatin = false;\r\n\r\n  for(const char of Array.from(domain)) {\r\n    if(!/\\p{L}/u.test(char)) continue; // Ignore non-letter characters\r\n\r\n    if(/\\p{Script=Latin}/u.test(char)) {\r\n      hasLatin = true;\r\n    } else {\r\n      hasNonLatin = true;\r\n    }\r\n\r\n    if(hasLatin && hasNonLatin) return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {EMOJI_VERSION} from '../../environment/emojiVersionsSupport';\r\nimport {SITE_HASHTAGS} from '.';\r\nimport {EmojiVersions} from '../../config/emoji';\r\nimport IS_EMOJI_SUPPORTED from '../../environment/emojiSupport';\r\nimport buildURLHash from '../../helpers/buildURLHash';\r\nimport copy from '../../helpers/object/copy';\r\nimport encodeEntities from '../../helpers/string/encodeEntities';\r\nimport {MessageEntity} from '../../layer';\r\nimport encodeSpoiler from './encodeSpoiler';\r\nimport parseEntities from './parseEntities';\r\nimport setBlankToAnchor from './setBlankToAnchor';\r\nimport wrapUrl from './wrapUrl';\r\nimport EMOJI_VERSIONS_SUPPORTED from '../../environment/emojiVersionsSupport';\r\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\r\nimport IS_CUSTOM_EMOJI_SUPPORTED from '../../environment/customEmojiSupport';\r\nimport BOM from '../../helpers/string/bom';\r\nimport wrapTelegramUrlToAnchor from './wrapTelegramUrlToAnchor';\r\nimport {IS_FIREFOX} from '../../environment/userAgent';\r\nimport CustomEmojiElement, {CustomEmojiElements} from '../customEmoji/element';\r\nimport {CustomEmojiRendererElementOptions, CustomEmojiRendererElement} from '../customEmoji/renderer';\r\nimport {setDirection} from '../../helpers/dom/setInnerHTML';\r\nimport {i18n} from '../langPack';\r\nimport Icon from '../../components/icon';\r\nimport {CodeLanguageAliases, highlightCode} from '../../codeLanguages';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport findIndexFrom from '../../helpers/array/findIndexFrom';\r\nimport {observeResize} from '../../components/resizeObserver';\r\nimport createElementFromMarkup from '../../helpers/createElementFromMarkup';\r\nimport DotRenderer from '../../components/dotRenderer';\r\nimport isMixedScriptUrl from '../../helpers/string/isMixedScriptUrl';\r\n\r\nexport type WrapRichTextOptions = Partial<{\r\n  entities: MessageEntity[],\r\n  contextSite: string,\r\n  highlightUsername: string,\r\n  noLinks: boolean,\r\n  noLinebreaks: boolean,\r\n  noCommands: boolean,\r\n  wrappingDraft: boolean,\r\n  // mustWrapEmoji: boolean,\r\n  fromBot: boolean,\r\n  noTextFormat: boolean,\r\n  passEntities: Partial<{\r\n    [_ in MessageEntity['_']]: boolean\r\n  }>,\r\n  maxMediaTimestamp: number,\r\n  noEncoding: boolean,\r\n  isSelectable: boolean,\r\n  whitelistedDomains?: string[],\r\n  passMaskedLinks?: boolean,\r\n\r\n  contextHashtag?: string,\r\n\r\n  // ! recursive, do not provide\r\n  nasty?: {\r\n    i: number,\r\n    usedLength: number,\r\n    text: string,\r\n    lastEntity?: MessageEntity\r\n  },\r\n  voodoo?: boolean,\r\n  customEmojis?: Map<DocId, CustomEmojiElements>,\r\n  customWraps?: Set<HTMLElement>,\r\n  ignoreNextIndex?: number,\r\n  doubleLinebreak?: number\r\n}> & CustomEmojiRendererElementOptions;\r\n\r\nfunction createMarkupFormatting(formatting: string) {\r\n  const element = document.createElement('span');\r\n  element.style.fontFamily = 'markup-' + formatting;\r\n  element.classList.add('is-markup');\r\n  element.dataset.markup = formatting;\r\n  return element;\r\n}\r\n\r\nfunction onQuoteResize(entry: ResizeObserverEntry) {\r\n  const target = entry.target as HTMLElement;\r\n  if((target as any).ignoreQuoteResize) {\r\n    if(Date.now() < (target as any).ignoreQuoteResize) {\r\n      return;\r\n    }\r\n\r\n    delete (target as any).ignoreQuoteResize;\r\n  }\r\n\r\n  const scrollHeight = target.scrollHeight;\r\n  if(!scrollHeight) {\r\n    return;\r\n  }\r\n\r\n  const padding = entry.contentRect.bottom - entry.contentRect.height + entry.contentRect.top;\r\n  // const margin = (entry.borderBoxSize[0].blockSize - entry.contentBoxSize[0].blockSize) * 2;\r\n  const margin = 0;\r\n  const diff = scrollHeight - padding - margin - Math.floor(entry.contentRect.height);\r\n  const isExpanded = diff <= 1;\r\n\r\n  // console.log('quote resize', entry, scrollHeight, entry.contentRect.height, isExpanded, diff);\r\n  target.style.setProperty('--quote-max-height', scrollHeight + 'px');\r\n  target.classList.toggle('is-truncated', !isExpanded);\r\n}\r\n\r\nfunction makeQuoteCollapsable(element: HTMLElement) {\r\n  element.classList.add('quote-like-collapsable');\r\n\r\n  const collapseIcon = document.createElement('span');\r\n  collapseIcon.classList.add('quote-like-icon', 'quote-like-collapse');\r\n  element.append(collapseIcon);\r\n\r\n  return observeResize(element, onQuoteResize);\r\n}\r\n\r\n/**\r\n * * Expecting correctly sorted nested entities (RichTextProcessor.sortEntities)\r\n */\r\nexport default function wrapRichText(text: string, options: WrapRichTextOptions = {}) {\r\n  const fragment = document.createDocumentFragment();\r\n  if(!text) {\r\n    return fragment;\r\n  }\r\n\r\n  const nasty = options.nasty ??= {\r\n    i: 0,\r\n    usedLength: 0,\r\n    text\r\n  };\r\n\r\n  const wrapSomething = (wrapElement: HTMLElement, noFiller?: boolean) => {\r\n    const element = document.createElement('span');\r\n    // element.append(BOM, a, BOM);\r\n    if(options.wrappingDraft) {\r\n      element.contentEditable = 'false';\r\n    }\r\n    // element.style.display = 'inline-block';\r\n    element.classList.add('input-something');\r\n    element.append(/* BOM,  */wrapElement);\r\n\r\n    (lastElement || fragment).append(element);\r\n\r\n    wrapElement.classList.add('input-selectable');\r\n    // if(wrapElement instanceof HTMLImageElement) {\r\n    //   element.prepend(f());\r\n    // } else {\r\n    !noFiller && wrapElement.append(createCustomFiller(true));\r\n    // }\r\n\r\n    customWraps.add(element);\r\n\r\n    return element;\r\n  };\r\n\r\n  options.isSelectable ||= options.wrappingDraft;\r\n\r\n  const customEmojis = options.customEmojis ??= new Map() as Map<DocId, CustomEmojiElements>;\r\n  const customWraps = options.customWraps ??= new Set();\r\n\r\n  const entities = options.entities ??= parseEntities(nasty.text);\r\n\r\n  const passEntities = options.passEntities ??= {};\r\n  const contextSite = options.contextSite ??= 'Telegram';\r\n  const contextExternal = contextSite !== 'Telegram';\r\n\r\n  const textLength = nasty.text.length;\r\n  const length = entities.length;\r\n  let lastElement: HTMLElement | DocumentFragment;\r\n  for(; nasty.i < length; ++nasty.i) {\r\n    let entity = entities[nasty.i];\r\n\r\n    // * check whether text was sliced\r\n    // TODO: consider about moving it to other function\r\n    if(entity.offset >= textLength) {\r\n      if(entity._ !== 'messageEntityCaret') { // * can set caret to the end\r\n        continue;\r\n      }\r\n    } else if((entity.offset + entity.length) > textLength) {\r\n      entity = copy(entity);\r\n      // entity.length = entity.offset + entity.length - textLength;\r\n      entity.length = textLength - entity.offset;\r\n    }\r\n\r\n    if(entity.length) {\r\n      nasty.lastEntity = entity;\r\n    }\r\n\r\n    let nextEntity = entities[nasty.i + 1];\r\n\r\n    const startOffset = entity.offset;\r\n    const endOffset = startOffset + entity.length;\r\n    const endPartOffset = Math.min(endOffset, nextEntity?.offset ?? 0xFFFF);\r\n    const fullEntityText = nasty.text.slice(startOffset, endOffset);\r\n    const sliced = nasty.text.slice(startOffset, endPartOffset);\r\n    let partText = sliced;\r\n\r\n    if(nasty.usedLength < startOffset) {\r\n      (lastElement || fragment).append(nasty.text.slice(nasty.usedLength, startOffset));\r\n    }\r\n\r\n    if(lastElement) {\r\n      lastElement = fragment;\r\n    }\r\n\r\n    nasty.usedLength = endPartOffset;\r\n\r\n    let element: HTMLElement,\r\n      property: 'alt',\r\n      usedText = false,\r\n      processingBlockElement = false;\r\n    switch(entity._) {\r\n      case 'messageEntityBold': {\r\n        if(!options.noTextFormat) {\r\n          if(options.wrappingDraft) {\r\n            element = createMarkupFormatting('bold');\r\n          } else {\r\n            element = document.createElement('strong');\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityItalic': {\r\n        if(!options.noTextFormat) {\r\n          if(options.wrappingDraft) {\r\n            element = createMarkupFormatting('italic');\r\n          } else {\r\n            element = document.createElement('em');\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityStrike': {\r\n        if(options.wrappingDraft) {\r\n          element = createMarkupFormatting('strikethrough');\r\n          // element = document.createElement('span');\r\n          // const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\r\n          // element.style.cssText = `${styleName}: line-through;`;\r\n          // element.style.fontFamily = 'markup-strikethrough';\r\n        } else/*  if(!options.noTextFormat) */ {\r\n          element = document.createElement('del');\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityUnderline': {\r\n        if(options.wrappingDraft) {\r\n          element = createMarkupFormatting('underline');\r\n          // element = document.createElement('span');\r\n          // const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\r\n          // element.style.cssText = `${styleName}: underline;`;\r\n          // element.style.fontFamily = 'markup-underline';\r\n        } else if(!options.noTextFormat) {\r\n          element = document.createElement('u');\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityPre':\r\n      case 'messageEntityCode': {\r\n        const entityLanguage = (entity as MessageEntity.messageEntityPre).language;\r\n        if(options.wrappingDraft) {\r\n          element = createMarkupFormatting('monospace');\r\n          if(entityLanguage) {\r\n            element.dataset.language = entityLanguage;\r\n          }\r\n          // element = document.createElement('span');\r\n          // element.style.fontFamily = 'var(--font-monospace)';\r\n          // element.style.fontFamily = 'markup-monospace';\r\n        } else if(entity._ === 'messageEntityPre' && !options.noTextFormat) {\r\n          const container = document.createElement('pre');\r\n          const content = document.createElement('div');\r\n          content.classList.add('code-content');\r\n          element = document.createElement('code');\r\n          element.classList.add('code-code');\r\n          fragment.append(container);\r\n          content.append(element);\r\n\r\n          container.classList.add('quote-like', 'quote-like-border', 'code');\r\n\r\n          const languageName = CodeLanguageAliases[entityLanguage.toLowerCase()];\r\n\r\n          const header = document.createElement('div');\r\n          header.classList.add('code-header');\r\n          const headerName = document.createElement('span');\r\n          headerName.classList.add('code-header-name');\r\n          headerName.append(languageName || i18n('CopyCode'));\r\n          const headerWrapButton = Icon('menu', 'code-header-button', 'code-header-toggle-wrap');\r\n          header.append(headerName, headerWrapButton, Icon('copy', 'code-header-button', 'code-header-copy'));\r\n\r\n          container.append(header, content);\r\n\r\n          const result = languageName && highlightCode(fullEntityText, languageName);\r\n          result && callbackify(result, (html) => {\r\n            if(html) {\r\n              element.innerHTML = html;\r\n            }\r\n          });\r\n\r\n          usedText = true;\r\n          if(!result || result instanceof Promise) {\r\n            element.textContent = fullEntityText;\r\n          }\r\n\r\n          let lastInnerEntityIndex = findIndexFrom(entities, (n) => n.offset >= endOffset, nasty.i + 1);\r\n          if(lastInnerEntityIndex === -1) lastInnerEntityIndex = entities.length - 1;\r\n          else lastInnerEntityIndex -= 1;\r\n          nasty.i = lastInnerEntityIndex;\r\n          nasty.usedLength = endOffset;\r\n          nasty.lastEntity = entities[lastInnerEntityIndex];\r\n          nextEntity = undefined;\r\n          processingBlockElement = true;\r\n        } else if(!options.noTextFormat) {\r\n          element = document.createElement('code');\r\n          element.classList.add('monospace-text');\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      // case 'messageEntityPre': {\r\n      //   if(options.wrappingDraft) {\r\n      //     element = document.createElement('span');\r\n      //     element.style.fontFamily = 'var(--font-monospace)';\r\n      //   } else if(!options.noTextFormat) {\r\n      //     element = document.createElement('pre');\r\n      //     const inner = document.createElement('code');\r\n      //     if(entity.language) {\r\n      //       inner.className = 'language-' + entity.language;\r\n      //       inner.textContent = entityText;\r\n      //       usedText = true;\r\n      //     }\r\n      //   }\r\n\r\n      //   break;\r\n      // }\r\n\r\n      case 'messageEntityHighlight': {\r\n        element = document.createElement('i');\r\n        element.className = 'text-highlight';\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityBotCommand': {\r\n        // if(!(options.noLinks || options.noCommands || contextExternal)/*  && !entity.unsafe */) {\r\n        if(!options.noLinks && passEntities[entity._]) {\r\n          let command = fullEntityText.slice(1);\r\n          let bot: string | boolean;\r\n          let atPos: number;\r\n          if((atPos = command.indexOf('@')) !== -1) {\r\n            bot = command.slice(atPos + 1);\r\n            command = command.slice(0, atPos);\r\n          } else {\r\n            bot = options.fromBot;\r\n          }\r\n\r\n          element = document.createElement('a');\r\n          (element as HTMLAnchorElement).href = encodeEntities('tg://bot_command?command=' + encodeURIComponent(command) + (bot ? '&bot=' + encodeURIComponent(bot) : ''));\r\n          if(!contextExternal) {\r\n            element.setAttribute('onclick', 'execBotCommand(this)');\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityCustomEmoji': {\r\n        if(!IS_CUSTOM_EMOJI_SUPPORTED) {\r\n          break;\r\n        }\r\n\r\n        while(nextEntity?._ === 'messageEntityEmoji' && nextEntity.offset < endOffset) {\r\n          ++nasty.i;\r\n          nasty.lastEntity = nextEntity;\r\n          nasty.usedLength += nextEntity.length;\r\n          nextEntity = entities[nasty.i + 1];\r\n        }\r\n\r\n        const customEmojiElement = element = CustomEmojiElement.create(entity.document_id);\r\n        const {docId} = customEmojiElement;\r\n        let set = customEmojis.get(docId);\r\n        if(!set) customEmojis.set(docId, set = new Set());\r\n        set.add(customEmojiElement);\r\n        customEmojiElement.dataset.stickerEmoji = fullEntityText;\r\n\r\n        if(options.wrappingDraft) {\r\n          element = document.createElement('img');\r\n          (element as HTMLImageElement).alt = fullEntityText;\r\n          for(const i in customEmojiElement.dataset) {\r\n            element.dataset[i] = customEmojiElement.dataset[i];\r\n          }\r\n          (element as any).customEmojiElement = customEmojiElement;\r\n          customEmojiElement.placeholder = element as HTMLImageElement;\r\n          element.classList.add('custom-emoji-placeholder');\r\n          (element as HTMLImageElement).src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC';\r\n          property = 'alt';\r\n          break;\r\n        }\r\n\r\n        if(options.isSelectable) {\r\n          // const s = document.createElement('span');\r\n          // s.append(fullEntityText);\r\n          // element.append(s);\r\n          // element.textContent = fullEntityText;\r\n          // element.textContent = 'a';\r\n          // element.contentEditable = 'false';\r\n\r\n          // const x = f();\r\n          // x.style.display = 'inline-block';\r\n          // x.contentEditable = 'false';\r\n          // (lastElement || fragment).append(BOM);\r\n          // (lastElement || fragment).append(x);\r\n\r\n          element = wrapSomething(element, !!options.customEmojiRenderer);\r\n\r\n          // const a = element;\r\n          // element = document.createElement('span');\r\n          // element.append(BOM, a, BOM);\r\n          // element.contentEditable = 'false';\r\n        }\r\n\r\n        property = 'alt';\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityEmoji': {\r\n        let isSupported = IS_EMOJI_SUPPORTED;\r\n        if(isSupported) {\r\n          for(const version in EmojiVersions) {\r\n            if(version) {\r\n              const emojiData = EmojiVersions[version as EMOJI_VERSION];\r\n              if(emojiData.hasOwnProperty(entity.unicode) && !EMOJI_VERSIONS_SUPPORTED[version as EMOJI_VERSION]) {\r\n                isSupported = false;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // if(!(options.wrappingDraft && isSupported)) { // * fix safari emoji\r\n        if(!isSupported) { // no wrapping needed\r\n          // if(isSupported) { // ! contenteditable=\"false\" нужен для поля ввода, иначе там будет меняться шрифт в Safari, или же рендерить смайлик напрямую, без контейнера\r\n          //   insertPart(entity, '<span class=\"emoji\">', '</span>');\r\n          // } else {\r\n          element = document.createElement('img');\r\n          (element as HTMLImageElement).src = `assets/img/emoji/${entity.unicode}.png`;\r\n          property = 'alt';\r\n          element.className = 'emoji emoji-image';\r\n\r\n          // if(options.isSelectable) {\r\n          //   usedText = true;\r\n          //   (element as HTMLImageElement).alt = partText;\r\n          //   element = wrapSomething(element);\r\n          // }\r\n\r\n          // const a = element;\r\n          // a.contentEditable = 'false';\r\n          // element = document.createElement('span');\r\n          // element.append(a);\r\n          // element.contentEditable = 'false';\r\n          // }\r\n        // } else if(options.mustWrapEmoji) {\r\n        } else if(!options.wrappingDraft) {\r\n          element = document.createElement('span');\r\n          element.className = 'emoji emoji-native';\r\n        }/*  else if(!IS_SAFARI) {\r\n          insertPart(entity, '<span class=\"emoji\" contenteditable=\"false\">', '</span>');\r\n        } */\r\n        /* if(!isSupported) {\r\n          insertPart(entity, `<img src=\"assets/img/emoji/${entity.unicode}.png\" alt=\"`, `\" class=\"emoji\">`);\r\n        } */\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityCaret': {\r\n        element = document.createElement('span');\r\n        element.className = 'composer-sel';\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityLinebreak': {\r\n        // slice linebreaks before and after quote\r\n        if(options.ignoreNextIndex === nasty.i || (options.wrappingDraft && nextEntity?._ === 'messageEntityBlockquote' && nextEntity.offset === endOffset)) {\r\n          usedText = true;\r\n        } else if(options.wrappingDraft && IS_FIREFOX) {\r\n          element = document.createElement('br');\r\n          usedText = true;\r\n        }\r\n\r\n        if(options.doubleLinebreak === nasty.i) {\r\n          options.doubleLinebreak = undefined;\r\n          (element || fragment).append('\\n\\n');\r\n          usedText = true;\r\n        }\r\n        // if(options.noLinebreaks) {\r\n        //   insertPart(entity, ' ');\r\n        // } else {\r\n        //   insertPart(entity, '<br/>');\r\n        // }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityUrl':\r\n      case 'messageEntityTextUrl': {\r\n        if(!(options.noLinks && !passEntities[entity._])) {\r\n          // let inner: string;\r\n          let url: string = (entity as MessageEntity.messageEntityTextUrl).url || fullEntityText;\r\n          let masked = false;\r\n          let onclick: string;\r\n\r\n          const wrapped = wrapUrl(url, true);\r\n          url = wrapped.url;\r\n          onclick = wrapped.onclick;\r\n\r\n          if(options.whitelistedDomains) {\r\n            try {\r\n              const hostname = new URL(url).hostname;\r\n              if(!options.whitelistedDomains.includes(hostname)) {\r\n                break;\r\n              }\r\n            } catch(err) {\r\n              break;\r\n            }\r\n          }\r\n\r\n          if(entity._ === 'messageEntityTextUrl') {\r\n            if(nextEntity?._ === 'messageEntityUrl' &&\r\n              nextEntity.length === entity.length &&\r\n              nextEntity.offset === entity.offset) {\r\n              nasty.lastEntity = nextEntity;\r\n              ++nasty.i;\r\n            }\r\n\r\n            if(url !== fullEntityText) {\r\n              masked = true;\r\n            }\r\n          } else {\r\n            masked = isMixedScriptUrl(url);\r\n            // inner = encodeEntities(replaceUrlEncodings(entityText));\r\n          }\r\n\r\n          const currentContext = !!onclick;\r\n          if(!onclick && masked && !currentContext && !options.passMaskedLinks) {\r\n            onclick = 'showMaskedAlert';\r\n          }\r\n\r\n          if(options.wrappingDraft) {\r\n            onclick = undefined;\r\n          }\r\n\r\n          const href = (currentContext || typeof electronHelpers === 'undefined') ?\r\n            url :\r\n            `javascript:electronHelpers.openExternal('${url}');`;\r\n\r\n          element = document.createElement('a');\r\n          element.className = 'anchor-url';\r\n          (element as HTMLAnchorElement).href = href;\r\n\r\n          if(!(currentContext || typeof electronHelpers !== 'undefined')) {\r\n            setBlankToAnchor(element as HTMLAnchorElement);\r\n          }\r\n\r\n          if(onclick) {\r\n            element.setAttribute('onclick', onclick + '(this)');\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityEmail': {\r\n        if(!options.noLinks) {\r\n          element = document.createElement('a');\r\n          (element as HTMLAnchorElement).href = encodeEntities('mailto:' + fullEntityText);\r\n          setBlankToAnchor(element as HTMLAnchorElement);\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityHashtag': {\r\n        const contextUrl = !options.noLinks && SITE_HASHTAGS[contextSite];\r\n        if(contextUrl) {\r\n          const hashtag = fullEntityText.slice(1);\r\n          element = document.createElement('a');\r\n          element.className = 'anchor-hashtag';\r\n          (element as HTMLAnchorElement).href = contextUrl.replace('{1}', encodeURIComponent(hashtag));\r\n          if(contextExternal) {\r\n            setBlankToAnchor(element as HTMLAnchorElement);\r\n          } else {\r\n            element.setAttribute('onclick', 'searchByHashtag(this)');\r\n          }\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityMentionName': {\r\n        if(!(options.noLinks && !passEntities[entity._])) {\r\n          element = document.createElement('a');\r\n          (element as HTMLAnchorElement).href = buildURLHash('' + entity.user_id);\r\n          element.className = 'follow';\r\n          element.dataset.follow = '' + entity.user_id;\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityMention': {\r\n        // const contextUrl = !options.noLinks && siteMentions[contextSite];\r\n        if(!options.noLinks) {\r\n          const username = fullEntityText.slice(1);\r\n\r\n          element = wrapTelegramUrlToAnchor('t.me/' + username);\r\n          element.className = 'mention';\r\n\r\n          // insertPart(entity, `<a class=\"mention\" href=\"${contextUrl.replace('{1}', encodeURIComponent(username))}\"${contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\"' : ''}>`, '</a>');\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntitySpoiler': {\r\n        if(options.noTextFormat) {\r\n          const encoded = encodeSpoiler(nasty.text, entity);\r\n          nasty.text = encoded.text;\r\n          partText = encoded.entityText;\r\n          if(endPartOffset !== endOffset) {\r\n            nasty.usedLength += endOffset - endPartOffset;\r\n          }\r\n          let n: MessageEntity;\r\n          for(; n = entities[nasty.i + 1], n && n.offset < endOffset;) {\r\n            // nasty.usedLength += n.length;\r\n            ++nasty.i;\r\n            nasty.lastEntity = n;\r\n            nextEntity = entities[nasty.i + 1];\r\n          }\r\n\r\n          if(!IS_FIREFOX) { // Firefox has very poor performance when drawing on canvas\r\n            element = document.createElement('span');\r\n            element.append(...partText.split('').map((encodedLetter, i) => createElementFromMarkup(`<span class=\"bluff-spoiler\" style=\"--index:${i}\">${encodedLetter}</span>`)))\r\n            fragment.append(element);\r\n\r\n            DotRenderer.attachBluffTextSpoilerTarget(element);\r\n\r\n            usedText = true;\r\n          }\r\n        } else if(options.wrappingDraft) {\r\n          element = createMarkupFormatting('spoiler');\r\n          // element = document.createElement('span');\r\n          // element.style.fontFamily = 'spoiler';\r\n          // element.style.fontFamily = 'markup-spoiler';\r\n        } else {\r\n          const container = document.createElement('span');\r\n          container.className = 'spoiler';\r\n          element = document.createElement('span');\r\n          element.className = 'spoiler-text';\r\n          element.textContent = partText;\r\n          usedText = true;\r\n          container.append(element);\r\n          fragment.append(container);\r\n\r\n          container[`on${CLICK_EVENT_NAME}`] = (window as any).onSpoilerClick;\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityTimestamp': {\r\n        if(!options.maxMediaTimestamp || entity.time > options.maxMediaTimestamp) {\r\n          break;\r\n        }\r\n\r\n        element = document.createElement('a');\r\n        element.classList.add('timestamp');\r\n        element.dataset.timestamp = '' + entity.time;\r\n        (element as HTMLAnchorElement).href = '#';\r\n        element.setAttribute('onclick', 'setMediaTimestamp(this)');\r\n\r\n        if(options.maxMediaTimestamp === Infinity) {\r\n          element.classList.add('is-disabled');\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case 'messageEntityBlockquote': {\r\n        if(options.noTextFormat) {\r\n          break;\r\n        }\r\n\r\n        if(options.wrappingDraft) {\r\n          element = createMarkupFormatting('quote');\r\n\r\n          // * ? because of layer migration\r\n          if(entity.pFlags?.collapsed) {\r\n            element.dataset.collapsed = '1';\r\n          }\r\n        } else {\r\n          element = document.createElement('blockquote');\r\n          element.classList.add('quote');\r\n\r\n          // * ? because of layer migration\r\n          if(entity.pFlags?.collapsed/*  || true */) {\r\n            const dispose = makeQuoteCollapsable(element);\r\n            options.middleware.onClean(dispose);\r\n          }\r\n        }\r\n\r\n        element.classList.add('quote-like', 'quote-like-border', 'quote-like-icon');\r\n        setDirection(element);\r\n\r\n        processingBlockElement = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(processingBlockElement) {\r\n      let foundNextLinebreakIndex = -1;\r\n      for(let i = nasty.i; i < length; ++i) {\r\n        const n = entities[i];\r\n        if(n._ === 'messageEntityLinebreak' && n.offset >= endOffset) {\r\n          foundNextLinebreakIndex = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(foundNextLinebreakIndex !== -1 && nasty.text.slice(endOffset, entities[foundNextLinebreakIndex].offset).trim()) {\r\n        foundNextLinebreakIndex = -1;\r\n      }\r\n\r\n      if(!options.wrappingDraft && endOffset < nasty.text.length) {\r\n        // * ignore inner linebreak if found and double next linebreak\r\n        if(!element.parentElement) {\r\n          const container = document.createElement('div');\r\n          container.append(element);\r\n          fragment.append(container);\r\n        }\r\n\r\n        if(nasty.text[endOffset - 1] === '\\n') {\r\n          let lastInnerLinebreakIndex = -1;\r\n          for(let i = nasty.i; i < length; ++i) {\r\n            const n = entities[i];\r\n            if(n.offset >= endOffset) {\r\n              break;\r\n            }\r\n\r\n            if(n._ === 'messageEntityLinebreak') {\r\n              lastInnerLinebreakIndex = i;\r\n            }\r\n          }\r\n\r\n          if(lastInnerLinebreakIndex !== -1) {\r\n            options.ignoreNextIndex = lastInnerLinebreakIndex;\r\n          }\r\n        } else if(foundNextLinebreakIndex !== -1) {\r\n          options.ignoreNextIndex = foundNextLinebreakIndex;\r\n        }\r\n\r\n        // if(nasty.text[endOffset - 1] === '\\n' &&\r\n        //   foundNextLinebreakIndex !== -1 &&\r\n        //   nasty.text[endPartOffset + 1] === '\\n') {\r\n        //   options.ignoreNextIndex = foundNextLinebreakIndex - 1;\r\n        //   options.doubleLinebreak = foundNextLinebreakIndex;\r\n        // }\r\n      }\r\n\r\n      if(options.wrappingDraft && foundNextLinebreakIndex !== -1) {\r\n        options.ignoreNextIndex = foundNextLinebreakIndex;\r\n      }\r\n\r\n      // if(!options.wrappingDraft) {\r\n      //   const i = Icon('quote', 'quote-icon');\r\n      //   element.textContent = partText;\r\n      //   usedText = true;\r\n      //   element.prepend(i);\r\n      // } else {\r\n      //   element.classList.add('quote-use-before');\r\n      // }\r\n    }\r\n\r\n    if(!usedText && partText) {\r\n      if(element) {\r\n        if(property) {\r\n          // @ts-ignore\r\n          element[property] = partText;\r\n        } else {\r\n          element.append(partText);\r\n        }\r\n      } else {\r\n        (element || fragment).append(partText);\r\n      }\r\n    }\r\n\r\n    if(element && !element.parentNode) {\r\n      (lastElement || fragment).append(element);\r\n    }\r\n\r\n    while(nextEntity && nextEntity.offset < endOffset) {\r\n      ++nasty.i;\r\n\r\n      (element || fragment).append(wrapRichText(nasty.text, {\r\n        ...options,\r\n        voodoo: true\r\n      }));\r\n\r\n      nextEntity = entities[nasty.i + 1];\r\n    }\r\n\r\n    // if(!element?.parentNode) {\r\n    //   (lastElement || fragment).append(element ?? partText);\r\n    // }\r\n\r\n    if(nasty.usedLength <= endOffset) {\r\n      if(nasty.usedLength < endOffset) {\r\n        (element || fragment).append(nasty.text.slice(nasty.usedLength, endOffset));\r\n        nasty.usedLength = endOffset;\r\n      }\r\n\r\n      lastElement = fragment;\r\n      nasty.lastEntity = undefined;\r\n    } else if(entity.length > partText.length && element) {\r\n      lastElement = element;\r\n    } else {\r\n      lastElement = fragment;\r\n    }\r\n\r\n    if(options.voodoo) {\r\n      return fragment;\r\n    }\r\n  }\r\n\r\n  if(nasty.lastEntity) {\r\n    nasty.usedLength = nasty.lastEntity.offset + nasty.lastEntity.length;\r\n  }\r\n\r\n  if(nasty.usedLength < textLength) {\r\n    (lastElement || fragment).append(nasty.text.slice(nasty.usedLength));\r\n  }\r\n\r\n  if((!options.wrappingDraft || options.customEmojiRenderer) && customEmojis.size) {\r\n    let renderer = options.customEmojiRenderer;\r\n    if(!renderer) {\r\n      renderer = CustomEmojiRendererElement.create(options);\r\n      fragment.prepend(renderer);\r\n    }\r\n\r\n    const loadPromise = renderer.add({\r\n      addCustomEmojis: customEmojis,\r\n      lazyLoadQueue: options.lazyLoadQueue,\r\n      onlyThumb: options.wrappingDraft\r\n    });\r\n    options.loadPromises?.push(loadPromise);\r\n    // recordPromise(loadPromise, 'render emojis: ' + docIds.length);\r\n  }\r\n\r\n  if(customWraps.size) {\r\n    insertCustomFillers(customWraps);\r\n  }\r\n\r\n  fragment.normalize();\r\n\r\n  return fragment;\r\n}\r\n\r\nexport const createCustomFiller = (notFiller?: boolean) => {\r\n  const x = document.createElement('span');\r\n  x.classList.add(notFiller ? 'input-filler2' : 'input-filler');\r\n  x.textContent = BOM;\r\n  return x;\r\n};\r\n\r\nexport function isCustomFillerNeededBySiblingNode(node: ChildNode) {\r\n  if(\r\n    // !node?.textContent ||\r\n    // node.textContent.endsWith('\\n') ||\r\n    node?.textContent !== BOM ||\r\n    (node as HTMLElement)?.getAttribute?.('contenteditable') === 'false'\r\n  ) {\r\n    // if(!node || (node as HTMLElement).firstElementChild || node.textContent.endsWith('\\n')) {\r\n    if(!node || node.textContent !== BOM || (node as HTMLElement).firstElementChild) {\r\n      return 2;\r\n    } else if(node.nodeType === node.ELEMENT_NODE) {\r\n      return 1;\r\n    }/*  else if(node.nodeType === node.TEXT_NODE && !node.nodeValue) {\r\n      (node as CharacterData).insertData(0, BOM);\r\n    } */\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nexport function insertCustomFillers(elements: Iterable<HTMLElement>) {\r\n  const check = (element: HTMLElement, node: ChildNode, method: 'before' | 'after') => {\r\n    const needed = isCustomFillerNeededBySiblingNode(node);\r\n    if(needed === 2) {\r\n      element[method](createCustomFiller());\r\n    } else if(needed === 1) {\r\n      node.appendChild(document.createTextNode(BOM));\r\n    }\r\n  };\r\n\r\n  for(const element of elements) {\r\n    const {previousSibling, nextSibling} = element;\r\n    check(element, previousSibling, 'before');\r\n    check(element, nextSibling, 'after');\r\n  }\r\n}\r\n\r\n(window as any).wrapRichText = wrapRichText;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport parseEntities from './parseEntities';\r\nimport wrapRichText from './wrapRichText';\r\n\r\nexport default function wrapEmojiText(text: string, isDraft = false, entities?: MessageEntity[]) {\r\n  if(!text) return wrapRichText('');\r\n\r\n  entities ??= parseEntities(text).filter((e) => e._ === 'messageEntityEmoji');\r\n  return wrapRichText(text, {entities, wrappingDraft: isDraft});\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport _limitSymbols from '../../helpers/string/limitSymbols';\r\nimport {Chat} from '../../layer';\r\nimport getPeerActiveUsernames from '../../lib/appManagers/utils/peers/getPeerActiveUsernames';\r\nimport I18n from '../../lib/langPack';\r\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport rootScope from '../../lib/rootScope';\r\n\r\ntype GetPeerTitleOptions = {\r\n  peerId: PeerId,\r\n  plainText?: boolean,\r\n  onlyFirstName?: boolean,\r\n  limitSymbols?: number,\r\n  threadId?: number,\r\n  useManagers?: boolean\r\n} & Pick<WrapSomethingOptions, 'managers'>;\r\n\r\nexport default async function getPeerTitle<\r\n  T extends GetPeerTitleOptions,\r\n  R = T['plainText'] extends true ? string : DocumentFragment\r\n>(\r\n  options: T\r\n): Promise<R> {\r\n  const {\r\n    peerId = rootScope.myId,\r\n    plainText,\r\n    onlyFirstName,\r\n    limitSymbols,\r\n    managers = rootScope.managers,\r\n    useManagers,\r\n    threadId\r\n  } = options;\r\n\r\n  let title = '';\r\n  if(peerId.isUser()) {\r\n    const user = useManagers ? await managers.appUsersManager.getUser(peerId.toUserId()) : apiManagerProxy.getUser(peerId.toUserId());\r\n    if(user) {\r\n      if(user.first_name) title += user.first_name;\r\n      if(user.last_name && (!onlyFirstName || !title)) title += ' ' + user.last_name;\r\n    }\r\n\r\n    if(!title) title = !user || user.pFlags.deleted ? I18n.format(onlyFirstName ? 'Deleted' : 'HiddenName', true) : getPeerActiveUsernames(user)[0] || '';\r\n    else title = title.trim();\r\n  } else {\r\n    if(threadId) {\r\n      const topic = await managers.dialogsStorage.getForumTopic(peerId, threadId);\r\n      title = topic?.title || '';\r\n    }\r\n\r\n    if(!title) {\r\n      const chat = (useManagers ? managers.appChatsManager.getChat(peerId.toChatId()) : apiManagerProxy.getChat(peerId.toChatId())) as Chat.chat;\r\n      title = chat?.title || '';\r\n    }\r\n\r\n    if(onlyFirstName) {\r\n      title = title.split(' ')[0];\r\n    }\r\n  }\r\n\r\n  if(limitSymbols !== undefined) {\r\n    title = _limitSymbols(title, limitSymbols, limitSymbols);\r\n  }\r\n\r\n  return plainText ? title : wrapEmojiText(title) as any;\r\n}\r\n","export const NOTIFICATION_ICON_PATH = 'assets/img/logo_filled_rounded.png';\r\nexport const NOTIFICATION_BADGE_PATH = 'assets/img/logo_plain.svg'; // masked\r\n","import {CURRENT_ACCOUNT_QUERY_PARAM} from './constants';\r\nimport {ActiveAccountNumber} from './types';\r\n\r\nexport function createAppURLForAccount(\r\n  accountNumber: ActiveAccountNumber,\r\n  hashParams?: Record<string, string>,\r\n  keepHash = false\r\n) {\r\n  const url = new URL(location.href);\r\n\r\n  const filteredEntries = Object.entries(hashParams || {}).filter((entry) => entry[1]);\r\n  const filteredParams = Object.fromEntries(filteredEntries);\r\n\r\n  if(filteredEntries.length) {\r\n    const hashSearchParams = new URLSearchParams();\r\n    for(const key in filteredParams) {\r\n      hashSearchParams.set(key, filteredParams[key]);\r\n    }\r\n    url.hash = `#/im?${hashSearchParams.toString()}`;\r\n  } else if(!keepHash) {\r\n    url.hash = '';\r\n  }\r\n\r\n  if(accountNumber === 1) url.searchParams.delete(CURRENT_ACCOUNT_QUERY_PARAM);\r\n  else url.searchParams.set(CURRENT_ACCOUNT_QUERY_PARAM, accountNumber + '');\r\n\r\n  return url;\r\n}\r\n","import {createRoot} from 'solid-js';\r\nimport {createStore, reconcile, unwrap} from 'solid-js/store';\r\nimport {State, StateSettings} from '../config/state';\r\nimport rootScope from '../lib/rootScope';\r\nimport {joinDeepPath} from '../helpers/object/setDeepProperty';\r\n\r\nconst [appSettings, _setAppSettings] = createRoot(() => createStore<StateSettings>({} as any));\r\n\r\nconst setAppSettings: typeof _setAppSettings = (...args: any[]) => {\r\n  const key = args[0];\r\n  // @ts-ignore\r\n  _setAppSettings(...args);\r\n  // @ts-ignore\r\n  rootScope.managers.appStateManager.setByKey(joinDeepPath('settings', key), unwrap(appSettings[key]));\r\n};\r\n\r\nconst setAppSettingsSilent = (key: any, value?: any) => {\r\n  if(typeof(key) === 'object') {\r\n    _setAppSettings(key);\r\n    return;\r\n  }\r\n\r\n  _setAppSettings(key, reconcile(value));\r\n};\r\n\r\nconst useAppSettings = () => [appSettings, setAppSettings] as const;\r\n\r\nexport {\r\n  appSettings,\r\n  useAppSettings,\r\n  setAppSettings,\r\n  setAppSettingsSilent\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppTheme} from '../config/state';\r\nimport type {Theme} from '../layer';\r\nimport type AppBackgroundTab from '../components/sidebarLeft/tabs/background';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport rootScope from '../lib/rootScope';\r\nimport {changeColorAccent, ColorRgb, getAccentColor, getAverageColor, getHexColorFromTelegramColor, getRgbColorFromTelegramColor, hexToRgb, hslaStringToHex, hslaStringToRgba, hslaToRgba, hsvToRgb, mixColors, rgbaToHexa, rgbaToHsla, rgbToHsv} from './color';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport customProperties from './dom/customProperties';\r\nimport {TelegramWebViewTheme} from '../types';\r\nimport {joinDeepPath} from './object/setDeepProperty';\r\nimport windowSize from './windowSize';\r\nimport liteMode from './liteMode';\r\n\r\nexport type AppColorName = 'primary-color' | 'message-out-primary-color' |\r\n  'surface-color' | 'danger-color' | 'primary-text-color' |\r\n  'secondary-text-color' | 'message-out-background-color' |\r\n  'saved-color' | 'message-background-color' | 'green-color';\r\ntype AppColor = {\r\n  rgb?: boolean,\r\n  light?: boolean,\r\n  lightFilled?: boolean,\r\n  dark?: boolean,\r\n  darkRgb?: boolean,\r\n  darkFilled?: boolean\r\n};\r\n\r\nconst appColorMap: {[name in AppColorName]: AppColor} = {\r\n  // 'background-color': {},\r\n  'primary-color': {\r\n    rgb: true,\r\n    light: true,\r\n    lightFilled: true,\r\n    dark: true,\r\n    darkRgb: true\r\n  },\r\n  'message-out-primary-color': {\r\n    lightFilled: true,\r\n    rgb: true\r\n  },\r\n  'surface-color': {\r\n    rgb: true\r\n  },\r\n  'danger-color': {\r\n    rgb: true,\r\n    light: true,\r\n    dark: true\r\n  },\r\n  'primary-text-color': {\r\n    rgb: true\r\n  },\r\n  'secondary-text-color': {\r\n    light: true,\r\n    lightFilled: true,\r\n    rgb: true\r\n  },\r\n  'message-background-color': {\r\n    light: true,\r\n    lightFilled: true,\r\n    dark: true,\r\n    darkFilled: true\r\n  },\r\n  'message-out-background-color': {\r\n    light: true,\r\n    lightFilled: true,\r\n    dark: true,\r\n    darkFilled: true,\r\n    rgb: true\r\n  },\r\n  'saved-color': {\r\n    lightFilled: true\r\n  },\r\n  'green-color': {}\r\n};\r\n\r\nconst colorMap: {\r\n  [name in AppTheme['name']]?: {\r\n    [name in AppColorName]?: string\r\n  }\r\n} = {\r\n  day: {\r\n    // 'background-color': '#f4f4f5',\r\n    'primary-color': '#3390ec',\r\n    'message-out-primary-color': '#5CA853',\r\n    'message-background-color': '#ffffff',\r\n    'surface-color': '#ffffff',\r\n    'danger-color': '#df3f40',\r\n    'primary-text-color': '#000000',\r\n    'secondary-text-color': '#707579',\r\n    'saved-color': '#359AD4',\r\n    'green-color': '#70b768'\r\n  },\r\n  night: {\r\n    // 'background-color': '#181818',\r\n    'primary-color': '#8774E1',\r\n    'message-out-primary-color': '#8774E1',\r\n    'message-background-color': '#212121',\r\n    'surface-color': '#212121',\r\n    'danger-color': '#ff595a',\r\n    'primary-text-color': '#ffffff',\r\n    'secondary-text-color': '#aaaaaa',\r\n    'saved-color': '#8774E1',\r\n    'green-color': '#5CC85E'\r\n  }\r\n};\r\n\r\nexport class ThemeController {\r\n  private themeColor: string;\r\n  private _themeColorElem: Element;\r\n  private systemTheme: AppTheme['name'];\r\n  private styleElement: HTMLStyleElement;\r\n  public AppBackgroundTab: typeof AppBackgroundTab;\r\n  private applied: boolean;\r\n\r\n  constructor() {\r\n    rootScope.addEventListener('theme_change', (coordinates) => {\r\n      this.setTheme(typeof(coordinates) === 'object' ? coordinates : undefined);\r\n    });\r\n\r\n    rootScope.addEventListener('theme_changed', () => {\r\n      this.setWorkerThemeParams();\r\n    });\r\n\r\n    // rootScope.addEventListener('settings_updated', ())\r\n  }\r\n\r\n  private setWorkerThemeParams() {\r\n    rootScope.managers.apiManager.setThemeParams({\r\n      _: 'dataJSON',\r\n      data: JSON.stringify(this.getThemeParamsForWebView())\r\n    });\r\n  }\r\n\r\n  private get themeColorElem() {\r\n    if(this._themeColorElem !== undefined) {\r\n      return this._themeColorElem;\r\n    }\r\n\r\n    return this._themeColorElem = document.head.querySelector('[name=\"theme-color\"]') as Element || null;\r\n  }\r\n\r\n  public setThemeColor(color = this.themeColor) {\r\n    if(!color) {\r\n      color = this.isNight() ? '#212121' : '#ffffff';\r\n    }\r\n\r\n    const themeColorElem = this.themeColorElem;\r\n    if(themeColorElem) {\r\n      themeColorElem.setAttribute('content', color);\r\n    }\r\n  }\r\n\r\n  public setThemeListener() {\r\n    try {\r\n      const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n      const checkDarkMode = () => {\r\n        // const theme = this.getTheme();\r\n        this.systemTheme = darkModeMediaQuery.matches ? 'night' : 'day';\r\n        // const newTheme = this.getTheme();\r\n\r\n        if(rootScope.myId) {\r\n          rootScope.dispatchEvent('theme_change');\r\n        } else {\r\n          this.setTheme();\r\n        }\r\n      };\r\n\r\n      if('addEventListener' in darkModeMediaQuery) {\r\n        darkModeMediaQuery.addEventListener('change', checkDarkMode);\r\n      } else if('addListener' in darkModeMediaQuery) {\r\n        (darkModeMediaQuery as any).addListener(checkDarkMode);\r\n      }\r\n\r\n      checkDarkMode();\r\n    } catch(err) {\r\n\r\n    }\r\n  }\r\n\r\n  public applyHighlightingColor({\r\n    hsla,\r\n    element = document.documentElement\r\n  }: {\r\n    hsla?: string,\r\n    element?: HTMLElement\r\n  } = {}) {\r\n    if(!hsla) {\r\n      hsla = 'hsla(85.5319, 36.9171%, 40.402%, .4)';\r\n      const theme = this.getTheme();\r\n      if(theme.settings?.highlightingColor) {\r\n        hsla = theme.settings.highlightingColor;\r\n      }\r\n    }\r\n\r\n    const highlightingRgba = hslaStringToRgba(hsla);\r\n    element.style.setProperty('--message-highlighting-color', hsla);\r\n    element.style.setProperty('--message-highlighting-color-rgb', highlightingRgba.slice(0, 3).join(','));\r\n    element.style.setProperty('--message-highlighting-alpha', '' + highlightingRgba[3] / 255);\r\n\r\n    if(!IS_TOUCH_SUPPORTED && hsla) {\r\n      this.themeColor = hslaStringToHex(hsla);\r\n    }\r\n  }\r\n\r\n  public _setTheme(silent?: boolean) {\r\n    const isNight = this.isNight();\r\n    const colorScheme = document.head.querySelector('[name=\"color-scheme\"]');\r\n    colorScheme?.setAttribute('content', isNight ? 'dark' : 'light');\r\n\r\n    document.documentElement.classList.toggle('night', isNight);\r\n    this.setThemeColor();\r\n    const theme = this.getTheme();\r\n    this.applyTheme(theme);\r\n\r\n    let style = this.styleElement;\r\n    if(!style) {\r\n      style = this.styleElement = document.createElement('style');\r\n      document.head.append(style);\r\n    }\r\n\r\n    const e = document.createElement('div');\r\n    this.applyTheme(rootScope.settings.themes.find((theme) => theme.name === 'night'), e, true);\r\n    style.textContent = `.night {${e.style.cssText}}`;\r\n\r\n    this.applyHighlightingColor();\r\n    !silent && rootScope.dispatchEventSingle('theme_changed');\r\n  }\r\n\r\n  public setTheme(coordinates?: {x: number, y: number}) {\r\n    if(!('startViewTransition' in document) || !this.applied) {\r\n      const silent = !this.applied;\r\n      const wasApplied = this.applied;\r\n      this.applied = true;\r\n\r\n      this._setTheme(silent);\r\n      if(!wasApplied) {\r\n        this.setWorkerThemeParams();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if(!liteMode.isAvailable('animations')) {\r\n      coordinates = undefined;\r\n    }\r\n\r\n    const reverse = !this.isNight();\r\n    if(coordinates) {\r\n      document.documentElement.classList.add('no-view-transition');\r\n      document.documentElement.classList.toggle('reverse', reverse);\r\n      void document.documentElement.offsetLeft; // reflow\r\n    }\r\n\r\n    const transition = document.startViewTransition(() => {\r\n      this._setTheme();\r\n    });\r\n\r\n    if(!coordinates) {\r\n      return;\r\n    }\r\n\r\n    const {x, y} = coordinates;\r\n    // Get the distance to the furthest corner\r\n    const endRadius = Math.hypot(\r\n      Math.max(x, windowSize.width - x),\r\n      Math.max(y, windowSize.height - y)\r\n    );\r\n\r\n    transition.ready.then(() => {\r\n      document.documentElement.animate({\r\n        clipPath: [\r\n          `circle(0 at ${x}px ${y}px)`,\r\n          `circle(${endRadius}px at ${x}px ${y}px)`\r\n        ]\r\n      }, {\r\n        duration: 500,\r\n        easing: 'ease-in-out',\r\n        pseudoElement: `::view-transition-${reverse ? 'old' : 'new'}(root)`,\r\n        direction: reverse ? 'reverse' : 'normal'\r\n      });\r\n    });\r\n\r\n    transition.finished.finally(() => {\r\n      document.documentElement.classList.remove('no-view-transition', 'reverse');\r\n    });\r\n  }\r\n\r\n  public async switchTheme(name: AppTheme['name'], coordinates?: {x: number, y: number}) {\r\n    await rootScope.managers.appStateManager.setByKey(joinDeepPath('settings', 'theme'), name);\r\n    rootScope.dispatchEvent('theme_change', coordinates);\r\n  }\r\n\r\n  public isNight() {\r\n    return this.getTheme().name === 'night';\r\n  }\r\n\r\n  public getTheme(name: AppTheme['name'] = rootScope.settings.theme === 'system' ? this.systemTheme : rootScope.settings.theme) {\r\n    return rootScope.settings.themes.find((t) => t.name === name);\r\n  }\r\n\r\n  // theme applier\r\n  private bindColorApplier(options: Pick<Parameters<ThemeController['applyAppColor']>[0], 'element' | 'isNight' | 'saveToCache'>) {\r\n    const appliedColors: Set<AppColorName> = new Set();\r\n    return {\r\n      applyAppColor: (_options: Omit<Parameters<ThemeController['applyAppColor']>[0], keyof typeof options>) => {\r\n        appliedColors.add(_options.name);\r\n        return this.applyAppColor({..._options, ...options});\r\n      },\r\n      finalize: () => {\r\n        const isNight = options.isNight;\r\n        for(const name in appColorMap) {\r\n          if(!appliedColors.has(name as AppColorName)) {\r\n            this.applyAppColor({\r\n              name: name as AppColorName,\r\n              hex: colorMap[isNight ? 'night' : 'day'][name as AppColorName],\r\n              ...options\r\n            });\r\n          }\r\n        }\r\n      }\r\n    };\r\n  };\r\n\r\n  public applyAppColor({\r\n    name,\r\n    hex,\r\n    element,\r\n    lightenAlpha = 0.08,\r\n    darkenAlpha = lightenAlpha,\r\n    mixColor,\r\n    isNight = this.isNight(),\r\n    saveToCache\r\n  }: {\r\n    name: AppColorName,\r\n    hex: string,\r\n    element: HTMLElement,\r\n    lightenAlpha?: number\r\n    darkenAlpha?: number,\r\n    mixColor?: ColorRgb,\r\n    isNight?: boolean,\r\n    saveToCache?: boolean\r\n  }) {\r\n    const appColor = appColorMap[name];\r\n    const rgb = hexToRgb(hex);\r\n    const hsla = rgbaToHsla(...rgb);\r\n\r\n    mixColor ??= hexToRgb(colorMap[isNight ? 'night' : 'day']['surface-color']);\r\n    const lightenedRgb = mixColors(rgb, mixColor, lightenAlpha);\r\n\r\n    const darkenedHsla: typeof hsla = {\r\n      ...hsla,\r\n      l: hsla.l - darkenAlpha * 100\r\n    };\r\n\r\n    const properties: [string, string][] = [\r\n      [name, hex],\r\n      appColor.rgb && [name + '-rgb', rgb.join(',')],\r\n      appColor.light && ['light-' + name, `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, ${lightenAlpha})`],\r\n      appColor.lightFilled && ['light-filled-' + name, rgbaToHexa(lightenedRgb)],\r\n      appColor.dark && ['dark-' + name, `hsl(${darkenedHsla.h}, ${darkenedHsla.s}%, ${darkenedHsla.l}%)`]\r\n      // appColor.darkFilled && ['dark-' + name, `hsl(${darkenedHsla.h}, ${darkenedHsla.s}%, ${darkenedHsla.l}%)`]\r\n    ];\r\n\r\n    saveToCache ??= element === document.documentElement;\r\n    properties.filter(Boolean).forEach(([name, value]) => {\r\n      element.style.setProperty('--' + name, value);\r\n\r\n      if(saveToCache) {\r\n        customProperties.setPropertyCache(name as AppColorName, value, isNight);\r\n      }\r\n    });\r\n  }\r\n\r\n  public async applyNewTheme(theme: Theme) {\r\n    const isNight = this.isNightTheme(theme);\r\n    const currentTheme = this.getTheme();\r\n    const themes = rootScope.settings.themes;\r\n    const themeSettings = theme.settings.find((themeSettings) => themeSettings.base_theme._ === (isNight ? 'baseThemeNight' : 'baseThemeClassic'));\r\n    const newAppTheme: AppTheme = {\r\n      ...theme,\r\n      name: currentTheme.name,\r\n      settings: {\r\n        ...themeSettings,\r\n        highlightingColor: ''\r\n      }\r\n    };\r\n\r\n    await this.AppBackgroundTab.setBackgroundDocument(themeSettings.wallpaper, newAppTheme.settings);\r\n    themes[themes.indexOf(currentTheme)] = newAppTheme;\r\n    await rootScope.managers.appStateManager.setByKey(joinDeepPath('settings', 'themes'), rootScope.settings.themes);\r\n    rootScope.dispatchEvent('theme_change');\r\n  }\r\n\r\n  private isNightTheme(theme: Theme | AppTheme) {\r\n    return (theme as AppTheme).name === 'night' || this.isNight();\r\n  }\r\n\r\n  public getThemeSettings(theme: Theme | AppTheme, isNight?: boolean) {\r\n    isNight ??= this.isNightTheme(theme);\r\n    const themeSettings = Array.isArray(theme.settings) ?\r\n      theme.settings.find((settings) => settings.base_theme._ === (isNight ? 'baseThemeNight' : 'baseThemeClassic')) :\r\n      theme.settings;\r\n    return themeSettings;\r\n  }\r\n\r\n  public applyTheme(theme: Theme | AppTheme, element = document.documentElement, saveToCache?: boolean) {\r\n    const isNight = this.isNightTheme(theme);\r\n    const themeSettings = this.getThemeSettings(theme, isNight);\r\n    const baseColors = colorMap[isNight ? 'night' : 'day'];\r\n\r\n    let hsvTemp1 = rgbToHsv(...hexToRgb(baseColors['primary-color'])); // primary base\r\n    let hsvTemp2 = rgbToHsv(...getRgbColorFromTelegramColor(themeSettings.accent_color)); // new primary\r\n\r\n    const newAccentRgb = changeColorAccent(\r\n      hsvTemp1,\r\n      hsvTemp2,\r\n      hexToRgb(baseColors['primary-color']),\r\n      !isNight\r\n    );\r\n    const newAccentHex = rgbaToHexa(newAccentRgb);\r\n\r\n    const {applyAppColor, finalize} = this.bindColorApplier({element, isNight, saveToCache});\r\n\r\n    applyAppColor({\r\n      name: 'primary-color',\r\n      hex: newAccentHex,\r\n      darkenAlpha: 0.04\r\n    });\r\n\r\n    applyAppColor({\r\n      name: 'saved-color',\r\n      hex: newAccentHex,\r\n      lightenAlpha: 0.64,\r\n      mixColor: [255, 255, 255]\r\n    });\r\n\r\n    if(!themeSettings.message_colors?.length) {\r\n      return;\r\n    }\r\n\r\n    const messageLightenAlpha = isNight ? 1 : 0.12;\r\n    const baseMessageColor = hexToRgb(baseColors['message-out-primary-color']);\r\n    hsvTemp1 = rgbToHsv(...baseMessageColor);\r\n    const baseMessageOutBackgroundColor = mixColors(baseMessageColor, hexToRgb(baseColors['surface-color']), messageLightenAlpha);\r\n\r\n    const firstColor = getRgbColorFromTelegramColor(themeSettings.message_colors[0]);\r\n\r\n    let myMessagesAccent = firstColor;\r\n    if(themeSettings.message_colors.length > 1) {\r\n      // const w = getAccentColor(hsvTemp1, baseMessageOutBackgroundColor, myMessagesAccent);\r\n\r\n      themeSettings.message_colors.slice(1).forEach((nextColor) => {\r\n        myMessagesAccent = getAverageColor(myMessagesAccent, getRgbColorFromTelegramColor(nextColor));\r\n      });\r\n\r\n      myMessagesAccent = getAccentColor(hsvTemp1, baseMessageOutBackgroundColor, myMessagesAccent);\r\n\r\n      // console.log('www', rgbaToHexa(w), rgbaToHexa(myMessagesAccent));\r\n    }\r\n\r\n    const o = myMessagesAccent;\r\n    hsvTemp2 = rgbToHsv(...o);\r\n\r\n    // const c = changeColorAccent(\r\n    //   hsvTemp1,\r\n    //   hsvTemp2,\r\n    //   baseMessageOutBackgroundColor\r\n    // );\r\n\r\n    // console.log(o, c, rgbaToHexa(o), rgbaToHexa(c));\r\n\r\n    const accentColor2 = themeSettings.outbox_accent_color !== undefined && rgbToHsv(...getRgbColorFromTelegramColor(themeSettings.outbox_accent_color));\r\n\r\n    let newMessageOutBackgroundColor = mixColors(myMessagesAccent, hexToRgb(baseColors['surface-color']), messageLightenAlpha);\r\n\r\n    if(!isNight/*  || true */) {\r\n      const messageOutBackgroundColorHsl = rgbaToHsla(...newMessageOutBackgroundColor);\r\n      messageOutBackgroundColorHsl.s = Math.min(messageOutBackgroundColorHsl.s + (isNight ? 8 : 63), 100);\r\n      newMessageOutBackgroundColor = hslaToRgba(messageOutBackgroundColorHsl.h, messageOutBackgroundColorHsl.s, messageOutBackgroundColorHsl.l, messageOutBackgroundColorHsl.a).slice(0, 3) as ColorRgb;\r\n    }\r\n\r\n    applyAppColor({\r\n      name: 'message-out-background-color',\r\n      hex: rgbaToHexa(newMessageOutBackgroundColor),\r\n      lightenAlpha: messageLightenAlpha\r\n    });\r\n\r\n    applyAppColor({\r\n      name: 'message-out-primary-color',\r\n      hex: isNight ? '#ffffff' : rgbaToHexa(accentColor2 ? hsvToRgb(...accentColor2) : myMessagesAccent),\r\n      mixColor: newMessageOutBackgroundColor\r\n    });\r\n\r\n    // if(accentColor2) {\r\n    //   console.log(rgbaToHexa(myMessagesAccent), rgbaToHexa(hsvToRgb(...accentColor2)));\r\n    // }\r\n\r\n    finalize();\r\n  }\r\n\r\n  public getThemeParamsForWebView() {\r\n    const themePropertiesMap: {[key in keyof TelegramWebViewTheme]: string} = {\r\n      bg_color: 'surface-color',\r\n      button_color: 'primary-color',\r\n      button_text_color: '#ffffff',\r\n      hint_color: 'secondary-text-color',\r\n      link_color: 'link-color',\r\n      secondary_bg_color: 'background-color-true',\r\n      text_color: 'primary-text-color',\r\n      header_bg_color: 'surface-color',\r\n      accent_text_color: 'primary-color',\r\n      section_bg_color: 'surface-color',\r\n      section_header_text_color: 'primary-color',\r\n      subtitle_text_color: 'secondary-text-color',\r\n      destructive_text_color: 'danger-color'\r\n    };\r\n\r\n    const themeParams: TelegramWebViewTheme = {} as any;\r\n    for(const key in themePropertiesMap) {\r\n      const value = themePropertiesMap[key as keyof TelegramWebViewTheme];\r\n      themeParams[key as keyof TelegramWebViewTheme] = value[0] === '#' ? value : customProperties.getProperty(value as AppColorName);\r\n    }\r\n\r\n    return themeParams;\r\n  }\r\n}\r\n\r\nconst themeController = new ThemeController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.themeController = themeController);\r\nexport default themeController;\r\n","import {getHexColorFromTelegramColor, hexToRgb, hexaToHsla} from '../../../../helpers/color';\r\nimport themeController from '../../../../helpers/themeController';\r\nimport {Chat, HelpPeerColorOption, HelpPeerColorSet, User} from '../../../../layer';\r\n\r\nconst DialogColorsFg: Array<string[]> = [['#CC5049'], ['#D67722'], ['#955CDB'], ['#40A920'], ['#309EBA'], ['#368AD1'], ['#C7508B']],\r\n  DialogColors = ['red', 'orange', 'violet', 'green', 'cyan', 'blue', 'pink'] as const;\r\n\r\nconst _DialogColorsFg = DialogColorsFg;\r\n\r\nexport function getPeerColorIndexById(peerId: UserId | ChatId) {\r\n  return Math.abs(+peerId) % 7;\r\n}\r\n\r\nexport function getPeerAvatarColorByPeer(peer: Chat | User) {\r\n  let idx = getPeerColorIndexByPeer(peer);\r\n  if(idx === -1) {\r\n    return;\r\n  }\r\n\r\n  let color = DialogColors[idx];\r\n  if(!color) {\r\n    const fgColor = DialogColorsFg[idx];\r\n    if(!fgColor) {\r\n      return DialogColors[getPeerColorIndexById(peer.id)];\r\n    }\r\n\r\n    const hsla = hexaToHsla(fgColor[0]);\r\n    const hue = hsla.h;\r\n\r\n    if(hue >= 345 || hue < 29) idx = 0; // red\r\n    else if(hue < 67) idx = 1; // orange\r\n    else if(hue < 140) idx = 3; // green\r\n    else if(hue < 199) idx = 4; // cyan\r\n    else if(hue < 234) idx = 5; // blue\r\n    else if(hue < 301) idx = 2; // violet\r\n    else idx = 6; // pink\r\n\r\n    color = DialogColors[idx];\r\n  }\r\n\r\n  return color;\r\n}\r\n\r\nexport function getPeerColorIndexByPeer(peer: Chat | User) {\r\n  if(!peer) return -1;\r\n  const peerColor = (peer as User.user).color;\r\n  return peerColor?.color ?? getPeerColorIndexById(peer.id);\r\n}\r\n\r\nexport function getPeerColorsByPeer(peer: Chat | User) {\r\n  const colorIndex = getPeerColorIndexByPeer(peer);\r\n  return DialogColorsFg[colorIndex] ?? [];\r\n}\r\n\r\nfunction replaceColors(writeIn: typeof DialogColorsFg, peerColorOptions: HelpPeerColorOption[], dark?: boolean) {\r\n  for(const peerColorOption of peerColorOptions) {\r\n    const colorSet = (dark ? peerColorOption.dark_colors : peerColorOption.colors) as HelpPeerColorSet.helpPeerColorSet;\r\n    const colors = colorSet?.colors;\r\n    if(!colors?.length) {\r\n      continue;\r\n    }\r\n\r\n    const c = colors.map((color) => getHexColorFromTelegramColor(color));\r\n    writeIn[peerColorOption.color_id] = c;\r\n  }\r\n\r\n  return writeIn;\r\n}\r\n\r\nexport function makeColorsGradient(colors: string[], partSize?: number) {\r\n  const length = colors.length;\r\n  partSize ||= 5;\r\n  if(length !== 3) {\r\n    colors = colors.slice().reverse();\r\n  }\r\n\r\n  const str = colors.map((color, idx, arr) => {\r\n    // const startPercents = +(idx * 100 / arr.length).toFixed(2);\r\n    // const endPercents = +((idx + 1) * 100 / arr.length).toFixed(2);\r\n    const startValue = idx * partSize + 'px';\r\n    const endValue = (idx + 1) * partSize + 'px';\r\n    return [\r\n      `${color} ${startValue}`,\r\n      `${color} ${endValue}`\r\n    ].join(', ');\r\n  }).join(', ');\r\n  return `repeating-linear-gradient(-45deg, ${str})`;\r\n}\r\n\r\nexport function setPeerColors(peerColorOptions: HelpPeerColorOption[], user: User.user) {\r\n  let newColors = replaceColors(_DialogColorsFg.slice(), peerColorOptions);\r\n  if(themeController.isNight()) {\r\n    newColors = replaceColors(newColors, peerColorOptions, true);\r\n  }\r\n  DialogColorsFg.splice(0, DialogColorsFg.length, ...newColors);\r\n\r\n  newColors.forEach((colors, index) => {\r\n    const peerProperty = `--peer-${index}`;\r\n    const borderBackgroundProperty = `${peerProperty}-border-background`;\r\n    const colorRgbProperty = `${peerProperty}-color-rgb`;\r\n    document.documentElement.style.setProperty(colorRgbProperty, hexToRgb(colors[0]).join(','));\r\n    if(colors.length > 1) {\r\n      const gradient = makeColorsGradient(colors);\r\n      document.documentElement.style.setProperty(\r\n        borderBackgroundProperty,\r\n        gradient\r\n      );\r\n    } else {\r\n      document.documentElement.style.removeProperty(borderBackgroundProperty);\r\n    }\r\n  });\r\n\r\n  // set my peer color\r\n  const myColors = getPeerColorsByPeer(user);\r\n  const properties: [string, string, number][] = [\r\n    ['--peer-border-background', '--primary-color', myColors.length],\r\n    ['--message-out-peer-border-background', '--message-out-primary-color', myColors.length],\r\n    ['--message-out-peer-1-border-background', '--message-out-primary-color', 1],\r\n    ['--message-out-peer-2-border-background', '--message-out-primary-color', 2],\r\n    ['--message-out-peer-3-border-background', '--message-out-primary-color', 3],\r\n    ['--message-empty-peer-1-border-background', '--message-empty-primary-color', 1],\r\n    ['--message-empty-peer-2-border-background', '--message-empty-primary-color', 2],\r\n    ['--message-empty-peer-3-border-background', '--message-empty-primary-color', 3]\r\n  ];\r\n\r\n  properties.forEach(([peerProperty, colorProperty, length]) => {\r\n    let borderBackground: string;\r\n    if(length > 1) {\r\n      const colors = [\r\n        `rgba(var(${colorProperty}-rgb), .4)`,\r\n        `rgba(var(${colorProperty}-rgb), .2)`,\r\n        `var(${colorProperty})`\r\n      ];\r\n\r\n      if(length === 2) {\r\n        colors.shift();\r\n      }\r\n\r\n      borderBackground = makeColorsGradient(colors);\r\n    } else {\r\n      borderBackground = `var(${colorProperty})`;\r\n    }\r\n\r\n    document.documentElement.style.setProperty(peerProperty, borderBackground);\r\n  });\r\n}\r\n","import {MessageEntity} from '../../layer';\r\nimport {toCodePoints} from '../../vendor/emoji';\r\n\r\nexport default function getEmojiEntityFromEmoji(emoji: string): MessageEntity.messageEntityEmoji {\r\n  return {\r\n    _: 'messageEntityEmoji',\r\n    offset: 0,\r\n    length: emoji.length,\r\n    unicode: toCodePoints(emoji).join('-').replace(/-?fe0f/g, '')\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport getEmojiEntityFromEmoji from './getEmojiEntityFromEmoji';\r\nimport emojiRegExp from '../../vendor/emoji/regex';\r\n\r\nconst EMOJI_REG_EXP = new RegExp(`(^${emojiRegExp})`);\r\n\r\nexport default function getAbbreviation(str: string, onlyFirst = false): {\r\n  text: string,\r\n  entities: MessageEntity[]\r\n} {\r\n  const splitted = (str || '').trim().split(' ');\r\n  if(!splitted[0]) return {text: '', entities: []};\r\n\r\n  const entities: MessageEntity.messageEntityEmoji[] = [];\r\n\r\n  const firstEmojiMatch = splitted[0].match(EMOJI_REG_EXP);\r\n  const first = firstEmojiMatch?.[0] || splitted[0][0];\r\n  if(firstEmojiMatch) {\r\n    entities.push(getEmojiEntityFromEmoji(first));\r\n  }\r\n\r\n  const length = splitted.length;\r\n  if(onlyFirst || length === 1) return {text: first, entities};\r\n\r\n  const lastEmojiMatch = splitted[length - 1].match(EMOJI_REG_EXP);\r\n  const last = lastEmojiMatch?.[0] || splitted[length - 1][0];\r\n  if(lastEmojiMatch) {\r\n    entities.push({\r\n      ...getEmojiEntityFromEmoji(last),\r\n      offset: first.length\r\n    });\r\n  }\r\n\r\n  return {text: first + last, entities};\r\n}\r\n","export default function drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\r\n  const dpr = ctx.canvas.dpr;\r\n  if(dpr) {\r\n    x *= dpr;\r\n    y *= dpr;\r\n    radius *= dpr;\r\n  }\r\n\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\r\n  ctx.closePath();\r\n\r\n  if(fill) {\r\n    ctx.fill();\r\n  }\r\n\r\n  if(stroke) {\r\n    ctx.stroke();\r\n  }\r\n}\r\n\r\nexport function drawCircleFromStart(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\r\n  return drawCircle(ctx, x + radius, y + radius, radius, fill, stroke);\r\n}\r\n","import {FontFamily} from '../config/font';\r\nimport type {AppManagers} from '../lib/appManagers/managers';\r\nimport {getPeerAvatarColorByPeer} from '../lib/appManagers/utils/peers/getPeerColorById';\r\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\r\nimport drawCircle from './canvas/drawCircle';\r\nimport customProperties from './dom/customProperties';\r\n\r\nlet avatarCanvas: HTMLCanvasElement;\r\nlet avatarContext: CanvasRenderingContext2D;\r\nlet avatarGradients: Record<string, CanvasGradient>;\r\n\r\nexport default async function createNotificationImage(\r\n  managers: AppManagers,\r\n  peerId: PeerId,\r\n  peerTitle: string\r\n) {\r\n  const peerPhoto = await managers.appPeersManager.getPeerPhoto(peerId);\r\n  if(peerPhoto) {\r\n    const url = await managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small');\r\n    return url;\r\n  }\r\n\r\n  if(!avatarCanvas) {\r\n    avatarCanvas = document.createElement('canvas');\r\n    avatarContext = avatarCanvas.getContext('2d');\r\n\r\n    const SIZE = 54;\r\n    const dpr = 1;\r\n    avatarCanvas.dpr = dpr;\r\n    avatarCanvas.width = avatarCanvas.height = SIZE * dpr;\r\n\r\n    avatarGradients = {};\r\n  } else {\r\n    avatarContext.clearRect(0, 0, avatarCanvas.width, avatarCanvas.height);\r\n  }\r\n\r\n  const peer = await managers.appPeersManager.getPeer(peerId);\r\n  const color = getPeerAvatarColorByPeer(peer);\r\n  let gradient = avatarGradients[color];\r\n  if(!gradient) {\r\n    gradient = avatarGradients[color] = avatarContext.createLinearGradient(avatarCanvas.width / 2, 0, avatarCanvas.width / 2, avatarCanvas.height);\r\n\r\n    const colorTop = customProperties.getProperty(`peer-avatar-${color}-top`);\r\n    const colorBottom = customProperties.getProperty(`peer-avatar-${color}-bottom`);\r\n    gradient.addColorStop(0, colorTop);\r\n    gradient.addColorStop(1, colorBottom);\r\n  }\r\n\r\n  avatarContext.fillStyle = gradient;\r\n\r\n  drawCircle(avatarContext, avatarCanvas.width / 2, avatarCanvas.height / 2, avatarCanvas.width / 2);\r\n  avatarContext.fill();\r\n\r\n  const fontSize = 20 * avatarCanvas.dpr;\r\n  const abbreviation = getAbbreviation(peerTitle);\r\n\r\n  avatarContext.font = `700 ${fontSize}px ${FontFamily}`;\r\n  avatarContext.textBaseline = 'middle';\r\n  avatarContext.textAlign = 'center';\r\n  avatarContext.fillStyle = 'white';\r\n  avatarContext.fillText(abbreviation.text, avatarCanvas.width / 2, avatarCanvas.height * (window.devicePixelRatio > 1 || true ? .5625 : .5));\r\n\r\n  return avatarCanvas.toDataURL();\r\n}\r\n","import { createRoot, createRenderEffect, sharedConfig, untrack, enableHydration, getOwner, createEffect, runWithOwner, createMemo, createSignal, onCleanup, splitProps } from 'solid-js';\r\nexport { ErrorBoundary, For, Index, Match, Show, Suspense, SuspenseList, Switch, createComponent, createRenderEffect as effect, getOwner, createMemo as memo, mergeProps, untrack } from 'solid-js';\r\n\r\nconst booleans = [\"allowfullscreen\", \"async\", \"autofocus\", \"autoplay\", \"checked\", \"controls\", \"default\", \"disabled\", \"formnovalidate\", \"hidden\", \"indeterminate\", \"ismap\", \"loop\", \"multiple\", \"muted\", \"nomodule\", \"novalidate\", \"open\", \"playsinline\", \"readonly\", \"required\", \"reversed\", \"seamless\", \"selected\"];\r\nconst Properties = /*#__PURE__*/new Set([\"className\", \"value\", \"readOnly\", \"formNoValidate\", \"isMap\", \"noModule\", \"playsInline\", ...booleans]);\r\nconst ChildProperties = /*#__PURE__*/new Set([\"innerHTML\", \"textContent\", \"innerText\", \"children\"]);\r\nconst Aliases = /*#__PURE__*/Object.assign(Object.create(null), {\r\n  className: \"class\",\r\n  htmlFor: \"for\"\r\n});\r\nconst PropAliases = /*#__PURE__*/Object.assign(Object.create(null), {\r\n  class: \"className\",\r\n  formnovalidate: {\r\n    $: \"formNoValidate\",\r\n    BUTTON: 1,\r\n    INPUT: 1\r\n  },\r\n  ismap: {\r\n    $: \"isMap\",\r\n    IMG: 1\r\n  },\r\n  nomodule: {\r\n    $: \"noModule\",\r\n    SCRIPT: 1\r\n  },\r\n  playsinline: {\r\n    $: \"playsInline\",\r\n    VIDEO: 1\r\n  },\r\n  readonly: {\r\n    $: \"readOnly\",\r\n    INPUT: 1,\r\n    TEXTAREA: 1\r\n  }\r\n});\r\nfunction getPropAlias(prop, tagName) {\r\n  const a = PropAliases[prop];\r\n  return typeof a === \"object\" ? a[tagName] ? a[\"$\"] : undefined : a;\r\n}\r\nconst DelegatedEvents = /*#__PURE__*/new Set([\"beforeinput\", \"click\", \"dblclick\", \"contextmenu\", \"focusin\", \"focusout\", \"input\", \"keydown\", \"keyup\", \"mousedown\", \"mousemove\", \"mouseout\", \"mouseover\", \"mouseup\", \"pointerdown\", \"pointermove\", \"pointerout\", \"pointerover\", \"pointerup\", \"touchend\", \"touchmove\", \"touchstart\"]);\r\nconst SVGElements = /*#__PURE__*/new Set([\r\n\"altGlyph\", \"altGlyphDef\", \"altGlyphItem\", \"animate\", \"animateColor\", \"animateMotion\", \"animateTransform\", \"circle\", \"clipPath\", \"color-profile\", \"cursor\", \"defs\", \"desc\", \"ellipse\", \"feBlend\", \"feColorMatrix\", \"feComponentTransfer\", \"feComposite\", \"feConvolveMatrix\", \"feDiffuseLighting\", \"feDisplacementMap\", \"feDistantLight\", \"feFlood\", \"feFuncA\", \"feFuncB\", \"feFuncG\", \"feFuncR\", \"feGaussianBlur\", \"feImage\", \"feMerge\", \"feMergeNode\", \"feMorphology\", \"feOffset\", \"fePointLight\", \"feSpecularLighting\", \"feSpotLight\", \"feTile\", \"feTurbulence\", \"filter\", \"font\", \"font-face\", \"font-face-format\", \"font-face-name\", \"font-face-src\", \"font-face-uri\", \"foreignObject\", \"g\", \"glyph\", \"glyphRef\", \"hkern\", \"image\", \"line\", \"linearGradient\", \"marker\", \"mask\", \"metadata\", \"missing-glyph\", \"mpath\", \"path\", \"pattern\", \"polygon\", \"polyline\", \"radialGradient\", \"rect\",\r\n\"set\", \"stop\",\r\n\"svg\", \"switch\", \"symbol\", \"text\", \"textPath\",\r\n\"tref\", \"tspan\", \"use\", \"view\", \"vkern\"]);\r\nconst SVGNamespace = {\r\n  xlink: \"http://www.w3.org/1999/xlink\",\r\n  xml: \"http://www.w3.org/XML/1998/namespace\"\r\n};\r\nconst DOMElements = /*#__PURE__*/new Set([\"html\", \"base\", \"head\", \"link\", \"meta\", \"style\", \"title\", \"body\", \"address\", \"article\", \"aside\", \"footer\", \"header\", \"main\", \"nav\", \"section\", \"body\", \"blockquote\", \"dd\", \"div\", \"dl\", \"dt\", \"figcaption\", \"figure\", \"hr\", \"li\", \"ol\", \"p\", \"pre\", \"ul\", \"a\", \"abbr\", \"b\", \"bdi\", \"bdo\", \"br\", \"cite\", \"code\", \"data\", \"dfn\", \"em\", \"i\", \"kbd\", \"mark\", \"q\", \"rp\", \"rt\", \"ruby\", \"s\", \"samp\", \"small\", \"span\", \"strong\", \"sub\", \"sup\", \"time\", \"u\", \"var\", \"wbr\", \"area\", \"audio\", \"img\", \"map\", \"track\", \"video\", \"embed\", \"iframe\", \"object\", \"param\", \"picture\", \"portal\", \"source\", \"svg\", \"math\", \"canvas\", \"noscript\", \"script\", \"del\", \"ins\", \"caption\", \"col\", \"colgroup\", \"table\", \"tbody\", \"td\", \"tfoot\", \"th\", \"thead\", \"tr\", \"button\", \"datalist\", \"fieldset\", \"form\", \"input\", \"label\", \"legend\", \"meter\", \"optgroup\", \"option\", \"output\", \"progress\", \"select\", \"textarea\", \"details\", \"dialog\", \"menu\", \"summary\", \"details\", \"slot\", \"template\", \"acronym\", \"applet\", \"basefont\", \"bgsound\", \"big\", \"blink\", \"center\", \"content\", \"dir\", \"font\", \"frame\", \"frameset\", \"hgroup\", \"image\", \"keygen\", \"marquee\", \"menuitem\", \"nobr\", \"noembed\", \"noframes\", \"plaintext\", \"rb\", \"rtc\", \"shadow\", \"spacer\", \"strike\", \"tt\", \"xmp\", \"a\", \"abbr\", \"acronym\", \"address\", \"applet\", \"area\", \"article\", \"aside\", \"audio\", \"b\", \"base\", \"basefont\", \"bdi\", \"bdo\", \"bgsound\", \"big\", \"blink\", \"blockquote\", \"body\", \"br\", \"button\", \"canvas\", \"caption\", \"center\", \"cite\", \"code\", \"col\", \"colgroup\", \"content\", \"data\", \"datalist\", \"dd\", \"del\", \"details\", \"dfn\", \"dialog\", \"dir\", \"div\", \"dl\", \"dt\", \"em\", \"embed\", \"fieldset\", \"figcaption\", \"figure\", \"font\", \"footer\", \"form\", \"frame\", \"frameset\", \"head\", \"header\", \"hgroup\", \"hr\", \"html\", \"i\", \"iframe\", \"image\", \"img\", \"input\", \"ins\", \"kbd\", \"keygen\", \"label\", \"legend\", \"li\", \"link\", \"main\", \"map\", \"mark\", \"marquee\", \"menu\", \"menuitem\", \"meta\", \"meter\", \"nav\", \"nobr\", \"noembed\", \"noframes\", \"noscript\", \"object\", \"ol\", \"optgroup\", \"option\", \"output\", \"p\", \"param\", \"picture\", \"plaintext\", \"portal\", \"pre\", \"progress\", \"q\", \"rb\", \"rp\", \"rt\", \"rtc\", \"ruby\", \"s\", \"samp\", \"script\", \"section\", \"select\", \"shadow\", \"slot\", \"small\", \"source\", \"spacer\", \"span\", \"strike\", \"strong\", \"style\", \"sub\", \"summary\", \"sup\", \"table\", \"tbody\", \"td\", \"template\", \"textarea\", \"tfoot\", \"th\", \"thead\", \"time\", \"title\", \"tr\", \"track\", \"tt\", \"u\", \"ul\", \"var\", \"video\", \"wbr\", \"xmp\", \"input\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"]);\r\n\r\nfunction reconcileArrays(parentNode, a, b) {\r\n  let bLength = b.length,\r\n    aEnd = a.length,\r\n    bEnd = bLength,\r\n    aStart = 0,\r\n    bStart = 0,\r\n    after = a[aEnd - 1].nextSibling,\r\n    map = null;\r\n  while (aStart < aEnd || bStart < bEnd) {\r\n    if (a[aStart] === b[bStart]) {\r\n      aStart++;\r\n      bStart++;\r\n      continue;\r\n    }\r\n    while (a[aEnd - 1] === b[bEnd - 1]) {\r\n      aEnd--;\r\n      bEnd--;\r\n    }\r\n    if (aEnd === aStart) {\r\n      const node = bEnd < bLength ? bStart ? b[bStart - 1].nextSibling : b[bEnd - bStart] : after;\r\n      while (bStart < bEnd) parentNode.insertBefore(b[bStart++], node);\r\n    } else if (bEnd === bStart) {\r\n      while (aStart < aEnd) {\r\n        if (!map || !map.has(a[aStart])) a[aStart].remove();\r\n        aStart++;\r\n      }\r\n    } else if (a[aStart] === b[bEnd - 1] && b[bStart] === a[aEnd - 1]) {\r\n      const node = a[--aEnd].nextSibling;\r\n      parentNode.insertBefore(b[bStart++], a[aStart++].nextSibling);\r\n      parentNode.insertBefore(b[--bEnd], node);\r\n      a[aEnd] = b[bEnd];\r\n    } else {\r\n      if (!map) {\r\n        map = new Map();\r\n        let i = bStart;\r\n        while (i < bEnd) map.set(b[i], i++);\r\n      }\r\n      const index = map.get(a[aStart]);\r\n      if (index != null) {\r\n        if (bStart < index && index < bEnd) {\r\n          let i = aStart,\r\n            sequence = 1,\r\n            t;\r\n          while (++i < aEnd && i < bEnd) {\r\n            if ((t = map.get(a[i])) == null || t !== index + sequence) break;\r\n            sequence++;\r\n          }\r\n          if (sequence > index - bStart) {\r\n            const node = a[aStart];\r\n            while (bStart < index) parentNode.insertBefore(b[bStart++], node);\r\n          } else parentNode.replaceChild(b[bStart++], a[aStart++]);\r\n        } else aStart++;\r\n      } else a[aStart++].remove();\r\n    }\r\n  }\r\n}\r\n\r\nconst $$EVENTS = \"_$DX_DELEGATE\";\r\nfunction render(code, element, init, options = {}) {\r\n  let disposer;\r\n  createRoot(dispose => {\r\n    disposer = dispose;\r\n    element === document ? code() : insert(element, code(), element.firstChild ? null : undefined, init);\r\n  }, options.owner);\r\n  return () => {\r\n    disposer();\r\n    element.textContent = \"\";\r\n  };\r\n}\r\nfunction template(html, isCE, isSVG) {\r\n  let node;\r\n  const create = () => {\r\n    const t = document.createElement(\"template\");\r\n    t.innerHTML = html;\r\n    return isSVG ? t.content.firstChild.firstChild : t.content.firstChild;\r\n  };\r\n  const fn = isCE ? () => untrack(() => document.importNode(node || (node = create()), true)) : () => (node || (node = create())).cloneNode(true);\r\n  fn.cloneNode = fn;\r\n  return fn;\r\n}\r\nfunction delegateEvents(eventNames, document = window.document) {\r\n  const e = document[$$EVENTS] || (document[$$EVENTS] = new Set());\r\n  for (let i = 0, l = eventNames.length; i < l; i++) {\r\n    const name = eventNames[i];\r\n    if (!e.has(name)) {\r\n      e.add(name);\r\n      document.addEventListener(name, eventHandler);\r\n    }\r\n  }\r\n}\r\nfunction clearDelegatedEvents(document = window.document) {\r\n  if (document[$$EVENTS]) {\r\n    for (let name of document[$$EVENTS].keys()) document.removeEventListener(name, eventHandler);\r\n    delete document[$$EVENTS];\r\n  }\r\n}\r\nfunction setAttribute(node, name, value) {\r\n  if (value == null) node.removeAttribute(name);else node.setAttribute(name, value);\r\n}\r\nfunction setAttributeNS(node, namespace, name, value) {\r\n  if (value == null) node.removeAttributeNS(namespace, name);else node.setAttributeNS(namespace, name, value);\r\n}\r\nfunction className(node, value) {\r\n  if (value == null) node.removeAttribute(\"class\");else node.className = value;\r\n}\r\nfunction addEventListener(node, name, handler, delegate) {\r\n  if (delegate) {\r\n    if (Array.isArray(handler)) {\r\n      node[`$$${name}`] = handler[0];\r\n      node[`$$${name}Data`] = handler[1];\r\n    } else node[`$$${name}`] = handler;\r\n  } else if (Array.isArray(handler)) {\r\n    const handlerFn = handler[0];\r\n    node.addEventListener(name, handler[0] = e => handlerFn.call(node, handler[1], e));\r\n  } else node.addEventListener(name, handler);\r\n}\r\nfunction classList(node, value, prev = {}) {\r\n  const classKeys = Object.keys(value || {}),\r\n    prevKeys = Object.keys(prev);\r\n  let i, len;\r\n  for (i = 0, len = prevKeys.length; i < len; i++) {\r\n    const key = prevKeys[i];\r\n    if (!key || key === \"undefined\" || value[key]) continue;\r\n    toggleClassKey(node, key, false);\r\n    delete prev[key];\r\n  }\r\n  for (i = 0, len = classKeys.length; i < len; i++) {\r\n    const key = classKeys[i],\r\n      classValue = !!value[key];\r\n    if (!key || key === \"undefined\" || prev[key] === classValue || !classValue) continue;\r\n    toggleClassKey(node, key, true);\r\n    prev[key] = classValue;\r\n  }\r\n  return prev;\r\n}\r\nfunction style(node, value, prev) {\r\n  if (!value) return prev ? setAttribute(node, \"style\") : value;\r\n  const nodeStyle = node.style;\r\n  if (typeof value === \"string\") return nodeStyle.cssText = value;\r\n  typeof prev === \"string\" && (nodeStyle.cssText = prev = undefined);\r\n  prev || (prev = {});\r\n  value || (value = {});\r\n  let v, s;\r\n  for (s in prev) {\r\n    value[s] == null && nodeStyle.removeProperty(s);\r\n    delete prev[s];\r\n  }\r\n  for (s in value) {\r\n    v = value[s];\r\n    if (v !== prev[s]) {\r\n      nodeStyle.setProperty(s, v);\r\n      prev[s] = v;\r\n    }\r\n  }\r\n  return prev;\r\n}\r\nfunction spread(node, props = {}, isSVG, skipChildren) {\r\n  const prevProps = {};\r\n  if (!skipChildren) {\r\n    createRenderEffect(() => prevProps.children = insertExpression(node, props.children, prevProps.children));\r\n  }\r\n  createRenderEffect(() => props.ref && props.ref(node));\r\n  createRenderEffect(() => assign(node, props, isSVG, true, prevProps, true));\r\n  return prevProps;\r\n}\r\nfunction dynamicProperty(props, key) {\r\n  const src = props[key];\r\n  Object.defineProperty(props, key, {\r\n    get() {\r\n      return src();\r\n    },\r\n    enumerable: true\r\n  });\r\n  return props;\r\n}\r\nfunction innerHTML(parent, content) {\r\n  !sharedConfig.context && (parent.innerHTML = content);\r\n}\r\nfunction use(fn, element, arg) {\r\n  return untrack(() => fn(element, arg));\r\n}\r\nfunction insert(parent, accessor, marker, initial) {\r\n  if (marker !== undefined && !initial) initial = [];\r\n  if (typeof accessor !== \"function\") return insertExpression(parent, accessor, initial, marker);\r\n  createRenderEffect(current => insertExpression(parent, accessor(), current, marker), initial);\r\n}\r\nfunction assign(node, props, isSVG, skipChildren, prevProps = {}, skipRef = false) {\r\n  props || (props = {});\r\n  for (const prop in prevProps) {\r\n    if (!(prop in props)) {\r\n      if (prop === \"children\") continue;\r\n      prevProps[prop] = assignProp(node, prop, null, prevProps[prop], isSVG, skipRef);\r\n    }\r\n  }\r\n  for (const prop in props) {\r\n    if (prop === \"children\") {\r\n      if (!skipChildren) insertExpression(node, props.children);\r\n      continue;\r\n    }\r\n    const value = props[prop];\r\n    prevProps[prop] = assignProp(node, prop, value, prevProps[prop], isSVG, skipRef);\r\n  }\r\n}\r\nfunction hydrate$1(code, element, options = {}) {\r\n  sharedConfig.completed = globalThis._$HY.completed;\r\n  sharedConfig.events = globalThis._$HY.events;\r\n  sharedConfig.load = globalThis._$HY.load;\r\n  sharedConfig.gather = root => gatherHydratable(element, root);\r\n  sharedConfig.registry = new Map();\r\n  sharedConfig.context = {\r\n    id: options.renderId || \"\",\r\n    count: 0\r\n  };\r\n  gatherHydratable(element, options.renderId);\r\n  const dispose = render(code, element, [...element.childNodes], options);\r\n  sharedConfig.context = null;\r\n  return dispose;\r\n}\r\nfunction getNextElement(template) {\r\n  let node, key;\r\n  if (!sharedConfig.context || !(node = sharedConfig.registry.get(key = getHydrationKey()))) {\r\n    return template();\r\n  }\r\n  if (sharedConfig.completed) sharedConfig.completed.add(node);\r\n  sharedConfig.registry.delete(key);\r\n  return node;\r\n}\r\nfunction getNextMatch(el, nodeName) {\r\n  while (el && el.localName !== nodeName) el = el.nextSibling;\r\n  return el;\r\n}\r\nfunction getNextMarker(start) {\r\n  let end = start,\r\n    count = 0,\r\n    current = [];\r\n  if (sharedConfig.context) {\r\n    while (end) {\r\n      if (end.nodeType === 8) {\r\n        const v = end.nodeValue;\r\n        if (v === \"#\") count++;else if (v === \"/\") {\r\n          if (count === 0) return [end, current];\r\n          count--;\r\n        }\r\n      }\r\n      current.push(end);\r\n      end = end.nextSibling;\r\n    }\r\n  }\r\n  return [end, current];\r\n}\r\nfunction runHydrationEvents() {\r\n  if (sharedConfig.events && !sharedConfig.events.queued) {\r\n    queueMicrotask(() => {\r\n      const {\r\n        completed,\r\n        events\r\n      } = sharedConfig;\r\n      events.queued = false;\r\n      while (events.length) {\r\n        const [el, e] = events[0];\r\n        if (!completed.has(el)) return;\r\n        eventHandler(e);\r\n        events.shift();\r\n      }\r\n    });\r\n    sharedConfig.events.queued = true;\r\n  }\r\n}\r\nfunction toPropertyName(name) {\r\n  return name.toLowerCase().replace(/-([a-z])/g, (_, w) => w.toUpperCase());\r\n}\r\nfunction toggleClassKey(node, key, value) {\r\n  const classNames = key.trim().split(/\\s+/);\r\n  for (let i = 0, nameLen = classNames.length; i < nameLen; i++) node.classList.toggle(classNames[i], value);\r\n}\r\nfunction assignProp(node, prop, value, prev, isSVG, skipRef) {\r\n  let isCE, isProp, isChildProp, propAlias, forceProp;\r\n  if (prop === \"style\") return style(node, value, prev);\r\n  if (prop === \"classList\") return classList(node, value, prev);\r\n  if (value === prev) return prev;\r\n  if (prop === \"ref\") {\r\n    if (!skipRef) value(node);\r\n  } else if (prop.slice(0, 3) === \"on:\") {\r\n    const e = prop.slice(3);\r\n    prev && node.removeEventListener(e, prev);\r\n    value && node.addEventListener(e, value);\r\n  } else if (prop.slice(0, 10) === \"oncapture:\") {\r\n    const e = prop.slice(10);\r\n    prev && node.removeEventListener(e, prev, true);\r\n    value && node.addEventListener(e, value, true);\r\n  } else if (prop.slice(0, 2) === \"on\") {\r\n    const name = prop.slice(2).toLowerCase();\r\n    const delegate = DelegatedEvents.has(name);\r\n    if (!delegate && prev) {\r\n      const h = Array.isArray(prev) ? prev[0] : prev;\r\n      node.removeEventListener(name, h);\r\n    }\r\n    if (delegate || value) {\r\n      addEventListener(node, name, value, delegate);\r\n      delegate && delegateEvents([name]);\r\n    }\r\n  } else if (prop.slice(0, 5) === \"attr:\") {\r\n    setAttribute(node, prop.slice(5), value);\r\n  } else if ((forceProp = prop.slice(0, 5) === \"prop:\") || (isChildProp = ChildProperties.has(prop)) || !isSVG && ((propAlias = getPropAlias(prop, node.tagName)) || (isProp = Properties.has(prop))) || (isCE = node.nodeName.includes(\"-\"))) {\r\n    if (forceProp) {\r\n      prop = prop.slice(5);\r\n      isProp = true;\r\n    }\r\n    if (prop === \"class\" || prop === \"className\") className(node, value);else if (isCE && !isProp && !isChildProp) node[toPropertyName(prop)] = value;else node[propAlias || prop] = value;\r\n  } else {\r\n    const ns = isSVG && prop.indexOf(\":\") > -1 && SVGNamespace[prop.split(\":\")[0]];\r\n    if (ns) setAttributeNS(node, ns, prop, value);else setAttribute(node, Aliases[prop] || prop, value);\r\n  }\r\n  return value;\r\n}\r\nfunction eventHandler(e) {\r\n  const key = `$$${e.type}`;\r\n  let node = e.composedPath && e.composedPath()[0] || e.target;\r\n  if (e.target !== node) {\r\n    Object.defineProperty(e, \"target\", {\r\n      configurable: true,\r\n      value: node\r\n    });\r\n  }\r\n  Object.defineProperty(e, \"currentTarget\", {\r\n    configurable: true,\r\n    get() {\r\n      return node || document;\r\n    }\r\n  });\r\n  if (sharedConfig.registry && !sharedConfig.done) sharedConfig.done = _$HY.done = true;\r\n  while (node) {\r\n    const handler = node[key];\r\n    if (handler && !node.disabled) {\r\n      const data = node[`${key}Data`];\r\n      data !== undefined ? handler.call(node, data, e) : handler.call(node, e);\r\n      if (e.cancelBubble) return;\r\n    }\r\n    node = node._$host || node.parentNode || node.host;\r\n  }\r\n}\r\nfunction insertExpression(parent, value, current, marker, unwrapArray) {\r\n  if (sharedConfig.context) {\r\n    !current && (current = [...parent.childNodes]);\r\n    let cleaned = [];\r\n    for (let i = 0; i < current.length; i++) {\r\n      const node = current[i];\r\n      if (node.nodeType === 8 && node.data.slice(0, 2) === \"!$\") node.remove();else cleaned.push(node);\r\n    }\r\n    current = cleaned;\r\n  }\r\n  while (typeof current === \"function\") current = current();\r\n  if (value === current) return current;\r\n  const t = typeof value,\r\n    multi = marker !== undefined;\r\n  parent = multi && current[0] && current[0].parentNode || parent;\r\n  if (t === \"string\" || t === \"number\") {\r\n    if (sharedConfig.context) return current;\r\n    if (t === \"number\") value = value.toString();\r\n    if (multi) {\r\n      let node = current[0];\r\n      if (node && node.nodeType === 3) {\r\n        node.data = value;\r\n      } else node = document.createTextNode(value);\r\n      current = cleanChildren(parent, current, marker, node);\r\n    } else {\r\n      if (current !== \"\" && typeof current === \"string\") {\r\n        current = parent.firstChild.data = value;\r\n      } else current = parent.textContent = value;\r\n    }\r\n  } else if (value == null || t === \"boolean\") {\r\n    if (sharedConfig.context) return current;\r\n    current = cleanChildren(parent, current, marker);\r\n  } else if (t === \"function\") {\r\n    createRenderEffect(() => {\r\n      let v = value();\r\n      while (typeof v === \"function\") v = v();\r\n      current = insertExpression(parent, v, current, marker);\r\n    });\r\n    return () => current;\r\n  } else if (Array.isArray(value)) {\r\n    const array = [];\r\n    const currentArray = current && Array.isArray(current);\r\n    if (normalizeIncomingArray(array, value, current, unwrapArray)) {\r\n      createRenderEffect(() => current = insertExpression(parent, array, current, marker, true));\r\n      return () => current;\r\n    }\r\n    if (sharedConfig.context) {\r\n      if (!array.length) return current;\r\n      for (let i = 0; i < array.length; i++) {\r\n        if (array[i].parentNode) return current = array;\r\n      }\r\n    }\r\n    if (array.length === 0) {\r\n      current = cleanChildren(parent, current, marker);\r\n      if (multi) return current;\r\n    } else if (currentArray) {\r\n      if (current.length === 0) {\r\n        appendNodes(parent, array, marker);\r\n      } else reconcileArrays(parent, current, array);\r\n    } else {\r\n      current && cleanChildren(parent);\r\n      appendNodes(parent, array);\r\n    }\r\n    current = array;\r\n  } else if (value.nodeType) {\r\n    if (sharedConfig.context && value.parentNode) return current = multi ? [value] : value;\r\n    if (Array.isArray(current)) {\r\n      if (multi) return current = cleanChildren(parent, current, marker, value);\r\n      cleanChildren(parent, current, null, value);\r\n    } else if (current == null || current === \"\" || !parent.firstChild) {\r\n      parent.appendChild(value);\r\n    } else parent.replaceChild(value, parent.firstChild);\r\n    current = value;\r\n  } else ;\r\n  return current;\r\n}\r\nfunction normalizeIncomingArray(normalized, array, current, unwrap) {\r\n  let dynamic = false;\r\n  for (let i = 0, len = array.length; i < len; i++) {\r\n    let item = array[i],\r\n      prev = current && current[i],\r\n      t;\r\n    if (item == null || item === true || item === false) ; else if ((t = typeof item) === \"object\" && item.nodeType) {\r\n      normalized.push(item);\r\n    } else if (Array.isArray(item)) {\r\n      dynamic = normalizeIncomingArray(normalized, item, prev) || dynamic;\r\n    } else if (t === \"function\") {\r\n      if (unwrap) {\r\n        while (typeof item === \"function\") item = item();\r\n        dynamic = normalizeIncomingArray(normalized, Array.isArray(item) ? item : [item], Array.isArray(prev) ? prev : [prev]) || dynamic;\r\n      } else {\r\n        normalized.push(item);\r\n        dynamic = true;\r\n      }\r\n    } else {\r\n      const value = String(item);\r\n      if (prev && prev.nodeType === 3 && prev.data === value) normalized.push(prev);else normalized.push(document.createTextNode(value));\r\n    }\r\n  }\r\n  return dynamic;\r\n}\r\nfunction appendNodes(parent, array, marker = null) {\r\n  for (let i = 0, len = array.length; i < len; i++) parent.insertBefore(array[i], marker);\r\n}\r\nfunction cleanChildren(parent, current, marker, replacement) {\r\n  if (marker === undefined) return parent.textContent = \"\";\r\n  const node = replacement || document.createTextNode(\"\");\r\n  if (current.length) {\r\n    let inserted = false;\r\n    for (let i = current.length - 1; i >= 0; i--) {\r\n      const el = current[i];\r\n      if (node !== el) {\r\n        const isParent = el.parentNode === parent;\r\n        if (!inserted && !i) isParent ? parent.replaceChild(node, el) : parent.insertBefore(node, marker);else isParent && el.remove();\r\n      } else inserted = true;\r\n    }\r\n  } else parent.insertBefore(node, marker);\r\n  return [node];\r\n}\r\nfunction gatherHydratable(element, root) {\r\n  const templates = element.querySelectorAll(`*[data-hk]`);\r\n  for (let i = 0; i < templates.length; i++) {\r\n    const node = templates[i];\r\n    const key = node.getAttribute(\"data-hk\");\r\n    if ((!root || key.startsWith(root)) && !sharedConfig.registry.has(key)) sharedConfig.registry.set(key, node);\r\n  }\r\n}\r\nfunction getHydrationKey() {\r\n  const hydrate = sharedConfig.context;\r\n  return `${hydrate.id}${hydrate.count++}`;\r\n}\r\nfunction NoHydration(props) {\r\n  return sharedConfig.context ? undefined : props.children;\r\n}\r\nfunction Hydration(props) {\r\n  return props.children;\r\n}\r\nfunction voidFn() {}\r\n\r\nfunction throwInBrowser(func) {\r\n  const err = new Error(`${func.name} is not supported in the browser, returning undefined`);\r\n  console.error(err);\r\n}\r\nfunction renderToString(fn, options) {\r\n  throwInBrowser(renderToString);\r\n}\r\nfunction renderToStringAsync(fn, options) {\r\n  throwInBrowser(renderToStringAsync);\r\n}\r\nfunction renderToStream(fn, options) {\r\n  throwInBrowser(renderToStream);\r\n}\r\nfunction ssr(template, ...nodes) {}\r\nfunction ssrElement(name, props, children, needsId) {}\r\nfunction ssrClassList(value) {}\r\nfunction ssrStyle(value) {}\r\nfunction ssrAttribute(key, value) {}\r\nfunction ssrHydrationKey() {}\r\nfunction resolveSSRNode(node) {}\r\nfunction escape(html) {}\r\nfunction ssrSpread(props, isSVG, skipChildren) {}\r\n\r\nconst isServer = false;\r\nconst isDev = false;\r\nconst SVG_NAMESPACE = \"http://www.w3.org/2000/svg\";\r\nfunction createElement(tagName, isSVG = false) {\r\n  return isSVG ? document.createElementNS(SVG_NAMESPACE, tagName) : document.createElement(tagName);\r\n}\r\nconst hydrate = (...args) => {\r\n  enableHydration();\r\n  return hydrate$1(...args);\r\n};\r\nfunction Portal(props) {\r\n  const {\r\n      useShadow\r\n    } = props,\r\n    marker = document.createTextNode(\"\"),\r\n    mount = () => props.mount || document.body,\r\n    owner = getOwner();\r\n  let content;\r\n  let hydrating = !!sharedConfig.context;\r\n  createEffect(() => {\r\n    if (hydrating) getOwner().user = hydrating = false;\r\n    content || (content = runWithOwner(owner, () => createMemo(() => props.children)));\r\n    const el = mount();\r\n    if (el instanceof HTMLHeadElement) {\r\n      const [clean, setClean] = createSignal(false);\r\n      const cleanup = () => setClean(true);\r\n      createRoot(dispose => insert(el, () => !clean() ? content() : dispose(), null));\r\n      onCleanup(cleanup);\r\n    } else {\r\n      const container = createElement(props.isSVG ? \"g\" : \"div\", props.isSVG),\r\n        renderRoot = useShadow && container.attachShadow ? container.attachShadow({\r\n          mode: \"open\"\r\n        }) : container;\r\n      Object.defineProperty(container, \"_$host\", {\r\n        get() {\r\n          return marker.parentNode;\r\n        },\r\n        configurable: true\r\n      });\r\n      insert(renderRoot, content);\r\n      el.appendChild(container);\r\n      props.ref && props.ref(container);\r\n      onCleanup(() => el.removeChild(container));\r\n    }\r\n  }, undefined, {\r\n    render: !hydrating\r\n  });\r\n  return marker;\r\n}\r\nfunction Dynamic(props) {\r\n  const [p, others] = splitProps(props, [\"component\"]);\r\n  const cached = createMemo(() => p.component);\r\n  return createMemo(() => {\r\n    const component = cached();\r\n    switch (typeof component) {\r\n      case \"function\":\r\n        return untrack(() => component(others));\r\n      case \"string\":\r\n        const isSvg = SVGElements.has(component);\r\n        const el = sharedConfig.context ? getNextElement() : createElement(component, isSvg);\r\n        spread(el, others, isSvg);\r\n        return el;\r\n    }\r\n  });\r\n}\r\n\r\nexport { Aliases, voidFn as Assets, ChildProperties, DOMElements, DelegatedEvents, Dynamic, Hydration, voidFn as HydrationScript, NoHydration, Portal, Properties, SVGElements, SVGNamespace, addEventListener, assign, classList, className, clearDelegatedEvents, delegateEvents, dynamicProperty, escape, voidFn as generateHydrationScript, voidFn as getAssets, getHydrationKey, getNextElement, getNextMarker, getNextMatch, getPropAlias, hydrate, innerHTML, insert, isDev, isServer, render, renderToStream, renderToString, renderToStringAsync, resolveSSRNode, runHydrationEvents, setAttribute, setAttributeNS, spread, ssr, ssrAttribute, ssrClassList, ssrElement, ssrHydrationKey, ssrSpread, ssrStyle, style, template, use, voidFn as useAssets };\r\n","import encodeEntities from '../string/encodeEntities';\r\n\r\nexport default function documentFragmentToHTML(fragment: DocumentFragment) {\r\n  return Array.from(fragment.childNodes).map((node) => {\r\n    return node.nodeType === node.TEXT_NODE ? encodeEntities(node.textContent) : (node as Element).outerHTML;\r\n  }).join('');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAttribute(el: any, attribute: string): HTMLElement {\r\n  return el.closest(`[${attribute}]`);\r\n  /* if(el.getAttribute(attribute) !== null) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.getAttribute(attribute) !== null)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpTag(el: any, tag: string): HTMLElement {\r\n  return el.closest(tag);\r\n  /* if(el.tagName === tag) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.tagName === tag)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAsChild<T extends {parentElement: HTMLElement}>(el: T, parent: HTMLElement): T {\r\n  if(!el) return null;\r\n  if(el.parentElement === parent) return el;\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement as any;\r\n    if(el.parentElement === parent) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpAsChild from './findUpAsChild';\r\n\r\nexport default function getCaretPosNew(input: HTMLElement, anchor?: boolean): ReturnType<typeof getCaretPosF> & {selection: Selection} {\r\n  const selection = document.getSelection();\r\n  // let {focusNode: node, focusOffset: offset} = selection;\r\n  const node = selection[anchor ? 'anchorNode' : 'focusNode'];\r\n  const offset = selection[anchor ? 'anchorOffset' : 'focusOffset'];\r\n  if(!findUpAsChild(node, input) && node !== input) {\r\n    return {selection} as any;\r\n  }\r\n\r\n  return {...getCaretPosF(input, node, offset), selection};\r\n}\r\n\r\nexport function getCaretPosF(input: HTMLElement, node: Node, offset: number) {\r\n  if(node === input) {\r\n    const childNodes = input.childNodes;\r\n    const childNodesLength = childNodes.length;\r\n    if(childNodesLength && offset >= childNodesLength) {\r\n      node = childNodes[childNodesLength - 1];\r\n      offset = (node.textContent || (node as HTMLImageElement).alt || '').length;\r\n    } else {\r\n      node = childNodes[offset];\r\n      offset = 0;\r\n    }\r\n  }\r\n\r\n  return {node: node as ChildNode, offset};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\n\r\nconst CAN_COMBINE_ENTITIES: Set<MessageEntity['_']> = new Set([\r\n  'messageEntityBold',\r\n  'messageEntityItalic',\r\n  'messageEntityCode',\r\n  'messageEntityPre',\r\n  'messageEntityUnderline',\r\n  'messageEntityStrike',\r\n  'messageEntityBlockquote',\r\n  'messageEntitySpoiler'\r\n]);\r\nexport default function combineSameEntities(entities: MessageEntity[]) {\r\n  // entities = entities.slice();\r\n  for(let i = 0; i < entities.length; ++i) {\r\n    const entity = entities[i];\r\n\r\n    let nextEntityIdx = -1;\r\n    do {\r\n      nextEntityIdx = entities.findIndex((e, _i) => {\r\n        return CAN_COMBINE_ENTITIES.has(e._) && _i !== i && e._ === entity._ && (e.offset - entity.length) === entity.offset;\r\n      });\r\n\r\n      if(nextEntityIdx !== -1) {\r\n        const nextEntity = entities[nextEntityIdx];\r\n        entity.length += nextEntity.length;\r\n        entities.splice(nextEntityIdx, 1);\r\n      }\r\n    } while(nextEntityIdx !== -1);\r\n  }\r\n  // return entities;\r\n}\r\n","import {MessageEntity} from '../../layer';\r\n\r\nexport default function sortEntities(entities: MessageEntity[]) {\r\n  entities.sort((a, b) => {\r\n    return (a.offset - b.offset) || (b.length - a.length);\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport BOM from '../string/bom';\r\n\r\nexport type MarkdownType = 'bold' | 'italic' | 'underline' | 'strikethrough' |\r\n  'monospace' | 'link' | 'mentionName' | 'spoiler' | 'quote'/*  | 'customEmoji' */;\r\nexport type MarkdownTag = {\r\n  match: string,\r\n  entityName: Extract<\r\n    MessageEntity['_'], 'messageEntityBold' | 'messageEntityUnderline' |\r\n    'messageEntityItalic' | 'messageEntityCode' | 'messageEntityStrike' |\r\n    'messageEntityTextUrl' | 'messageEntityMentionName' | 'messageEntitySpoiler' |\r\n    'messageEntityBlockquote'/*  | 'messageEntityCustomEmoji' */\r\n  >;\r\n};\r\n\r\n// https://core.telegram.org/bots/api#html-style\r\nexport const markdownTags: {[type in MarkdownType]: MarkdownTag} = {\r\n  bold: {\r\n    match: '[style*=\"bold\"], [style*=\"font-weight: 700\"], [style*=\"font-weight: 600\"], [style*=\"font-weight:700\"], [style*=\"font-weight:600\"], b, strong',\r\n    entityName: 'messageEntityBold'\r\n  },\r\n  underline: {\r\n    match: '[style*=\"underline\"], u, ins',\r\n    entityName: 'messageEntityUnderline'\r\n  },\r\n  italic: {\r\n    match: '[style*=\"italic\"], i, em',\r\n    entityName: 'messageEntityItalic'\r\n  },\r\n  monospace: {\r\n    match: '[style*=\"monospace\"], [face*=\"monospace\"], pre',\r\n    entityName: 'messageEntityCode'\r\n  },\r\n  strikethrough: {\r\n    match: '[style*=\"line-through\"], [style*=\"strikethrough\"], strike, del, s',\r\n    entityName: 'messageEntityStrike'\r\n  },\r\n  link: {\r\n    match: 'A:not(.follow)',\r\n    entityName: 'messageEntityTextUrl'\r\n  },\r\n  mentionName: {\r\n    match: 'A.follow',\r\n    entityName: 'messageEntityMentionName'\r\n  },\r\n  spoiler: {\r\n    match: '[style*=\"spoiler\"]',\r\n    entityName: 'messageEntitySpoiler'\r\n  },\r\n  quote: {\r\n    match: '[style*=\"quote\"], .quote',\r\n    entityName: 'messageEntityBlockquote'\r\n  }\r\n  // customEmoji: {\r\n  //   match: '.custom-emoji',\r\n  //   entityName: 'messageEntityCustomEmoji'\r\n  // }\r\n};\r\n\r\nconst tabulationMatch = '[style*=\"table-cell\"], th, td';\r\n\r\n/* export function getDepth(child: Node, container?: Node) {\r\n  let depth = 0;\r\n\r\n  do {\r\n    if(child === container) {\r\n      return depth;\r\n    }\r\n\r\n    ++depth;\r\n  } while((child = child.parentNode) !== null);\r\n\r\n  return depth;\r\n} */\r\n\r\nconst BLOCK_TAGS = new Set([\r\n  'DIV',\r\n  'P',\r\n  'BR',\r\n  'LI',\r\n  'SECTION',\r\n  'H6',\r\n  'H5',\r\n  'H4',\r\n  'H3',\r\n  'H2',\r\n  'H1',\r\n  'TR',\r\n  'OL',\r\n  'UL',\r\n  'BLOCKQUOTE'\r\n]);\r\n\r\n// const INSERT_NEW_LINE_TAGS = new Set([\r\n//   'OL',\r\n//   'UL'\r\n// ]);\r\n\r\nconst BOM_REG_EXP = new RegExp(BOM, 'g');\r\nexport const SELECTION_SEPARATOR = '\\x01';\r\n\r\nfunction checkNodeForEntity(node: Node, value: string, entities: MessageEntity[], offset: {offset: number}) {\r\n  const parentElement = node.parentElement;\r\n\r\n  // let closestTag: MarkdownTag, closestElementByTag: Element, closestDepth = Infinity;\r\n  for(const type in markdownTags) {\r\n    const tag = markdownTags[type as MarkdownType];\r\n    const closest: HTMLElement = parentElement.closest(tag.match + ', [contenteditable=\"true\"]');\r\n    if(closest?.getAttribute('contenteditable') !== null) {\r\n      /* const depth = getDepth(closest, parentElement.closest('[contenteditable]'));\r\n      if(closestDepth > depth) {\r\n        closestDepth = depth;\r\n        closestTag = tag;\r\n        closestElementByTag = closest;\r\n      } */\r\n      continue;\r\n    }\r\n\r\n    let codeElement: HTMLElement;\r\n    if(tag.entityName === 'messageEntityCode' && (codeElement = parentElement.closest('[data-language]'))) {\r\n      entities.push({\r\n        _: 'messageEntityPre',\r\n        language: codeElement.dataset.language || '',\r\n        offset: offset.offset,\r\n        length: value.length\r\n      });\r\n    } else if(tag.entityName === 'messageEntityTextUrl') {\r\n      entities.push({\r\n        _: tag.entityName,\r\n        url: (closest as HTMLAnchorElement).href,\r\n        offset: offset.offset,\r\n        length: value.length\r\n      });\r\n    } else if(tag.entityName === 'messageEntityMentionName') {\r\n      entities.push({\r\n        _: tag.entityName,\r\n        offset: offset.offset,\r\n        length: value.length,\r\n        user_id: (closest as HTMLElement).dataset.follow.toUserId()\r\n      });\r\n    } else if(tag.entityName === 'messageEntityBlockquote') {\r\n      entities.push({\r\n        _: tag.entityName,\r\n        pFlags: {\r\n          collapsed: /* closest.classList.contains('can-send-collapsd') &&  */!!closest.dataset.collapsed || undefined\r\n        },\r\n        offset: offset.offset,\r\n        length: value.length\r\n      });\r\n    } /*  else if(tag.entityName === 'messageEntityCustomEmoji') {\r\n      entities.push({\r\n        _: tag.entityName,\r\n        document_id: (closest as HTMLElement).dataset.docId,\r\n        offset: offset.offset,\r\n        length: emoji.length\r\n      });\r\n    } */ else {\r\n      entities.push({\r\n        _: tag.entityName,\r\n        offset: offset.offset,\r\n        length: value.length\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction isLineEmpty(line: string[]) {\r\n  const {length} = line;\r\n  if(!length) {\r\n    return true;\r\n  }\r\n\r\n  if(line[length - 1] === SELECTION_SEPARATOR && length === SELECTION_SEPARATOR.length) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport default function getRichElementValue(\r\n  node: HTMLElement,\r\n  lines: string[],\r\n  line: string[],\r\n  selNode?: Node,\r\n  selOffset?: number,\r\n  entities?: MessageEntity[],\r\n  offset: {offset: number, isInQuote?: boolean} = {offset: 0}\r\n) {\r\n  if(node.nodeType === node.TEXT_NODE) { // TEXT\r\n    let nodeValue = node.nodeValue;\r\n    // if(nodeValue[0] === BOM) {\r\n    nodeValue = nodeValue.replace(BOM_REG_EXP, '');\r\n    // }\r\n\r\n    /* const tabulation = node.parentElement?.closest(tabulationMatch + ', [contenteditable]');\r\n    if(tabulation?.getAttribute('contenteditable') === null) {\r\n      nodeValue += ' ';\r\n      // line.push('\\t');\r\n      // ++offset.offset;\r\n    } */\r\n\r\n    if(nodeValue) {\r\n      // if(offset.isInQuote && nodeValue.endsWith('\\n')) { // slice last linebreak from quote\r\n      //   nodeValue = nodeValue.slice(0, -1);\r\n      // }\r\n\r\n      if(selNode === node) {\r\n        line.push(nodeValue.substr(0, selOffset) + SELECTION_SEPARATOR + nodeValue.substr(selOffset));\r\n      } else {\r\n        line.push(nodeValue);\r\n      }\r\n    } else if(selNode === node) {\r\n      line.push(SELECTION_SEPARATOR);\r\n    }\r\n\r\n    if(entities && nodeValue.length && node.parentNode) {\r\n      checkNodeForEntity(node, nodeValue, entities, offset);\r\n    }\r\n\r\n    offset.offset += nodeValue.length;\r\n    return;\r\n  }\r\n\r\n  if(node.nodeType !== node.ELEMENT_NODE) { // NON-ELEMENT\r\n    return;\r\n  }\r\n\r\n  const pushLine = () => {\r\n    lines.push(line.join(''));\r\n    line.length = 0;\r\n    ++offset.offset;\r\n  };\r\n\r\n  const isSelected = selNode === node;\r\n  const isQuote = node.matches(markdownTags.quote.match);\r\n  const isBlock = BLOCK_TAGS.has(node.tagName) || isQuote;\r\n  if(isBlock && ((line.length && line[line.length - 1].slice(-1) !== '\\n') || node.tagName === 'BR'/*  || (BLOCK_TAGS.has(node.tagName) && lines.length) */)) {\r\n    pushLine();\r\n  } else {\r\n    const alt = node.dataset.stickerEmoji || (node as HTMLImageElement).alt;\r\n    const stickerEmoji = node.dataset.stickerEmoji;\r\n\r\n    if(alt && entities) {\r\n      checkNodeForEntity(node, alt, entities, offset);\r\n    }\r\n\r\n    if(stickerEmoji && entities) {\r\n      entities.push({\r\n        _: 'messageEntityCustomEmoji',\r\n        document_id: node.dataset.docId,\r\n        offset: offset.offset,\r\n        length: alt.length\r\n      });\r\n    }\r\n\r\n    if(alt) {\r\n      line.push(alt);\r\n      offset.offset += alt.length;\r\n    }\r\n  }\r\n\r\n  if(isSelected && !selOffset) {\r\n    line.push(SELECTION_SEPARATOR);\r\n  }\r\n\r\n  const isTableCell = node.matches(tabulationMatch);\r\n  const wasEntitiesLength = entities?.length;\r\n  // const wasLinesLength = lines.length;\r\n  let wasNodeEmpty = true;\r\n\r\n  if(isQuote) {\r\n    offset.isInQuote = true;\r\n  }\r\n\r\n  let curChild = node.firstChild as HTMLElement;\r\n  while(curChild) {\r\n    getRichElementValue(curChild, lines, line, selNode, selOffset, entities, offset);\r\n    curChild = curChild.nextSibling as any;\r\n\r\n    if(!isLineEmpty(line)) {\r\n      wasNodeEmpty = false;\r\n    }\r\n  }\r\n\r\n  if(isQuote) {\r\n    const lastValue = line[line.length - 1];\r\n    if(lastValue?.endsWith('\\n')) { // slice last linebreak from quote\r\n      line[line.length - 1] = lastValue.slice(0, -1);\r\n      offset.offset -= 1;\r\n    }\r\n\r\n    offset.isInQuote = false;\r\n  }\r\n\r\n  // can test on text with list (https://www.who.int/initiatives/sports-and-health)\r\n  if(wasNodeEmpty && node.textContent?.replace(/[\\r\\n]/g, '')) {\r\n    wasNodeEmpty = false;\r\n  }\r\n\r\n  if(isSelected && selOffset) {\r\n    line.push(SELECTION_SEPARATOR);\r\n  }\r\n\r\n  if(isTableCell && node.nextSibling && !isLineEmpty(line)) {\r\n    line.push(' ');\r\n    ++offset.offset;\r\n\r\n    // * combine entities such as url after adding space\r\n    if(wasEntitiesLength !== undefined) {\r\n      for(let i = wasEntitiesLength, length = entities.length; i < length; ++i) {\r\n        ++entities[i].length;\r\n      }\r\n    }\r\n  }\r\n\r\n  if(isBlock && !wasNodeEmpty) {\r\n    pushLine();\r\n  }\r\n\r\n  if(!wasNodeEmpty && node.tagName === 'P' && node.nextSibling) {\r\n    lines.push('');\r\n    ++offset.offset;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\r\nimport getRichElementValue, {SELECTION_SEPARATOR} from './getRichElementValue';\r\n\r\nexport function getCaretPos(field: Node) {\r\n  const sel = window.getSelection();\r\n  let selNode: Node;\r\n  let selOffset: number;\r\n  if(sel?.rangeCount) {\r\n    const range = sel.getRangeAt(0);\r\n    const startOffset = range.startOffset;\r\n    if(\r\n      range.startContainer &&\r\n      range.startContainer == range.endContainer &&\r\n      startOffset == range.endOffset\r\n    ) {\r\n      // * if focused on img, or caret has been set via placeCaretAtEnd\r\n      const possibleChildrenFocusOffset = startOffset - 1;\r\n      const childNodes = field.childNodes;\r\n      if(range.startContainer === field && childNodes[possibleChildrenFocusOffset]) {\r\n        selNode = childNodes[possibleChildrenFocusOffset];\r\n        selOffset = 0;\r\n\r\n        for(let i = 0; i < range.endOffset; ++i) {\r\n          const node = childNodes[i];\r\n          const value = node.nodeValue || (node as HTMLImageElement).alt;\r\n\r\n          if(value) {\r\n            selOffset += value.length;\r\n          }\r\n        }\r\n      } else {\r\n        selNode = range.startContainer;\r\n        selOffset = startOffset;\r\n      }\r\n    }\r\n  }\r\n\r\n  return {node: selNode, offset: selOffset};\r\n}\r\n\r\nexport default function getRichValueWithCaret(\r\n  field: Node | HTMLElement | DocumentFragment,\r\n  withEntities = true,\r\n  withCaret = true\r\n) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const {node: selNode, offset: selOffset} = !(field instanceof DocumentFragment) && withCaret && getCaretPos(field);\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  const offset = {offset: 0};\r\n  if(field instanceof DocumentFragment) {\r\n    let curChild = field.firstChild as HTMLElement;\r\n    while(curChild) {\r\n      getRichElementValue(curChild, lines, line, selNode, selOffset, entities, offset);\r\n      curChild = curChild.nextSibling as any;\r\n    }\r\n  } else {\r\n    getRichElementValue(field as HTMLElement, lines, line, selNode, selOffset, entities, offset);\r\n  }\r\n\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  const caretPos = value.indexOf(SELECTION_SEPARATOR);\r\n  if(caretPos !== -1) {\r\n    value = value.substr(0, caretPos) + value.substr(caretPos + 1);\r\n  }\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities?.length) {\r\n    // ! cannot do that here because have the same check before the sending in RichTextProcessor.parseMarkdown\r\n    /* const entity = entities[entities.length - 1];\r\n    const length = value.length;\r\n    const trimmedLength = value.trimRight().length;\r\n    if(length !== trimmedLength) {\r\n      entity.length -= length - trimmedLength;\r\n    } */\r\n\r\n    combineSameEntities(entities);\r\n    sortEntities(entities);\r\n  }\r\n\r\n  return {value, entities, caretPos};\r\n}\r\n\r\nMOUNT_CLASS_TO.getCaretPos = getCaretPos;\r\nMOUNT_CLASS_TO.getRichValueWithCaret = getRichValueWithCaret;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function isInputEmpty(element: HTMLElement, allowStartingSpace?: boolean) {\r\n  let value: string;\r\n  if(element.isContentEditable || element.tagName !== 'INPUT') {\r\n    if(element.querySelector('.emoji, .custom-emoji, .custom-emoji-placeholder')) {\r\n      return false;\r\n    }\r\n    /* const value = element.innerText;\r\n\r\n    return !value.trim() && !serializeNodes(Array.from(element.childNodes)).trim(); */\r\n    // return !getRichValueWithCaret(element, false, false).value.trim();\r\n    value = element.textContent;\r\n  } else {\r\n    value = (element as HTMLInputElement).value;\r\n  }\r\n\r\n  if(!allowStartingSpace) {\r\n    return !value.trim();\r\n  }\r\n\r\n  return !value;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type EventListenerBase from './eventListenerBase';\r\n\r\nexport type Listener = {\r\n  element: ListenerElement,\r\n  event: ListenerEvent,\r\n  callback: ListenerCallback,\r\n  options?: ListenerOptions,\r\n\r\n  onceFired?: true, // will be set only when options.once is set\r\n  onceCallback?: () => void,\r\n};\r\n\r\nexport type ListenerElement = Window | Document | HTMLElement | Element | EventListenerBase<any> | EventTarget;\r\nexport type ListenerEvent = string;\r\nexport type ListenerCallback = Function;\r\nexport type ListenerOptions = AddEventListenerOptions;\r\n\r\n/* const originalAddEventListener = HTMLElement.prototype.addEventListener;\r\nHTMLElement.prototype.addEventListener = function(this, name: string, callback: EventListenerOrEventListenerObject, options: AddEventListenerOptions) {\r\n  console.log('nu zdarova', name);\r\n  originalAddEventListener.call(this, name, callback, options);\r\n\r\n  if(options?.ls) {\r\n    return options.ls.addFromElement(this, name, callback as any, options);\r\n  }\r\n}; */\r\n\r\nexport default class ListenerSetter {\r\n  private listeners: Set<Listener> = new Set();\r\n\r\n  public add<T extends ListenerElement>(element: T): T['addEventListener'] {\r\n    return ((event: string, callback: Function, options: ListenerOptions) => {\r\n      const listener: Listener = {element, event, callback, options};\r\n      this.addManual(listener);\r\n      return listener;\r\n    }) as any;\r\n  }\r\n\r\n  /* public addFromElement<T extends ListenerElement>(element: T, event: ListenerEvent, callback: ListenerCallback, options: ListenerOptions) {\r\n    const listener: Listener = {element, event, callback, options};\r\n    this.addManual(listener);\r\n    return listener;\r\n  } */\r\n\r\n  public addManual(listener: Listener) {\r\n    // @ts-ignore\r\n    listener.element.addEventListener(listener.event, listener.callback, listener.options);\r\n\r\n    if(listener.options?.once) { // remove listener when its called\r\n      listener.onceCallback = () => {\r\n        this.remove(listener);\r\n        listener.onceFired = true;\r\n      };\r\n\r\n      // @ts-ignore\r\n      listener.element.addEventListener(listener.event, listener.onceCallback, listener.options);\r\n    }\r\n\r\n    this.listeners.add(listener);\r\n  }\r\n\r\n  public remove(listener: Listener) {\r\n    if(!listener.onceFired) {\r\n      // @ts-ignore\r\n      listener.element.removeEventListener(listener.event, listener.callback, listener.options);\r\n\r\n      if(listener.onceCallback) {\r\n        // @ts-ignore\r\n        listener.element.removeEventListener(listener.event, listener.onceCallback, listener.options);\r\n      }\r\n    }\r\n\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  public removeManual<T extends ListenerElement>(\r\n    element: T,\r\n    event: ListenerEvent,\r\n    callback: ListenerCallback,\r\n    options?: ListenerOptions\r\n  ) {\r\n    let listener: Listener;\r\n    for(const _listener of this.listeners) {\r\n      if(_listener.element === element &&\r\n        _listener.event === event &&\r\n        _listener.callback === callback &&\r\n        _listener.options === options) {\r\n        listener = _listener;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(listener) {\r\n      this.remove(listener);\r\n    }\r\n  }\r\n\r\n  public removeAll() {\r\n    this.listeners.forEach((listener) => {\r\n      this.remove(listener);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function whichChild(elem: Node, countNonElements?: boolean) {\r\n  if(!elem?.parentNode) {\r\n    return -1;\r\n  }\r\n\r\n  if(countNonElements) {\r\n    return Array.from(elem.parentNode.childNodes).indexOf(elem as ChildNode);\r\n  }\r\n\r\n  let i = 0;\r\n  // @ts-ignore\r\n  while((elem = elem.previousElementSibling) !== null) ++i;\r\n  return i;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport clamp from '../number/clamp';\r\nimport findUpAsChild from './findUpAsChild';\r\nimport whichChild from './whichChild';\r\n\r\nexport default function compareNodes(node1: ChildNode, node1Offset: number, node2: ChildNode, node2Offset: number) {\r\n  let diff: number;\r\n  if(node1 === node2) {\r\n    diff = node1Offset - node2Offset;\r\n  } else if(node1.parentElement === node2.parentElement) {\r\n    diff = whichChild(node1, true) - whichChild(node2, true);\r\n  } else {\r\n    const parents: HTMLElement[] = [];\r\n    let parentElement = node1.parentElement;\r\n    do {\r\n      parents.push(parentElement);\r\n    } while(parentElement = parentElement.parentElement);\r\n\r\n    parentElement = node2.parentElement;\r\n    do {\r\n      if(parents.includes(parentElement)) {\r\n        break;\r\n      }\r\n    } while(parentElement = parentElement.parentElement);\r\n\r\n    const commonAncestorContainer = parentElement;\r\n    // const range = document.createRange();\r\n    // range.setStart(node1, 0);\r\n    // range.setEnd(node2, node2.textContent.length);\r\n    // const {commonAncestorContainer} = range;\r\n    node1 = findUpAsChild(node1 as HTMLElement, commonAncestorContainer as HTMLElement);\r\n    node2 = findUpAsChild(node2 as HTMLElement, commonAncestorContainer as HTMLElement);\r\n    diff = whichChild(node1, true) - whichChild(node2, true);\r\n  }\r\n\r\n  return clamp(diff, -1, 1);\r\n}\r\n\r\n(window as any).compareNodes = compareNodes;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function placeCaretAtEnd(el: HTMLElement, ignoreTouchCheck = false, focus = true) {\r\n  if(IS_TOUCH_SUPPORTED && (!ignoreTouchCheck || (document.activeElement.tagName !== 'INPUT' && !(document.activeElement as HTMLElement).isContentEditable))) {\r\n    return;\r\n  }\r\n\r\n  focus && el.focus();\r\n  if(el instanceof HTMLInputElement) {\r\n    const length = el.value.length;\r\n    el.selectionStart = length;\r\n    el.selectionEnd = length;\r\n  } else {\r\n    const range = document.createRange();\r\n    range.selectNodeContents(el);\r\n    range.collapse(false);\r\n    const sel = window.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n  }\r\n}\r\n\r\n(window as any).placeCaretAtEnd = placeCaretAtEnd;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_FIREFOX} from '../../environment/userAgent';\r\nimport {logger} from '../../lib/logger';\r\nimport {isCustomFillerNeededBySiblingNode} from '../../lib/richTextProcessor/wrapRichText';\r\nimport ListenerSetter from '../listenerSetter';\r\nimport BOM from '../string/bom';\r\nimport compareNodes from './compareNodes';\r\nimport getCaretPosNew from './getCaretPosNew';\r\nimport placeCaretAtEnd from './placeCaretAtEnd';\r\nimport whichChild from './whichChild';\r\n\r\nconst NOT_ONLY_BOMS_REG_EXP = new RegExp(`[^${BOM}]`);\r\n\r\nexport const USING_BOMS = false;\r\n\r\nexport default class RichInputHandler {\r\n  private static INSTANCE: RichInputHandler;\r\n\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private lastNode: Node;\r\n  private lastOffset: number;\r\n  private savedRanges: WeakMap<HTMLElement, Range>;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  private inputCaptureCallbacks: Function[];\r\n\r\n  constructor() {\r\n    this.log = logger('RICH-INPUT');\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.savedRanges = new WeakMap();\r\n\r\n    this.listenerSetter.add(document)('selectionchange', this.saveSelectionOnChange);\r\n    if(USING_BOMS) {\r\n      this.listenerSetter.add(document)('focusout', this.onFocusOut);\r\n      this.listenerSetter.add(document)('selectionchange', this.onSelectionChange);\r\n      this.listenerSetter.add(document)('beforeinput', this.onBeforeInput);\r\n      this.listenerSetter.add(document)('keydown', this.onKeyDown, {capture: true});\r\n\r\n      if(IS_FIREFOX) {\r\n        this.inputCaptureCallbacks = [];\r\n        this.listenerSetter.add(document)('input', () => {\r\n          this.inputCaptureCallbacks.forEach((callback) => callback());\r\n          this.inputCaptureCallbacks.length = 0;\r\n        }, {capture: true});\r\n      }\r\n    }\r\n  }\r\n\r\n  private get input() {\r\n    const selection = document.getSelection();\r\n    const {anchorNode: node} = selection;\r\n    if(!node) return;\r\n    return ((node as HTMLElement).closest ? node as HTMLElement : node.parentElement).closest<HTMLElement>('[contenteditable=\"true\"]');\r\n  }\r\n\r\n  private saveRangeForElement(element: HTMLElement) {\r\n    if(element && (element.isContentEditable || element.tagName === 'INPUT')) {\r\n      const selection = document.getSelection();\r\n      if(selection.rangeCount) {\r\n        this.savedRanges.set(element as HTMLElement, document.getSelection().getRangeAt(0));\r\n      }\r\n    }\r\n  }\r\n\r\n  private saveSelectionOnChange = (e: Event) => {\r\n    const element = document.activeElement as HTMLElement; // e.target as HTMLElement;\r\n    this.saveRangeForElement(element);\r\n  };\r\n\r\n  private onFocusOut = (e: FocusEvent) => {\r\n    this.lastNode = this.lastOffset = undefined;\r\n  };\r\n\r\n  private findPreviousSmthIndex(input: HTMLElement, node: ChildNode, something?: NodeListOf<Element>) {\r\n    // node = this.getFiller(node);\r\n    // const childNodes = Array.from(node.parentElement.childNodes);\r\n    // fillerIndex = childNodes.indexOf(node);\r\n    // let smthIndex = -1;\r\n    // for(let i = fillerIndex; i >= 0; --i) {\r\n    //   const node = childNodes[i];\r\n    //   if((node as HTMLElement)?.classList?.contains('input-something')) {\r\n    //     smthIndex = i;\r\n    //     break;\r\n    //   }\r\n    // }\r\n    // return smthIndex;\r\n\r\n    const elements = Array.from(something ?? input.querySelectorAll('.input-something'));\r\n    const index = elements.findIndex((element) => compareNodes(element, 0, node, 0) >= 0);\r\n    return index === -1 ? elements.length - 1 : Math.max(0, index - 1);\r\n  }\r\n\r\n  private superMove(\r\n    input: HTMLElement,\r\n    caret: ReturnType<RichInputHandler['getCaretPosN']>,\r\n    toLeft: boolean,\r\n    fromSelectionChange: boolean\r\n  ) {\r\n    const {node, offset, move} = caret;\r\n    const something = input.querySelectorAll('.input-something');\r\n    const smthIndex = this.findPreviousSmthIndex(input, node, something);\r\n    const r = document.createRange();\r\n    r[toLeft ? 'setEnd' : 'setStart'](node, offset);\r\n\r\n    if(fromSelectionChange) {\r\n      move(toLeft);\r\n    }\r\n\r\n    const c = this.getCaretPosN();\r\n    if(c.node?.nodeValue === BOM && (!fromSelectionChange || node === this.lastNode)) {\r\n      const idx = this.findPreviousSmthIndex(input, c.node, something);\r\n\r\n      let moved = !fromSelectionChange;\r\n\r\n      do {\r\n        const c = this.getCaretPosN();\r\n        const idxidx = this.findPreviousSmthIndex(input, c.node, something);\r\n        r[toLeft ? 'setStart' : 'setEnd'](c.node, c.offset);\r\n        const rangeString = r.toString();\r\n        const onlyBOMs = !NOT_ONLY_BOMS_REG_EXP.test(rangeString);\r\n        this.log('test cursor', rangeString, onlyBOMs, idx, idxidx);\r\n        if(\r\n          onlyBOMs &&\r\n          c.node?.nodeValue === BOM &&\r\n          idxidx === idx &&\r\n          // (idxidx > 1 || c.offset) &&\r\n          // (idxidx < (getFiller(c.node).parentElement.childNodes.length - 2) || c.offset < BOM.length)\r\n          (idxidx || c.offset) &&\r\n          (idxidx < (something.length - 1) || c.offset < BOM.length)\r\n        ) {\r\n          move(toLeft);\r\n          moved = true;\r\n        } else if(!moved) {\r\n          break;\r\n        } else {\r\n          if((!this.getFiller(node as HTMLElement).classList.contains('input-filler-text') && idx !== smthIndex) || c.offset === BOM.length) {\r\n            move(!toLeft);\r\n          }\r\n\r\n          break;\r\n        }\r\n      } while(true);\r\n    }\r\n  }\r\n\r\n  private onSelectionChange = (e: Event) => {\r\n    const {input} = this;\r\n    if(!input) {\r\n      this.setSelectionClassName(document.getSelection());\r\n      return;\r\n    }\r\n\r\n    // return;\r\n\r\n    // this.log('selectionchange', document.getSelection(), document.getSelection().rangeCount && document.getSelection().getRangeAt(0), getCaretPosN());\r\n    // let {node, offset} = getCaretPos(this.messageInput);\r\n\r\n    let caret = this.getCaretPosN();\r\n    do {\r\n      const {node, offset, selection, move} = caret;\r\n\r\n      const nodeValue = node?.nodeValue;\r\n      // if(!nodeValue?.includes(BOM)) {\r\n      if(nodeValue !== BOM || !this.lastNode) {\r\n        break;\r\n      }\r\n\r\n      // node = getFiller(node);\r\n\r\n      // const childIndex = whichChild(getFiller(node), true);\r\n      // let toLeft: boolean;\r\n      // // if(node === lastNode) toLeft = lastOffset >= offset;\r\n      // if(node === lastNode) toLeft = lastOffset > offset;\r\n      // else {\r\n      //   // toLeft = whichChild(getFiller(lastNode)) > childIndex;\r\n      //   toLeft = (lastNode.nodeValue === BOM ? whichChild(getFiller(lastNode), true) : whichChild(findUpAsChild(lastNode as any, getFiller(node).parentElement), true)) > childIndex;\r\n      // }\r\n\r\n      const toLeft = compareNodes(node, offset, this.lastNode as ChildNode, this.lastOffset) < 0;\r\n\r\n      // const childNodes = Array.from(node.parentElement.childNodes);\r\n      // if(toLeft) {\r\n      //   for(let i = childIndex; i >= 0; --i) {\r\n      //     const sibling = childNodes[i];\r\n      //     const {textContent} = sibling;\r\n      //     for()\r\n      //   }\r\n      // }\r\n\r\n      // {\r\n      //   if(toLeft === undefined) {\r\n      //     return;\r\n      //   }\r\n\r\n      //   const selection = window.getSelection();\r\n      //   selection.modify(selection.isCollapsed ? 'move' : 'extend', toLeft ? 'backward' : 'forward', 'character');\r\n      //   return;\r\n      // }\r\n\r\n      // const parent = getFiller(node);\r\n      if(toLeft !== undefined) {\r\n        // let newNode = toLeft ? parent.previousSibling : parent.nextSibling;\r\n        if(selection.isCollapsed) {\r\n          this.superMove(input, caret, toLeft, true);\r\n\r\n          // if(offset === BOM.length) {\r\n          //   newNode = toLeft ? newNode.nextSibling.nextSibling : parent.previousSibling.previousSibling;\r\n          // }\r\n\r\n          // setCaretAt(newNode);\r\n        } else {\r\n          selection.modify(selection.isCollapsed ? 'move' : 'extend', toLeft ? 'backward' : 'forward', 'character');\r\n          // const range = selection.getRangeAt(0);\r\n\r\n          // if(toLeft) {\r\n          //   newNode = parent.previousSibling.previousSibling.firstChild;\r\n          //   const value = newNode.nodeValue;\r\n          //   range.setStart(newNode, value?.length);\r\n          // } else {\r\n          //   newNode = parent.nextSibling.nextSibling.firstChild;\r\n          //   range.setEnd(newNode, 0);\r\n          // }\r\n        }\r\n      }\r\n\r\n      this.log('selectionchange',\r\n        node,\r\n        offset,\r\n        this.lastNode,\r\n        this.lastOffset,\r\n        node === this.lastNode,\r\n        whichChild(this.getFiller(node)),\r\n        whichChild(this.getFiller(this.lastNode)),\r\n        toLeft,\r\n        selection,\r\n        document.getSelection(),\r\n        document.getSelection().getRangeAt(0),\r\n        node?.parentNode,\r\n        this.lastNode?.parentNode\r\n      );\r\n\r\n      caret = this.getCaretPosN();\r\n      this.lastNode = node;\r\n      this.lastOffset = offset;\r\n\r\n      break;\r\n\r\n      // if(findPreviousSmthIndex(caret.node) !== smthIndex) {\r\n      //   break;\r\n      // }\r\n    } while(true);\r\n\r\n    this.lastNode = this.lastOffset = undefined;\r\n\r\n    // if(offset === BOM.length) {\r\n    //   setCaretAt(parent);\r\n    // } else {\r\n    //   setCaretAt(parent.nextSibling);\r\n    // }\r\n\r\n    this.setSelectionClassName(caret.selection, input);\r\n  };\r\n\r\n  public restoreSavedRange(input: HTMLElement) {\r\n    const range = this.getSavedRange(input);\r\n    if(!range) {\r\n      return false;\r\n    }\r\n\r\n    const selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n\r\n    return true;\r\n  }\r\n\r\n  public getSavedRange(input: HTMLElement) {\r\n    return this.savedRanges.get(input);\r\n  }\r\n\r\n  public makeFocused(input: HTMLElement) {\r\n    if(document.activeElement !== input && !this.restoreSavedRange(input)) {\r\n      placeCaretAtEnd(input, false, false);\r\n    }\r\n  }\r\n\r\n  private fixInsertedLineBreaks(input: HTMLElement) {\r\n    input.querySelectorAll('br').forEach((br) => {\r\n      br.classList.add('br-not-br');\r\n    });\r\n  }\r\n\r\n  private fixBuggedCaret() {\r\n    const selection = document.getSelection();\r\n    const range = selection.getRangeAt(0);\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n  }\r\n\r\n  public onBeforeInput = (e: Pick<InputEvent, 'inputType'>) => {\r\n    const {input, log} = this;\r\n    if(!input) {\r\n      return;\r\n    }\r\n\r\n    const addInputCallback = this.addInputCallback.bind(this, input);\r\n\r\n    const caretPos = this.getCaretPosN();\r\n    let {node, offset, selection, move} = caretPos;\r\n    log('beforeinput', e, node, offset, selection, caretPos);\r\n    this.lastNode = this.lastOffset = undefined;\r\n\r\n    if(e.inputType.startsWith('delete')) { // delete current BOM\r\n      addInputCallback(() => {\r\n        this.processEmptiedFillers(input);\r\n        this.removeExtraBOMs(input);\r\n        this.fixInsertedLineBreaks(input);\r\n      });\r\n\r\n      if(node?.nodeValue === BOM && selection.isCollapsed && e.inputType.includes('deleteContent')) {\r\n        const toLeft = e.inputType.includes('Backward');\r\n        const moveFirst = (offset === BOM.length && toLeft) || (!offset && !toLeft);\r\n        this.superMove(input, caretPos, toLeft, moveFirst);\r\n        // if((offset === BOM.length && toLeft) || (!offset && !toLeft)) {\r\n        //   move(toLeft);\r\n        // }\r\n\r\n        // addInputCallback(() => {\r\n        //   removePossibleBOMSiblingsByNode(getFiller(node));\r\n        // });\r\n\r\n        // if(node.parentNode.childNodes.length === 1) {\r\n        //   (node.parentNode as HTMLElement).remove();\r\n        //   move(e.inputType.includes('Backward') ? false : true);\r\n        // } else {\r\n        //   move(e.inputType.includes('Backward') ? true : false);\r\n        //   addInputCallback(() => {\r\n        //     move(e.inputType.includes('Backward') ? false : true);\r\n        //   });\r\n        // }\r\n\r\n        // for(let i = 0, length = BOM.length + (direction === 'backward' ? offset : BOM.length - offset); i < length; ++i) {\r\n        //   selection.modify('extend', direction, 'character');\r\n        // }\r\n\r\n        // selection.modify('extend', direction, 'character');\r\n        // selection.modify('extend', direction, 'character');\r\n\r\n        // selection.deleteFromDocument();\r\n        // e.preventDefault();\r\n      } else {\r\n        // const filler = getFiller(node);\r\n        // if(filler?.classList?.contains('input-filler-text')) {\r\n        //   const {previousSibling, nextSibling} = filler;\r\n        //   addInputCallback(() => {\r\n        //     if(!filler.isConnected) {\r\n        //       removePossibleBOMSiblings(previousSibling, nextSibling);\r\n        //     }\r\n        //     // removeExtraBOMs();\r\n        //     // processEmptiedFillers();\r\n        //   });\r\n        // }\r\n        // addInputCallback(() => {\r\n        //   this.fixInsertedLineBreaks(input);\r\n        // });\r\n      }\r\n    } else if(e.inputType.startsWith('insert')) { // clear current BOM\r\n      if((node as HTMLElement)?.classList?.contains('input-something')/*  || (node.textContent === BOM && offset === BOM.length) */) {\r\n        node = node.previousSibling.firstChild;\r\n        const range = selection.getRangeAt(0);\r\n        range.setStart(node, 0);\r\n        range.setEnd(node, 0);\r\n        range.collapse(true);\r\n        // selection.modify('move', 'backward', 'character');\r\n\r\n        const c = this.getCaretPosN();\r\n        node = c.node;\r\n        selection = c.selection;\r\n        offset = c.offset;\r\n      }\r\n      if(node && node.textContent === BOM && offset === BOM.length) {\r\n        // const range = selection.getRangeAt(0);\r\n        // range.setStart(node, 0);\r\n        // range.setEnd(node, 0);\r\n        // range.collapse(true);\r\n        selection.modify('move', 'backward', 'character');\r\n\r\n        const c = this.getCaretPosN();\r\n        node = c.node;\r\n        selection = c.selection;\r\n        offset = c.offset;\r\n      }\r\n      // if(node && node.textContent === BOM && offset === 0) {\r\n      //   selection.modify('move', 'forward', 'character');\r\n      //   offset = BOM.length;\r\n      // }\r\n\r\n      if(e.inputType === 'insertLineBreak' || true) {\r\n        // const appendix = 'X';\r\n        // const textNode = document.createTextNode(appendix);\r\n        // if(node.parentElement !== this.messageInput) node.parentElement.after(textNode);\r\n        // else node.after(textNode);\r\n        // selection.modify('move', 'forward', 'character');\r\n        // selection.modify('move', 'forward', 'character');\r\n        // addInputCallback(() => {\r\n        //   textNode.remove();\r\n        // });\r\n\r\n        /* if(node?.nodeValue === BOM) */ {\r\n          // const parent = node.parentElement;\r\n          // parent.contentEditable = 'false';\r\n          // addInputCallback(() => {\r\n          //   parent.contentEditable = 'inherit';\r\n          // });\r\n          // node.parentElement.remove();\r\n\r\n          // const textNode = document.createTextNode(appendix);\r\n          // if(node.parentElement !== this.messageInput) node.parentElement.after(textNode);\r\n          // else node.after(textNode);\r\n          // // selection.modify('move', 'forward', 'character');\r\n          // // selection.modify('move', 'forward', 'character');\r\n          // addInputCallback(() => {\r\n          //   textNode.remove();\r\n          // });\r\n\r\n          // fix case when focused somehow on span instead of text node\r\n          if(node && node.nodeType === node.ELEMENT_NODE) {\r\n            node = node.firstChild;\r\n            log.warn('fixing focus on span');\r\n          }\r\n\r\n          const isBOM = node?.nodeValue === BOM;\r\n          log('inserting line break', isBOM, node, `\"${node?.nodeValue}\"`, node?.parentElement ? Array.from(node.parentElement.childNodes).slice() : []);\r\n          if(isBOM) {\r\n            // (node as ChildNode).replaceWith(this.messageInput.querySelector('.lol'));\r\n\r\n            const parentElement = node.parentElement;\r\n            parentElement.classList.replace('input-filler', 'input-filler-text');\r\n            const childNodesLength = parentElement.childNodes.length;\r\n            addInputCallback(() => {\r\n              const newChildNodesLength = parentElement.childNodes.length;\r\n              if(newChildNodesLength > 1/*  && newChildNodesLength !== childNodesLength */) {\r\n                log('inserting line break, remove');\r\n                node = Array.from(parentElement.childNodes).find((node) => node.nodeValue === BOM);\r\n                (parentElement as any).t = node;\r\n                // node?.remove();\r\n\r\n                // const n = parentElement.firstChild;\r\n                // const range = selection.getRangeAt(0);\r\n                // range.setStart(n, n.nodeValue.length);\r\n                // range.setEnd(n, n.nodeValue.length);\r\n              } else if(node.nodeValue !== BOM) {\r\n                log('inserting line break, deleteData');\r\n                (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n                // node = document.createTextNode(BOM);\r\n              }\r\n\r\n              this.fixInsertedLineBreaks(input);\r\n              // (parentElement as any).t = node;\r\n              // node.remove();\r\n            });\r\n            // addInputCallback(() => {\r\n            //   node.parentElement.classList.replace('input-filler', 'input-filler3');\r\n            //   const s = document.createElement('span');\r\n            //   s.style.display = 'none';\r\n            //   node.replaceWith(s);\r\n            //   s.prepend(node);\r\n            // });\r\n          } else if(e.inputType === 'insertLineBreak') {\r\n            addInputCallback(() => {\r\n              this.fixInsertedLineBreaks(input);\r\n            });\r\n            // const range = selection.getRangeAt(0);\r\n            // this.messageInput.querySelectorAll<HTMLElement>('.input-something').forEach((el) => {\r\n            //   el.contentEditable = 'inherit';\r\n            // });\r\n\r\n            // addInputCallback(() => {\r\n            //   this.messageInput.querySelectorAll<HTMLElement>('.input-something').forEach((el) => {\r\n            //     el.contentEditable = 'false';\r\n            //   });\r\n\r\n            //   selection.removeAllRanges();\r\n            //   selection.addRange(range);\r\n            // }, false);\r\n          }/*  else if(node &&\r\n            node.nodeType === node.TEXT_NODE &&\r\n            node.nodeValue.length === offset) {\r\n\r\n          } */\r\n\r\n          // if(e.inputType === 'insertLineBreak') {\r\n          //   e.preventDefault();\r\n          //   document.execCommand('insertHTML', false, '<span class=\"lol\">\\n</span>');\r\n\r\n          //   this.messageInputField.simulateInputEvent();\r\n          // }\r\n\r\n          // node.parentElement.replaceWith(node);\r\n          // selection.removeAllRanges();\r\n          // const range = new Range();\r\n          // range.setStart(node, 0);\r\n          // range.setEnd(node, node.nodeValue.length);\r\n          // selection.addRange(range);\r\n          // node.parentElement.classList.remove('input-filler');\r\n          // node.parentElement\r\n        }\r\n\r\n        // document.execCommand('insertHTML', false, '\\n');\r\n        // e.preventDefault();\r\n        // (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n        // if(node?.nodeValue === BOM) {\r\n        //   addInputCallback(() => {\r\n        //     node.remove();\r\n        //   });\r\n        // }\r\n        // this.messageInputField.simulateInputEvent();\r\n\r\n        // this.messageInput.querySelectorAll<HTMLElement>('.input-something').forEach((el) => {\r\n        //   el.contentEditable = 'inherit';\r\n        // });\r\n        // addInputCallback(() => {\r\n        //   this.messageInput.querySelectorAll<HTMLElement>('.input-something').forEach((el) => {\r\n        //     el.contentEditable = 'false';\r\n        //   });\r\n        // });\r\n        return;\r\n      }\r\n\r\n      if(node?.nodeValue === BOM) {\r\n        // node.nodeValue = ''; // ! will move cursor forward\r\n        // addInputCallback(() => {\r\n        //   (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n        // });\r\n\r\n        if(e.inputType === 'insertLineBreak') {\r\n          if(offset === BOM.length) {\r\n            selection.modify('move', 'backward', 'character');\r\n          }\r\n\r\n          // if(offset !== BOM.length) {\r\n          //   selection.modify('move', 'forward', 'character');\r\n          // }\r\n\r\n          addInputCallback(() => {\r\n            node.remove();\r\n            // (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n            // selection.modify('move', 'forward', 'character');\r\n\r\n            setTimeout(() => {\r\n              selection.modify('move', 'forward', 'character');\r\n            }, 0);\r\n          });\r\n        }\r\n\r\n        // node.parentElement.replaceWith(node);\r\n\r\n        // node.parentElement.replaceWith(node);\r\n        if(e.inputType === 'insertLineBreak') {\r\n          // const previousParentSibling = node.parentNode.previousSibling;\r\n          // addInputCallback(() => {\r\n          //   if(previousParentSibling.nextSibling.nodeValue === '\\n') {\r\n          //     previousParentSibling.nextSibling.remove();\r\n\r\n          //     setTimeout(() => {\r\n          //       // selection.modify('move', 'forward', 'character');\r\n          //       // selection.modify('move', 'forward', 'character');\r\n          //     }, 0);\r\n          //   } else {\r\n          //     previousParentSibling.nextSibling.nodeValue = previousParentSibling.nextSibling.nodeValue.replace('\\n\\n', '\\n');\r\n          //   }\r\n          // });\r\n        } else {\r\n          // if(node.parentElement !== this.messageInput) {\r\n          //   node.parentElement.replaceWith(node);\r\n          // }\r\n\r\n          // setTimeout(() => {\r\n          //   this.log(JSON.stringify(node.parentElement.innerHTML));\r\n          //   node.nodeValue = node.nodeValue.replace(BOM, '');\r\n          //   // (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n          //   this.log(JSON.stringify(node.parentElement.innerHTML));\r\n          // }, 1000);\r\n\r\n          addInputCallback(() => {\r\n            (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n            if(!node.nodeValue) {\r\n              node.remove();\r\n            }\r\n\r\n            // selection.modify('move', 'forward', 'character');\r\n          });\r\n        }\r\n\r\n        if(selection.isCollapsed && false) {\r\n          node.parentElement.replaceWith(node);\r\n          // const textNode = document.createTextNode(BOM);\r\n          // (node.parentNode as any as ChildNode).after(textNode);\r\n          // setCaretAt(textNode.nextSibling);\r\n          // selection.modify('move', 'forward', 'character');\r\n          node.remove();\r\n          // (node as CharacterData).deleteData(node.nodeValue.indexOf(BOM), BOM.length);\r\n          // selection.modify('move', 'forward', 'character');\r\n          // selection.collapseToEnd();\r\n\r\n          // addInputCallback(() => {\r\n          //   (textNode as CharacterData).deleteData(textNode.nodeValue.indexOf(BOM), BOM.length);\r\n          //   node.parentElement.remove();\r\n          // });\r\n        }\r\n      } else if(e.inputType === 'insertLineBreak' &&\r\n        node &&\r\n        node.nodeType === node.TEXT_NODE &&\r\n        node.nodeValue.length === offset) {\r\n        log('inserting line break');\r\n        // const appendix = '\\x01';\r\n\r\n        input.querySelectorAll<HTMLElement>('.input-something').forEach((el) => {\r\n          el.contentEditable = 'inherit';\r\n        });\r\n        addInputCallback(() => {\r\n          input.querySelectorAll<HTMLElement>('.input-something').forEach((el) => {\r\n            el.contentEditable = 'false';\r\n          });\r\n        });\r\n\r\n        // const textNode = document.createTextNode(appendix);\r\n        // if(node.parentElement !== this.messageInput) node.parentElement.after(textNode);\r\n        // else node.after(textNode);\r\n        // // selection.modify('move', 'forward', 'character');\r\n        // addInputCallback(() => {\r\n        //   textNode.remove();\r\n        // });\r\n\r\n        // const offset = node.nodeValue.length;\r\n        // (node as CharacterData).insertData(offset, appendix);\r\n        // addInputCallback(() => {\r\n        //   selection.modify('move', 'forward', 'character');\r\n        //   (node as CharacterData).deleteData(node.nodeValue.indexOf(appendix), appendix.length);\r\n        //   if(!node.nodeValue) {\r\n        //     node.remove();\r\n        //   }\r\n        // });\r\n      }\r\n    } else if(e.inputType === 'historyUndo') { // have to remove extra BOMs\r\n      addInputCallback(() => {\r\n        this.processFilledFillers(input);\r\n        this.processEmptiedFillers(input);\r\n        this.removeExtraBOMs(input);\r\n        this.removeEmptyTextNodes(input);\r\n\r\n        // ! lol what, caret will be at the wrong position, have to set it to the same\r\n        this.fixBuggedCaret();\r\n\r\n        // lol\r\n        // this.messageInput.querySelectorAll('.has-text').forEach((el) => {\r\n        //   if(el.textContent === BOM) {\r\n        //     el.firstElementChild.replaceWith(el.firstElementChild.firstChild);\r\n        //     el.classList.replace('input-filler3', 'input-filler');\r\n        //   }\r\n        // });\r\n      });\r\n    } else if(e.inputType === 'historyRedo') {\r\n      // if(node?.nodeValue === BOM && offset === BOM.length) {\r\n      //   selection.modify('move', 'backward', 'character');\r\n      // }\r\n\r\n      addInputCallback(() => {\r\n        this.processFilledFillers(input);\r\n        this.processEmptiedFillers(input);\r\n\r\n        // fix contenteditable attribute\r\n        input.querySelectorAll<HTMLElement>('.input-something:not([contenteditable])').forEach((el) => {\r\n          el.contentEditable = 'false';\r\n        });\r\n\r\n        this.removeExtraBOMs(input);\r\n\r\n        // ! lol what, caret will be at the wrong position, have to set it to the same\r\n        this.fixBuggedCaret();\r\n      });\r\n    }\r\n  };\r\n\r\n  private onKeyDown = (e: KeyboardEvent) => {\r\n    const key = e.key;\r\n\r\n    // // have to ignore line up and down\r\n    if(key === 'ArrowDown' || key === 'ArrowUp') {\r\n      this.lastNode = this.lastOffset = undefined;\r\n    } else {\r\n      const {node, offset} = this.getCaretPosN();\r\n      this.lastNode = node/* getFiller(node) */, this.lastOffset = offset;\r\n      if(this.lastNode === this.input) {\r\n        this.lastNode = this.lastOffset = undefined;\r\n      }\r\n    }\r\n\r\n    this.log('keydown', this.lastNode, this.lastNode?.parentNode, this.lastOffset, this.getCaretPosN(), e);\r\n  };\r\n\r\n  private addInputCallback(input: HTMLElement, callback: () => void, capture = true) {\r\n    const newCallback = () => {\r\n      this.log('input modify callback');\r\n      callback();\r\n    };\r\n\r\n    if(capture && IS_FIREFOX) this.inputCaptureCallbacks.push(newCallback);\r\n    else this.listenerSetter.add(input)('input', newCallback, {once: true, capture});\r\n  }\r\n\r\n  public removeExtraBOMs(input: HTMLElement) {\r\n    const c = (sibling: ChildNode) => {\r\n      return (sibling as HTMLElement)?.classList?.contains('input-something');\r\n    };\r\n\r\n    input.querySelectorAll('.input-filler').forEach((el) => {\r\n      const {previousSibling, nextSibling} = el;\r\n      let needed = false;\r\n\r\n      // if(!(previousSibling as HTMLElement)?.classList?.contains('input-filler') && isCustomFillerNeededBySiblingNode(previousSibling)) {\r\n      if(!(nextSibling as HTMLElement)?.classList?.contains('input-filler') && isCustomFillerNeededBySiblingNode(nextSibling)) {\r\n        needed = c(previousSibling) || c(nextSibling);\r\n      }\r\n\r\n      if(!needed) {\r\n        this.log.warn('removing empty bom node', el);\r\n        el.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private getFiller(node: Node) {\r\n    return node && node.nodeType === node.TEXT_NODE && node.parentElement !== this.input ? node.parentElement : node as HTMLElement;\r\n  }\r\n\r\n  private getCaretPosN() {\r\n    const ret = getCaretPosNew(this.input);\r\n    // const {node} = ret;\r\n    // if((node as HTMLElement)?.classList?.contains('input-something')) {\r\n    //   ret.node = node.previousSibling;\r\n    //   ret.offset = ret.node.textContent.length;\r\n    // }\r\n\r\n    return {...ret, move: this.move.bind(this, ret.selection)};\r\n  }\r\n\r\n  private removeEmptyTextNodes(input: HTMLElement) {\r\n    const {log} = this;\r\n    // let i = -1;\r\n    // remove empty text nodes\r\n    const treeWalker = document.createTreeWalker(\r\n      input,\r\n      NodeFilter.SHOW_TEXT,\r\n      {acceptNode: (node) => node.parentElement === input && !node.nodeValue/*  && !++i */ ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT}\r\n    );\r\n\r\n    let textNode: Text;\r\n    while(textNode = treeWalker.nextNode() as Text) {\r\n      log.warn('removing empty text node', textNode);\r\n      textNode.remove();\r\n    }\r\n  }\r\n\r\n  private removePossibleBOMSiblings(previousSibling: ChildNode, nextSibling: ChildNode) {\r\n    [previousSibling, nextSibling].forEach((sibling) => {\r\n      if((sibling as HTMLElement)?.classList?.contains('input-filler')) {\r\n        sibling.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private removePossibleBOMSiblingsByNode(node: ChildNode) {\r\n    const {previousSibling, nextSibling} = node;\r\n    this.removePossibleBOMSiblings(previousSibling, nextSibling);\r\n  };\r\n\r\n  private processEmptiedFillers(input: HTMLElement) {\r\n    input.querySelectorAll<HTMLElement>('.input-filler-text').forEach((el) => {\r\n      this.removeExtraBOMs(el);\r\n\r\n      let cleanSiblings = true;\r\n      if(!el.textContent) {\r\n        el.classList.replace('input-filler-text', 'input-filler');\r\n\r\n        const textNode = Array.from(el.childNodes).find((node) => node.nodeType === node.TEXT_NODE);\r\n        if(textNode) {\r\n          (textNode as CharacterData).insertData(0, BOM);\r\n        } else if(((el as any).t as ChildNode)?.nodeValue) {\r\n          el.append((el as any).t);\r\n        } else {\r\n          el.append(document.createTextNode(BOM));\r\n        }\r\n      } else if(!NOT_ONLY_BOMS_REG_EXP.test(el.textContent) && !el.querySelector('.input-something')) {\r\n        el.classList.replace('input-filler-text', 'input-filler');\r\n      } else {\r\n        cleanSiblings = false;\r\n      }\r\n\r\n      if(cleanSiblings) {\r\n        this.removePossibleBOMSiblingsByNode(el);\r\n      }\r\n    });\r\n  }\r\n\r\n  private processFilledFillers(input: HTMLElement) {\r\n    // remove the BOM when changing to text\r\n    input.querySelectorAll('.input-filler').forEach((el) => {\r\n      if(el.textContent !== BOM) {\r\n        el.classList.replace('input-filler', 'input-filler-text');\r\n        const t = (el as any).t as ChildNode;\r\n        const bomNode = Array.from(el.childNodes).find((node) => node.nodeType === node.TEXT_NODE && node.nodeValue.includes(BOM));\r\n        if(bomNode && !t?.nodeValue) {\r\n          const idx = bomNode.nodeValue.indexOf(BOM);\r\n          if(idx !== -1) {\r\n            (bomNode as CharacterData).deleteData(idx, BOM.length);\r\n          }\r\n        }\r\n\r\n        // t?.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private setSelectionClassName(selection: Selection, input?: HTMLElement) {\r\n    // Array.from(this.messageInput.querySelectorAll('.selection')).forEach((element) => {\r\n    //   element.classList.remove('selection');\r\n    // });\r\n\r\n    if(selection.rangeCount) {\r\n      const range = selection.getRangeAt(0);\r\n\r\n      if(input) {\r\n        Array.from(input.querySelectorAll('.input-selectable')).forEach((element) => {\r\n          element.classList.toggle('selection', !range.collapsed && range.intersectsNode(element));\r\n        });\r\n      } else {\r\n        Array.from(document.querySelectorAll('.input-selectable.selection')).forEach((element) => element.classList.remove('selection'));\r\n      }\r\n    }\r\n  }\r\n\r\n  private move(selection: Selection, left: boolean) {\r\n    const {focusNode: focusNodeBefore, focusOffset: focusOffsetBefore} = selection;\r\n    selection.modify('extend', left ? 'backward' : 'forward', 'character');\r\n    // if(offset === nodeValue.length) {\r\n    //   selection.modify('extend', !left ? 'backward' : 'forward', 'character');\r\n    // }\r\n    if(left) selection.collapseToStart();\r\n    else selection.collapseToEnd();\r\n    const {focusNode: focusNodeAfter, focusOffset: focusOffsetAfter} = selection;\r\n    this.log(\r\n      'moving cursor',\r\n      left,\r\n      focusNodeBefore,\r\n      focusNodeBefore.nodeType === focusNodeBefore.ELEMENT_NODE ? focusNodeBefore : focusNodeBefore.parentElement,\r\n      focusOffsetBefore,\r\n      focusNodeAfter,\r\n      focusNodeAfter.nodeType === focusNodeAfter.ELEMENT_NODE ? focusNodeAfter : focusNodeAfter.parentElement,\r\n      focusOffsetAfter\r\n    );\r\n  }\r\n\r\n  public prepareApplyingMarkdown() {\r\n    const {input} = this;\r\n\r\n    // do not wrap fillers into spans\r\n    const fillers = input.querySelectorAll<HTMLElement>('.input-filler');\r\n    // fillers.forEach((el) => {\r\n    //   el.contentEditable = 'false';\r\n    // });\r\n\r\n    const smths = input.querySelectorAll<HTMLElement>('.input-something');\r\n    smths.forEach((el) => {\r\n      el.contentEditable = 'inherit';\r\n    });\r\n\r\n    return () => {\r\n      fillers.forEach((el) => {\r\n        el.contentEditable = 'inherit';\r\n      });\r\n\r\n      smths.forEach((el) => {\r\n        el.contentEditable = 'false';\r\n      });\r\n\r\n      this.removeExtraBOMs(input);\r\n    };\r\n  }\r\n\r\n  public static getInstance() {\r\n    return this.INSTANCE ??= new RichInputHandler();\r\n  }\r\n}\r\n","// https://stackoverflow.com/a/6150060\r\nexport default function selectElementContents(el: HTMLElement) {\r\n  const range = document.createRange();\r\n  range.selectNodeContents(el);\r\n  const sel = window.getSelection();\r\n  sel.removeAllRanges();\r\n  sel.addRange(range);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {PASS_CONFLICTING_ENTITIES, PASS_SINGLE_CONFLICTING_ENTITIES} from '.';\r\nimport {MessageEntity} from '../../layer';\r\n\r\nconst SINGLE_ENTITIES: Set<MessageEntity['_']> = new Set(['messageEntityPre', 'messageEntityCode']);\r\n\r\nexport default function findConflictingEntity(currentEntities: MessageEntity[], newEntity: MessageEntity) {\r\n  let singleStart = -1, singleEnd = -1;\r\n  return currentEntities.find((currentEntity) => {\r\n    const {offset, length} = currentEntity;\r\n    if(SINGLE_ENTITIES.has(currentEntity._)) {\r\n      singleStart = offset;\r\n      singleEnd = singleStart + length;\r\n    }\r\n\r\n    if(singleStart !== -1) {\r\n      if(\r\n        newEntity.offset >= singleStart &&\r\n        newEntity.offset < singleEnd &&\r\n        !PASS_SINGLE_CONFLICTING_ENTITIES.has(newEntity._)\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    const isConflictingTypes = newEntity._ === currentEntity._ ||\r\n      (!PASS_CONFLICTING_ENTITIES.has(newEntity._) && !PASS_CONFLICTING_ENTITIES.has(currentEntity._));\r\n\r\n    if(!isConflictingTypes) {\r\n      return false;\r\n    }\r\n\r\n    const isConflictingOffset = newEntity.offset >= offset &&\r\n      (newEntity.length + newEntity.offset) <= (length + offset);\r\n\r\n    return isConflictingOffset;\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport findConflictingEntity from './findConflictingEntity';\r\nimport sortEntities from './sortEntities';\r\n\r\nexport default function mergeEntities(currentEntities: MessageEntity[], newEntities: MessageEntity[]) {\r\n  currentEntities = currentEntities.slice();\r\n  const filtered = newEntities.filter((e) => {\r\n    return !findConflictingEntity(currentEntities, e);\r\n  });\r\n\r\n  currentEntities.push(...filtered);\r\n  sortEntities(currentEntities);\r\n  // currentEntities.sort((a, b) => a.offset - b.offset);\r\n  // currentEntities.sort((a, b) => (a.offset - b.offset) || (a._ === 'messageEntityCaret' && -1));\r\n\r\n  // * fix splitted emoji. messageEntityTextUrl can split the emoji if starts before its end (e.g. on fe0f)\r\n  // * have to fix even if emoji supported since it's being wrapped in span\r\n  // if(!IS_EMOJI_SUPPORTED) {\r\n  for(let i = 0; i < currentEntities.length; ++i) {\r\n    let entity = currentEntities[i];\r\n    if(entity._ === 'messageEntityEmoji') {\r\n      const nextEntity = currentEntities[i + 1];\r\n      if(nextEntity /* && nextEntity._ !== 'messageEntityCaret' */ && nextEntity.offset < (entity.offset + entity.length)) {\r\n        entity = currentEntities[i] = {...entity};\r\n        entity.length = nextEntity.offset - entity.offset;\r\n      }\r\n    }\r\n  }\r\n  // }\r\n\r\n  return currentEntities;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AnimationItemGroup} from '../../components/animationIntersector';\r\nimport rootScope from '../rootScope';\r\nimport wrapRichText from './wrapRichText';\r\n\r\nexport default function wrapDraftText(text: string, options: Partial<{\r\n  wrappingForPeerId: PeerId,\r\n  animationGroup?: AnimationItemGroup\r\n}> & Parameters<typeof wrapRichText>[1] = {}) {\r\n  if(!text) {\r\n    return wrapRichText('');\r\n  }\r\n\r\n  let entities = options.entities;\r\n  if(entities && !rootScope.premium && options.wrappingForPeerId !== rootScope.myId) {\r\n    entities = entities.filter((entity) => entity._ !== 'messageEntityCustomEmoji');\r\n  }\r\n\r\n  const fragment = wrapRichText(text, {\r\n    ...options,\r\n    entities,\r\n    noLinks: true,\r\n    wrappingDraft: true,\r\n    passEntities: {\r\n      messageEntityTextUrl: true,\r\n      messageEntityMentionName: true\r\n    }\r\n  });\r\n\r\n  return fragment;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type CustomEmojiElement from '../lib/customEmoji/element';\r\nimport type {AnimationItemGroup} from './animationIntersector';\r\nimport {CustomEmojiRendererElement} from '../lib/customEmoji/renderer';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport documentFragmentToHTML from '../helpers/dom/documentFragmentToHTML';\r\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\r\nimport findUpTag from '../helpers/dom/findUpTag';\r\nimport getCaretPosNew from '../helpers/dom/getCaretPosNew';\r\nimport getRichValueWithCaret from '../helpers/dom/getRichValueWithCaret';\r\nimport isInputEmpty from '../helpers/dom/isInputEmpty';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport RichInputHandler, {USING_BOMS} from '../helpers/dom/richInputHandler';\r\nimport selectElementContents from '../helpers/dom/selectElementContents';\r\nimport setInnerHTML, {setDirection} from '../helpers/dom/setInnerHTML';\r\nimport {MessageEntity} from '../layer';\r\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\r\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\r\nimport mergeEntities from '../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../lib/richTextProcessor/parseEntities';\r\nimport wrapDraftText from '../lib/richTextProcessor/wrapDraftText';\r\nimport {createCustomFiller, insertCustomFillers} from '../lib/richTextProcessor/wrapRichText';\r\nimport type {MarkupTooltipTypes} from './chat/markupTooltip';\r\n\r\nexport async function insertRichTextAsHTML(input: HTMLElement, text: string, entities: MessageEntity[], wrappingForPeerId: PeerId) {\r\n  const loadPromises: Promise<any>[] = [];\r\n  const wrappingCustomEmoji = entities?.some((entity) => entity._ === 'messageEntityCustomEmoji');\r\n  const renderer = wrappingCustomEmoji ? createCustomEmojiRendererForInput() : undefined;\r\n  const fragment = wrapDraftText(text, {entities, wrappingForPeerId, loadPromises, customEmojiRenderer: renderer});\r\n  const something = fragment.querySelectorAll<HTMLElement>('[contenteditable=\"false\"]');\r\n  something.forEach((el) => {\r\n    el.contentEditable = 'inherit';\r\n    el.classList.add('pc');\r\n  });\r\n\r\n  loadPromises.length && await Promise.all(loadPromises);\r\n\r\n  fragment.querySelectorAll<HTMLElement>('.input-selectable').forEach((el) => {\r\n    el.prepend(createCustomFiller(true));\r\n  });\r\n\r\n  const richInputHandler = USING_BOMS ? RichInputHandler.getInstance() : undefined;\r\n  // const restore = richInputHandler.prepareApplyingMarkdown();\r\n\r\n  // fragment.querySelectorAll('.input-filler').forEach((el) => el.remove());\r\n\r\n  // const fillers = Array.from(input.querySelectorAll<HTMLElement>('.input-filler')).map((el) => {\r\n  //   el.contentEditable = 'false';\r\n  //   return el;\r\n  // });\r\n\r\n  const customEmojiElements = Array.from(fragment.querySelectorAll<HTMLImageElement>('.custom-emoji-placeholder')).map((el) => {\r\n    el.dataset.ces = '1';\r\n    return (el as any).customEmojiElement as CustomEmojiElement;\r\n  });\r\n\r\n  const html = documentFragmentToHTML(fragment);\r\n  renderer?.destroy();\r\n\r\n  // console.log(html);\r\n\r\n  const pre = getCaretPosNew(input);\r\n  // console.log('pre', pre);\r\n  let textNode: ChildNode, textNodeValue: string;\r\n  if(pre.node) {\r\n    // if(pre.node?.nodeValue === BOM && false) {\r\n    //   textNode = document.createTextNode(textNodeValue = BOM);\r\n    //   (pre.node.parentNode as any as ChildNode).after(textNode);\r\n    //   pre.selection.modify('extend', 'forward', 'character');\r\n    //   pre.selection.collapseToEnd();\r\n    // }\r\n  } else {\r\n    const range = document.createRange();\r\n    let node = input.lastChild;\r\n    if(!node) {\r\n      input.append(node /* = textNode */ = document.createTextNode(''));\r\n    }\r\n\r\n    range.setStartAfter(node);\r\n    range.collapse(true);\r\n    pre.selection.removeAllRanges();\r\n    pre.selection.addRange(range);\r\n  }\r\n\r\n  // const fragmentLastChild = fragment.lastChild;\r\n\r\n  // const s = document.createElement('span');\r\n  // (node as ChildNode).replaceWith(s);\r\n  // s.append(node);\r\n  input.addEventListener('input', cancelEvent, {capture: true, once: true, passive: false});\r\n  richInputHandler?.onBeforeInput({inputType: 'insertContent'});\r\n  window.document.execCommand('insertHTML', false, html);\r\n  Array.from(input.querySelectorAll<HTMLImageElement>('[data-ces]')).forEach((el, idx) => {\r\n    delete el.dataset.ces;\r\n    const customEmojiElement = customEmojiElements[idx];\r\n    (el as any).customEmojiElement = customEmojiElement;\r\n    customEmojiElement.placeholder = el;\r\n  });\r\n  // fillers.forEach((el) => {\r\n  //   el.contentEditable = 'inherit';\r\n  // });\r\n  input.querySelectorAll<HTMLElement>('.pc').forEach((el) => {\r\n    el.contentEditable = 'false';\r\n  });\r\n  if(textNode) {\r\n    const {nodeValue} = textNode;\r\n    if(nodeValue === textNodeValue) {\r\n      textNode.remove();\r\n    } else {\r\n      (textNode as CharacterData).replaceData(nodeValue.indexOf(textNodeValue), textNodeValue.length, '');\r\n    }\r\n  }\r\n  // restore();\r\n  richInputHandler?.removeExtraBOMs(input);\r\n  simulateEvent(input, 'input');\r\n\r\n  // if(textNode) {\r\n  //   const selection = document.getSelection();\r\n  //   const node = fragmentLastChild.nextSibling || fragmentLastChild;\r\n  //   const range = document.createRange();\r\n  //   range.setStartAfter(node);\r\n  //   range.collapse(true);\r\n  //   selection.removeAllRanges();\r\n  //   selection.addRange(range);\r\n  // }\r\n\r\n  // const after = getCaretPosNew(input);\r\n  // console.log('after', after);\r\n  // if(after.node?.nodeValue === BOM) {\r\n  //   const smth = findUpClassName(after.node.parentElement, 'input-something');\r\n  //   if(smth) {\r\n  //     const selection = document.getSelection();\r\n  //     const node = smth.nextSibling;\r\n  //     const range = document.createRange();\r\n  //     range.setStartAfter(node);\r\n  //     range.collapse(true);\r\n  //     selection.removeAllRanges();\r\n  //     selection.addRange(range);\r\n\r\n  //     // if(after.offset === 0) after.selection.modify('extend', 'forward', 'character');\r\n  //     // after.selection.modify('extend', 'forward', 'character');\r\n  //     // after.selection.collapseToEnd();\r\n  //   }\r\n  // }\r\n\r\n  // setCaretAt(fragmentLastChild.nextSibling);\r\n\r\n  // console.log('ASD');\r\n}\r\n\r\nlet init = () => {\r\n  document.addEventListener('paste', (e) => {\r\n    const input = findUpAttribute(e.target, 'contenteditable=\"true\"');\r\n    if(!input) {\r\n      return;\r\n    }\r\n\r\n    const noLinebreaks = !!input.dataset.noLinebreaks;\r\n    e.preventDefault();\r\n    let text: string, entities: MessageEntity[];\r\n\r\n    // @ts-ignore\r\n    let plainText: string = (e.originalEvent || e).clipboardData.getData('text/plain').replace(/\\r/g, '');\r\n    let usePlainText = true;\r\n\r\n    // @ts-ignore\r\n    let html: string = (e.originalEvent || e).clipboardData.getData('text/html') || plainText;\r\n\r\n    const filterEntity = (e: MessageEntity) => e._ === 'messageEntityEmoji' || (e._ === 'messageEntityLinebreak' && !noLinebreaks);\r\n    if(noLinebreaks) {\r\n      const regExp = /[\\r\\n]/g;\r\n      plainText = plainText.replace(regExp, '');\r\n      html = html.replace(regExp, '');\r\n    }\r\n\r\n    const peerId = (input.dataset.peerId || NULL_PEER_ID).toPeerId();\r\n    if(html.trim()) {\r\n      // console.log(html.replace(/ (style|class|id)=\".+?\"/g, ''));\r\n\r\n      html = html.replace(/<style([\\s\\S]*)<\\/style>/, '');\r\n      html = html.replace(/<!--([\\s\\S]*?)-->/g, '');\r\n      html = html.replace('<br class=\"Apple-interchange-newline\">', '');\r\n      html = html.replace(/\\r/g, '');\r\n\r\n      const match = html.match(/<body>([\\s\\S]*)<\\/body>/);\r\n      if(match) {\r\n        html = match[1].trim();\r\n      }\r\n\r\n      // const s = cleanHTML(html, true) as NodeList;\r\n      // console.log(s);\r\n\r\n      const parser = new DOMParser();\r\n      const doc = parser.parseFromString(html, 'text/html');\r\n      const span = doc.body || document.createElement('body');\r\n\r\n      // const span: HTMLElement = document.createElement('span');\r\n      // span.innerHTML = html;\r\n      // span.append(...Array.from(s));\r\n\r\n      let curChild = span.firstChild;\r\n      while(curChild) { // * fix whitespace between elements like <p>asd</p>\\n<p>zxc</p>\r\n        const nextSibling = curChild.nextSibling;\r\n        if(curChild.nodeType === curChild.TEXT_NODE) {\r\n          if(!curChild.nodeValue.trim()) {\r\n            curChild.remove();\r\n          }\r\n        }\r\n\r\n        curChild = nextSibling;\r\n      }\r\n\r\n      const richValue = getRichValueWithCaret(span, true, false);\r\n\r\n      const canWrapCustomEmojis = !!peerId;\r\n      if(!canWrapCustomEmojis) {\r\n        richValue.entities = richValue.entities.filter((entity) => entity._ !== 'messageEntityCustomEmoji');\r\n      }\r\n\r\n      /* if(false) */ { // * fix extra new lines appearing from <p> (can have them from some sources, like macOS Terminal)\r\n        const lines = richValue.value.split('\\n');\r\n        let textLength = 0;\r\n        for(let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\r\n          const line = lines[lineIndex];\r\n          textLength += line.length;\r\n\r\n          const index = textLength;\r\n          if(plainText[index] !== '\\n' && lineIndex !== (lines.length - 1)) {\r\n            const nextLine = lines.splice(lineIndex + 1, 1)[0];\r\n            lines[lineIndex] = line + nextLine;\r\n\r\n            // fix entities\r\n            richValue.entities.forEach((entity) => {\r\n              if(entity.offset >= index) {\r\n                entity.offset -= 1;\r\n              }\r\n            });\r\n\r\n            textLength += nextLine.length;\r\n          }\r\n\r\n          textLength += 1;\r\n        }\r\n\r\n        const correctedText = lines.join('\\n');\r\n        richValue.value = correctedText;\r\n      }\r\n\r\n      const richTextLength = richValue.value.replace(/\\s/g, '').length;\r\n      const plainTextLength = plainText.replace(/\\s/g, '').length;\r\n      if(richTextLength === plainTextLength ||\r\n        richValue.entities.find((entity) => entity._ === 'messageEntityCustomEmoji')) {\r\n        text = richValue.value;\r\n        entities = richValue.entities;\r\n        usePlainText = false;\r\n\r\n        let entities2 = parseEntities(text);\r\n        entities2 = entities2.filter(filterEntity);\r\n        entities = mergeEntities(entities, entities2);\r\n      }\r\n\r\n      // console.log('usePlainText', usePlainText);\r\n    }\r\n\r\n    if(usePlainText) {\r\n      text = plainText;\r\n      entities = parseEntities(text);\r\n      entities = entities.filter(filterEntity);\r\n    }\r\n\r\n    insertRichTextAsHTML(input, text, entities, peerId);\r\n  });\r\n\r\n  init = null;\r\n};\r\n\r\n// ! it doesn't respect symbols other than strongs\r\n/* const checkAndSetRTL = (input: HTMLElement) => {\r\n  //const isEmpty = isInputEmpty(input);\r\n  //console.log('input', isEmpty);\r\n\r\n  //const char = [...getRichValue(input)][0];\r\n  const char = (input instanceof HTMLInputElement ? input.value : input.innerText)[0];\r\n  let direction = 'ltr';\r\n  if(char && checkRTL(char)) {\r\n    direction = 'rtl';\r\n  }\r\n\r\n  //console.log('RTL', direction, char);\r\n\r\n  input.style.direction = direction;\r\n}; */\r\n\r\nexport enum InputState {\r\n  Neutral = 0,\r\n  Valid = 1,\r\n  Error = 2\r\n};\r\n\r\nexport type InputFieldOptions = {\r\n  placeholder?: LangPackKey,\r\n  placeholderAsElement?: boolean,\r\n  label?: LangPackKey,\r\n  labelOptions?: any[],\r\n  labelText?: string | DocumentFragment,\r\n  name?: string,\r\n  maxLength?: number,\r\n  showLengthOn?: number,\r\n  plainText?: true,\r\n  required?: boolean,\r\n  canBeEdited?: boolean,\r\n  validate?: () => boolean,\r\n  inputMode?: 'tel' | 'numeric',\r\n  withLinebreaks?: boolean,\r\n  autocomplete?: string,\r\n  withBorder?: boolean,\r\n  allowStartingSpace?: boolean,\r\n  onRawInput?: (value: string) => void,\r\n  canHaveFormatting?: Array<MarkupTooltipTypes>\r\n};\r\n\r\nfunction createCustomEmojiRendererForInput(textColor?: string, animationGroup?: AnimationItemGroup) {\r\n  const renderer = CustomEmojiRendererElement.create({\r\n    wrappingDraft: true,\r\n    isSelectable: true,\r\n    textColor: textColor || 'primary-text-color',\r\n    animationGroup\r\n  });\r\n\r\n  return renderer;\r\n}\r\n\r\nfunction processCustomEmojisInInput(input: HTMLElement) {\r\n  const customEmojiElements = Array.from(input.querySelectorAll<CustomEmojiElement | HTMLElement>('.custom-emoji, .custom-emoji-placeholder'));\r\n  let renderer = input.querySelector<CustomEmojiRendererElement>('.custom-emoji-renderer');\r\n  if(!renderer && customEmojiElements.length) {\r\n    renderer = createCustomEmojiRendererForInput(input.dataset.textColor, input.dataset.animationGroup as AnimationItemGroup);\r\n    input.prepend(renderer);\r\n  } else if(renderer && !customEmojiElements.length) {\r\n    renderer.remove();\r\n    return;\r\n  }\r\n\r\n  if(!renderer) {\r\n    return;\r\n  }\r\n\r\n  const customEmojis: Parameters<CustomEmojiRendererElement['add']>[0]['addCustomEmojis'] = new Map();\r\n  customEmojiElements.forEach((element) => {\r\n    const customEmojiElement: CustomEmojiElement = (element as CustomEmojiElement).loop !== undefined ? element as CustomEmojiElement : (element as any).customEmojiElement as CustomEmojiElement;\r\n    const {docId} = customEmojiElement;\r\n    let set = customEmojis.get(docId);\r\n    if(!set) {\r\n      customEmojis.set(docId, set = new Set());\r\n    }\r\n\r\n    set.add(customEmojiElement);\r\n  });\r\n\r\n  for(const [docId, customEmojiElements] of customEmojis) {\r\n    let hasSet = renderer.customEmojis.get(docId);\r\n    if(hasSet) {\r\n      for(const customEmojiElement of hasSet) {\r\n        if(!customEmojiElements.has(customEmojiElement)) {\r\n          customEmojiElement.destroy();\r\n        }\r\n      }\r\n    } else {\r\n      hasSet = new Set();\r\n    }\r\n\r\n    for(const customEmojiElement of customEmojiElements) {\r\n      if(!hasSet.has(customEmojiElement)) {\r\n        customEmojiElement.connectedCallback();\r\n      }\r\n    }\r\n  }\r\n\r\n  renderer.add({\r\n    addCustomEmojis: customEmojis,\r\n    lazyLoadQueue: false\r\n  });\r\n  renderer.forceRender();\r\n}\r\n\r\nexport default class InputField {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public label: HTMLLabelElement;\r\n  public placeholder: HTMLElement;\r\n\r\n  public originalValue: string;\r\n\r\n  public required: boolean;\r\n  public validate: () => boolean;\r\n\r\n  public allowStartingSpace: boolean;\r\n\r\n  constructor(public options: InputFieldOptions = {}) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('input-field');\r\n\r\n    this.required = options.required;\r\n    this.validate = options.validate;\r\n\r\n    if(options.maxLength !== undefined && options.showLengthOn === undefined) {\r\n      options.showLengthOn = Math.min(40, Math.round(options.maxLength / 3));\r\n    }\r\n\r\n    const {placeholder, maxLength, showLengthOn, name, plainText, canBeEdited = true, autocomplete, withBorder, allowStartingSpace, canHaveFormatting} = options;\r\n    const label = options.label || options.labelText;\r\n    this.allowStartingSpace = allowStartingSpace;\r\n\r\n    const onInputCallbacks: Array<() => void> = [];\r\n    let input: HTMLElement;\r\n    if(!plainText) {\r\n      if(init) {\r\n        init();\r\n      }\r\n\r\n      this.container.innerHTML = `<div class=\"input-field-input\"></div>`;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      input.contentEditable = '' + !!canBeEdited;\r\n      // const observer = new MutationObserver(() => {\r\n      //   //checkAndSetRTL(input);\r\n\r\n      //   if(processInput) {\r\n      //     processInput();\r\n      //   }\r\n      // });\r\n\r\n      RichInputHandler.getInstance();\r\n\r\n      input.addEventListener('mousedown', (e) => {\r\n        const selection = document.getSelection();\r\n        if(!selection.isCollapsed) {\r\n          return;\r\n        }\r\n\r\n        const placeholder = findUpTag(e.target, 'IMG');\r\n        if(!placeholder) {\r\n          return;\r\n        }\r\n\r\n        const rect = placeholder.getBoundingClientRect();\r\n        const centerX = rect.left + rect.width / 2;\r\n        const focusOnNext = e.clientX >= centerX;\r\n\r\n        const range = document.createRange();\r\n        range.setStartAfter(focusOnNext ? placeholder : placeholder.previousSibling ?? placeholder);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      });\r\n\r\n      if(canHaveFormatting) {\r\n        input.setAttribute('can-format', canHaveFormatting.join(','));\r\n      }\r\n\r\n      onInputCallbacks.push(() => {\r\n        // console.log('input');\r\n        // return;\r\n        // * because if delete all characters there will br left\r\n        const isEmpty = this.isEmpty();\r\n        if(isEmpty) {\r\n          // const textNode = Array.from(input.childNodes).find((node) => node.nodeType === node.TEXT_NODE) || document.createTextNode('');\r\n          input.replaceChildren();\r\n          // input.append(document.createTextNode('')); // need first text node to support history stack\r\n        }\r\n\r\n        this.setEmpty(isEmpty);\r\n\r\n        // const fillers = Array.from(input.querySelectorAll('.emoji-filler')) as HTMLElement[];\r\n        // fillers.forEach((filler) => {\r\n        //   const textContent = filler.textContent;\r\n        //   if(textContent === BOM) {\r\n        //     return;\r\n        //   }\r\n\r\n        //   if(textContent) {\r\n\r\n        //   } else {\r\n        //     let curChild = filler.firstChild;\r\n        //     while(curChild) {\r\n        //       curChild = curChild.nextSibling;\r\n        //     }\r\n        //   }\r\n\r\n        //   filler.classList.remove('emoji-filler');\r\n        // });\r\n\r\n        // Array.from(input.querySelectorAll('br, span:empty')).forEach((el) => {\r\n        //   const parentElement = el.parentElement;\r\n        //   (parentElement === input ? el : parentElement).remove();\r\n        // });\r\n        USING_BOMS && Array.from(input.querySelectorAll('br:not(.br-not-br)')).forEach((el) => {\r\n          // const parentElement = el.parentElement;\r\n          el.remove();\r\n          // if(!parentElement.children.length && !parentElement.textContent) {\r\n          //   parentElement.textContent = '';\r\n          // }\r\n        });\r\n\r\n        insertCustomFillers(Array.from(input.querySelectorAll('.input-something')));\r\n\r\n        processCustomEmojisInInput(input);\r\n\r\n        // .forEach((el) => el.remove());\r\n      });\r\n\r\n      // ! childList for paste first symbol\r\n      // observer.observe(input, {characterData: true, childList: true, subtree: true});\r\n    } else {\r\n      this.container.innerHTML = `\r\n      <input type=\"text\" ${name ? `name=\"${name}\"` : ''} autocomplete=\"${autocomplete ?? 'off'}\" ${label ? 'required=\"\"' : ''} class=\"input-field-input\">\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // input.addEventListener('input', () => checkAndSetRTL(input));\r\n\r\n      onInputCallbacks.push(() => {\r\n        const isEmpty = this.isEmpty();\r\n        if(isEmpty) {\r\n          (input as HTMLInputElement).value = '';\r\n        }\r\n\r\n        this.setEmpty(isEmpty);\r\n      });\r\n    }\r\n\r\n    setDirection(input);\r\n\r\n    if(options.inputMode) {\r\n      input.inputMode = options.inputMode;\r\n    }\r\n\r\n    if(placeholder) {\r\n      // if(options.placeholderAsElement) {\r\n      this.placeholder = document.createElement('span');\r\n      this.placeholder.classList.add('input-field-placeholder');\r\n      this.container.append(this.placeholder);\r\n      _i18n(this.placeholder, placeholder, undefined);\r\n      // } else {\r\n      //   _i18n(input, placeholder, undefined, 'placeholder');\r\n      // }\r\n    }\r\n\r\n    if(withBorder !== false && withBorder || label || placeholder) {\r\n      const border = document.createElement('div');\r\n      border.classList.add('input-field-border');\r\n      this.container.append(border);\r\n    }\r\n\r\n    if(label) {\r\n      this.label = document.createElement('label');\r\n      this.setLabel();\r\n      this.container.append(this.label);\r\n    }\r\n\r\n    if(maxLength) {\r\n      const labelEl = this.container.lastElementChild as HTMLLabelElement;\r\n      let showingLength = false;\r\n\r\n      const onInput = () => {\r\n        const wasError = input.classList.contains('error');\r\n        // * https://stackoverflow.com/a/54369605 #2 to count emoji as 1 symbol\r\n        const inputLength = plainText ? (input as HTMLInputElement).value.length : [...getRichValueWithCaret(input, false, false).value].length;\r\n        const diff = maxLength - inputLength;\r\n        const isError = diff < 0;\r\n        input.classList.toggle('error', isError);\r\n\r\n        // this.onLengthChange && this.onLengthChange(inputLength, isError);\r\n\r\n        if(isError || diff <= showLengthOn) {\r\n          this.setLabel();\r\n          labelEl.append(` (${maxLength - inputLength})`);\r\n          if(!showingLength) showingLength = true;\r\n        } else if((wasError && !isError) || showingLength) {\r\n          this.setLabel();\r\n          showingLength = false;\r\n        }\r\n      };\r\n\r\n      onInputCallbacks.push(onInput);\r\n    }\r\n\r\n    const noLinebreaks = !options.withLinebreaks;\r\n    if(noLinebreaks && !plainText) {\r\n      input.dataset.noLinebreaks = '1';\r\n      input.addEventListener('keypress', (e) => {\r\n        if(e.key === 'Enter') {\r\n          e.preventDefault();\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n\r\n    if(options.onRawInput) {\r\n      onInputCallbacks.push(() => {\r\n        options.onRawInput(this.value);\r\n      });\r\n    }\r\n\r\n    if(onInputCallbacks.length) {\r\n      input.addEventListener('input', () => {\r\n        onInputCallbacks.forEach((callback) => callback());\r\n      });\r\n    }\r\n\r\n    this.input = input;\r\n    this.setEmpty(true);\r\n  }\r\n\r\n  public select() {\r\n    if(!this.value) { // * avoid selecting whole empty field on iOS devices\r\n      return;\r\n    }\r\n\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).select(); // * select text\r\n    } else {\r\n      selectElementContents(this.input);\r\n    }\r\n  }\r\n\r\n  public setLabel() {\r\n    this.label.textContent = '';\r\n    if(this.options.labelText) {\r\n      setInnerHTML(this.label, this.options.labelText);\r\n    } else {\r\n      this.label.append(i18n(this.options.label, this.options.labelOptions));\r\n    }\r\n  }\r\n\r\n  get value(): string {\r\n    return this.options.plainText ? (this.input as HTMLInputElement).value : getRichValueWithCaret(this.input, false, false).value;\r\n    // return getRichValue(this.input);\r\n  }\r\n\r\n  set value(value: Parameters<typeof replaceContent>[1]) {\r\n    this.setValueSilently(value, true);\r\n    this.simulateInputEvent();\r\n  }\r\n\r\n  public simulateInputEvent() {\r\n    simulateEvent(this.input, 'input');\r\n  }\r\n\r\n  public setValueSilently(value: Parameters<typeof replaceContent>[1], fromSet?: boolean) {\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).value = value as string;\r\n    } else {\r\n      replaceContent(this.input, value);\r\n      processCustomEmojisInInput(this.input);\r\n    }\r\n\r\n    this.setEmpty();\r\n  }\r\n\r\n  private setEmpty = (empty = this.isEmpty()) => {\r\n    [this.input, this.placeholder].filter(Boolean).forEach((el) => {\r\n      el.classList.toggle('is-empty', empty);\r\n    });\r\n  };\r\n\r\n  public isEmpty() {\r\n    return isInputEmpty(this.input, this.allowStartingSpace);\r\n  }\r\n\r\n  public isChanged() {\r\n    return this.value !== this.originalValue;\r\n  }\r\n\r\n  public isValid() {\r\n    return !this.input.classList.contains('error') &&\r\n      (!this.validate || this.validate()) &&\r\n      (!this.required || !this.isEmpty());\r\n  }\r\n\r\n  public isValidToChange() {\r\n    return this.isValid() && this.isChanged();\r\n  }\r\n\r\n  public setDraftValue(value = '', silent?: boolean) {\r\n    let _value: Parameters<typeof replaceContent>[1] = value;\r\n    if(!this.options.plainText) {\r\n      _value = /* documentFragmentToHTML */(wrapDraftText(value));\r\n    }\r\n\r\n    if(silent) {\r\n      this.setValueSilently(_value, false);\r\n    } else {\r\n      this.value = _value;\r\n    }\r\n  }\r\n\r\n  public setOriginalValue(value: InputField['originalValue'] = '', silent?: boolean) {\r\n    this.originalValue = value;\r\n    this.setDraftValue(value, silent);\r\n  }\r\n\r\n  public setState(state: InputState, label?: LangPackKey) {\r\n    if(label) {\r\n      this.label.textContent = '';\r\n      this.label.append(i18n(label, this.options.labelOptions));\r\n    } else {\r\n      this.setLabel();\r\n    }\r\n\r\n    this.input.classList.toggle('error', !!(state & InputState.Error));\r\n    this.input.classList.toggle('valid', !!(state & InputState.Valid));\r\n  }\r\n\r\n  public setError(label?: LangPackKey) {\r\n    this.setState(InputState.Error, label);\r\n  }\r\n\r\n  public toggleForceFocus(enabled: boolean) {\r\n    this.input.classList.toggle('force-focus', enabled)\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport Icon from './icon';\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport class PasswordInputHelpers {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(public container: HTMLElement, public input: HTMLInputElement) {\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.name = 'notsearch_password';\r\n    input.autocomplete = 'off';\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    /* if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      input.setAttribute('readonly', '');\r\n      input.addEventListener('focus', () => {\r\n        input.removeAttribute('readonly');\r\n      }, {once: true});\r\n    } */\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible');\r\n    toggleVisible.append(Icon('eye1'));\r\n\r\n    container.classList.add('input-field-password');\r\n    container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.replaceChildren(Icon(this.passwordVisible ? 'eye2' : 'eye1'));\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional?.();\r\n  };\r\n}\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public helpers: PasswordInputHelpers;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      allowStartingSpace: true,\r\n      ...options\r\n    });\r\n\r\n    this.helpers = new PasswordInputHelpers(this.container, this.input as HTMLInputElement);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, {LottieLoader} from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport PasswordInputField from '../passwordInputField';\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    // }, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then((_animation) => {\r\n    }, 'TwoFactorSetupMonkeyPeek').then((_animation) => {\r\n      // return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', (currentFrame) => {\r\n        // console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n          this.animation.setSpeed(1);\r\n          this.animation.pause();\r\n        }\r\n      });\r\n\r\n      this.passwordInputField.helpers.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.helpers.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","import {createEffect, mergeProps, on, splitProps} from 'solid-js';\r\n\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport {InstanceOf} from '../types';\r\n\r\nimport InputField, {InputFieldOptions, InputState} from './inputField';\r\n\r\nexport interface InputFieldTsxProps<T extends typeof InputField> extends InputFieldOptions {\r\n  InputFieldClass?: T\r\n\r\n  instanceRef?: (value: InstanceOf<T>) => void\r\n\r\n  class?: string\r\n  value?: string\r\n  onRawInput?: (value: string) => void\r\n  errorLabel?: LangPackKey\r\n}\r\n\r\nexport const InputFieldTsx = <T extends typeof InputField>(inProps: InputFieldTsxProps<T>) => {\r\n  const props = mergeProps({InputFieldClass: InputField}, inProps);\r\n\r\n  const [, options] = splitProps(props, ['class', 'value', 'InputFieldClass', 'errorLabel'])\r\n\r\n  const obj = new props.InputFieldClass(options)\r\n  props.instanceRef?.(obj as InstanceOf<T>)\r\n\r\n  createEffect(on(\r\n    () => props.class,\r\n    (value, prev) => {\r\n      obj.container.classList.remove(prev)\r\n      obj.container.classList.add(value)\r\n    }\r\n  ))\r\n\r\n  createEffect(on(\r\n    () => props.errorLabel,\r\n    (value, prev) => {\r\n      if(!value && !prev) return // Prevent setting error first render\r\n\r\n      if(value) obj.setError(value)\r\n      else obj.setState(InputState.Neutral)\r\n    }\r\n  ))\r\n\r\n  createEffect(on(\r\n    () => props.value,\r\n    (value) => {\r\n      if(value !== obj.value) {\r\n        obj.value = value\r\n      }\r\n    }\r\n  ))\r\n\r\n  return obj.container\r\n}\r\n","import {createContext, useContext} from 'solid-js';\r\n\r\n/**\r\n * `import type` is mandatory to avoid reloading the page (not really 😀, vite handles it even without the `import type`)\r\n */\r\n\r\nimport type AppChatFoldersTab from '../../components/sidebarLeft/tabs/chatFolders';\r\nimport type AppEditFolderTab from '../../components/sidebarLeft/tabs/editFolder';\r\nimport type wrapStickerSetThumb from '../../components/wrappers/stickerSetThumb';\r\nimport type EmoticonsSearch from '../../components/emoticonsDropdown/search';\r\nimport type PasswordInputField from '../../components/passwordInputField';\r\nimport type {ThemeController} from '../../helpers/themeController';\r\nimport type {InputFieldTsx} from '../../components/inputFieldTsx';\r\nimport type {AppSidebarLeft} from '../../components/sidebarLeft';\r\nimport type showLimitPopup from '../../components/popups/limit';\r\nimport type PasswordMonkey from '../../components/monkeys/password';\r\nimport type {setQuizHint} from '../../components/poll';\r\n\r\nimport type {AppImManager} from '../appManagers/appImManager';\r\nimport type apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport type lottieLoader from '../rlottie/lottieLoader';\r\nimport type {RootScope} from '../rootScope';\r\n\r\nexport type SolidJSHotReloadGuardContextValue = {\r\n  rootScope: RootScope;\r\n  appSidebarLeft: AppSidebarLeft;\r\n  AppChatFoldersTab: typeof AppChatFoldersTab;\r\n  AppEditFolderTab: typeof AppEditFolderTab;\r\n  EmoticonsSearch: typeof EmoticonsSearch;\r\n  wrapStickerSetThumb: typeof wrapStickerSetThumb;\r\n  showLimitPopup: typeof showLimitPopup;\r\n  lottieLoader: typeof lottieLoader;\r\n  themeController: ThemeController;\r\n  appImManager: AppImManager;\r\n  apiManagerProxy: typeof apiManagerProxy;\r\n  setQuizHint: typeof setQuizHint;\r\n  PasswordInputField: typeof PasswordInputField;\r\n  InputFieldTsx: typeof InputFieldTsx;\r\n  PasswordMonkey: typeof PasswordMonkey;\r\n};\r\n\r\nexport type LockScreenHotReloadGuardContextValue = Pick<\r\n  SolidJSHotReloadGuardContextValue,\r\n  | 'rootScope'\r\n  | 'apiManagerProxy'\r\n  | 'themeController'\r\n  | 'InputFieldTsx'\r\n  | 'PasswordInputField'\r\n  | 'PasswordMonkey'\r\n>;\r\n\r\nexport const SolidJSHotReloadGuardContext = createContext<SolidJSHotReloadGuardContextValue>(null);\r\nexport const LockScreenHotReloadGuardContext = createContext<LockScreenHotReloadGuardContextValue>(null);\r\n\r\n/**\r\n * If importing a module causes the page to reload when you make changes in your SolidJS component\r\n * provide the values through the SolidJSHotReloadGuardProvider\r\n */\r\nexport function useHotReloadGuard() {\r\n  const contextValue = useContext(SolidJSHotReloadGuardContext);\r\n  if(!contextValue) throw new Error('useHotReloadGuard should not be used outside a <SolidJSHotReloadGuardProvider />');\r\n\r\n  return contextValue;\r\n}\r\n\r\nexport function useLockScreenHotReloadGuard() {\r\n  const contextValue = useContext(LockScreenHotReloadGuardContext) || useContext(SolidJSHotReloadGuardContext);\r\n  if(!contextValue) throw new Error('useLockScreenHotReloadGuard should not be used outside a <LockScreenHotReloadGuardProvider />');\r\n\r\n  return contextValue;\r\n}\r\n","import {ParentProps} from 'solid-js';\r\n\r\nimport PasswordInputField from '../../components/passwordInputField';\r\nimport PasswordMonkey from '../../components/monkeys/password';\r\nimport {InputFieldTsx} from '../../components/inputFieldTsx';\r\nimport themeController from '../../helpers/themeController';\r\n\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport rootScope from '../rootScope';\r\n\r\nimport {LockScreenHotReloadGuardContext} from './hotReloadGuard';\r\n\r\n\r\nexport default function LockScreenHotReloadGuardProvider(props: ParentProps) {\r\n  return (\r\n    <LockScreenHotReloadGuardContext.Provider value={{\r\n      rootScope,\r\n      themeController,\r\n      apiManagerProxy,\r\n      InputFieldTsx,\r\n      PasswordInputField,\r\n      PasswordMonkey\r\n    }}>\r\n      {props.children}\r\n    </LockScreenHotReloadGuardContext.Provider>\r\n  );\r\n}\r\n","import {render} from 'solid-js/web';\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport deferredPromise from '../../helpers/cancellablePromise';\r\nimport {doubleRaf} from '../../helpers/schedulers';\r\nimport LockScreenHotReloadGuardProvider from '../../lib/solidjs/lockScreenHotReloadGuardProvider';\r\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\r\nimport StaticUtilityClass from '../../lib/staticUtilityClass';\r\nimport sessionStorage from '../../lib/sessionStorage';\r\nimport EncryptionKeyStore from '../../lib/passcode/keyStore';\r\nimport appNavigationController from '../appNavigationController';\r\n\r\n\r\nexport default class PasscodeLockScreenController extends StaticUtilityClass {\r\n  private static mountedElement: HTMLDivElement;\r\n  private static dispose?: () => void;\r\n\r\n  private static appStartupDeferred = deferredPromise<void>();\r\n\r\n  private static isLocked?: boolean;\r\n  private static savedHash: string = '';\r\n\r\n  public static getIsLocked() {\r\n    return this.isLocked;\r\n  }\r\n\r\n  private static async tryGetStoredEncryptionHash() {\r\n    const storedBase64Key = await sessionStorage.get('encryption_key');\r\n\r\n    if(storedBase64Key) {\r\n      sessionStorage.delete('encryption_key');\r\n\r\n      const isValid = typeof storedBase64Key === 'string'; // storedEncryptionHash instanceof Array && storedEncryptionHash.every((num) => typeof num === 'number');\r\n      if(!isValid) return false;\r\n\r\n      const keyAsBuffer = new Uint8Array(atob(storedBase64Key).split('').map(c => c.charCodeAt(0)));\r\n      const importedKey =  await crypto.subtle.importKey(\r\n        'raw',\r\n        keyAsBuffer,\r\n        {name: 'AES-GCM'},\r\n        true,\r\n        ['encrypt', 'decrypt']\r\n      );\r\n\r\n      await apiManagerProxy.invoke('saveEncryptionKey', importedKey);\r\n      EncryptionKeyStore.save(importedKey);\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  private static async checkLockState(isLockedCallback: () => Promise<void>) {\r\n    const hasStoredEncryptionHash = await this.tryGetStoredEncryptionHash();\r\n\r\n    const isLocked = hasStoredEncryptionHash ?\r\n      false :\r\n      await apiManagerProxy.invoke('isLocked', undefined);\r\n\r\n    this.isLocked = isLocked;\r\n\r\n    if(isLocked) {\r\n      await isLockedCallback();\r\n      await this.lock();\r\n    } else {\r\n      this.appStartupDeferred.resolve();\r\n      this.appStartupDeferred = undefined;\r\n    }\r\n  }\r\n\r\n  public static async waitForUnlock(isLockedCallback: () => Promise<void>) {\r\n    this.checkLockState(isLockedCallback);\r\n    await this.appStartupDeferred;\r\n    this.isLocked = false;\r\n  }\r\n\r\n  public static async lockOtherTabs() {\r\n    await apiManagerProxy.invoke('toggleLockOthers', true);\r\n  }\r\n\r\n  public static async lock(fromLockIcon?: HTMLElement | boolean, onAnimationEnd?: () => void) {\r\n    if(this.mountedElement) return;\r\n\r\n    this.isLocked = true;\r\n\r\n    if(this.appStartupDeferred) {\r\n      this.savedHash = window.location.hash;\r\n      window.location.hash = '';\r\n    }\r\n\r\n    const shouldAnimateIn = !!fromLockIcon;\r\n\r\n    const importPasscodeLockScreen = () => import('./passcodeLockScreen');\r\n\r\n    await Promise.race([pause(100), importPasscodeLockScreen()]);\r\n\r\n    this.mountedElement = document.createElement('div');\r\n    this.mountedElement.classList.add('passcode-lock-screen');\r\n\r\n\r\n    const clonedLockIcon = fromLockIcon instanceof HTMLElement ? this.cloneLockIcon(fromLockIcon) : undefined;\r\n    if(clonedLockIcon) this.mountedElement.append(clonedLockIcon);\r\n\r\n    if(shouldAnimateIn) {\r\n      this.mountedElement.classList.add('passcode-lock-screen--hidden');\r\n    }\r\n    document.body.append(this.mountedElement);\r\n\r\n    const {default: PasscodeLockScreen} = await importPasscodeLockScreen();\r\n\r\n    this.dispose = render(() => (\r\n      <LockScreenHotReloadGuardProvider>\r\n        <PasscodeLockScreen\r\n          onUnlock={() => this.unlock()}\r\n          fromLockIcon={clonedLockIcon}\r\n          onAnimationEnd={onAnimationEnd}\r\n        />\r\n      </LockScreenHotReloadGuardProvider>\r\n    ), this.mountedElement);\r\n\r\n    if(shouldAnimateIn) {\r\n      doubleRaf().then(async() => {\r\n        this.mountedElement.classList.remove('passcode-lock-screen--hidden');\r\n\r\n        if(!clonedLockIcon) pause(200).then(() => {\r\n          onAnimationEnd();\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  private static cloneLockIcon(icon?: HTMLElement) {\r\n    const clonedLockIcon = icon.cloneNode(true) as HTMLElement;\r\n    clonedLockIcon.classList.add('passcode-lock-screen__animated-lock-icon');\r\n\r\n    const rect = icon.getBoundingClientRect();\r\n\r\n    clonedLockIcon.style.setProperty('--x', (rect.left + rect.width / 2) + 'px');\r\n    clonedLockIcon.style.setProperty('--y', (rect.top + rect.height / 2) + 'px');\r\n\r\n    return clonedLockIcon;\r\n  }\r\n\r\n  public static unlock() {\r\n    const element = this.mountedElement;\r\n    this.mountedElement = undefined;\r\n\r\n    this.isLocked = false;\r\n    if(this.savedHash) {\r\n      // window.location.hash = this.savedHash;\r\n      appNavigationController.overrideHash(this.savedHash)\r\n      appNavigationController.replaceState();\r\n    }\r\n\r\n    if(element) (async() => {\r\n      element.style.setProperty('transition-time', '.12s');\r\n      await pause(120);\r\n\r\n      const next = async() => {\r\n        await pause(250);\r\n        element.classList.add('passcode-lock-screen--hidden');\r\n        await pause(120);\r\n\r\n        this.dispose?.();\r\n        element?.remove();\r\n      };\r\n\r\n      if(document.startViewTransition) document.startViewTransition(next);\r\n      else next();\r\n    })();\r\n\r\n    this.appStartupDeferred?.resolve();\r\n    this.appStartupDeferred = undefined;\r\n  }\r\n}\r\n\r\nMOUNT_CLASS_TO['PasscodeLockScreenControler'] = PasscodeLockScreenController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {Awaited} from '../../types';\r\nimport {type State} from '../../config/state';\r\nimport type {Chat, ChatPhoto, Message, MessagePeerReaction, PeerNotifySettings, User, UserProfilePhoto} from '../../layer';\r\nimport type {CryptoMethods} from '../crypto/crypto_methods';\r\nimport type {ThumbStorageMedia} from '../storages/thumbs';\r\nimport type ThumbsStorage from '../storages/thumbs';\r\nimport type {AppReactionsManager} from '../appManagers/appReactionsManager';\r\nimport type {MessagesStorageKey} from '../appManagers/appMessagesManager';\r\nimport type {AppAvatarsManager, PeerPhotoSize} from '../appManagers/appAvatarsManager';\r\nimport rootScope, {BroadcastEvents} from '../rootScope';\r\nimport webpWorkerController from '../webp/webpWorkerController';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport sessionStorage from '../sessionStorage';\r\nimport webPushApiManager from './webPushApiManager';\r\nimport appRuntimeManager from '../appManagers/appRuntimeManager';\r\nimport telegramMeWebManager from './telegramMeWebManager';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport ENVIRONMENT from '../../environment';\r\nimport loadStateForAllAccountsOnce from '../appManagers/utils/state/loadState';\r\nimport opusDecodeController from '../opusDecodeController';\r\nimport MTProtoMessagePort from './mtprotoMessagePort';\r\nimport cryptoMessagePort from '../crypto/cryptoMessagePort';\r\nimport SuperMessagePort from './superMessagePort';\r\nimport IS_SHARED_WORKER_SUPPORTED from '../../environment/sharedWorkerSupport';\r\nimport toggleStorages from '../../helpers/toggleStorages';\r\nimport idleController from '../../helpers/idleController';\r\nimport ServiceMessagePort from '../serviceWorker/serviceMessagePort';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {makeWorkerURL} from '../../helpers/setWorkerProxy';\r\nimport ServiceWorkerURL from '../../../sw?worker&url';\r\nimport setDeepProperty, {joinDeepPath, splitDeepPath} from '../../helpers/object/setDeepProperty';\r\nimport getThumbKey from '../storages/utils/thumbs/getThumbKey';\r\nimport {NULL_PEER_ID, TEST_NO_STREAMING, THUMB_TYPE_FULL} from './mtproto_config';\r\nimport generateEmptyThumb from '../storages/utils/thumbs/generateEmptyThumb';\r\nimport getStickerThumbKey from '../storages/utils/thumbs/getStickerThumbKey';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport isLegacyMessageId from '../appManagers/utils/messageId/isLegacyMessageId';\r\nimport {MTAppConfig} from './appConfig';\r\nimport {setAppStateSilent} from '../../stores/appState';\r\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\r\nimport {reconcilePeer, reconcilePeers} from '../../stores/peers';\r\nimport {getCurrentAccount} from '../accounts/getCurrentAccount';\r\nimport {ActiveAccountNumber} from '../accounts/types';\r\nimport {createProxiedManagersForAccount} from '../appManagers/getProxiedManagers';\r\nimport noop from '../../helpers/noop';\r\nimport AccountController from '../accounts/accountController';\r\nimport getPeerTitle from '../../components/wrappers/getPeerTitle';\r\nimport I18n from '../langPack';\r\nimport {NOTIFICATION_BADGE_PATH} from '../../config/notifications';\r\nimport {createAppURLForAccount} from '../accounts/createAppURLForAccount';\r\nimport {appSettings, setAppSettingsSilent} from '../../stores/appSettings';\r\nimport {unwrap} from 'solid-js/store';\r\nimport createNotificationImage from '../../helpers/createNotificationImage';\r\nimport PasscodeLockScreenController from '../../components/passcodeLock/passcodeLockScreenController';\r\nimport EncryptionKeyStore from '../passcode/keyStore';\r\nimport DeferredIsUsingPasscode from '../passcode/deferredIsUsingPasscode';\r\nimport CacheStorageController from '../files/cacheStorage';\r\n\r\n\r\nexport type Mirrors = {\r\n  state: State,\r\n  thumbs: ThumbsStorage['thumbsCache'],\r\n  stickerThumbs: ThumbsStorage['stickerCachedThumbs'],\r\n  availableReactions: AppReactionsManager['availableReactions'] | Promise<AppReactionsManager['availableReactions']>,\r\n  messages: {\r\n    [type in string]: {\r\n      [mid in number]: Message.message | Message.messageService\r\n    }\r\n  },\r\n  groupedMessages: {\r\n    [groupedId in string]: Map<number, Message.message | Message.messageService>\r\n  },\r\n  peers: {\r\n    [peerId in PeerId]: Exclude<Chat, Chat.chatEmpty> | User.user\r\n  },\r\n  avatars: AppAvatarsManager['savedAvatarURLs']\r\n};\r\n\r\nexport type MirrorTaskPayload<\r\n  T extends keyof Mirrors = keyof Mirrors\r\n  // K extends keyof Mirrors[T] = keyof Mirrors[T],\r\n  // J extends Mirrors[T][K] = Mirrors[T][K]\r\n> = {\r\n  name: T,\r\n  // key?: K,\r\n  key?: string,\r\n  value?: any,\r\n  accountNumber: ActiveAccountNumber\r\n};\r\n\r\nexport type NotificationBuildTaskPayload = {\r\n  message: Message.message | Message.messageService,\r\n  fwdCount?: number,\r\n  peerReaction?: MessagePeerReaction,\r\n  peerTypeNotifySettings?: PeerNotifySettings,\r\n  accountNumber?: ActiveAccountNumber,\r\n  isOtherTabActive?: boolean\r\n};\r\n\r\nexport type TabState = {\r\n  chatPeerIds: PeerId[],\r\n  idleStartTime: number,\r\n  accountNumber: number\r\n};\r\n\r\nclass ApiManagerProxy extends MTProtoMessagePort {\r\n  // private worker: /* Window */Worker;\r\n  // private sockets: Map<number, Socket> = new Map();\r\n  private mirrors: Mirrors;\r\n\r\n  public newVersion: string;\r\n  public oldVersion: string;\r\n\r\n  private tabState: TabState;\r\n  private allTabStates: TabState[];\r\n\r\n  public share: ShareData;\r\n\r\n  public serviceMessagePort: ServiceMessagePort<true>;\r\n  private lastServiceWorker: ServiceWorker;\r\n\r\n  private pingServiceWorkerPromise: CancellablePromise<void>;\r\n\r\n  private processMirrorTaskMap: {\r\n    [type in keyof Mirrors]?: (payload: MirrorTaskPayload) => void\r\n  };\r\n\r\n  private appConfig: MaybePromise<MTAppConfig>;\r\n\r\n  private closeMTProtoWorker = noop;\r\n\r\n  private intervals: Map<number, () => any>;\r\n\r\n  private serviceWorkerRegistration: ServiceWorkerRegistration;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.mirrors = {\r\n      state: undefined,\r\n      thumbs: {},\r\n      stickerThumbs: {},\r\n      availableReactions: undefined,\r\n      messages: {},\r\n      groupedMessages: {},\r\n      peers: {},\r\n      avatars: {}\r\n    };\r\n\r\n    this.processMirrorTaskMap = {\r\n      messages: (payload) => {\r\n        if(!payload.key) { // * mirroring all messages at once\r\n          for(const key in payload.value) {\r\n            for(const mid in payload.value[key]) {\r\n              this.processMirrorTaskMap.messages({\r\n                name: payload.name,\r\n                accountNumber: payload.accountNumber,\r\n                key: joinDeepPath(key, mid),\r\n                value: payload.value[key][mid] as any\r\n              });\r\n            }\r\n          }\r\n\r\n          return;\r\n        }\r\n\r\n        const message = payload.value as Message.message | Message.messageService;\r\n        let mid: number, groupedId: string;\r\n        if(message) {\r\n          mid = message.mid;\r\n          groupedId = (message as Message.message).grouped_id;\r\n        } else {\r\n          const [key, _mid] = splitDeepPath(payload.key);\r\n          mid = +_mid;\r\n          const previousMessage = this.mirrors.messages[key]?.[mid];\r\n          if(!previousMessage) {\r\n            return;\r\n          }\r\n\r\n          groupedId = (previousMessage as Message.message).grouped_id;\r\n        }\r\n\r\n        if(!groupedId) {\r\n          return;\r\n        }\r\n\r\n        const map = this.mirrors.groupedMessages[groupedId] ??= new Map();\r\n        if(!message) {\r\n          map.delete(mid);\r\n\r\n          if(!map.size) {\r\n            delete this.mirrors.groupedMessages[groupedId];\r\n          }\r\n        } else {\r\n          map.set(mid, message);\r\n        }\r\n      },\r\n\r\n      state: (payload) => {\r\n        if(payload.key) {\r\n          setAppStateSilent(payload.key, payload.value);\r\n        } else {\r\n          console.error(payload);\r\n        }\r\n      },\r\n\r\n      peers: (payload) => {\r\n        if(payload.key) {\r\n          reconcilePeer(payload.key.toPeerId(), payload.value as any);\r\n        } else {\r\n          reconcilePeers(payload.value);\r\n        }\r\n      }\r\n    };\r\n\r\n    this.tabState = {\r\n      accountNumber: getCurrentAccount(),\r\n      chatPeerIds: [],\r\n      idleStartTime: 0\r\n    };\r\n\r\n    this.intervals = new Map();\r\n\r\n    this.log('constructor');\r\n\r\n    if(!import.meta.env.VITE_MTPROTO_SW) {\r\n      this.registerWorker();\r\n    }\r\n\r\n    this.registerServiceWorker();\r\n    this.registerCryptoWorker();\r\n\r\n    const commonEventNames = new Set<keyof BroadcastEvents>([\r\n      'language_change',\r\n      'settings_updated',\r\n      'theme_changed',\r\n      'theme_change',\r\n      'background_change',\r\n      'logging_out',\r\n      'notification_count_update',\r\n      'account_logged_in',\r\n      'notification_cancel',\r\n      'toggle_using_passcode',\r\n      'toggle_locked'\r\n    ]);\r\n\r\n    // const perf = performance.now();\r\n    this.addMultipleEventsListeners({\r\n      convertWebp: ({fileName, bytes}) => {\r\n        return webpWorkerController.convert(fileName, bytes);\r\n      },\r\n\r\n      convertOpus: ({fileName, bytes}) => {\r\n        return opusDecodeController.pushDecodeTask(bytes, false).then((result) => result.bytes);\r\n      },\r\n\r\n      event: ({name, args, accountNumber}) => {\r\n        const isDifferentAccount = accountNumber && accountNumber !== getCurrentAccount();\r\n        if(!commonEventNames.has(name as keyof BroadcastEvents) && isDifferentAccount) return;\r\n        // @ts-ignore\r\n        rootScope.dispatchEventSingle(name, ...args);\r\n      },\r\n\r\n      localStorageProxy: (payload) => {\r\n        return sessionStorage.localStorageProxy(payload.type, ...payload.args);\r\n      },\r\n\r\n      mirror: this.onMirrorTask,\r\n\r\n      receivedServiceMessagePort: () => {\r\n        this.log.warn('mtproto worker received service message port');\r\n      },\r\n\r\n      tabsUpdated: (payload) => {\r\n        this.allTabStates = payload;\r\n        rootScope.dispatchEvent('notification_count_update');\r\n      },\r\n\r\n      callNotification: async(payload) => {\r\n        const {accountNumber} = payload;\r\n        const managers = createProxiedManagersForAccount(accountNumber);\r\n        const peerId = payload.callerId.toPeerId();\r\n        const peer = await managers.appPeersManager.getPeer(peerId);\r\n        const title = await getPeerTitle({peerId: peerId, managers, plainText: true, limitSymbols: 20, useManagers: true});\r\n\r\n        const notification = new Notification(title, {\r\n          body: I18n.format('Call.StatusCalling', true),\r\n          icon: await createNotificationImage(managers, peerId, title),\r\n          badge: NOTIFICATION_BADGE_PATH\r\n        });\r\n        notification.onclick = () => {\r\n          const peerId = peer.id;\r\n          const url = createAppURLForAccount(accountNumber, {\r\n            p: '' + peerId.toPeerId(),\r\n            call: '' + payload.callId\r\n          });\r\n          window.open(url, '_blank');\r\n          notification.close();\r\n        };\r\n        setTimeout(() => {\r\n          notification.close();\r\n        }, 5_000);\r\n      },\r\n\r\n      log: (payload) => {\r\n        console.log('[SharedWorker]', payload);\r\n      },\r\n\r\n      intervalCallback: (intervalId) => {\r\n        const callback = this.intervals.get(intervalId);\r\n        if(callback) {\r\n          callback();\r\n        }\r\n      },\r\n\r\n      saveEncryptionKey: (payload) => {\r\n        EncryptionKeyStore.save(payload);\r\n      },\r\n\r\n      toggleLock: (isLocked) => {\r\n        if(isLocked) {\r\n          PasscodeLockScreenController.lock();\r\n        } else {\r\n          PasscodeLockScreenController.unlock();\r\n        }\r\n      },\r\n\r\n      toggleCacheStorage: (enabled) => {\r\n        CacheStorageController.temporarilyToggle(enabled);\r\n      },\r\n\r\n      toggleUsingPasscode: (payload) => {\r\n        DeferredIsUsingPasscode.resolveDeferred(payload.isUsingPasscode);\r\n        EncryptionKeyStore.save(payload.isUsingPasscode ? payload.encryptionKey : null);\r\n      }\r\n\r\n      // hello: () => {\r\n      //   this.log.error('time hello', performance.now() - perf);\r\n      // }\r\n    });\r\n\r\n    // this.addTaskListener('socketProxy', (task) => {\r\n    //   const socketTask = task.payload;\r\n    //   const id = socketTask.id;\r\n    //   //console.log('socketProxy', socketTask, id);\r\n\r\n    //   if(socketTask.type === 'send') {\r\n    //     const socket = this.sockets.get(id);\r\n    //     socket.send(socketTask.payload);\r\n    //   } else if(socketTask.type === 'close') { // will remove from map in onClose\r\n    //     const socket = this.sockets.get(id);\r\n    //     socket.close();\r\n    //   } else if(socketTask.type === 'setup') {\r\n    //     const socket = new Socket(socketTask.payload.dcId, socketTask.payload.url, socketTask.payload.logSuffix);\r\n\r\n    //     const onOpen = () => {\r\n    //       //console.log('socketProxy onOpen');\r\n    //       this.postMessage({\r\n    //         type: 'socketProxy',\r\n    //         payload: {\r\n    //           type: 'open',\r\n    //           id\r\n    //         }\r\n    //       });\r\n    //     };\r\n    //     const onClose = () => {\r\n    //       this.postMessage({\r\n    //         type: 'socketProxy',\r\n    //         payload: {\r\n    //           type: 'close',\r\n    //           id\r\n    //         }\r\n    //       });\r\n\r\n    //       socket.removeEventListener('open', onOpen);\r\n    //       socket.removeEventListener('close', onClose);\r\n    //       socket.removeEventListener('message', onMessage);\r\n    //       this.sockets.delete(id);\r\n    //     };\r\n    //     const onMessage = (buffer: ArrayBuffer) => {\r\n    //       this.postMessage({\r\n    //         type: 'socketProxy',\r\n    //         payload: {\r\n    //           type: 'message',\r\n    //           id,\r\n    //           payload: buffer\r\n    //         }\r\n    //       });\r\n    //     };\r\n\r\n    //     socket.addEventListener('open', onOpen);\r\n    //     socket.addEventListener('close', onClose);\r\n    //     socket.addEventListener('message', onMessage);\r\n    //     this.sockets.set(id, socket);\r\n    //   }\r\n    // });\r\n\r\n    rootScope.addEventListener('language_change', (language) => {\r\n      rootScope.managers.networkerFactory.setLanguage(language);\r\n      rootScope.managers.appAttachMenuBotsManager.onLanguageChange();\r\n    });\r\n\r\n    window.addEventListener('online', () => {\r\n      rootScope.managers.networkerFactory.forceReconnectTimeout();\r\n    });\r\n\r\n    rootScope.addEventListener('logging_out', ({accountNumber, migrateTo}) => {\r\n      // const toClear: CacheStorageDbName[] = ['cachedFiles', 'cachedStreamChunks'];\r\n      Promise.all([\r\n        toggleStorages(false, true),\r\n        Promise.race([\r\n          // TODO: Check here\r\n          telegramMeWebManager.setAuthorized(false),\r\n          pause(3000)\r\n        ]),\r\n        webPushApiManager.forceUnsubscribe(),\r\n        this.invokeVoid('terminate', undefined), // * terminate mtproto worker\r\n        this.serviceWorkerRegistration?.unregister().catch(noop) // * release storages\r\n      ]).finally(() => {\r\n        let url = new URL(location.href);\r\n\r\n        const currentAccount = getCurrentAccount();\r\n        if(!accountNumber) {\r\n          url.hash = '';\r\n          url.search = '';\r\n        } else if(currentAccount > accountNumber) {\r\n          const newAccountNumber = currentAccount - 1;\r\n          url = createAppURLForAccount(newAccountNumber as ActiveAccountNumber, undefined, true);\r\n          //\r\n        } else if(currentAccount === accountNumber) {\r\n          if(migrateTo) url = createAppURLForAccount(migrateTo);\r\n          else {\r\n            url.hash = '';\r\n            url.search = '';\r\n          }\r\n        }\r\n\r\n        history.replaceState(null, '', url);\r\n\r\n        // Make sure managers don't have any obsolete data\r\n        this.closeMTProtoWorker(); // might be useless because of the above `this.invokeVoid('terminate', undefined)` ⬆️\r\n\r\n        appRuntimeManager.reload();\r\n      });\r\n    });\r\n\r\n    rootScope.addEventListener('settings_updated', ({key, settings}) => {\r\n      setAppSettingsSilent(/* key,  */settings);\r\n    });\r\n\r\n    rootScope.addEventListener('toggle_using_passcode', (value) => {\r\n      DeferredIsUsingPasscode.resolveDeferred(value);\r\n    });\r\n\r\n    idleController.addEventListener('change', (idle) => {\r\n      this.updateTabStateIdle(idle);\r\n    });\r\n    this.updateTabStateIdle(idleController.isIdle);\r\n\r\n    // this.sendState();\r\n  }\r\n\r\n  public sendEnvironment() {\r\n    this.log('Passing environment:', ENVIRONMENT);\r\n    this.invoke('environment', ENVIRONMENT);\r\n  }\r\n\r\n  public pingServiceWorkerWithIframe() {\r\n    if(this.pingServiceWorkerPromise) {\r\n      return this.pingServiceWorkerPromise;\r\n    }\r\n\r\n    const promise = this.pingServiceWorkerPromise = deferredPromise<void>();\r\n    const iframe = document.createElement('iframe');\r\n    iframe.hidden = true;\r\n    const onFinish = () => {\r\n      clearTimeout(timeout);\r\n      setTimeout(() => { // ping once in 10 seconds\r\n        this.pingServiceWorkerPromise = undefined;\r\n      }, 10e3);\r\n\r\n      iframe.removeEventListener('load', onLoad);\r\n      iframe.removeEventListener('error', onError);\r\n      iframe.remove();\r\n    };\r\n    const onLoad = () => {\r\n      onFinish();\r\n      promise.resolve();\r\n    };\r\n    const onError = () => {\r\n      onFinish();\r\n      promise.reject();\r\n    };\r\n    iframe.addEventListener('load', onLoad);\r\n    iframe.addEventListener('error', onError);\r\n    iframe.src = 'ping/' + (Math.random() * 0xFFFFFFFF | 0) + '.nocache';\r\n    document.body.append(iframe);\r\n\r\n    const timeout = window.setTimeout(onError, 1500);\r\n    return promise;\r\n  }\r\n\r\n  private attachServiceWorker(serviceWorker: ServiceWorker) {\r\n    if(this.lastServiceWorker === serviceWorker) {\r\n      this.log.warn('trying to attach same service worker');\r\n      return;\r\n    }\r\n\r\n    this.lastServiceWorker && this.serviceMessagePort.detachPort(this.lastServiceWorker);\r\n    this.serviceMessagePort.attachSendPort(this.lastServiceWorker = serviceWorker);\r\n    this.serviceMessagePort.invokeVoid('hello', undefined);\r\n    this.serviceMessagePort.invokeVoid('environment', ENVIRONMENT);\r\n\r\n    DeferredIsUsingPasscode.isUsingPasscode().then((value) => {\r\n      if(!value) {\r\n        // When value=true we'll send it and the encryption key after unlocking the screen\r\n        this.serviceMessagePort.invokeVoid('toggleUsingPasscode', {isUsingPasscode: false});\r\n      }\r\n    });\r\n  }\r\n\r\n  private _registerServiceWorker() {\r\n    // if(import.meta.env.DEV && IS_SAFARI) {\r\n    //   return;\r\n    // }\r\n\r\n    navigator.serviceWorker.register(\r\n      // * doesn't work\r\n      // new URL('../../../sw.ts', import.meta.url),\r\n      // '../../../sw',\r\n      ServiceWorkerURL,\r\n      {type: 'module', scope: './'}\r\n    ).then((registration) => {\r\n      if(TEST_NO_STREAMING) {\r\n        throw 1;\r\n      }\r\n\r\n      this.log('SW registered', registration);\r\n      this.serviceWorkerRegistration = registration;\r\n\r\n      const url = new URL(window.location.href);\r\n      const FIX_KEY = 'swfix';\r\n      const swfix = +url.searchParams.get(FIX_KEY) || 0;\r\n      if(registration.active && !navigator.serviceWorker.controller) {\r\n        if(swfix >= 3) {\r\n          throw new Error('no controller');\r\n        }\r\n\r\n        // ! doubtful fix for hard refresh\r\n        return registration.unregister().then(() => {\r\n          url.searchParams.set(FIX_KEY, '' + (swfix + 1));\r\n          window.location.href = url.toString();\r\n        });\r\n      }\r\n\r\n      if(swfix) {\r\n        url.searchParams.delete(FIX_KEY);\r\n        history.pushState(undefined, '', url);\r\n      }\r\n\r\n      const sw = registration.installing || registration.waiting || registration.active;\r\n      sw.addEventListener('statechange', (e) => {\r\n        this.log('SW statechange', e);\r\n      });\r\n\r\n      const controller = navigator.serviceWorker.controller || registration.installing || registration.waiting || registration.active;\r\n      this.attachServiceWorker(controller);\r\n\r\n      if(import.meta.env.VITE_MTPROTO_SW) {\r\n        this.onWorkerFirstMessage(controller);\r\n      }\r\n    }).catch((err) => {\r\n      this.log.error('SW registration failed!', err);\r\n\r\n      this.invokeVoid('serviceWorkerOnline', false);\r\n    });\r\n  }\r\n\r\n  private registerServiceWorker() {\r\n    if(!('serviceWorker' in navigator)) return;\r\n\r\n    this.serviceMessagePort = webPushApiManager.serviceMessagePort = new ServiceMessagePort<true>();\r\n\r\n    // this.addMultipleEventsListeners({\r\n    //   hello: () => {\r\n    //     // this.serviceMessagePort.invokeVoid('port', undefined);\r\n    //   }\r\n    // });\r\n\r\n    // ! I hate webpack - it won't load it by using worker.register, only navigator.serviceWorker will do it.\r\n    const worker = navigator.serviceWorker;\r\n    this._registerServiceWorker();\r\n\r\n    // worker.startMessages();\r\n\r\n    worker.addEventListener('controllerchange', () => {\r\n      this.log.warn('controllerchange');\r\n\r\n      const controller = worker.controller;\r\n      this.attachServiceWorker(controller);\r\n\r\n      controller.addEventListener('error', (e) => {\r\n        this.log.error('controller error:', e);\r\n      });\r\n    });\r\n\r\n    if(import.meta.env.VITE_MTPROTO_SW) {\r\n      this.attachListenPort(worker);\r\n    } else {\r\n      this.serviceMessagePort.attachListenPort(worker);\r\n      this.serviceMessagePort.addMultipleEventsListeners({\r\n        port: (payload, source, event) => {\r\n          this.log.warn('got service worker port');\r\n          this.invokeVoid('serviceWorkerPort', undefined, undefined, [event.ports[0]]);\r\n        },\r\n\r\n        serviceCryptoPort: (_, __, event) => {\r\n          cryptoMessagePort.sendToOnePort(event.ports[0]);\r\n        },\r\n\r\n        hello: (payload, source) => {\r\n          this.log('got hello from service worker');\r\n          this.serviceMessagePort.resendLockTask(source);\r\n          this.serviceMessagePort.invokeVoid('environment', ENVIRONMENT);\r\n        },\r\n\r\n        share: (payload) => {\r\n          this.log('will try to share something');\r\n          this.share = payload;\r\n        }\r\n      });\r\n    }\r\n\r\n    worker.addEventListener('messageerror', (e) => {\r\n      this.log.error('SW messageerror:', e);\r\n    });\r\n  }\r\n\r\n  private async registerCryptoWorker() {\r\n    const get = (url: string) => {\r\n      return fetch(url).then((response) => response.text()).then((text) => {\r\n        const pathnameSplitted = location.pathname.split('/');\r\n        pathnameSplitted[pathnameSplitted.length - 1] = '';\r\n        const pre = location.origin + pathnameSplitted.join('/');\r\n        text = text.replace(/(import (?:.+? from )?['\"])\\//g, '$1' + pre);\r\n        const blob = new Blob([text], {type: 'application/javascript'});\r\n        return blob;\r\n      });\r\n    };\r\n\r\n    const workerHandler = {\r\n      construct(target: any, args: any): any {\r\n        return {\r\n          url: makeWorkerURL(args[0]).toString()\r\n        };\r\n      }\r\n    };\r\n\r\n    const originals = [\r\n      Worker,\r\n      typeof(SharedWorker) !== 'undefined' && SharedWorker\r\n    ].filter(Boolean);\r\n    originals.forEach((w) => window[w.name as any] = new Proxy(w, workerHandler));\r\n\r\n    const worker: SharedWorker | Worker = new Worker(\r\n      new URL('../crypto/crypto.worker.ts', import.meta.url),\r\n      {type: 'module'}\r\n    );\r\n\r\n    originals.forEach((w) => window[w.name as any] = w as any);\r\n\r\n    const originalUrl = (worker as any).url;\r\n\r\n    const createWorker = (url: string) => new constructor(url, {type: 'module'});\r\n    const attachWorkerToPort = (worker: SharedWorker | Worker) => this.attachWorkerToPort(worker, cryptoMessagePort, 'crypto');\r\n    const constructor = IS_SHARED_WORKER_SUPPORTED ? SharedWorker : Worker;\r\n\r\n    // let cryptoWorkers = workers.length;\r\n    // cryptoMessagePort.addEventListener('servicePort', (payload, source, event) => {\r\n    //   this.serviceMessagePort.invokeVoid('cryptoPort', undefined, undefined, [event.ports[0]]);\r\n    // });\r\n    cryptoMessagePort.addEventListener('port', (payload, source, event) => {\r\n      this.invokeVoid('cryptoPort', undefined, undefined, [event.ports[0]]);\r\n\r\n      // .then((attached) => {\r\n      //   if(!attached && cryptoWorkers-- > 1) {\r\n      //     this.log.error('terminating unneeded crypto worker');\r\n\r\n      //     cryptoMessagePort.invokeVoid('terminate', undefined, source);\r\n      //     const worker = workers.find((worker) => (worker as SharedWorker).port === source || (worker as any) === source);\r\n      //     if((worker as SharedWorker).port) (worker as SharedWorker).port.close();\r\n      //     else (worker as Worker).terminate();\r\n      //     cryptoMessagePort.detachPort(source);\r\n      //   }\r\n      // });\r\n    });\r\n\r\n    const firstWorker = createWorker(originalUrl);\r\n    attachWorkerToPort(firstWorker);\r\n\r\n    const blob = await get(originalUrl);\r\n    const urlsPromise = await this.invoke('createProxyWorkerURLs', {originalUrl, blob});\r\n    const workers = urlsPromise.slice(1).map(createWorker);\r\n    workers.forEach(attachWorkerToPort);\r\n  }\r\n\r\n  private registerWorker() {\r\n    if(import.meta.env.VITE_MTPROTO_SW) {\r\n      return;\r\n    }\r\n\r\n    let worker: SharedWorker | Worker;\r\n    if(IS_SHARED_WORKER_SUPPORTED) {\r\n      worker = new SharedWorker(\r\n        new URL('./mtproto.worker.ts', import.meta.url),\r\n        {type: 'module'}\r\n      );\r\n      this.closeMTProtoWorker = () => (worker as SharedWorker).port.close();\r\n    } else {\r\n      worker = new Worker(\r\n        new URL('./mtproto.worker.ts', import.meta.url),\r\n        {type: 'module'}\r\n      );\r\n      this.closeMTProtoWorker = () => (worker as Worker).terminate();\r\n    }\r\n\r\n    this.onWorkerFirstMessage(worker);\r\n  }\r\n\r\n  private attachWorkerToPort(worker: SharedWorker | Worker, messagePort: SuperMessagePort<any, any, any>, type: string) {\r\n    const port: MessagePort = (worker as SharedWorker).port || worker as any;\r\n    messagePort.attachPort(port);\r\n\r\n    worker.addEventListener('error', (err) => {\r\n      this.log.error(type, 'worker error', err);\r\n    });\r\n  }\r\n\r\n  private onWorkerFirstMessage(worker: any) {\r\n    this.log('set webWorker');\r\n\r\n    // this.worker = worker;\r\n    if(import.meta.env.VITE_MTPROTO_SW) {\r\n      this.attachSendPort(worker);\r\n    } else {\r\n      this.attachWorkerToPort(worker, this, 'mtproto');\r\n    }\r\n  }\r\n\r\n  public async loadAllStates() {\r\n    const loadedStates = await loadStateForAllAccountsOnce();\r\n\r\n    this.dispatchUserAuth();\r\n\r\n    const stateForThisAccount = loadedStates[getCurrentAccount()];\r\n    rootScope.settings = stateForThisAccount.common.settings;\r\n    this.newVersion = stateForThisAccount.newVersion;\r\n    this.oldVersion = stateForThisAccount.oldVersion;\r\n    this.mirrors['state'] = stateForThisAccount.state;\r\n    setAppStateSilent(stateForThisAccount.state);\r\n    setAppSettingsSilent(stateForThisAccount.common.settings);\r\n\r\n    Object.defineProperty(rootScope, 'settings', {\r\n      get: () => {\r\n        return unwrap(appSettings);\r\n      }\r\n    });\r\n\r\n    return loadedStates;\r\n  }\r\n\r\n  private async dispatchUserAuth() {\r\n    const accountData = await AccountController.get(getCurrentAccount());\r\n    if(accountData?.userId) {\r\n      rootScope.dispatchEvent('user_auth', {\r\n        dcID: accountData.dcId || 0,\r\n        date: accountData.date || (Date.now() / 1000 | 0),\r\n        id: accountData.userId.toPeerId(false)\r\n      });\r\n    }\r\n  }\r\n\r\n  public hasTabOpenFor(accountNumber: ActiveAccountNumber) {\r\n    return !!this.allTabStates.find((tab) => tab.accountNumber === accountNumber);\r\n  }\r\n\r\n  public getOpenTabsCount() {\r\n    return this.allTabStates.length;\r\n  }\r\n\r\n  public sendAllStates(loadedStates: Awaited<ReturnType<ApiManagerProxy['loadAllStates']>>) {\r\n    const promises: Promise<any>[] = [];\r\n    for(let i = 1; i <= 4; i++) {\r\n      const state = loadedStates[i as ActiveAccountNumber];\r\n      const promise = this.invoke('state', {\r\n        ...state,\r\n        accountNumber: i as ActiveAccountNumber\r\n      });\r\n\r\n      promises.push(promise);\r\n    }\r\n\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  public invokeCrypto<Method extends keyof CryptoMethods>(method: Method, ...args: Parameters<CryptoMethods[typeof method]>) {\r\n    if(!import.meta.env.VITE_MTPROTO_WORKER) {\r\n      return;\r\n    }\r\n\r\n    return cryptoMessagePort.invokeCrypto(method, ...args);\r\n  }\r\n\r\n  public async toggleStorages(enabled: boolean, clearWrite: boolean) {\r\n    await toggleStorages(enabled, clearWrite);\r\n    this.invoke('toggleStorages', {enabled, clearWrite});\r\n    this.serviceMessagePort?.invokeVoid('toggleStorages', {enabled, clearWrite});\r\n  }\r\n\r\n  public async getMirror<T extends keyof Mirrors>(name: T) {\r\n    const mirror = this.mirrors[name];\r\n    return mirror;\r\n  }\r\n\r\n  public getState() {\r\n    return this.getMirror('state');\r\n  }\r\n\r\n  public getAllTabStates() {\r\n    return [...this.allTabStates];\r\n  }\r\n\r\n  public getCacheContext(\r\n    media: ThumbStorageMedia,\r\n    thumbSize: string = THUMB_TYPE_FULL,\r\n    key = getThumbKey(media)\r\n  ) {\r\n    const cache = this.mirrors.thumbs[key];\r\n    return cache?.[thumbSize] || generateEmptyThumb(thumbSize);\r\n  }\r\n\r\n  public getStickerCachedThumb(docId: DocId, toneIndex: string | number) {\r\n    const key = getStickerThumbKey(docId, toneIndex);\r\n    return this.mirrors.stickerThumbs[key];\r\n  }\r\n\r\n  public getAvailableReactions() {\r\n    return this.mirrors.availableReactions ||= rootScope.managers.appReactionsManager.getAvailableReactions();\r\n  }\r\n\r\n  public getReaction(reaction: string) {\r\n    return callbackify(this.getAvailableReactions(), (availableReactions) => {\r\n      return availableReactions.find((availableReaction) => availableReaction.reaction === reaction);\r\n    });\r\n  }\r\n\r\n  public getMessageFromStorage(key: MessagesStorageKey, mid: number) {\r\n    // * use global storage instead\r\n    if(key.endsWith('history') && isLegacyMessageId(mid)) {\r\n      key = this.getGlobalHistoryMessagesStorage();\r\n    }\r\n\r\n    const cache = this.mirrors.messages[key];\r\n    return cache?.[mid];\r\n  }\r\n\r\n  public getGroupsFirstMessage(message: Message.message) {\r\n    if(!message?.grouped_id) return message;\r\n\r\n    const storage = this.mirrors.groupedMessages[message.grouped_id];\r\n    let minMid = Number.MAX_SAFE_INTEGER;\r\n    for(const [mid, message] of storage) {\r\n      if(message.mid < minMid) {\r\n        minMid = message.mid;\r\n      }\r\n    }\r\n\r\n    return storage.get(minMid);\r\n  }\r\n\r\n  public getMidsByGroupedId(groupedId: string, sort: 'asc' | 'desc' = 'asc') {\r\n    return getObjectKeysAndSort(this.mirrors.groupedMessages[groupedId], sort);\r\n  }\r\n\r\n  public getMessagesByGroupedId(groupedId: string) {\r\n    const mids = this.getMidsByGroupedId(groupedId, 'asc');\r\n    const storage = this.mirrors.groupedMessages[groupedId];\r\n    // return mids.map((mid) => this.getMessageFromStorage(storage, mid) as Message.message);\r\n    return mids.map((mid) => storage.get(mid) as Message.message);\r\n  }\r\n\r\n  public getHistoryMessagesStorage(peerId: PeerId): MessagesStorageKey {\r\n    return `${peerId}_history`;\r\n  }\r\n\r\n  public getGlobalHistoryMessagesStorage(): MessagesStorageKey {\r\n    return this.getHistoryMessagesStorage(NULL_PEER_ID);\r\n  }\r\n\r\n  public getMessageById(messageId: number) {\r\n    if(isLegacyMessageId(messageId)) {\r\n      return this.getMessageFromStorage(this.getGlobalHistoryMessagesStorage(), messageId);\r\n    }\r\n  }\r\n\r\n  public getMessageByPeer(peerId: PeerId, messageId: number) {\r\n    if(!peerId) {\r\n      return this.getMessageById(messageId);\r\n    }\r\n\r\n    return this.getMessageFromStorage(this.getHistoryMessagesStorage(peerId), messageId);\r\n  }\r\n\r\n\r\n  public getPeerForAccount(peerId: PeerId, accountNumber: ActiveAccountNumber) {\r\n    const managers = createProxiedManagersForAccount(accountNumber);\r\n    return managers.appPeersManager.getPeer(peerId);\r\n  }\r\n\r\n  public getPeer(peerId: PeerId) {\r\n    return this.mirrors.peers[peerId];\r\n  }\r\n\r\n  public getUser(userId: UserId) {\r\n    return this.mirrors.peers[userId.toPeerId(false)] as User.user;\r\n  }\r\n\r\n  public getChat(chatId: ChatId) {\r\n    return this.mirrors.peers[chatId.toPeerId(true)] as Exclude<Chat, Chat.chatEmpty>;\r\n  }\r\n\r\n  public isForum(peerId: PeerId) {\r\n    const peer = this.getPeer(peerId);\r\n    return !!(peer as Chat.channel)?.pFlags?.forum;\r\n  }\r\n\r\n  public isAvatarCached(peerId: PeerId, size?: PeerPhotoSize) {\r\n    const saved = this.mirrors.avatars[peerId];\r\n    if(size === undefined) {\r\n      return !!saved;\r\n    }\r\n\r\n    return !!(saved && saved[size] && !(saved[size] instanceof Promise));\r\n  }\r\n\r\n  public loadAvatar(peerId: PeerId, photo: UserProfilePhoto.userProfilePhoto | ChatPhoto.chatPhoto, size: PeerPhotoSize, accountNumber?: ActiveAccountNumber) {\r\n    if(accountNumber && accountNumber !== getCurrentAccount()) {\r\n      const managers = createProxiedManagersForAccount(accountNumber);\r\n      return managers.appAvatarsManager.loadAvatar(peerId, photo, size);\r\n    }\r\n\r\n    const saved = this.mirrors.avatars[peerId] ??= {};\r\n    return saved[size] ??= rootScope.managers.appAvatarsManager.loadAvatar(peerId, photo, size);\r\n  }\r\n\r\n  public getAppConfig(overwrite?: boolean) {\r\n    if(overwrite) {\r\n      this.appConfig = undefined;\r\n    }\r\n\r\n    if(!this.appConfig) {\r\n      const promise = rootScope.managers.apiManager.getAppConfig().then((appConfig) => {\r\n        if(this.appConfig === promise) {\r\n          this.appConfig = appConfig;\r\n        }\r\n\r\n        return appConfig;\r\n      });\r\n\r\n      return this.appConfig = promise;\r\n    }\r\n\r\n    return this.appConfig;\r\n  }\r\n\r\n  public isPremiumFeaturesHidden(): MaybePromise<boolean> {\r\n    return callbackify(this.isPremiumPurchaseBlocked(), (isPremiumPurchaseBlocked) => {\r\n      return isPremiumPurchaseBlocked && !rootScope.premium;\r\n    });\r\n  }\r\n\r\n  public isPremiumPurchaseBlocked(): MaybePromise<boolean> {\r\n    return callbackify(this.getAppConfig(), (appConfig) => {\r\n      return !!appConfig.premium_purchase_blocked;\r\n    });\r\n  }\r\n\r\n  public async hasSomeonePremium() {\r\n    const totalAccounts = await AccountController.getTotalAccounts();\r\n\r\n    let hasSomeonePremium = false;\r\n    for(let i = 1; i <= totalAccounts; i++) {\r\n      const accountNumber = i as ActiveAccountNumber;\r\n      const managers = createProxiedManagersForAccount(accountNumber);\r\n      hasSomeonePremium ||= await managers.rootScope.getPremium();\r\n      if(hasSomeonePremium) break;\r\n    }\r\n\r\n    return hasSomeonePremium;\r\n  }\r\n\r\n  public updateTabState<T extends keyof TabState>(key: T, value: TabState[T]) {\r\n    this.tabState[key] = value;\r\n    this.invokeVoid('tabState', this.tabState);\r\n  }\r\n\r\n  public updateTabStateIdle(idle: boolean) {\r\n    this.updateTabState('idleStartTime', idle ? Date.now() : 0);\r\n  }\r\n\r\n  private onMirrorTask = (payload: MirrorTaskPayload) => {\r\n    const {name, key, value, accountNumber} = payload;\r\n    const isSettingsUpdate = name === 'state' && key === 'settings';\r\n    if(!isSettingsUpdate && accountNumber !== getCurrentAccount()) return;\r\n\r\n    this.processMirrorTaskMap[name]?.(payload);\r\n    if(!payload.hasOwnProperty('key')) {\r\n      this.mirrors[name] = value;\r\n      return;\r\n    }\r\n\r\n    const mirror = this.mirrors[name] ??= {} as any;\r\n    setDeepProperty(mirror, key, value, true);\r\n  };\r\n\r\n  public async setInterval(callback: () => void, ms: number) {\r\n    const intervalId = await this.invoke('setInterval', ms);\r\n    this.intervals.set(intervalId, callback);\r\n    return intervalId;\r\n  }\r\n\r\n  public async clearInterval(intervalId: number) {\r\n    this.intervals.delete(intervalId);\r\n    await this.invoke('clearInterval', intervalId);\r\n  }\r\n}\r\n\r\ninterface ApiManagerProxy extends MTProtoMessagePort<true> {}\r\n\r\nconst apiManagerProxy = new ApiManagerProxy();\r\nMOUNT_CLASS_TO.apiManagerProxy = apiManagerProxy;\r\nexport default apiManagerProxy;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport EventListenerBase from './eventListenerBase';\r\n\r\nexport class OverlayCounter extends EventListenerBase<{\r\n  change: (isActive: boolean) => void\r\n}> {\r\n  public overlaysActive = 0;\r\n  public hasDarkOverlays = 0;\r\n\r\n  get isOverlayActive() {\r\n    return this.overlaysActive > 0;\r\n  }\r\n\r\n  set isOverlayActive(value: boolean) {\r\n    this.overlaysActive += value ? 1 : -1;\r\n    this.dispatchEvent('change', this.isOverlayActive);\r\n  }\r\n\r\n  get isDarkOverlayActive() {\r\n    return this.hasDarkOverlays > 0;\r\n  }\r\n\r\n  set isDarkOverlayActive(value: boolean) {\r\n    this.hasDarkOverlays += value ? 1 : -1;\r\n    this.isOverlayActive = value;\r\n  }\r\n}\r\n\r\nconst overlayCounter = new OverlayCounter();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.overlayCounter = overlayCounter);\r\nexport default overlayCounter;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function parseUriParams(uri: string, splitted = uri.split('?')) {\r\n  try {\r\n    const url = new URL(uri);\r\n    const obj: any = {};\r\n    for(const [key, value] of url.searchParams.entries()) {\r\n      obj[key] = value;\r\n    }\r\n\r\n    return obj;\r\n  } catch(err) {\r\n    return parseUriParamsLine(splitted?.[1]);\r\n  }\r\n}\r\n\r\nexport function parseUriParamsLine(line: string) {\r\n  const params: any = {};\r\n  if(!line) {\r\n    return params;\r\n  }\r\n\r\n  line.split('&').forEach((item) => {\r\n    const [key, value = ''] = item.split('=');\r\n    params[key] = decodeURIComponent(value);\r\n  });\r\n\r\n  return params;\r\n}\r\n","const IS_INSTALL_PROMPT_SUPPORTED = 'onbeforeinstallprompt' in window;\r\nexport default IS_INSTALL_PROMPT_SUPPORTED;\r\n","let callback: () => Promise<void>;\r\nexport default function cacheInstallPrompt() {\r\n  window.addEventListener('beforeinstallprompt', (deferredPrompt: any) => {\r\n    callback = async() => {\r\n      deferredPrompt.prompt();\r\n      const {outcome} = await deferredPrompt.userChoice;\r\n      const installed = outcome === 'accepted';\r\n      if(installed) {\r\n        callback = undefined;\r\n      }\r\n    };\r\n  });\r\n}\r\n\r\nexport function getInstallPrompt() {\r\n  return callback;\r\n}\r\n","export const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\nexport const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport I18n, {i18n} from '../lib/langPack';\r\nimport {days, months} from './date/common';\r\nimport capitalizeFirstLetter from './string/capitalizeFirstLetter';\r\n\r\nexport const monthsLocalized = months.slice();\r\nexport const daysLocalized = days.slice();\r\n\r\nexport const ONE_DAY = 86400;\r\nexport const ONE_DAY_MINUTES = 1440;\r\nexport const ONE_WEEK = 604800;\r\nexport const ONE_WEEK_MINUTES = 10080;\r\n\r\nexport function getWeekDays() {\r\n  const dateTimeFormat = I18n.getDateTimeFormat({weekday: 'long'});\r\n  const date = new Date(Date.UTC(2017, 0, 2));\r\n  const out: string[] = [];\r\n  for(let i = 0; i < 7; ++i) {\r\n    out.push(capitalizeFirstLetter(dateTimeFormat.format(date)));\r\n    date.setDate(date.getDate() + 1);\r\n  }\r\n  return out;\r\n}\r\n\r\nexport function getMonths() {\r\n  const dateTimeFormat = I18n.getDateTimeFormat({month: 'long'});\r\n  const date = new Date(Date.UTC(2017, 0, 1));\r\n  const out: string[] = [];\r\n  for(let i = 0; i < 12; ++i) {\r\n    out.push(capitalizeFirstLetter(dateTimeFormat.format(date)));\r\n    date.setMonth(date.getMonth() + 1);\r\n  }\r\n  return out;\r\n}\r\n\r\nexport function fillLocalizedDates() {\r\n  monthsLocalized.splice(0, monthsLocalized.length, ...getMonths());\r\n  daysLocalized.splice(0, daysLocalized.length, ...getWeekDays());\r\n}\r\n\r\n// https://stackoverflow.com/a/6117889\r\nexport const getWeekNumber = (date: Date) => {\r\n  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\r\n  const dayNum = d.getUTCDay() || 7;\r\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\r\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\r\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / ONE_DAY) + 1) / 7);\r\n};\r\n\r\nexport function formatDate(date: Date, today?: Date) {\r\n  if(!today) {\r\n    today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n  }\r\n\r\n  const options: Intl.DateTimeFormatOptions = {\r\n    day: 'numeric',\r\n    month: 'long'\r\n  };\r\n\r\n  if(date.getFullYear() !== today.getFullYear()) {\r\n    options.year = 'numeric';\r\n  }\r\n\r\n  return new I18n.IntlDateElement({\r\n    date,\r\n    options\r\n  }).element;\r\n}\r\n\r\nexport function formatDateAccordingToTodayNew(time: Date) {\r\n  const today = new Date();\r\n  const now = today.getTime() / 1000 | 0;\r\n  const timestamp = time.getTime() / 1000 | 0;\r\n\r\n  const options: Intl.DateTimeFormatOptions = {};\r\n  if((now - timestamp) < ONE_DAY && today.getDate() === time.getDate()) { // if the same day\r\n    options.hour = options.minute = '2-digit';\r\n  } else if(today.getFullYear() !== time.getFullYear()) { // different year\r\n    options.year = options.day = 'numeric';\r\n    options.month = '2-digit';\r\n  } else if((now - timestamp) < (ONE_DAY * 7) && getWeekNumber(today) === getWeekNumber(time)) { // current week\r\n    options.weekday = 'short';\r\n  } else { // same year\r\n    options.month = 'short';\r\n    options.day = 'numeric';\r\n  }\r\n\r\n  return new I18n.IntlDateElement({\r\n    date: time,\r\n    options\r\n  }).element;\r\n}\r\n\r\nconst formatTimeOptions: Intl.DateTimeFormatOptions = {\r\n  hour: '2-digit',\r\n  minute: '2-digit'\r\n};\r\n\r\nexport function formatFullSentTimeRaw(timestamp: number, options: {\r\n  capitalize?: boolean\r\n  noToday?: boolean,\r\n  combined?: boolean\r\n} = {}) {\r\n  if(options.combined) {\r\n    options.noToday = true;\r\n  }\r\n\r\n  const date = new Date();\r\n  const time = new Date(timestamp * 1000);\r\n  const now = date.getTime() / 1000 | 0;\r\n  const diff = now - timestamp;\r\n\r\n  const timeEl = options.combined ? undefined : formatTime(time);\r\n\r\n  let dateEl: HTMLElement;\r\n  if(!options.noToday && diff < ONE_DAY && date.getDate() === time.getDate()) { // if the same day\r\n    dateEl = i18n(options.capitalize ? 'Date.Today' : 'Peer.Status.Today');\r\n  } else if(!options.noToday && diff > 0 && diff < (ONE_DAY * 2) && new Date(date.getTime() - ONE_DAY * 1000).getDate() === time.getDate()) { // yesterday\r\n    dateEl = i18n(options.capitalize ? 'Yesterday' : 'Peer.Status.Yesterday');\r\n\r\n    if(options.capitalize) {\r\n      dateEl.style.textTransform = 'capitalize';\r\n    }\r\n  } else if(date.getFullYear() !== time.getFullYear()) { // different year\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric',\r\n        ...(options.combined ? formatTimeOptions: {})\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate() + ', ' + time.getFullYear();\r\n  } else {\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        ...(options.combined ? formatTimeOptions: {})\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate();\r\n  }\r\n\r\n  return {dateEl, timeEl};\r\n}\r\n\r\nexport function formatFullSentTime(timestamp: number, capitalize = true, noToday = false) {\r\n  const {dateEl, timeEl} = formatFullSentTimeRaw(timestamp, {\r\n    capitalize,\r\n    noToday\r\n  });\r\n\r\n  const fragment = document.createDocumentFragment();\r\n  fragment.append(dateEl, ' ', i18n('ScheduleController.at'), ' ', timeEl);\r\n  return fragment;\r\n}\r\n\r\nexport function formatTime(date: Date) {\r\n  return new I18n.IntlDateElement({\r\n    date,\r\n    options: formatTimeOptions\r\n  }).element;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.formatDateAccordingToTodayNew = formatDateAccordingToTodayNew);\r\n\r\nexport function formatMonthsDuration(months: number, bold?: boolean) {\r\n  const isYears = months >= 12 && !(months % 12);\r\n  return i18n(\r\n    bold ? (isYears ? 'BoldYears' : 'BoldMonths') : (isYears ? 'Years' : 'Months'),\r\n    [isYears ? months / 12 : months]\r\n  );\r\n}\r\n\r\n// https://github.com/DrKLO/Telegram/blob/d52b2c921abd3c1e8d6368858313ad0cb0468c07/TMessagesProj/src/main/java/org/telegram/ui/Adapters/FiltersView.java\r\nconst minYear = 2013;\r\nconst yearPattern = new RegExp('20[0-9]{1,2}');\r\nconst anyLetterRegExp = `\\\\p{L}`;\r\nconst monthPattern = new RegExp(`(${anyLetterRegExp}{3,})`, 'iu');\r\nconst monthYearOrDayPattern = new RegExp(`(${anyLetterRegExp}{3,}) ([0-9]{0,4})`, 'iu');\r\nconst yearOrDayAndMonthPattern = new RegExp(`([0-9]{0,4}) (${anyLetterRegExp}{2,})`, 'iu');\r\nconst shortDate = new RegExp('^([0-9]{1,4})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst longDate = new RegExp('^([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst numberOfDaysEachMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\nexport type DateData = {\r\n  title: string,\r\n  minDate: number,\r\n  maxDate: number,\r\n};\r\nexport function fillTipDates(query: string, dates: DateData[]) {\r\n  const q = query.trim().toLowerCase();\r\n\r\n  if(q.length < 3) {\r\n    return;\r\n  }\r\n\r\n  if(['today', I18n.format('Peer.Status.Today', true)].some((haystack) => haystack.indexOf(q) === 0)) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: I18n.format('Date.Today', true),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  if(['yesterday', I18n.format('Peer.Status.Yesterday', true)].some((haystack) => haystack.indexOf(q) === 0)) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime() - 86400000;\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 86400001;\r\n    dates.push({\r\n      title: capitalizeFirstLetter(I18n.format('Yesterday', true)),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  const dayOfWeek = getDayOfWeek(q);\r\n  if(dayOfWeek >= 0) {\r\n    const date = new Date();\r\n    const now = date.getTime();\r\n    const currentDay = date.getDay();\r\n    const distance = dayOfWeek - currentDay;\r\n    date.setDate(date.getDate() + distance);\r\n    if(date.getTime() > now) {\r\n      date.setTime(date.getTime() - 604800000);\r\n    }\r\n    const year = date.getFullYear()\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: formatWeekLong(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  let matches: any[];\r\n  if((matches = shortDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const k = parseInt(g1);\r\n    const k1 = parseInt(g2);\r\n    if(k > 0 && k <= 31) {\r\n      if(k1 >= minYear && k <= 12) {\r\n        const selectedYear = k1;\r\n        const month = k - 1;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      } else if(k1 <= 12) {\r\n        const day = k - 1;\r\n        const month = k1 - 1;\r\n        createForDayMonth(dates, day, month);\r\n      }\r\n    } else if(k >= minYear && k1 <= 12) {\r\n      const selectedYear = k;\r\n      const month = k1 - 1;\r\n      createForMonthYear(dates, month, selectedYear);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = longDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const g3 = matches[5];\r\n    if(!matches[2] === matches[4]) {\r\n      return;\r\n    }\r\n\r\n    const day = parseInt(g1);\r\n    const month = parseInt(g2) - 1;\r\n    let year = parseInt(g3);\r\n    if(year >= 10 && year <= 99) {\r\n      year += 2000;\r\n    }\r\n\r\n    const currentYear = new Date().getFullYear();\r\n    if(validDateForMonth(day - 1, month) && year >= minYear && year <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(year, month, day);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(year, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: formatterYearMax(minDate),\r\n        minDate,\r\n        maxDate\r\n      });\r\n      return;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = monthYearOrDayPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g1);\r\n    if(month >= 0) {\r\n      const k = +g2 || new Date().getUTCFullYear();\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = yearOrDayAndMonthPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g2);\r\n    if(month >= 0) {\r\n      const k = +g1;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = monthPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const month = getMonth(g1);\r\n    if(month >= 0) {\r\n      const currentYear = new Date().getFullYear();\r\n      for(let i = currentYear; i >= minYear; --i) {\r\n        createForMonthYear(dates, month, i);\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = yearPattern.exec(q)) !== null) {\r\n    let selectedYear = +matches[0];\r\n    const currentYear = new Date().getFullYear();\r\n    if(selectedYear < minYear) {\r\n      selectedYear = minYear;\r\n      for(let i = currentYear; i >= selectedYear; i--) {\r\n        const date = new Date();\r\n        date.setFullYear(i, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const minDate = date.getTime();\r\n        date.setFullYear(i + 1, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const maxDate = date.getTime() - 1;\r\n        dates.push({\r\n          title: '' + i,\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    } else if(selectedYear <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(selectedYear, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(selectedYear + 1, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: '' + selectedYear,\r\n        minDate,\r\n        maxDate\r\n      });\r\n    }\r\n\r\n    return;\r\n  }\r\n}\r\n\r\nfunction createForMonthYear(dates: DateData[], month: number, selectedYear: number) {\r\n  const currentYear = new Date().getFullYear();\r\n  const today = Date.now();\r\n  if(selectedYear >= minYear && selectedYear <= currentYear) {\r\n    const date = new Date();\r\n    date.setFullYear(selectedYear, month, 1);\r\n    date.setHours(0, 0, 0);\r\n    const minDate = date.getTime();\r\n    if(minDate > today) {\r\n      return;\r\n    }\r\n    date.setMonth(date.getMonth() + 1);\r\n    const maxDate = date.getTime() - 1;\r\n\r\n    dates.push({\r\n      title: formatterMonthYear(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n  }\r\n}\r\n\r\nfunction createForDayMonth(dates: DateData[], day: number, month: number) {\r\n  if(validDateForMonth(day, month)) {\r\n    const currentYear = new Date().getFullYear();\r\n    const today = Date.now();\r\n\r\n    for(let i = currentYear; i >= minYear; i--) {\r\n      if(month === 1 && day === 28 && !isLeapYear(i)) {\r\n        continue;\r\n      }\r\n\r\n      const date = new Date();\r\n      date.setFullYear(i, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      if(minDate > today) {\r\n        continue;\r\n      }\r\n\r\n      date.setFullYear(i, month, day + 2);\r\n      date.setHours(0, 0, 0);\r\n      const maxDate = date.getTime() - 1;\r\n      if(i === currentYear) {\r\n        dates.push({\r\n          title: formatterDayMonth(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      } else {\r\n        dates.push({\r\n          title: formatterYearMax(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction formatterMonthYear(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return monthsLocalized[date.getMonth()]/* .slice(0, 3) */ + ' ' + date.getFullYear();\r\n}\r\n\r\nfunction formatterDayMonth(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return monthsLocalized[date.getMonth()]/* .slice(0, 3) */ + ' ' + date.getDate();\r\n}\r\n\r\nfunction formatterYearMax(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();\r\n}\r\n\r\nfunction formatWeekLong(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return daysLocalized[date.getDay()];\r\n}\r\n\r\nfunction validDateForMonth(day: number, month: number) {\r\n  if(month >= 0 && month < 12) {\r\n    if(day >= 0 && day < numberOfDaysEachMonth[month]) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isLeapYear(year: number) {\r\n  return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);\r\n}\r\n\r\nfunction getMonth(q: string) {\r\n  q = q.toLowerCase();\r\n  for(let i = 0; i < 12; i++) {\r\n    if([months[i], monthsLocalized[i]].some((month) => month.toLowerCase().indexOf(q) === 0)) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction getDayOfWeek(q: string) {\r\n  const c = new Date();\r\n  if(q.length <= 3) {\r\n    return -1;\r\n  }\r\n\r\n  for(let i = 0; i < 7; i++) {\r\n    c.setDate(c.getDate() + 1);\r\n\r\n    if(formatWeekLong(c.getTime()).toLowerCase().indexOf(q) === 0) {\r\n      return c.getDay();\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nMOUNT_CLASS_TO.fillTipDates = fillTipDates;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nconst arrays = {\r\n  8: new Uint8Array(1),\r\n  16: new Uint16Array(1),\r\n  32: new Uint32Array(1)\r\n};\r\nexport function nextRandomUint(bits: 8 | 16 | 32) {\r\n  const array = arrays[bits];\r\n  crypto.getRandomValues(array);\r\n  return array[0];\r\n}\r\n\r\nexport function randomLong() {\r\n  return '' + nextRandomUint(32) + nextRandomUint(32) % 0xFFFFFF;\r\n}\r\n","import {CHROMIUM_VERSION, IS_CHROMIUM, IS_FIREFOX, IS_MOBILE, IS_MOBILE_SAFARI, IS_SAFARI} from './userAgent';\r\n\r\nexport const USE_NATIVE_SCROLL = /* IS_APPLE ||  */IS_MOBILE/*  || true */;\r\nexport const IS_OVERLAY_SCROLL_SUPPORTED = IS_MOBILE || (!IS_CHROMIUM && (!IS_SAFARI || IS_MOBILE_SAFARI)/*  && !IS_FIREFOX */) || CHROMIUM_VERSION < 113;\r\nexport const USE_CUSTOM_SCROLL = !USE_NATIVE_SCROLL && !IS_OVERLAY_SCROLL_SUPPORTED;\r\n","import appNavigationController from '../../components/appNavigationController';\r\n\r\nimport {CURRENT_ACCOUNT_QUERY_PARAM} from './constants';\r\nimport {ActiveAccountNumber} from './types';\r\n\r\nexport function changeAccount(accountNumber: ActiveAccountNumber, newTab = false) {\r\n  const url = new URL(location.href);\r\n\r\n  if(accountNumber === 1) url.searchParams.delete(CURRENT_ACCOUNT_QUERY_PARAM);\r\n  else url.searchParams.set(CURRENT_ACCOUNT_QUERY_PARAM, accountNumber + '');\r\n\r\n  const newUrl = url.search ? url.pathname + url.search : url.pathname;\r\n  if(newTab) {\r\n    window.open(newUrl, '_blank');\r\n  } else {\r\n    appNavigationController.overrideHash();\r\n    history.replaceState(null, '', newUrl);\r\n    location.reload();\r\n  }\r\n}\r\n","export default function replaceChildrenPolyfill() {\r\n  if((Node as any).prototype.replaceChildren === undefined) {\r\n    (Node as any).prototype.replaceChildren = function(...nodes: any[]) {\r\n      this.textContent = '';\r\n      // while(this.lastChild) {\r\n      //   this.removeChild(this.lastChild);\r\n      // }\r\n      if(nodes) {\r\n        this.append(...nodes);\r\n      }\r\n    }\r\n  }\r\n}\r\n","function preparePrint() {\r\n  const chat = document.querySelector('.chat.active');\r\n  if(!chat) {\r\n    return;\r\n  }\r\n\r\n  const chatClone = chat.cloneNode(true) as HTMLElement;\r\n  chatClone.querySelectorAll('.chat-input, .chat-background').forEach((element) => element.remove());\r\n  const bubbles = chatClone.querySelector('.bubbles');\r\n  const bubblesInner = bubbles.querySelector('.bubbles-inner');\r\n  bubbles.replaceChildren(bubblesInner);\r\n  const video = bubbles.querySelectorAll<HTMLVideoElement>('video');\r\n  video.forEach((video) => (video.muted = true));\r\n  const printable = document.createElement('div');\r\n  printable.setAttribute('id', 'printable');\r\n  printable.append(chatClone);\r\n  document.body.append(printable);\r\n}\r\n\r\nfunction removePrint() {\r\n  const printContent = document.getElementById('printable');\r\n  printContent?.remove();\r\n}\r\n\r\nexport default function listenForWindowPrint() {\r\n  window.addEventListener('beforeprint', preparePrint);\r\n  window.addEventListener('afterprint', removePrint);\r\n}\r\n","import cancelEvent from './cancelEvent';\r\n\r\nexport default function cancelImageEvents() {\r\n  // prevent firefox image dragging\r\n  document.addEventListener('dragstart', (e) => {\r\n    if((e.target as HTMLElement)?.tagName === 'IMG') {\r\n      e.preventDefault();\r\n      return false;\r\n    }\r\n  });\r\n\r\n  // restrict contextmenu on images (e.g. webp stickers)\r\n  document.addEventListener('contextmenu', (e) => {\r\n    if((e.target as HTMLElement).tagName === 'IMG' && !(window as any).appMediaViewer) {\r\n      cancelEvent(e);\r\n    }\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport sequentialDom from '../helpers/sequentialDom';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport liteMode from '../helpers/liteMode';\r\n\r\n\r\ndeclare module 'solid-js' {\r\n  namespace JSX {\r\n    interface Directives {\r\n      /**\r\n       * To be used in solid-js as `<button use:ripple />`\r\n       */\r\n      ripple: true;\r\n    }\r\n  }\r\n}\r\n\r\nlet rippleClickId = 0;\r\nexport default function ripple(\r\n  elem: HTMLElement,\r\n  callback: (id: number) => Promise<boolean | void> = () => Promise.resolve(),\r\n  onEnd: (id: number) => void = null,\r\n  prepend = false,\r\n  attachListenerTo = elem\r\n) {\r\n  // return;\r\n  if(elem.querySelector('.c-ripple')) return;\r\n  elem.classList.add('rp');\r\n\r\n  const r = document.createElement('div');\r\n  r.classList.add('c-ripple');\r\n\r\n  const isSquare = elem.classList.contains('rp-square');\r\n  if(isSquare) {\r\n    r.classList.add('is-square');\r\n  }\r\n\r\n  elem[prepend ? 'prepend' : 'append'](r);\r\n\r\n  let handler: () => void;\r\n  // let animationEndPromise: Promise<number>;\r\n  const drawRipple = (clientX: number, clientY: number) => {\r\n    const startTime = Date.now();\r\n    const circle = document.createElement('div');\r\n\r\n    const clickId = rippleClickId++;\r\n\r\n    // console.log('ripple drawRipple');\r\n\r\n    // const auto = elem.classList.contains('row-sortable') && !elem.classList.contains('cant-sort');\r\n    const auto = false;\r\n    const duration = (auto ? .3 : +window.getComputedStyle(r).getPropertyValue('--ripple-duration').replace('s', '')) * 1000;\r\n    // console.log('ripple duration', duration);\r\n\r\n    const _handler = handler = () => {\r\n    // handler = () => animationEndPromise.then((duration) => {\r\n      // console.log('ripple animation was:', duration);\r\n\r\n      // const duration = isSquare || mediaSizes.isMobile ? 200 : 700;\r\n      // return;\r\n      const elapsedTime = Date.now() - startTime;\r\n      const cb = () => {\r\n        // console.log('ripple elapsedTime total pre-remove:', Date.now() - startTime);\r\n        sequentialDom.mutate(() => {\r\n          circle.remove();\r\n        });\r\n\r\n        onEnd?.(clickId);\r\n      };\r\n      if(elapsedTime < duration) {\r\n        const delay = Math.max(duration - elapsedTime, duration / 2);\r\n        setTimeout(() => circle.classList.add('hiding'), Math.max(delay - duration / 2, 0));\r\n\r\n        setTimeout(cb, delay);\r\n      } else {\r\n        circle.classList.add('hiding');\r\n        setTimeout(cb, duration / 2);\r\n      }\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        window.removeEventListener('contextmenu', handler);\r\n        window.removeEventListener('mousemove', handler);\r\n      }\r\n\r\n      handler = null;\r\n      touchStartFired = false;\r\n    };\r\n    // });\r\n\r\n    callback?.(clickId);\r\n\r\n    /* callback().then((bad) => {\r\n      if(bad) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    // console.log('ripple after promise', Date.now() - startTime);\r\n    // console.log('ripple tooSlow:', tooSlow);\r\n    /* if(tooSlow) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    fastRaf(() => {\r\n      if(_handler !== handler) {\r\n        return;\r\n      }\r\n\r\n      const rect = r.getBoundingClientRect();\r\n      circle.classList.add('c-ripple__circle');\r\n\r\n      const clickX = clientX - rect.left;\r\n      const clickY = clientY - rect.top;\r\n\r\n      const radius = Math.sqrt((Math.abs(clickY - rect.height / 2) + rect.height / 2) ** 2 + (Math.abs(clickX - rect.width / 2) + rect.width / 2) ** 2);\r\n      const size = radius;\r\n\r\n      // center of circle\r\n      const x = clickX - size / 2;\r\n      const y = clickY - size / 2;\r\n\r\n      // console.log('ripple click', offsetFromCenter, size, clickX, clickY);\r\n\r\n      circle.style.width = circle.style.height = size + 'px';\r\n      circle.style.left = x + 'px';\r\n      circle.style.top = y + 'px';\r\n      circle.style.opacity = '0';\r\n\r\n      // нижний код выполняется с задержкой\r\n      /* animationEndPromise = new Promise((resolve) => {\r\n          span.addEventListener('animationend', () => {\r\n            // 713 -> 700\r\n            resolve(((Date.now() - startTime) / 100 | 0) * 100);\r\n          }, {once: true});\r\n        }); */\r\n\r\n      // нижний код не всегда включает анимацию ПРИ КЛИКЕ НА ТАЧПАД БЕЗ ТАПТИК ЭНЖИНА\r\n      /* span.style.display = 'none';\r\n        r.append(span);\r\n        duration = +window.getComputedStyle(span).getPropertyValue('animation-duration').replace('s', '') * 1000;\r\n        span.style.display = ''; */\r\n\r\n      r.append(circle);\r\n\r\n      void circle.offsetWidth; // force reflow\r\n      circle.style.opacity = '';\r\n\r\n      if(auto) {\r\n        // window.addEventListener('mousemove', handler, {once: true, passive: true});\r\n        handler();\r\n      }\r\n\r\n      // r.classList.add('active');\r\n      // handler();\r\n    });\r\n    // });\r\n  };\r\n\r\n  const isRippleUnneeded = (e: Event) => {\r\n    return e.target !== elem && (\r\n      ['BUTTON', 'A'].includes((e.target as HTMLElement).tagName) ||\r\n        findUpClassName(e.target as HTMLElement, 'c-ripple') !== r\r\n    ) && (\r\n      attachListenerTo === elem ||\r\n        !findUpAsChild(e.target as HTMLElement, attachListenerTo)\r\n    ) && !findUpClassName(e.target, 'checkbox-field');\r\n  };\r\n\r\n  // TODO: rename this variable\r\n  let touchStartFired = false;\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    const touchEnd = () => {\r\n      handler?.();\r\n    };\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      if(!liteMode.isAvailable('animations')) {\r\n        return;\r\n      }\r\n\r\n      // console.log('ripple touchstart', e);\r\n      if(e.touches.length > 1 || touchStartFired || isRippleUnneeded(e)) {\r\n        return;\r\n      }\r\n\r\n      // console.log('touchstart', e);\r\n      touchStartFired = true;\r\n\r\n      const {clientX, clientY} = e.touches[0];\r\n      drawRipple(clientX, clientY);\r\n      attachListenerTo.addEventListener('touchend', touchEnd, {once: true});\r\n\r\n      window.addEventListener('touchmove', (e) => {\r\n        e.cancelBubble = true;\r\n        e.stopPropagation();\r\n        touchEnd();\r\n        attachListenerTo.removeEventListener('touchend', touchEnd);\r\n      }, {once: true});\r\n    };\r\n\r\n    attachListenerTo.addEventListener('touchstart', onTouchStart, {passive: true});\r\n    return {\r\n      dispose: () => attachListenerTo.removeEventListener('touchstart', onTouchStart),\r\n      element: r\r\n    };\r\n  } else {\r\n    const onMouseDown = (e: MouseEvent) => {\r\n      if(![0, 2].includes(e.button)) { // only left and right buttons\r\n        return;\r\n      }\r\n\r\n      if(!liteMode.isAvailable('animations')) {\r\n        return;\r\n      }\r\n      // console.log('ripple mousedown', e, e.target, findUpClassName(e.target as HTMLElement, 'c-ripple') === r);\r\n\r\n      if(attachListenerTo.dataset.ripple === '0' || isRippleUnneeded(e)) {\r\n        return;\r\n      } else if(touchStartFired) {\r\n        touchStartFired = false;\r\n        return;\r\n      }\r\n\r\n      const {clientX, clientY} = e;\r\n      drawRipple(clientX, clientY);\r\n      window.addEventListener('mouseup', handler, {once: true, passive: true});\r\n      window.addEventListener('contextmenu', handler, {once: true, passive: true});\r\n    };\r\n\r\n    attachListenerTo.addEventListener('mousedown', onMouseDown, {passive: true});\r\n    return {\r\n      dispose: () => attachListenerTo.removeEventListener('mousedown', onMouseDown),\r\n      element: r\r\n    };\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\nimport {IS_MOBILE, IS_APPLE} from '../../environment/userAgent';\r\n\r\nexport default function isSendShortcutPressed(e: KeyboardEvent) {\r\n  if(e.key === 'Enter' && !IS_MOBILE && !e.isComposing) {\r\n    /* if(e.ctrlKey || e.metaKey) {\r\n      this.messageInput.innerHTML += '<br>';\r\n      placeCaretAtEnd(this.message)\r\n      return;\r\n    } */\r\n\r\n    if(rootScope.settings.sendShortcut === 'enter') {\r\n      if(e.shiftKey || e.ctrlKey || e.metaKey) {\r\n        return;\r\n      }\r\n\r\n      return true;\r\n    } else {\r\n      const secondaryKey = IS_APPLE ? e.metaKey : e.ctrlKey;\r\n      if(e.shiftKey || (IS_APPLE ? e.ctrlKey : e.metaKey)) {\r\n        return;\r\n      }\r\n\r\n      if(secondaryKey) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\n\r\nexport function requestFullScreen(element: HTMLElement) {\r\n  if(element.requestFullscreen) {\r\n    element.requestFullscreen();\r\n    // @ts-ignore\r\n  } else if(element.mozRequestFullScreen) {\r\n    // @ts-ignore\r\n    element.mozRequestFullScreen(); // Firefox\r\n    // @ts-ignore\r\n  } else if(element.webkitRequestFullscreen) {\r\n    // @ts-ignore\r\n    element.webkitRequestFullscreen(); // Chrome and Safari\r\n    // @ts-ignore\r\n  } else if(element.msRequestFullscreen) {\r\n    // @ts-ignore\r\n    element.msRequestFullscreen();\r\n  }\r\n}\r\n\r\nexport function cancelFullScreen() {\r\n  // @ts-ignore\r\n  if(document.cancelFullScreen) {\r\n    // @ts-ignore\r\n    document.cancelFullScreen();\r\n    // @ts-ignore\r\n  } else if(document.mozCancelFullScreen) {\r\n    // @ts-ignore\r\n    document.mozCancelFullScreen();\r\n    // @ts-ignore\r\n  } else if(document.webkitCancelFullScreen) {\r\n    // @ts-ignore\r\n    document.webkitCancelFullScreen();\r\n    // @ts-ignore\r\n  } else if(document.msExitFullscreen) {\r\n    // @ts-ignore\r\n    document.msExitFullscreen();\r\n  }\r\n}\r\n\r\nexport function addFullScreenListener(element: HTMLElement, callback: (e: Event) => any, listenerSetter?: ListenerSetter) {\r\n  const addListener = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\r\n  'webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange'.split(' ').forEach((eventName) => {\r\n    addListener(eventName, callback, false);\r\n  });\r\n}\r\n\r\nexport function getFullScreenElement(): HTMLElement {\r\n  // @ts-ignore\r\n  return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;\r\n}\r\n\r\nexport function isFullScreen() {\r\n  return !!getFullScreenElement();\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's fastSmoothScroll slightly patched\r\n\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRafPromise} from './schedulers';\r\nimport {animateSingle, cancelAnimationByKey} from './animation';\r\nimport isInDOM from './dom/isInDOM';\r\nimport liteMode from './liteMode';\r\n\r\nconst MIN_JS_DURATION = 250;\r\nconst MAX_JS_DURATION = 600;\r\nconst LONG_TRANSITION_MAX_DISTANCE = 1500;\r\nconst SHORT_TRANSITION_MAX_DISTANCE = 500;\r\n\r\nexport enum FocusDirection {\r\n  Up,\r\n  Down,\r\n  Static,\r\n};\r\n\r\nexport type ScrollGetNormalSizeCallback = (options: {rect: DOMRect}) => number;\r\nexport type ScrollGetElementPositionCallback = (options: {elementRect: DOMRect, containerRect: DOMRect, elementPosition: number}) => number;\r\nexport type ScrollStartCallbackDimensions = {\r\n  scrollSize: number,\r\n  scrollPosition: number,\r\n  distanceToEnd: number,\r\n  path: number,\r\n  duration: number,\r\n  containerRect: DOMRect,\r\n  elementRect: DOMRect,\r\n  getProgress: () => number\r\n};\r\n\r\nexport type ScrollOptions = {\r\n  container: HTMLElement,\r\n  element: HTMLElement,\r\n  position: ScrollLogicalPosition,\r\n  margin?: number,\r\n  maxDistance?: number,\r\n  forceDirection?: FocusDirection,\r\n  forceDuration?: number,\r\n  axis?: 'x' | 'y',\r\n  getNormalSize?: ScrollGetNormalSizeCallback,\r\n  getElementPosition?: ScrollGetElementPositionCallback,\r\n  fallbackToElementStartWhenCentering?: HTMLElement,\r\n  startCallback?: (dimensions: ScrollStartCallbackDimensions) => void,\r\n  transitionFunction?: (value: number) => number\r\n};\r\n\r\nexport function fastSmoothScrollToStart(container: HTMLElement, axis: 'x') {\r\n  return fastSmoothScroll({\r\n    container: container,\r\n    element: container,\r\n    getElementPosition: () => -container.scrollLeft,\r\n    position: 'start',\r\n    axis: 'x'\r\n  });\r\n}\r\n\r\nexport default function fastSmoothScroll(options: ScrollOptions) {\r\n  options.margin ??= 0;\r\n  options.maxDistance ??= LONG_TRANSITION_MAX_DISTANCE;\r\n  options.axis ??= 'y';\r\n  // return;\r\n\r\n  if(!liteMode.isAvailable('animations') || options.forceDuration === 0) {\r\n    options.forceDirection = FocusDirection.Static;\r\n  }\r\n\r\n  if(options.forceDirection === FocusDirection.Static) {\r\n    options.forceDuration = 0;\r\n    return scrollWithJs(options);\r\n    /* return Promise.resolve();\r\n\r\n    element.scrollIntoView({ block: position });\r\n\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve(); */\r\n  }\r\n\r\n  const promise = fastRafPromise().then(() => scrollWithJs(options));\r\n\r\n  return options.axis === 'y' ? dispatchHeavyAnimationEvent(promise) : promise;\r\n}\r\n\r\nfunction scrollWithJs(options: ScrollOptions): Promise<void> {\r\n  const {element, container, getNormalSize, getElementPosition, transitionFunction, axis, margin, position, forceDirection, maxDistance, forceDuration} = options;\r\n  if(!isInDOM(element)) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const rectStartKey = axis === 'y' ? 'top' : 'left';\r\n  const rectEndKey = axis === 'y' ? 'bottom' : 'right';\r\n  const sizeKey = axis === 'y' ? 'height' : 'width';\r\n  const scrollSizeKey = axis === 'y' ? 'scrollHeight' : 'scrollWidth';\r\n  const elementScrollSizeKey = axis === 'y' ? 'scrollHeight' : 'offsetWidth'; // can use offsetWidth for X, since it's almost same as scrollWidth\r\n  const scrollPositionKey = axis === 'y' ? 'scrollTop' : 'scrollLeft';\r\n\r\n  // const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\r\n  const elementRect = element.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect ? container.getBoundingClientRect() : document.body.getBoundingClientRect();\r\n\r\n  // const transformable = container.firstElementChild as HTMLElement;\r\n\r\n  const possibleElementPosition = elementRect[rectStartKey] - containerRect[rectStartKey];\r\n  const elementPosition = getElementPosition ? getElementPosition({elementRect, containerRect, elementPosition: possibleElementPosition}) : possibleElementPosition;\r\n  const elementSize = element[elementScrollSizeKey]; // margin is exclusive in DOMRect\r\n\r\n  const containerSize = getNormalSize ? getNormalSize({rect: containerRect}) : containerRect[sizeKey];\r\n\r\n  let scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  /* const elementPosition = element.offsetTop;\r\n  const elementSize = element.offsetHeight;\r\n\r\n  const scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  const containerSize = container.offsetHeight; */\r\n\r\n  let path!: number;\r\n\r\n  switch(position) {\r\n    case 'start':\r\n      path = elementPosition - margin;\r\n      break;\r\n    case 'end':\r\n      path = elementRect[rectEndKey] /* + (elementSize - elementRect[sizeKey]) */ - containerRect[rectEndKey] + margin;\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      if(elementSize < containerSize) {\r\n        path = (elementPosition + elementSize / 2) - (containerSize / 2);\r\n      } else {\r\n        if(options.fallbackToElementStartWhenCentering && options.fallbackToElementStartWhenCentering !== element) {\r\n          options.element = options.fallbackToElementStartWhenCentering;\r\n          options.position = 'start';\r\n          return scrollWithJs(options);\r\n        }\r\n\r\n        path = elementPosition - margin;\r\n      }\r\n\r\n      break;\r\n  }\r\n  /* switch (position) {\r\n    case 'start':\r\n      path = (elementPosition - margin) - scrollPosition;\r\n      break;\r\n    case 'end':\r\n      path = (elementPosition + elementSize + margin) - (scrollPosition + containerSize);\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      path = elementSize < containerSize\r\n        ? (elementPosition + elementSize / 2) - (scrollPosition + containerSize / 2)\r\n        : (elementPosition - margin) - scrollPosition;\r\n      break;\r\n  } */\r\n\r\n  if(Math.abs(path - (margin || 0)) < 1) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  let jumpToScrollPosition: number;\r\n  if(axis === 'y') {\r\n    if(forceDirection === undefined) {\r\n      if(path > maxDistance) {\r\n        jumpToScrollPosition = scrollPosition += path - maxDistance;\r\n        path = maxDistance;\r\n      } else if(path < -maxDistance) {\r\n        jumpToScrollPosition = scrollPosition += path + maxDistance;\r\n        path = -maxDistance;\r\n      }\r\n    }/*  else if(forceDirection === FocusDirection.Up) { // * not tested yet\r\n      container.scrollTop = offsetTop + container.scrollTop + maxDistance;\r\n    } else if(forceDirection === FocusDirection.Down) { // * not tested yet\r\n      container.scrollTop = Math.max(0, offsetTop + container.scrollTop - maxDistance);\r\n    } */\r\n  }\r\n\r\n  // console.log('scrollWithJs: will scroll path:', path, element);\r\n\r\n  /* let existsTransform = 0;\r\n  const currentTransform = transformable.style.transform;\r\n  if(currentTransform) {\r\n    existsTransform = parseInt(currentTransform.match(/\\((.+?), (.+?), .+\\)/)[2]);\r\n    //path += existsTransform;\r\n  } */\r\n\r\n  if(path < 0) {\r\n    const remainingPath = -scrollPosition;\r\n    path = Math.max(path, remainingPath);\r\n  } else if(path > 0) {\r\n    const remainingPath = scrollSize - (scrollPosition + containerSize);\r\n    path = Math.min(path, remainingPath);\r\n  }\r\n\r\n  const target = scrollPosition + path;\r\n  const absPath = Math.abs(path);\r\n  const duration = forceDuration ?? (\r\n    MIN_JS_DURATION + (absPath / LONG_TRANSITION_MAX_DISTANCE) * (MAX_JS_DURATION - MIN_JS_DURATION)\r\n  );\r\n  const startAt = Date.now();\r\n\r\n  /* transformable.classList.add('no-transition');\r\n\r\n  const tickTransform = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n    const currentPath = path * transition(t);\r\n\r\n    transformable.style.transform = `translate3d(0, ${-currentPath}px, 0)`;\r\n    container.dataset.translate = '' + -currentPath;\r\n\r\n    const willContinue = t < 1;\r\n    if(!willContinue) {\r\n      fastRaf(() => {\r\n        delete container.dataset.transform;\r\n        container.dataset.transform = '';\r\n        transformable.style.transform = '';\r\n        void transformable.offsetLeft; // reflow\r\n        transformable.classList.remove('no-transition');\r\n        void transformable.offsetLeft; // reflow\r\n        container[scrollPositionKey] = Math.round(target);\r\n      });\r\n    }\r\n\r\n    return willContinue;\r\n  };\r\n\r\n  return animateSingle(tickTransform, container); */\r\n\r\n  /* return new Promise((resolve) => {\r\n    fastRaf(() => {\r\n      transformable.style.transform = '';\r\n      transformable.style.transition = '';\r\n\r\n      setTimeout(resolve, duration);\r\n    });\r\n  });\r\n\r\n  const transformableHeight = transformable.scrollHeight;\r\n  //transformable.style.minHeight = `${transformableHeight}px`;\r\n  */\r\n\r\n  const transition = transitionFunction ?? (absPath < SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition);\r\n  const getProgress = () => duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n  const tick = () => {\r\n    if(jumpToScrollPosition !== undefined) {\r\n      container[scrollPositionKey] = jumpToScrollPosition;\r\n      jumpToScrollPosition = undefined;\r\n    }\r\n\r\n    const t = getProgress();\r\n    const value = transition(t);\r\n    const currentPath = path * (1 - value);\r\n    container[scrollPositionKey] = Math.round(target - currentPath);\r\n\r\n    return t < 1;\r\n  };\r\n\r\n  if(!duration || !path) {\r\n    cancelAnimationByKey(container);\r\n    tick();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /* return new Promise((resolve) => {\r\n    setTimeout(resolve, duration);\r\n  }).then(() => {\r\n    transformable.classList.add('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.style.transform = '';\r\n    transformable.style.transition = '';\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.classList.remove('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    fastRaf(() => {\r\n\r\n      container[scrollPositionKey] = Math.round(target);\r\n      //transformable.style.minHeight = ``;\r\n    });\r\n\r\n  }); */\r\n\r\n  if(options.startCallback) {\r\n    const distanceToEnd = scrollSize - Math.round(target + container[axis === 'y' ? 'offsetHeight' : 'offsetWidth']);\r\n    options.startCallback({\r\n      scrollSize,\r\n      scrollPosition,\r\n      distanceToEnd,\r\n      path,\r\n      duration,\r\n      containerRect,\r\n      elementRect,\r\n      getProgress\r\n    });\r\n  }\r\n\r\n  return animateSingle(tick, container);\r\n}\r\n\r\nfunction longTransition(t: number) {\r\n  return 1 - ((1 - t) ** 5);\r\n}\r\n\r\nfunction shortTransition(t: number) {\r\n  return 1 - ((1 - t) ** 3.5);\r\n}\r\n\r\nexport {shortTransition as shortScrollTransition};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {logger, LogTypes} from '../lib/logger';\r\nimport fastSmoothScroll, {ScrollOptions} from '../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {IS_OVERLAY_SCROLL_SUPPORTED} from '../environment/overlayScrollSupport';\r\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../environment/userAgent';\r\n/*\r\nvar el = $0;\r\nvar height = 0;\r\nvar checkUp = false;\r\n\r\ndo {\r\n  height += el.scrollHeight;\r\n} while(el = (checkUp ? el.previousElementSibling : el.nextElementSibling));\r\nconsole.log(height);\r\n*/\r\n\r\n/*\r\nArray.from($0.querySelectorAll('.bubble-content')).forEach((_el) => {\r\n  //_el.style.display = '';\r\n  //return;\r\n\r\n  let el = _el.parentElement;\r\n  let height = el.scrollHeight;\r\n  let width = el.scrollWidth;\r\n  el.style.width = width + 'px';\r\n  el.style.height = height + 'px';\r\n  _el.style.display = 'none';\r\n});\r\n*/\r\n\r\n/* const scrollables: Map<HTMLElement, Scrollable> = new Map();\r\nconst scrollsIntersector = new IntersectionObserver((entries) => {\r\n  for(let entry of entries) {\r\n    const scrollable = scrollables.get(entry.target as HTMLElement);\r\n\r\n    if(entry.isIntersecting) {\r\n      scrollable.isVisible = true;\r\n    } else {\r\n      scrollable.isVisible = false;\r\n\r\n      if(!isInDOM(entry.target)) {\r\n        scrollsIntersector.unobserve(scrollable.container);\r\n        scrollables.delete(scrollable.container);\r\n      }\r\n    }\r\n  }\r\n}); */\r\n\r\nconst SCROLL_THROTTLE = /* IS_ANDROID ? 200 :  */24;\r\nconst USE_OWN_SCROLL = !IS_OVERLAY_SCROLL_SUPPORTED;\r\n\r\nlet throttleMeasurement: (callback: () => void) => number,\r\n  cancelMeasurement: (id: number) => void;\r\nif(USE_OWN_SCROLL) {\r\n  throttleMeasurement = (callback) => requestAnimationFrame(callback);\r\n  cancelMeasurement = (id) => cancelAnimationFrame(id);\r\n} else {\r\n  throttleMeasurement = (callback) => window.setTimeout(callback, SCROLL_THROTTLE);\r\n  cancelMeasurement = (id) => window.clearTimeout(id);\r\n}\r\n\r\nexport class ScrollableBase {\r\n  protected log: ReturnType<typeof logger>;\r\n\r\n  public padding: HTMLElement;\r\n  public splitUp: HTMLElement;\r\n  public onScrollMeasure: number = 0;\r\n\r\n  public lastScrollPosition: number = 0;\r\n  public lastScrollDirection: number = 0;\r\n\r\n  public onAdditionalScroll: () => void;\r\n  public onScrolledTop: () => void;\r\n  public onScrolledBottom: () => void;\r\n\r\n  public isHeavyAnimationInProgress = false;\r\n  protected needCheckAfterAnimation = false;\r\n\r\n  public checkForTriggers?: () => void;\r\n\r\n  public scrollPositionProperty: 'scrollTop' | 'scrollLeft';\r\n  public scrollSizeProperty: 'scrollHeight' | 'scrollWidth';\r\n  public clientSizeProperty: 'clientHeight' | 'clientWidth';\r\n  public offsetSizeProperty: 'offsetHeight' | 'offsetWidth';\r\n  public clientAxis: 'clientY' | 'clientX';\r\n\r\n  protected startMousePosition: number;\r\n  protected startScrollPosition: number;\r\n\r\n  protected thumb: HTMLElement;\r\n  protected thumbContainer: HTMLElement;\r\n\r\n  protected removeHeavyAnimationListener: () => void;\r\n  protected addedScrollListener: boolean;\r\n\r\n  constructor(\r\n    public el?: HTMLElement,\r\n    logPrefix = '',\r\n    public container: HTMLElement = document.createElement('div')\r\n  ) {\r\n    this.container.classList.add('scrollable');\r\n\r\n    this.log = logger('SCROLL' + (logPrefix ? '-' + logPrefix : ''), LogTypes.Error);\r\n\r\n    if(el) {\r\n      Array.from(el.children).forEach((c) => this.container.append(c));\r\n\r\n      el.append(this.container);\r\n    }\r\n\r\n    // this.onScroll();\r\n  }\r\n\r\n  public addScrollListener() {\r\n    if(this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = true;\r\n    this.container.addEventListener('scroll', this.onScroll, {passive: true, capture: true});\r\n  }\r\n\r\n  public removeScrollListener() {\r\n    if(!this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = false;\r\n    this.container.removeEventListener('scroll', this.onScroll, {capture: true});\r\n  }\r\n\r\n  public setListeners() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onScroll, {passive: true});\r\n    this.addScrollListener();\r\n\r\n    this.removeHeavyAnimationListener = useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n\r\n      if(this.onScrollMeasure) {\r\n        this.cancelMeasure();\r\n        this.needCheckAfterAnimation = true;\r\n      }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(this.needCheckAfterAnimation) {\r\n        this.onScroll();\r\n        this.needCheckAfterAnimation = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onScroll);\r\n    if(this.thumb) {\r\n      this.thumb.removeEventListener('mousedown', this.onMouseMove);\r\n      window.removeEventListener('mousemove', this.onMouseMove);\r\n      window.removeEventListener('mouseup', this.onMouseUp);\r\n    }\r\n    this.removeScrollListener();\r\n\r\n    this.removeHeavyAnimationListener();\r\n    this.removeHeavyAnimationListener = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    this.removeListeners();\r\n    this.onAdditionalScroll = undefined;\r\n    this.onScrolledTop = undefined;\r\n    this.onScrolledBottom = undefined;\r\n  }\r\n\r\n  public prepend(...elements: (string | Node)[]) {\r\n    const prependTo = this.splitUp || this.padding || this.container;\r\n    this.thumb && /* prependTo === this.container &&  */elements.unshift(this.thumbContainer);\r\n    prependTo.prepend(...elements);\r\n    this.onSizeChange();\r\n  }\r\n\r\n  public append(...elements: (string | Node)[]) {\r\n    (this.splitUp || this.padding || this.container).append(...elements);\r\n    this.onSizeChange();\r\n  }\r\n\r\n  public scrollIntoViewNew(options: Omit<ScrollOptions, 'container'>) {\r\n    // return Promise.resolve();\r\n    // this.removeListeners();\r\n    return fastSmoothScroll({\r\n      ...options,\r\n      container: this.container\r\n    });/* .finally(() => {\r\n      this.setListeners();\r\n    }); */\r\n  }\r\n\r\n  public onScroll = () => {\r\n    // if(this.debug) {\r\n    // this.log('onScroll call', this.onScrollMeasure);\r\n    // }\r\n\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.cancelMeasure();\r\n      this.needCheckAfterAnimation = true;\r\n      return;\r\n    }\r\n\r\n    // if(this.onScrollMeasure || ((this.scrollLocked || (!this.onScrolledTop && !this.onScrolledBottom)) && !this.splitUp && !this.onAdditionalScroll)) return;\r\n    if((!this.onScrolledTop && !this.onScrolledBottom) && !this.splitUp && !this.onAdditionalScroll) return;\r\n    if(this.onScrollMeasure) return;\r\n    this.onScrollMeasure = throttleMeasurement(() => {\r\n      this.onScrollMeasure = 0;\r\n\r\n      const scrollPosition = this.scrollPosition;\r\n      this.lastScrollDirection = this.lastScrollPosition === scrollPosition ? 0 : (this.lastScrollPosition < scrollPosition ? 1 : -1); // * 1 - bottom, -1 - top\r\n      this.lastScrollPosition = scrollPosition;\r\n\r\n      this.updateThumb(scrollPosition);\r\n\r\n      // lastScrollDirection check is useless here, every callback should decide on its own\r\n      if(this.onAdditionalScroll/*  && this.lastScrollDirection !== 0 */) {\r\n        this.onAdditionalScroll();\r\n      }\r\n\r\n      if(this.checkForTriggers) {\r\n        this.checkForTriggers();\r\n      }\r\n    });\r\n  };\r\n\r\n  public updateThumb(scrollPosition = this.scrollPosition) {\r\n    if(!USE_OWN_SCROLL || !this.thumb) {\r\n      return;\r\n    }\r\n\r\n    const scrollSize = this.container[this.scrollSizeProperty];\r\n    const clientSize = this.container[this.clientSizeProperty];\r\n    const divider = scrollSize / clientSize / 0.75;\r\n    const thumbSize = Math.max(20, clientSize / divider);\r\n    const value = scrollPosition / (scrollSize - clientSize) * clientSize;\r\n    // const b = (scrollPosition + clientSize) / scrollSize;\r\n    const b = scrollPosition / (scrollSize - clientSize);\r\n    const maxValue = clientSize - thumbSize;\r\n    if(clientSize < scrollSize) {\r\n      this.thumb.style.height = thumbSize + 'px';\r\n      // this.thumb.style.top = `${Math.min(maxValue, value - thumbSize * b)}px`;\r\n      this.thumb.style.transform = `translateY(${Math.min(maxValue, value - thumbSize * b)}px)`;\r\n    } else {\r\n      this.thumb.style.height = '0px';\r\n    }\r\n  }\r\n\r\n  public cancelMeasure() {\r\n    if(this.onScrollMeasure) {\r\n      cancelMeasurement(this.onScrollMeasure);\r\n      this.onScrollMeasure = 0;\r\n    }\r\n  }\r\n\r\n  protected onMouseMove = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n\r\n    const contentHeight = this.scrollSize;\r\n    const viewportHeight = this.clientSize;\r\n    const scrollbarSize = this.thumb.offsetHeight;\r\n    const maxScrollTop = contentHeight - viewportHeight;\r\n\r\n    const maxScrollbarOffset = viewportHeight - scrollbarSize;\r\n    const deltaY = e[this.clientAxis] - this.startMousePosition;\r\n    const scrollAmount = (deltaY / maxScrollbarOffset) * maxScrollTop;\r\n    const newScrollTop = this.startScrollPosition + scrollAmount;\r\n\r\n    this.scrollPosition = newScrollTop;\r\n  };\r\n\r\n  protected onMouseDown = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.startMousePosition = e[this.clientAxis];\r\n    this.startScrollPosition = this.scrollPosition;\r\n    this.thumb.classList.add('is-focused');\r\n\r\n    window.addEventListener('mousemove', this.onMouseMove);\r\n    window.addEventListener('mouseup', this.onMouseUp, {once: true});\r\n  };\r\n\r\n  protected onMouseUp = (e: MouseEvent) => {\r\n    window.removeEventListener('mousemove', this.onMouseMove);\r\n    this.thumb.classList.remove('is-focused');\r\n  };\r\n\r\n  public onSizeChange() {\r\n    if(USE_OWN_SCROLL && this.thumb) {\r\n      this.onScroll();\r\n    }\r\n  }\r\n\r\n  public getDistanceToEnd() {\r\n    return this.scrollSize - Math.round(this.scrollPosition + this.offsetSize);\r\n  }\r\n\r\n  get isScrolledToEnd() {\r\n    return this.getDistanceToEnd() <= 1;\r\n  }\r\n\r\n  get scrollPosition() {\r\n    return this.container[this.scrollPositionProperty];\r\n  }\r\n\r\n  set scrollPosition(value: number) {\r\n    this.container[this.scrollPositionProperty] = value;\r\n  }\r\n\r\n  get scrollSize() {\r\n    return this.container[this.scrollSizeProperty];\r\n  }\r\n\r\n  get clientSize() {\r\n    return this.container[this.clientSizeProperty];\r\n  }\r\n\r\n  get offsetSize() {\r\n    return this.container[this.offsetSizeProperty];\r\n  }\r\n\r\n  get firstElementChild() {\r\n    return this.thumb ? this.thumbContainer.nextElementSibling : this.container.firstElementChild;\r\n  }\r\n\r\n  public setScrollPositionSilently(value: number) {\r\n    this.lastScrollPosition = value;\r\n    this.ignoreNextScrollEvent();\r\n\r\n    this.scrollPosition = value;\r\n  }\r\n\r\n  public ignoreNextScrollEvent() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      this.removeScrollListener();\r\n      this.container.addEventListener('scroll', (e) => {\r\n        cancelEvent(e);\r\n        this.addScrollListener();\r\n      }, {capture: true, passive: false, once: true});\r\n    }\r\n  }\r\n\r\n  public replaceChildren(...args: (string | Node)[]) {\r\n    this.thumb && args.unshift(this.thumbContainer);\r\n    this.container.replaceChildren(...args);\r\n  }\r\n}\r\n\r\nexport type SliceSides = 'top' | 'bottom';\r\nexport type SliceSidesContainer = {[k in SliceSides]: boolean};\r\n\r\nexport default class Scrollable extends ScrollableBase {\r\n  public loadedAll: SliceSidesContainer = {top: true, bottom: false};\r\n\r\n  constructor(\r\n    el?: HTMLElement,\r\n    logPrefix = '',\r\n    public onScrollOffset = 300,\r\n    withPaddingContainer?: boolean,\r\n    container?: HTMLElement\r\n  ) {\r\n    super(el, logPrefix, container);\r\n\r\n    // withPaddingContainer = true;\r\n    // if(withPaddingContainer) {\r\n    //   this.padding = document.createElement('div');\r\n    //   this.padding.classList.add('scrollable-padding');\r\n    //   this.padding.append(...Array.from(this.container.children));\r\n    //   this.container.append(this.padding);\r\n    // }\r\n\r\n    this.scrollPositionProperty = 'scrollTop';\r\n    this.scrollSizeProperty = 'scrollHeight';\r\n    this.clientSizeProperty = 'clientHeight';\r\n    this.offsetSizeProperty = 'offsetHeight';\r\n    this.clientAxis = 'clientY';\r\n\r\n    if(USE_OWN_SCROLL) {\r\n      this.thumbContainer = document.createElement('div');\r\n      this.thumbContainer.classList.add('scrollable-thumb-container');\r\n      this.thumb = document.createElement('div');\r\n      this.thumb.classList.add('scrollable-thumb');\r\n      this.thumbContainer.append(this.thumb);\r\n      this.container.prepend(this.thumbContainer);\r\n\r\n      this.thumb.addEventListener('mousedown', this.onMouseDown);\r\n    }\r\n\r\n    this.container.classList.add('scrollable-y');\r\n    if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      this.container.classList.add('no-scrollbar');\r\n    }\r\n    this.setListeners();\r\n  }\r\n\r\n  public attachBorderListeners(setClassOn = this.container) {\r\n    const cb = this.onAdditionalScroll;\r\n    this.onAdditionalScroll = () => {\r\n      cb?.();\r\n      setClassOn.classList.toggle('scrolled-start', !this.scrollPosition);\r\n      setClassOn.classList.toggle('scrolled-end', this.isScrolledToEnd);\r\n    };\r\n\r\n    setClassOn.classList.add('scrolled-start', 'scrolled-end', 'scrollable-y-bordered');\r\n  }\r\n\r\n  public setVirtualContainer(el?: HTMLElement) {\r\n    this.splitUp = el;\r\n    this.log('setVirtualContainer:', el, this);\r\n  }\r\n\r\n  public checkForTriggers = () => {\r\n    if((!this.onScrolledTop && !this.onScrolledBottom)) return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.onScroll();\r\n      return;\r\n    }\r\n\r\n    const {scrollSize, scrollPosition, clientSize} = this;\r\n    if(!scrollSize) { // незачем вызывать триггеры если блок пустой или не виден\r\n      return;\r\n    }\r\n\r\n    const maxScrollPosition = scrollSize - clientSize;\r\n\r\n    // this.log('checkForTriggers:', scrollTop, maxScrollTop);\r\n\r\n    if(this.onScrolledTop && scrollPosition <= this.onScrollOffset && this.lastScrollDirection <= 0/* && direction === -1 */) {\r\n      this.onScrolledTop();\r\n    }\r\n\r\n    if(this.onScrolledBottom && (maxScrollPosition - scrollPosition) <= this.onScrollOffset && this.lastScrollDirection >= 0/* && direction === 1 */) {\r\n      this.onScrolledBottom();\r\n    }\r\n  };\r\n}\r\n\r\nexport class ScrollableX extends ScrollableBase {\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, public splitCount = 15, public container: HTMLElement = document.createElement('div')) {\r\n    super(el, logPrefix, container);\r\n\r\n    this.container.classList.add('scrollable-x');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const scrollHorizontally = (e: WheelEvent) => {\r\n        e.stopPropagation();\r\n        if(!e.deltaX && this.container.scrollWidth > this.container.clientWidth) {\r\n          this.container.scrollLeft += e.deltaY / 4;\r\n          cancelEvent(e);\r\n        }\r\n      };\r\n\r\n      this.container.addEventListener('wheel', scrollHorizontally, {passive: false});\r\n    }\r\n\r\n    this.scrollPositionProperty = 'scrollLeft';\r\n    this.scrollSizeProperty = 'scrollWidth';\r\n    this.clientSizeProperty = 'clientWidth';\r\n    this.offsetSizeProperty = 'offsetWidth';\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\nimport Icon from './icon';\r\nimport ripple from './ripple';\r\n\r\nexport type ButtonOptions = Partial<{\r\n  noRipple: true,\r\n  onlyMobile: true,\r\n  icon: Icon,\r\n  rippleSquare: true,\r\n  text: LangPackKey,\r\n  textArgs?: FormatterArguments,\r\n  disabled: boolean,\r\n  asDiv: boolean,\r\n  asLink: boolean\r\n}>;\r\n\r\nexport default function Button<T extends ButtonOptions>(className: string, options: T = {} as T): T['asLink'] extends true ? HTMLAnchorElement : HTMLButtonElement {\r\n  const button = document.createElement(options.asLink ? 'a' : (options.asDiv ? 'div' : 'button'));\r\n  button.className = className;\r\n\r\n  if(!options.noRipple) {\r\n    if(options.rippleSquare) {\r\n      button.classList.add('rp-square');\r\n    }\r\n\r\n    ripple(button);\r\n  }\r\n\r\n  if(options.icon) {\r\n    replaceButtonIcon(button, options.icon, false);\r\n  }\r\n\r\n  if(options.onlyMobile) {\r\n    button.classList.add('only-handhelds');\r\n  }\r\n\r\n  if(options.disabled) {\r\n    button.setAttribute('disabled', 'true');\r\n  }\r\n\r\n  if(options.text) {\r\n    button.append(i18n(options.text, options.textArgs));\r\n  }\r\n\r\n  return button as any;\r\n}\r\n\r\nexport function replaceButtonIcon(element: HTMLElement, icon: Icon, oldIcon: Element | false = element.querySelector('.button-icon')) {\r\n  const newIcon = Icon(icon, 'button-icon');\r\n  if(oldIcon) oldIcon.replaceWith(newIcon);\r\n  else element.append(newIcon);\r\n  return newIcon;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonIcon = (className?: (string & {}) | Icon, options: Partial<{noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const splitted = className?.split(' ');\r\n  const button = Button('btn-icon' + (splitted?.length > 1 ? ' ' + splitted.slice(1).join(' ') : ''), {\r\n    icon: splitted?.[0] as Icon || undefined,\r\n    ...options\r\n  });\r\n\r\n  return button;\r\n};\r\n\r\nexport default ButtonIcon;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport toArray from '../array/toArray';\r\n\r\nexport default function toggleDisability(elements: HTMLElement | HTMLElement[], disable: boolean): () => void {\r\n  elements = toArray(elements);\r\n\r\n  if(disable) {\r\n    elements.forEach((el) => el.setAttribute('disabled', 'true'));\r\n  } else {\r\n    elements.forEach((el) => el.removeAttribute('disabled'));\r\n  }\r\n\r\n  return () => toggleDisability(elements, !disable);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ripple from '../ripple';\r\nimport animationIntersector from '../animationIntersector';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {i18n, LangPackKey, _i18n} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\r\nimport {addFullScreenListener, getFullScreenElement} from '../../helpers/dom/fullScreen';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport Scrollable from '../scrollable';\r\nimport {getMiddleware, MiddlewareHelper} from '../../helpers/middleware';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport Icon from '../icon';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport {JSX} from 'solid-js';\r\nimport {render} from 'solid-js/web';\r\n\r\nexport type PopupButton = {\r\n  text?: HTMLElement | DocumentFragment | Text,\r\n  callback?: (e: MouseEvent) => void | MaybePromise<boolean>,\r\n  langKey?: LangPackKey,\r\n  langArgs?: any[],\r\n  isDanger?: boolean,\r\n  isCancel?: boolean,\r\n  element?: HTMLButtonElement,\r\n  noRipple?: boolean,\r\n  iconLeft?: Icon,\r\n  iconRight?: Icon\r\n};\r\n\r\nexport type PopupOptions = Partial<{\r\n  closable: boolean,\r\n  onBackClick: () => void | false,\r\n  isConfirmationNeededOnClose: () => void | boolean | Promise<any>, // should return boolean instantly or `Promise` from `confirmationPopup`\r\n  overlayClosable: boolean,\r\n  withConfirm: LangPackKey | boolean,\r\n  body: boolean,\r\n  footer: boolean,\r\n  confirmShortcutIsSendShortcut: boolean,\r\n  withoutOverlay: boolean,\r\n  scrollable: boolean,\r\n  buttons: Array<PopupButton>,\r\n  title: boolean | LangPackKey | DocumentFragment | HTMLElement,\r\n  floatingHeader: boolean,\r\n  withFooterConfirm: boolean\r\n}>;\r\n\r\nexport interface PopupElementConstructable<T extends PopupElement = any> {\r\n  new(...args: any[]): T;\r\n}\r\n\r\nconst DEFAULT_APPEND_TO = document.body;\r\nlet appendPopupTo = DEFAULT_APPEND_TO;\r\n\r\nconst onFullScreenChange = () => {\r\n  appendPopupTo = getFullScreenElement() || DEFAULT_APPEND_TO;\r\n  PopupElement.reAppend();\r\n};\r\n\r\naddFullScreenListener(DEFAULT_APPEND_TO, onFullScreenChange);\r\n\r\ntype PopupListeners = {\r\n  close: () => void,\r\n  closeAfterTimeout: () => void\r\n};\r\n\r\nexport default class PopupElement<T extends EventListenerListeners = {}> extends EventListenerBase<PopupListeners & T> {\r\n  private static POPUPS: PopupElement<any>[] = [];\r\n  public static MANAGERS: AppManagers;\r\n\r\n  protected element = document.createElement('div');\r\n  protected container = document.createElement('div');\r\n  protected header = document.createElement('div');\r\n  protected title = document.createElement('div');\r\n  protected footer: HTMLElement;\r\n  protected btnClose: HTMLElement;\r\n  protected btnCloseAnimatedIcon: HTMLElement;\r\n  protected btnConfirm: HTMLButtonElement;\r\n  protected body: HTMLElement;\r\n  protected buttonsEl: HTMLElement;\r\n\r\n  protected isConfirmationNeededOnClose: PopupOptions['isConfirmationNeededOnClose'];\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  protected listenerSetter: ListenerSetter;\r\n\r\n  protected confirmShortcutIsSendShortcut: boolean;\r\n  protected btnConfirmOnEnter: HTMLElement;\r\n\r\n  protected withoutOverlay: boolean;\r\n\r\n  protected managers: AppManagers;\r\n\r\n  protected scrollable: Scrollable;\r\n\r\n  protected buttons: Array<PopupButton>;\r\n\r\n  protected middlewareHelper: MiddlewareHelper;\r\n  protected destroyed: boolean;\r\n  protected shown: boolean;\r\n\r\n  protected night: boolean;\r\n\r\n  constructor(className: string, options: PopupOptions = {}) {\r\n    super(false);\r\n    this.element.classList.add('popup');\r\n    this.element.className = 'popup' + (className ? ' ' + className : '');\r\n    this.container.classList.add('popup-container', 'z-depth-1');\r\n\r\n    if(overlayCounter.isDarkOverlayActive) {\r\n      this.night = true;\r\n      this.element.classList.add('night');\r\n    }\r\n\r\n    this.header.classList.add('popup-header');\r\n\r\n    if(options.title) {\r\n      this.title.classList.add('popup-title');\r\n      if(typeof(options.title) === 'string') {\r\n        _i18n(this.title, options.title);\r\n      } else if(typeof(options.title) !== 'boolean') {\r\n        this.title.append(options.title);\r\n      }\r\n\r\n      this.header.append(this.title);\r\n    }\r\n\r\n    this.isConfirmationNeededOnClose = options.isConfirmationNeededOnClose;\r\n    this.middlewareHelper = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.managers = PopupElement.MANAGERS;\r\n\r\n    this.confirmShortcutIsSendShortcut = options.confirmShortcutIsSendShortcut;\r\n\r\n    if(options.closable) {\r\n      this.btnClose = ButtonIcon('', {noRipple: true});\r\n      this.btnClose.classList.add('popup-close');\r\n      // ripple(this.closeBtn);\r\n      this.header.prepend(this.btnClose);\r\n\r\n      if(options.onBackClick) {\r\n        this.btnCloseAnimatedIcon = document.createElement('div');\r\n        this.btnCloseAnimatedIcon.classList.add('animated-close-icon');\r\n        this.btnClose.append(this.btnCloseAnimatedIcon);\r\n      } else {\r\n        this.btnClose.append(Icon('close'));\r\n      }\r\n\r\n      attachClickEvent(this.btnClose, () => {\r\n        if(options.onBackClick && this.btnCloseAnimatedIcon.classList.contains('state-back')) {\r\n          if(options.onBackClick() !== false) {\r\n            this.btnCloseAnimatedIcon.classList.remove('state-back');\r\n          }\r\n        } else {\r\n          this.hide();\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    this.withoutOverlay = options.withoutOverlay;\r\n    if(this.withoutOverlay) {\r\n      this.element.classList.add('no-overlay');\r\n    }\r\n\r\n    if(options.overlayClosable) {\r\n      attachClickEvent(this.element, (e: MouseEvent) => {\r\n        if(findUpClassName(e.target, 'popup-container') || !(e.target as HTMLElement).isConnected) {\r\n          return;\r\n        }\r\n\r\n        this.hide();\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(options.withConfirm) {\r\n      this.btnConfirm = document.createElement('button');\r\n      this.btnConfirm.classList.add('btn-primary', 'btn-color-primary');\r\n      if(options.withConfirm !== true) {\r\n        this.btnConfirm.append(i18n(options.withConfirm));\r\n      }\r\n      this.header.append(this.btnConfirm);\r\n      // ripple(this.btnConfirm);\r\n    }\r\n\r\n    this.container.append(this.header);\r\n    if(options.body) {\r\n      this.body = document.createElement('div');\r\n      this.body.classList.add('popup-body');\r\n      this.container.append(this.body);\r\n    }\r\n\r\n    if(options.scrollable) {\r\n      const scrollable = this.scrollable = new Scrollable(this.body);\r\n      this.attachScrollableListeners();\r\n\r\n      if(options.floatingHeader) {\r\n        this.attachScrollableListeners(this.header);\r\n        const background = document.createElement('div');\r\n        background.classList.add('popup-header-background');\r\n        this.header.prepend(background);\r\n        this.header.classList.add('is-floating');\r\n      }\r\n\r\n      if(!this.body) {\r\n        this.header.after(scrollable.container);\r\n      }\r\n    }\r\n\r\n    if(options.footer) {\r\n      this.footer = document.createElement('div');\r\n      this.footer.classList.add('popup-footer');\r\n      (this.body || this.container).append(this.footer);\r\n\r\n      if(options.withFooterConfirm) {\r\n        this.footer.append(this.btnConfirm);\r\n      }\r\n    }\r\n\r\n    this.btnConfirmOnEnter = this.btnConfirm;\r\n    this.setButtons(options.buttons);\r\n\r\n    this.element.append(this.container);\r\n\r\n    PopupElement.POPUPS.push(this);\r\n  }\r\n\r\n  protected setButtons(buttons: PopupButton[]) {\r\n    this.buttons = buttons;\r\n    if(this.buttonsEl) {\r\n      this.buttonsEl.remove();\r\n      this.buttonsEl = undefined;\r\n    }\r\n\r\n    if(!buttons?.length) {\r\n      return;\r\n    }\r\n\r\n    const buttonsDiv = this.buttonsEl = document.createElement('div');\r\n    buttonsDiv.classList.add('popup-buttons');\r\n\r\n    const buttonsElements = buttons.map((b) => {\r\n      const button = document.createElement('button');\r\n      button.className = 'popup-button btn' + (b.isDanger ? ' danger' : ' primary');\r\n\r\n      if(!b.noRipple) {\r\n        ripple(button);\r\n      }\r\n\r\n      if(b.text) {\r\n        button.append(b.text);\r\n      } else if(b.langKey) {\r\n        button.append(i18n(b.langKey, b.langArgs));\r\n      }\r\n\r\n      if(b.iconLeft || b.iconRight) {\r\n        const i = Icon(b.iconLeft || b.iconRight, 'popup-button-icon', b.iconLeft ? 'left' : 'right');\r\n        button.classList.add('with-icon');\r\n        if(b.iconLeft) button.prepend(i);\r\n        else button.append(i);\r\n      }\r\n\r\n      attachClickEvent(button, async(e) => {\r\n        let result = b.callback?.(e);\r\n        if(result !== undefined && result instanceof Promise) {\r\n          const toggle = toggleDisability([b.element], true);\r\n          try {\r\n            result = await result;\r\n          } catch(err) {\r\n            result = false;\r\n          }\r\n\r\n          if(result === false) {\r\n            toggle();\r\n          }\r\n        }\r\n\r\n        if(result === false) {\r\n          return;\r\n        }\r\n\r\n        this.hide();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      return b.element = button;\r\n    });\r\n\r\n    if(!this.btnConfirmOnEnter && buttons.length === 2) {\r\n      const button = buttons.find((button) => !button.isCancel);\r\n      if(button) {\r\n        this.btnConfirmOnEnter = button.element;\r\n      }\r\n    }\r\n\r\n    if(buttons.length >= 3) {\r\n      buttonsDiv.classList.add('is-vertical-layout');\r\n    }\r\n\r\n    buttonsDiv.append(...buttonsElements);\r\n    this.container.append(buttonsDiv);\r\n  }\r\n\r\n  protected attachScrollableListeners(setClassOn?: HTMLElement) {\r\n    return this.scrollable.attachBorderListeners(setClassOn);\r\n  }\r\n\r\n  protected onContentUpdate() {\r\n    this.scrollable?.onAdditionalScroll?.();\r\n  }\r\n\r\n  public show() {\r\n    if(this.shown) {\r\n      return;\r\n    }\r\n\r\n    this.shown = true;\r\n    this.navigationItem = {\r\n      type: 'popup',\r\n      onPop: () => {\r\n        if(this.isConfirmationNeededOnClose) {\r\n          const result = this.isConfirmationNeededOnClose();\r\n          if(result) {\r\n            Promise.resolve(result).then(() => {\r\n              this.destroy();\r\n            });\r\n\r\n            return false;\r\n          }\r\n        }\r\n\r\n        return this.destroy();\r\n      }\r\n    };\r\n\r\n    appNavigationController.pushItem(this.navigationItem);\r\n\r\n    blurActiveElement(); // * hide mobile keyboard\r\n    appendPopupTo.append(this.element);\r\n    void this.element.offsetWidth; // reflow\r\n    this.element.classList.add('active');\r\n\r\n    this.onContentUpdate();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = true;\r\n      animationIntersector.checkAnimations2(true);\r\n    }\r\n\r\n    // cannot add event instantly because keydown propagation will fire it\r\n    // if(this.btnConfirmOnEnter) {\r\n    setTimeout(() => {\r\n      if(!this.element.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      this.listenerSetter.add(document.body)('keydown', (e) => {\r\n        if(!this.btnConfirmOnEnter ||\r\n          (this.btnConfirmOnEnter as HTMLButtonElement).disabled ||\r\n          PopupElement.POPUPS[PopupElement.POPUPS.length - 1] !== this) {\r\n          return;\r\n        }\r\n\r\n        if(this.confirmShortcutIsSendShortcut ? isSendShortcutPressed(e) : e.key === 'Enter') {\r\n          simulateClickEvent(this.btnConfirmOnEnter);\r\n          cancelEvent(e);\r\n        }\r\n      });\r\n    }, 0);\r\n    // }\r\n  }\r\n\r\n  public hide() {\r\n    if(this.destroyed || !this.navigationItem) {\r\n      return;\r\n    }\r\n\r\n    appNavigationController.backByItem(this.navigationItem);\r\n  }\r\n\r\n  public hideWithCallback = (callback: () => void) => {\r\n    this.addEventListener('closeAfterTimeout', callback as any);\r\n    this.hide();\r\n  };\r\n\r\n  public forceHide() {\r\n    return this.destroy();\r\n  }\r\n\r\n  protected destroy() {\r\n    if(this.destroyed) {\r\n      return;\r\n    }\r\n\r\n    this.destroyed = true;\r\n    this.dispatchEvent<PopupListeners>('close');\r\n    this.element.classList.add('hiding');\r\n    this.element.classList.remove('active');\r\n    this.listenerSetter.removeAll();\r\n    this.middlewareHelper.destroy();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = false;\r\n    }\r\n\r\n    appNavigationController.removeItem(this.navigationItem);\r\n    this.navigationItem = undefined;\r\n\r\n    indexOfAndSplice(PopupElement.POPUPS, this);\r\n\r\n    // ! calm\r\n    onFullScreenChange();\r\n\r\n    setTimeout(() => {\r\n      this.element.remove();\r\n      this.dispatchEvent<PopupListeners>('closeAfterTimeout');\r\n      this.cleanup();\r\n      this.scrollable?.destroy();\r\n\r\n      if(!this.withoutOverlay) {\r\n        animationIntersector.checkAnimations2(false);\r\n      }\r\n    }, 250);\r\n  }\r\n\r\n  protected appendSolid(callback: () => JSX.Element) {\r\n    const div = document.createElement('div');\r\n    (this.scrollable || this.body).prepend(div);\r\n    const dispose = render(callback, div);\r\n    this.addEventListener('closeAfterTimeout', dispose as any);\r\n  }\r\n\r\n  public static reAppend() {\r\n    this.POPUPS.forEach((popup) => {\r\n      const {element, container} = popup;\r\n      const parentElement = element.parentElement;\r\n      if(parentElement && parentElement !== appendPopupTo && appendPopupTo !== container) {\r\n        appendPopupTo.append(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  public static getPopups<T extends PopupElement>(popupConstructor: PopupElementConstructable<T>) {\r\n    return this.POPUPS.filter((element) => element instanceof popupConstructor) as T[];\r\n  }\r\n\r\n  public static createPopup<T extends /* PopupElement */any, A extends Array<any>>(ctor: {new(...args: A): T}, ...args: A) {\r\n    const popup = new ctor(...args);\r\n    return popup;\r\n  }\r\n}\r\n\r\nexport const addCancelButton = (buttons: PopupButton[]) => {\r\n  const button = buttons.find((b) => b.isCancel);\r\n  if(!button) {\r\n    buttons.push({\r\n      langKey: 'Cancel',\r\n      isCancel: true\r\n    });\r\n  }\r\n\r\n  return buttons;\r\n};\r\n","export const MIN_SIDEBAR_WIDTH = 308;\r\nexport const MAX_SIDEBAR_WIDTH = 420;\r\nexport const SIDEBAR_COLLAPSE_FACTOR = 0.65;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n/* @refresh reload */\r\n\r\nimport App from './config/app';\r\nimport blurActiveElement from './helpers/dom/blurActiveElement';\r\nimport {IS_STICKY_INPUT_BUGGED} from './helpers/dom/fixSafariStickyInputFocusing';\r\nimport loadFonts from './helpers/dom/loadFonts';\r\nimport IS_EMOJI_SUPPORTED from './environment/emojiSupport';\r\nimport {IS_ANDROID, IS_APPLE, IS_APPLE_MOBILE, IS_FIREFOX, IS_MOBILE, IS_MOBILE_SAFARI, IS_SAFARI} from './environment/userAgent';\r\nimport './materialize.scss';\r\nimport './scss/style.scss';\r\nimport pause from './helpers/schedulers/pause';\r\nimport setWorkerProxy from './helpers/setWorkerProxy';\r\nimport toggleAttributePolyfill from './helpers/dom/toggleAttributePolyfill';\r\nimport rootScope from './lib/rootScope';\r\nimport IS_TOUCH_SUPPORTED from './environment/touchSupport';\r\nimport I18n, {i18n} from './lib/langPack';\r\nimport './helpers/peerIdPolyfill';\r\nimport './lib/polyfill';\r\nimport apiManagerProxy from './lib/mtproto/mtprotoworker';\r\nimport getProxiedManagers from './lib/appManagers/getProxiedManagers';\r\nimport themeController from './helpers/themeController';\r\nimport overlayCounter from './helpers/overlayCounter';\r\nimport singleInstance, {InstanceDeactivateReason} from './lib/mtproto/singleInstance';\r\nimport {parseUriParamsLine} from './helpers/string/parseUriParams';\r\nimport Modes from './config/modes';\r\nimport {AuthState} from './types';\r\nimport DEBUG, {IS_BETA} from './config/debug';\r\nimport IS_INSTALL_PROMPT_SUPPORTED from './environment/installPrompt';\r\nimport cacheInstallPrompt from './helpers/dom/installPrompt';\r\nimport {fillLocalizedDates} from './helpers/date';\r\nimport {nextRandomUint} from './helpers/random';\r\nimport {IS_OVERLAY_SCROLL_SUPPORTED, USE_CUSTOM_SCROLL, USE_NATIVE_SCROLL} from './environment/overlayScrollSupport';\r\nimport IMAGE_MIME_TYPES_SUPPORTED, {IMAGE_MIME_TYPES_SUPPORTED_PROMISE} from './environment/imageMimeTypesSupport';\r\nimport MEDIA_MIME_TYPES_SUPPORTED from './environment/mediaMimeTypesSupport';\r\nimport {doubleRaf} from './helpers/schedulers';\r\nimport {getCurrentAccount} from './lib/accounts/getCurrentAccount';\r\nimport AccountController from './lib/accounts/accountController';\r\nimport {changeAccount} from './lib/accounts/changeAccount';\r\nimport {MAX_ACCOUNTS_FREE, MAX_ACCOUNTS_PREMIUM} from './lib/accounts/constants';\r\nimport sessionStorage from './lib/sessionStorage';\r\nimport replaceChildrenPolyfill from './helpers/dom/replaceChildrenPolyfill';\r\nimport listenForWindowPrint from './helpers/dom/windowPrint';\r\nimport cancelImageEvents from './helpers/dom/cancelImageEvents';\r\nimport PopupElement from './components/popups';\r\nimport appRuntimeManager from './lib/appManagers/appRuntimeManager';\r\nimport PasscodeLockScreenController from './components/passcodeLock/passcodeLockScreenController'; PasscodeLockScreenController;\r\nimport type {LangPackDifference} from './layer';\r\nimport commonStateStorage from './lib/commonStateStorage';\r\nimport {MAX_SIDEBAR_WIDTH, MIN_SIDEBAR_WIDTH, SIDEBAR_COLLAPSE_FACTOR} from './components/sidebarLeft/constants';\r\n\r\n// import commonStateStorage from './lib/commonStateStorage';\r\n// import { STATE_INIT } from './config/state';\r\n\r\n// if(DEBUG) {\r\n//   (async() => {\r\n//     const {attachDevtoolsOverlay} = await import('@solid-devtools/overlay');\r\n\r\n//     attachDevtoolsOverlay();\r\n//   })();\r\n// }\r\n\r\n\r\nIMAGE_MIME_TYPES_SUPPORTED_PROMISE.then((mimeTypes) => {\r\n  mimeTypes.forEach((mimeType) => {\r\n    IMAGE_MIME_TYPES_SUPPORTED.add(mimeType);\r\n    MEDIA_MIME_TYPES_SUPPORTED.add(mimeType);\r\n  });\r\n\r\n  console.log('Supported image mime types', IMAGE_MIME_TYPES_SUPPORTED);\r\n  apiManagerProxy.sendEnvironment();\r\n});\r\n\r\n// * Randomly choose a version if user came from a search engine\r\nfunction randomlyChooseVersionFromSearch() {\r\n  try {\r\n    if(\r\n      App.isMainDomain &&\r\n      document.referrer &&\r\n      /(^|\\.)(google|bing|duckduckgo|ya|yandex)\\./i.test(new URL(document.referrer).host)\r\n    ) {\r\n      const version = localStorage.getItem('kz_version');\r\n      if(version === 'Z' || nextRandomUint(8) > 127) {\r\n        localStorage.setItem('kz_version', 'Z');\r\n        location.href = 'https://web.telegram.org/a/';\r\n      } else {\r\n        localStorage.setItem('kz_version', 'K');\r\n      }\r\n    }\r\n  } catch(err) {}\r\n}\r\n\r\nfunction setManifest() {\r\n  const manifest = document.getElementById('manifest') as HTMLLinkElement;\r\n  if(manifest) manifest.href = `site${IS_APPLE && !IS_APPLE_MOBILE ? '_apple' : ''}.webmanifest?v=jw3mK7G9Aq`;\r\n}\r\n\r\nfunction setViewportHeightListeners() {\r\n  // We listen to the resize event (https://css-tricks.com/the-trick-to-viewport-units-on-mobile/)\r\n  const w = window.visualViewport || window; // * handle iOS keyboard\r\n  let setViewportVH = false/* , hasFocus = false */;\r\n  let lastVH: number;\r\n  const setVH = () => {\r\n    let vh = (setViewportVH && !overlayCounter.isOverlayActive ? (w as VisualViewport).height || (w as Window).innerHeight : window.innerHeight) * 0.01;\r\n    vh = +vh.toFixed(2);\r\n    if(lastVH === vh) {\r\n      return;\r\n    } else if(IS_TOUCH_SUPPORTED && lastVH < vh && (vh - lastVH) > 1) {\r\n      blurActiveElement(); // (Android) fix blurring inputs when keyboard is being closed (e.g. closing keyboard by back arrow and touching a bubble)\r\n    }\r\n\r\n    lastVH = vh;\r\n\r\n    // const vh = document.documentElement.scrollHeight * 0.01;\r\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\r\n\r\n    // console.log('setVH', vh, setViewportVH ? w : window);\r\n\r\n    /* if(setViewportVH && userAgent.isSafari && touchSupport.isTouchSupported && document.activeElement && (document.activeElement as HTMLElement).blur) {\r\n      const rect = document.activeElement.getBoundingClientRect();\r\n      if(rect.top < 0 || rect.bottom >= (w as any).height) {\r\n        fastSmoothScroll(findUpClassName(document.activeElement, 'scrollable-y') || window as any, document.activeElement as HTMLElement, 'center', 4, undefined, FocusDirection.Static);\r\n      }\r\n    } */\r\n  };\r\n\r\n  window.addEventListener('resize', setVH);\r\n  setVH();\r\n\r\n  if(IS_STICKY_INPUT_BUGGED) {\r\n    const toggleResizeMode = () => {\r\n      setViewportVH = tabId === 1 && IS_STICKY_INPUT_BUGGED && !overlayCounter.isOverlayActive;\r\n      setVH();\r\n\r\n      if(w !== window) {\r\n        if(setViewportVH) {\r\n          window.removeEventListener('resize', setVH);\r\n          w.addEventListener('resize', setVH);\r\n        } else {\r\n          w.removeEventListener('resize', setVH);\r\n          window.addEventListener('resize', setVH);\r\n        }\r\n      }\r\n    };\r\n\r\n    let tabId: number;\r\n    (window as any).onImTabChange = (id: number) => {\r\n      const wasTabId = tabId !== undefined;\r\n      tabId = id;\r\n\r\n      if(wasTabId || tabId === 1) {\r\n        toggleResizeMode();\r\n      }\r\n    };\r\n\r\n    overlayCounter.addEventListener('change', () => {\r\n      toggleResizeMode();\r\n    });\r\n  }\r\n}\r\n\r\nfunction setSidebarLeftWidth() {\r\n  const sidebarEl = document.getElementById('column-left');\r\n  const storedWidth = localStorage.getItem('sidebar-left-width');\r\n\r\n  let validatedWidth = parseInt(storedWidth);\r\n  validatedWidth = isNaN(validatedWidth) ? undefined : validatedWidth;\r\n\r\n  if(validatedWidth > MAX_SIDEBAR_WIDTH) validatedWidth = MAX_SIDEBAR_WIDTH;\r\n  else if(validatedWidth < MIN_SIDEBAR_WIDTH * SIDEBAR_COLLAPSE_FACTOR) validatedWidth = 0;\r\n  else if(validatedWidth < MIN_SIDEBAR_WIDTH) validatedWidth = MIN_SIDEBAR_WIDTH;\r\n\r\n  if(typeof validatedWidth === 'number' && String(validatedWidth) !== storedWidth)\r\n    localStorage.setItem('sidebar-left-width', validatedWidth + '');\r\n\r\n  if(validatedWidth === 0) {\r\n    sidebarEl.classList.add('is-collapsed');\r\n  } else if(validatedWidth) {\r\n    document.documentElement.style.setProperty('--current-sidebar-left-width', validatedWidth + 'px');\r\n  }\r\n}\r\n\r\nfunction setRootClasses() {\r\n  const add: string[] = [];\r\n\r\n  if(IS_EMOJI_SUPPORTED) {\r\n    add.push('native-emoji');\r\n  }\r\n\r\n  if(USE_NATIVE_SCROLL) {\r\n    add.push('native-scroll');\r\n  } else if(IS_OVERLAY_SCROLL_SUPPORTED) {\r\n    add.push('overlay-scroll');\r\n  } else if(USE_CUSTOM_SCROLL) {\r\n    add.push('custom-scroll');\r\n  }\r\n\r\n  // root.style.setProperty('--quote-icon', `\"${getIconContent('quote')}\"`);\r\n\r\n  if(IS_FIREFOX) {\r\n    add.push('is-firefox', 'no-backdrop');\r\n  }\r\n\r\n  if(IS_MOBILE) {\r\n    add.push('is-mobile');\r\n  }\r\n\r\n  if(IS_APPLE) {\r\n    if(IS_SAFARI) {\r\n      add.push('is-safari');\r\n    }\r\n\r\n    // root.classList.add('emoji-supported');\r\n\r\n    if(IS_APPLE_MOBILE) {\r\n      add.push('is-ios');\r\n    } else {\r\n      add.push('is-mac');\r\n    }\r\n  } else if(IS_ANDROID) {\r\n    add.push('is-android');\r\n\r\n    // force losing focus on input blur\r\n    // focusin and focusout are not working on mobile\r\n\r\n    // const onInResize = () => {\r\n    //   hasFocus = true;\r\n    //   window.addEventListener('resize', onOutResize, {once: true});\r\n    // };\r\n\r\n    // const onOutResize = () => {\r\n    //   hasFocus = false;\r\n    //   blurActiveElement();\r\n    // };\r\n\r\n    // let hasFocus = false;\r\n    // document.addEventListener('touchend', (e) => {\r\n    //   const input = (e.target as HTMLElement).closest('[contenteditable=\"true\"], input');\r\n    //   if(!input) {\r\n    //     return;\r\n    //   }\r\n\r\n    //   if(document.activeElement !== input && !hasFocus) {\r\n    //     console.log('input click', e, document.activeElement, input, input.matches(':focus'));\r\n    //     window.addEventListener('resize', onInResize, {once: true});\r\n    //   }\r\n    // });\r\n  }\r\n\r\n  if(!IS_TOUCH_SUPPORTED) {\r\n    add.push('no-touch');\r\n  } else {\r\n    add.push('is-touch');\r\n    /* document.addEventListener('touchmove', (event: any) => {\r\n      event = event.originalEvent || event;\r\n      if(event.scale && event.scale !== 1) {\r\n        event.preventDefault();\r\n      }\r\n    }, {capture: true, passive: false}); */\r\n  }\r\n\r\n  document.documentElement.classList.add(...add);\r\n}\r\n\r\nfunction onInstanceDeactivated(reason: InstanceDeactivateReason) {\r\n  const isUpdated = reason === 'version';\r\n  const popup = PopupElement.createPopup(PopupElement, 'popup-instance-deactivated', {overlayClosable: true});\r\n  const c = document.createElement('div');\r\n  c.classList.add('instance-deactivated-container');\r\n  (popup as any).container.replaceWith(c);\r\n\r\n  const header = document.createElement('div');\r\n  header.classList.add('header');\r\n  header.append(i18n(isUpdated ? 'Deactivated.Version.Title' : 'Deactivated.Title'));\r\n\r\n  const subtitle = document.createElement('div');\r\n  subtitle.classList.add('subtitle');\r\n  subtitle.append(i18n(isUpdated ? 'Deactivated.Version.Subtitle' : 'Deactivated.Subtitle'));\r\n\r\n  c.append(header, subtitle);\r\n\r\n  document.body.classList.add('deactivated');\r\n\r\n  const onClose = isUpdated ? () => {\r\n    appRuntimeManager.reload();\r\n  } : () => {\r\n    document.body.classList.add('deactivated-backwards');\r\n\r\n    singleInstance.activateInstance();\r\n\r\n    setTimeout(() => {\r\n      document.body.classList.remove('deactivated', 'deactivated-backwards');\r\n    }, 333);\r\n  };\r\n\r\n  popup.addEventListener('close', onClose);\r\n  popup.show();\r\n};\r\n\r\nconst TIME_LABEL = 'Elapsed time since unlocked';\r\n\r\nfunction setDocumentLangPackProperties(langPack: LangPackDifference.langPackDifference) {\r\n  if(langPack.lang_code === 'ar' || langPack.lang_code === 'fa' && IS_BETA && false) {\r\n    document.documentElement.classList.add('is-rtl');\r\n    document.documentElement.dir = 'rtl';\r\n    document.documentElement.lang = langPack.lang_code;\r\n    I18n.setRTL(true);\r\n  } else {\r\n    document.documentElement.dir = 'ltr';\r\n  }\r\n}\r\n\r\n/* false &&  */document.addEventListener('DOMContentLoaded', async() => {\r\n  const perf = performance.now();\r\n  randomlyChooseVersionFromSearch();\r\n  setSidebarLeftWidth();\r\n  toggleAttributePolyfill();\r\n  replaceChildrenPolyfill();\r\n  rootScope.managers = getProxiedManagers();\r\n  setManifest();\r\n  setViewportHeightListeners();\r\n  setWorkerProxy; // * just to import\r\n  listenForWindowPrint();\r\n  cancelImageEvents();\r\n  setRootClasses();\r\n\r\n  if(IS_INSTALL_PROMPT_SUPPORTED) {\r\n    cacheInstallPrompt();\r\n  }\r\n\r\n  await PasscodeLockScreenController.waitForUnlock(async() => {\r\n    rootScope.settings = await commonStateStorage.get('settings');\r\n    themeController.setThemeListener();\r\n\r\n    const langPack = await I18n.getCacheLangPack();\r\n    setDocumentLangPackProperties(langPack);\r\n\r\n    if(IS_BETA) import('./pages/pageIm'); // cache it\r\n    // const settings = await commonStateStorage.get('settings');\r\n    // const timeFormat =\r\n    // I18n.setTimeFormat(settings?.timeFormat || STATE_INIT.settings?.timeFormat);\r\n  });\r\n\r\n  console.time(TIME_LABEL);\r\n\r\n  // * (1) load states\r\n  // * (2) check app version\r\n  // * (3) send all states if updated\r\n  // * (4) exit if not updated\r\n\r\n  // * (1)\r\n  const allStates = await apiManagerProxy.loadAllStates();\r\n  const stateResult = allStates[getCurrentAccount()];\r\n\r\n  console.timeLog(TIME_LABEL, 'allStates loaded');\r\n\r\n  // * (2)\r\n  singleInstance.addEventListener('deactivated', onInstanceDeactivated);\r\n  await singleInstance.start();\r\n  console.timeLog(TIME_LABEL, 'singleInstance started');\r\n\r\n  const sendAllStatesPromise = singleInstance.deactivatedReason !== 'version' && apiManagerProxy.sendAllStates(allStates);\r\n  if(singleInstance.deactivatedReason) {\r\n    onInstanceDeactivated(singleInstance.deactivatedReason);\r\n  }\r\n\r\n  // * (3)\r\n  await sendAllStatesPromise;\r\n  console.timeLog(TIME_LABEL, 'sent all states (1)');\r\n\r\n  const langPack = await I18n.getCacheLangPack();\r\n  console.timeLog(TIME_LABEL, 'await I18n.getCacheLangPack()');\r\n  I18n.setTimeFormat(rootScope.settings.timeFormat);\r\n\r\n  // * (4)\r\n  if(!sendAllStatesPromise) {\r\n    return;\r\n  }\r\n\r\n  await apiManagerProxy.sendAllStates(allStates);\r\n\r\n  console.timeLog(TIME_LABEL, 'sent all states (2)');\r\n\r\n  document.body.classList.toggle('has-folders-sidebar', rootScope.settings.tabsInSidebar);\r\n\r\n  rootScope.managers.rootScope.getPremium().then((isPremium) => {\r\n    rootScope.premium = isPremium;\r\n  });\r\n\r\n  themeController.setThemeListener();\r\n\r\n  const setUnreadMessagesText = () => {\r\n    const text = I18n.format('UnreadMessages', true);\r\n    document.documentElement.style.setProperty('--unread-messages-text', `\"${text}\"`);\r\n  };\r\n\r\n  setUnreadMessagesText();\r\n  if(langPack.appVersion !== App.langPackVersion) {\r\n    I18n.getLangPack(langPack.lang_code).finally(setUnreadMessagesText);\r\n  } else {\r\n    fillLocalizedDates();\r\n  }\r\n\r\n  rootScope.addEventListener('language_change', (langCode) => {\r\n    I18n.getLangPack(langCode);\r\n    fillLocalizedDates();\r\n    setUnreadMessagesText();\r\n  });\r\n\r\n  /**\r\n   * won't fire if font is loaded too fast\r\n   */\r\n  function fadeInWhenFontsReady(elem: HTMLElement, promise: Promise<any>) {\r\n    elem.style.opacity = '0';\r\n\r\n    promise.then(() => {\r\n      window.requestAnimationFrame(() => {\r\n        elem.style.opacity = '';\r\n      });\r\n    });\r\n  }\r\n\r\n  console.log('got state, time:', performance.now() - perf);\r\n\r\n  await IMAGE_MIME_TYPES_SUPPORTED_PROMISE;\r\n\r\n  console.timeLog(TIME_LABEL, 'IMAGE_MIME_TYPES_SUPPORTED_PROMISE');\r\n\r\n\r\n  setDocumentLangPackProperties(langPack);\r\n\r\n  let authState = stateResult.state.authState;\r\n\r\n  const hash = location.hash;\r\n  const splitted = hash.split('?');\r\n  const params = parseUriParamsLine(splitted[1] ?? splitted[0].slice(1));\r\n  if(params.tgWebAuthToken && authState._ !== 'authStateSignedIn') {\r\n    const data: AuthState.signImport['data'] = {\r\n      token: params.tgWebAuthToken,\r\n      dcId: +params.tgWebAuthDcId,\r\n      userId: params.tgWebAuthUserId.toUserId(),\r\n      isTest: params.tgWebAuthTest !== undefined && !!+params.tgWebAuthTest,\r\n      tgAddr: params.tgaddr\r\n    };\r\n\r\n    if(data.isTest !== Modes.test) {\r\n      const urlSearchParams = new URLSearchParams(location.search);\r\n      if(+params.tgWebAuthTest) {\r\n        urlSearchParams.set('test', '1');\r\n      } else {\r\n        urlSearchParams.delete('test');\r\n      }\r\n\r\n      location.search = urlSearchParams.toString();\r\n      return;\r\n    }\r\n\r\n    rootScope.managers.appStateManager.pushToState('authState', authState = {_: 'authStateSignImport', data});\r\n\r\n    // appNavigationController.overrideHash('?tgaddr=' + encodeURIComponent(params.tgaddr));\r\n  }\r\n\r\n  if(authState._ !== 'authStateSignedIn'/*  || 1 === 1 */) {\r\n    console.log('Will mount auth page:', authState._, Date.now() / 1000);\r\n\r\n    (async() => {\r\n      const totalAccounts = await AccountController.getTotalAccounts();\r\n      const hasSomeonePremium = await apiManagerProxy.hasSomeonePremium();\r\n      const maxAccountNumber = hasSomeonePremium ? MAX_ACCOUNTS_PREMIUM : MAX_ACCOUNTS_FREE;\r\n\r\n      const currentAccount = getCurrentAccount();\r\n\r\n      if(currentAccount > Math.min(maxAccountNumber, totalAccounts + 1)) {\r\n        changeAccount(1);\r\n      }\r\n    })();\r\n\r\n    const el = document.getElementById('auth-pages');\r\n    let scrollable: HTMLElement;\r\n\r\n    let isEnteringAnimationFinished = false;\r\n\r\n    const finishEnteringAnimation = async() => {\r\n      if(isEnteringAnimationFinished) return;\r\n      isEnteringAnimationFinished = true;\r\n\r\n      await doubleRaf();\r\n      el.classList.add('auth-pages-entering');\r\n\r\n      await pause(1000); // Need a little more time for the animation to finish\r\n      el.classList.remove('auth-pages-enter', 'auth-pages-entering');\r\n    }\r\n\r\n    if(el) {\r\n      if(await sessionStorage.get('should_animate_auth')) {\r\n        await sessionStorage.delete('should_animate_auth');\r\n        el.classList.add('auth-pages-enter');\r\n\r\n        // Just in case\r\n        pause(1000).then(() => finishEnteringAnimation());\r\n      }\r\n\r\n      scrollable = el.querySelector('.scrollable') as HTMLElement;\r\n      if((!IS_TOUCH_SUPPORTED || IS_MOBILE_SAFARI)) {\r\n        scrollable.classList.add('no-scrollbar');\r\n      }\r\n\r\n      // * don't remove this line\r\n      scrollable.style.opacity = '0';\r\n\r\n      const placeholder = document.createElement('div');\r\n      placeholder.classList.add('auth-placeholder');\r\n\r\n      scrollable.prepend(placeholder);\r\n      scrollable.append(placeholder.cloneNode());\r\n    }\r\n\r\n    try {\r\n      await Promise.all([\r\n        import('./lib/mtproto/telegramMeWebManager'),\r\n        import('./lib/mtproto/webPushApiManager')\r\n      ]).then(([meModule, pushModule]) => {\r\n        meModule.default.setAuthorized(false);\r\n        pushModule.default.forceUnsubscribe();\r\n      });\r\n    } catch(err) {\r\n\r\n    }\r\n\r\n    let pagePromise: Promise<void>;\r\n    // langPromise.then(async() => {\r\n    switch(authState._) {\r\n      case 'authStateSignIn':\r\n        pagePromise = (await import('./pages/pageSignIn')).default.mount();\r\n        break;\r\n      case 'authStateSignQr':\r\n        pagePromise = (await import('./pages/pageSignQR')).default.mount();\r\n        break;\r\n      case 'authStateAuthCode':\r\n        pagePromise = (await import('./pages/pageAuthCode')).default.mount(authState.sentCode);\r\n        break;\r\n      case 'authStatePassword':\r\n        pagePromise = (await import('./pages/pagePassword')).default.mount();\r\n        break;\r\n      case 'authStateSignUp':\r\n        pagePromise = (await import('./pages/pageSignUp')).default.mount(authState.authCode);\r\n        break;\r\n      case 'authStateSignImport':\r\n        pagePromise = (await import('./pages/pageSignImport')).default.mount(authState.data);\r\n        break;\r\n    }\r\n    // });\r\n\r\n    if(scrollable) {\r\n      // wait for text appear\r\n      if(pagePromise) {\r\n        await pagePromise;\r\n      }\r\n\r\n      const promise = 'fonts' in document ?\r\n        Promise.race([\r\n          pause(1000),\r\n          document.fonts.ready\r\n        ]) :\r\n        Promise.resolve();\r\n\r\n      promise.then(async() => {\r\n        await pause(20);\r\n        finishEnteringAnimation();\r\n      });\r\n\r\n      fadeInWhenFontsReady(scrollable, promise);\r\n    }\r\n\r\n    /* setTimeout(async() => {\r\n      (await import('./pages/pageAuthCode')).default.mount({\r\n        \"_\": \"auth.sentCode\",\r\n        \"pFlags\": {},\r\n        \"flags\": 6,\r\n        \"type\": {\r\n          \"_\": \"auth.sentCodeTypeSms\",\r\n          \"length\": 5\r\n        },\r\n        \"phone_code_hash\": \"\",\r\n        \"next_type\": {\r\n          \"_\": \"auth.codeTypeCall\"\r\n        },\r\n        \"timeout\": 120,\r\n        \"phone_number\": \"\"\r\n      });\r\n\r\n      (await import('./pages/pageSignQR')).default.mount();\r\n\r\n      (await import('./pages/pagePassword')).default.mount();\r\n\r\n      (await import('./pages/pageSignUp')).default.mount({\r\n        \"phone_code_hash\": \"\",\r\n        \"phone_number\": \"\"\r\n      });\r\n    }, 500); */\r\n  } else {\r\n    console.log('Will mount IM page:', Date.now() / 1000);\r\n\r\n    const fontsPromise = loadFonts();\r\n    fadeInWhenFontsReady(document.getElementById('main-columns'), fontsPromise);\r\n\r\n    const [page, shouldAnimate] = await Promise.all([\r\n      import('./pages/pageIm').then((module) => module.default),\r\n      sessionStorage.get('should_animate_main')\r\n    ]);\r\n    if(shouldAnimate) {\r\n      await sessionStorage.delete('should_animate_main');\r\n      page.pageEl.classList.add('main-screen-enter');\r\n\r\n      console.log('[my-debug] mounting page');\r\n      await page.mount();\r\n      console.timeLog(TIME_LABEL, 'await page.mount()');\r\n\r\n      await fontsPromise;\r\n      console.timeLog(TIME_LABEL, 'await fontsPromise');\r\n\r\n\r\n      await doubleRaf();\r\n      page.pageEl.classList.add('main-screen-entering');\r\n      await pause(200);\r\n\r\n      page.pageEl.classList.remove('main-screen-enter', 'main-screen-entering');\r\n    } else {\r\n      await page.mount();\r\n    }\r\n  }\r\n});\r\n"],"file":"index-CTd46-d9.js"}